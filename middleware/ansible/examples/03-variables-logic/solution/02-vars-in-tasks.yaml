# =============================================================================
# 02-vars-in-tasks.yaml - Using Variables in Tasks
# =============================================================================
#
# CONCEPT: Use {{ variable }} syntax in task parameters
#
# What's new from 01:
#   + Using variables in different contexts
#   + String interpolation
#   + Variable in file paths, commands, templates
#
# Important:
#   - Always quote strings containing {{ }}
#   - Use | filters to transform values
#
# Compare with previous:
#   diff 01-inline-vars.yaml 02-vars-in-tasks.yaml
#
# =============================================================================
---
- name: Using variables in tasks
  hosts: localhost
  connection: local
  gather_facts: false

  vars:
    app_name: myapp
    app_version: "1.2.3"
    base_path: /opt
    env: production

  tasks:
    # String interpolation
    # 文字列補間
    - name: Build full path from variables
      ansible.builtin.debug:
        msg: "Full path: {{ base_path }}/{{ app_name }}/{{ app_version }}"

    # Variable in file path (must be quoted!)
    # ファイルパスでの変数使用（引用符必須！）
    - name: Create application directory
      ansible.builtin.file:
        path: "{{ base_path }}/{{ app_name }}"
        state: directory
        mode: '0755'
      check_mode: true  # Don't actually create

    # Using filters
    # フィルターの使用
    - name: Show uppercase app name
      ansible.builtin.debug:
        msg: "{{ app_name | upper }}"

    - name: Show default value if variable is undefined
      ansible.builtin.debug:
        msg: "Region: {{ region | default('ap-northeast-1') }}"

    # Combining variables in a template-like way
    # テンプレート的な変数の組み合わせ
    - name: Build configuration string
      ansible.builtin.debug:
        msg: |
          Configuration:
            App: {{ app_name }}
            Version: {{ app_version }}
            Environment: {{ env }}
            Path: {{ base_path }}/{{ app_name }}

    # Using variables in conditionals (preview - more in 04)
    # 条件式での変数使用（プレビュー）
    - name: Only run in production
      ansible.builtin.debug:
        msg: "This is production!"
      when: env == "production"
