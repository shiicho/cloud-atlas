# 00 · HULFT 概念与架构（vs SFTP/FTPS Comparison）

> **目标**：理解 HULFT store-and-forward 与传统文件传输的核心区别
> **前置**：Linux 基础知识（文件系统、权限）
> **适用**：日本 SIer/银行 IT 岗位面试准备
> **时长**：约 30 分钟

## 为什么学 HULFT？

在日本 IT 就业市场，**HULFT** 是一个绕不开的关键词：

- **82.6%** 日本国内市场占有率
- **100%** 日本银行采用 HULFT
- 面试标配问题：「HULFT経験ありますか？」（你有 HULFT 经验吗？）

目前**零中文教程**覆盖这个领域 —— 这正是本系列的价值所在。

## 将完成的内容

1. 理解 Store-and-Forward 与 SFTP 流式传输的本质区别
2. 掌握 HULFT 核心术语（日语/英语）
3. 认识日本银行典型 HULFT 网络拓扑
4. 准备两道面试常见问题

---

## Step 1 — 理解 Store-and-Forward 模型

### 什么是 Store-and-Forward？

**Store-and-Forward**（存储转发）是 HULFT 的核心传输模型：

```
发送方                                          接收方
┌─────────────────┐                      ┌─────────────────┐
│  1. 写入本地    │                      │                 │
│     Spool 队列  │ ──── 传输通道 ────→  │  3. 确认后      │
│                 │                      │     才暴露文件  │
│  2. 等待确认    │ ←─── 确认信号 ────   │                 │
└─────────────────┘                      └─────────────────┘
```

**关键特性：**
- 文件先写入本地 **spool（队列）**
- 传输完成后，接收方发送 **确认信号**
- 接收方 **确认后才暴露文件** 给下游应用
- 支持 **CRC 校验、序列号、自动重试、断点续传**

### SFTP 对比：流式传输的问题

**SFTP（Streaming）** 直接将数据流写入目标：

```
发送方                                          接收方
┌─────────────────┐                      ┌─────────────────┐
│                 │ ──── 数据流 ──────→  │  直接写入目标   │
│  直接发送       │                      │  文件           │
│                 │        ✗ 中断！      │                 │
└─────────────────┘        ↓             └─────────────────┘
                    ┌─────────────┐
                    │ 部分文件！  │  ← 需要人工清理
                    │ 无法恢复    │
                    └─────────────┘
```

**问题场景：网络中断**

| 场景 | SFTP | HULFT |
|------|------|-------|
| 传输中断 | 产生**部分文件**，需人工清理 | 文件**不暴露**，干净状态 |
| 恢复方式 | 手动重传整个文件 | **自动重试**，从断点续传 |
| 重复风险 | 可能产生重复文件 | **序列号去重**，保证唯一交付 |

> 💡 **面试要点 #1**
>
> **问题**：「HULFTのStore-and-Forward方式は、転送中にリンクが切断された場合、SFTPと比較してどのように部分ファイルの露出を防ぐのですか？」
>
> （中文参考：HULFT 的 Store-and-Forward 模式在传输中断时，相比 SFTP 如何避免部分文件暴露？）
>
> **期望回答**：
> - SFTP 直接流式写入目标，中断 = 部分文件，需要人工清理
> - HULFT 先写入本地 spool，**只有确认后才暴露文件**
> - 自动从 checkpoint 续传，序列号防止重复

---

## Step 2 — 掌握 HULFT 核心术语

在日本 IT 现场和面试中，以下术语是**必须掌握**的：

### 基础术语

| 日语 | 读音 | 英语 | 含义 |
|------|------|------|------|
| **送信** | そうしん (soushin) | Send | 发送方发起传输 |
| **受信** | じゅしん (jushin) | Receive | 接收方接受传输 |
| **集信** | しゅうしん (shushin) | Pull | **接收方发起**拉取（重要！） |
| **配信** | はいしん (haishin) | Push/Distribute | 发送方推送到多个下游 |

### 重要概念

| 日语 | 含义 |
|------|------|
| **転送グループ** | Transfer Group - 批量传输的逻辑分组，支持顺序、条件 |
| **管理情報** | Management Info - 用于去重、续传的元数据 |
| **スプール** | Spool - 本地队列目录 |

### 集信 vs 配信：安全设计的关键

```
┌─────────────────────────────────────────────────────────────┐
│                        集信（Pull）模式                      │
│                                                             │
│   外部伙伴        DMZ HULFT        Core HULFT               │
│   ┌─────┐         ┌─────┐          ┌─────┐                 │
│   │     │ ──放置→ │     │ ←─拉取── │     │                 │
│   └─────┘         └─────┘          └─────┘                 │
│                                       ↑                     │
│                              Core 发起连接                  │
│                              DMZ 无需开放入站               │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                        配信（Push）模式                      │
│                                                             │
│   Core HULFT                      下游系统 A/B/C            │
│   ┌─────┐                         ┌─────┐                  │
│   │     │ ──推送到多个下游──────→ │     │                  │
│   └─────┘                         └─────┘                  │
│      ↑                                                      │
│   发送方发起                                                │
└─────────────────────────────────────────────────────────────┘
```

**为什么银行偏好集信（Pull）？**
- 避免从外部网络开放入站端口到核心系统
- Core 系统控制何时拉取数据
- 符合银行安全策略（最小权限原则）

> 💡 **面试要点 #2**
>
> **问题**：「銀行のDMZ-Core設計において、集信と配信の違いと、それぞれをどのような場面で使用するか説明してください。」
>
> （中文参考：在银行 DMZ-Core 设计中，集信和配信的区别是什么？各自在什么场景使用？）
>
> **期望回答**：
> - **集信（Pull）**：接收方发起，用于 DMZ→Core，避免向 DMZ 开放入站端口
> - **配信（Push）**：发送方发起，用于 Core→下游分发
> - 银行因安全策略偏好集信模式处理外部连接

---

## Step 3 — 日本银行典型 HULFT 拓扑

理解真实银行环境的 HULFT 部署架构：

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         日本银行典型 HULFT 拓扑                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────┐      ┌─────────────┐      ┌─────────────┐                 │
│  │  Mainframe  │──────│  Core HULFT │──────│  DMZ HULFT  │────→ 外部连接   │
│  │   (z/OS)    │      │  (AIX HA)   │      │  (Linux)    │                 │
│  │             │      │             │      │             │                 │
│  │  EBCDIC     │      │  UTF-8      │      │  中継节点   │                 │
│  └─────────────┘      └─────────────┘      └─────────────┘                 │
│                              │                                              │
│                              │                                              │
│                       ┌──────┴──────┐                                       │
│                       │    JP1      │                                       │
│                       │  Scheduler  │  ← 作业调度器（90%+ 银行使用）        │
│                       │             │                                       │
│                       └─────────────┘                                       │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│  设计要点：                                                                  │
│  • Core: AIX/Linux HA 双机热备                                              │
│  • DMZ: 作为外部连接的中继节点                                               │
│  • 防火墙: 严格单向流控制                                                    │
│  • 集信: 从 Core 拉取，避免入站开放                                          │
│  • JP1: 控制批处理作业时序                                                   │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 典型数据流场景

**场景 1：日次バッチ（日结批处理）**
```
Mainframe (EBCDIC) → Core HULFT (编码转换) → 分行报表系统
                         ↓
                    JP1 23:00 触发
```

**场景 2：全銀ファイル（银行间清算）**
```
外部银行 → DMZ HULFT (中继) ← 集信 ← Core HULFT → 勘定系統
                                                (核心银行系统)
```

**场景 3：カード認証（信用卡授权）**
```
卡组织 → DMZ HULFT ← 集信 ← Core → 实时授权处理
```

---

## Step 4 — 实践：对比 HULFT vs SFTP 恢复场景

### 思考练习

想象以下场景：

**场景**：100MB 的日结报表正在传输，传输到 60% 时网络中断 5 分钟后恢复。

| 问题 | SFTP 会怎样？ | HULFT 会怎样？ |
|------|---------------|----------------|
| 目标文件状态 | ？ | ？ |
| 恢复方式 | ？ | ？ |
| 下游应用影响 | ？ | ？ |

<details>
<summary>点击查看答案</summary>

| 问题 | SFTP | HULFT |
|------|------|-------|
| 目标文件状态 | 60MB 部分文件已存在 | 文件不暴露，干净状态 |
| 恢复方式 | 人工删除 + 重传整个文件 | 自动从 60% 断点续传 |
| 下游应用影响 | 可能读到损坏数据 | 无影响，等传输完成后才可见 |

</details>

### 绘制你的拓扑图

基于你所在（或目标）公司的环境，尝试绘制 HULFT 拓扑图：

1. **识别节点**：有哪些系统需要文件传输？
2. **确定方向**：哪些是 Push，哪些是 Pull？
3. **安全边界**：DMZ 在哪里？防火墙规则？
4. **调度集成**：用什么作业调度器？

---

## 常见误区

| 误区 | 正确理解 |
|------|----------|
| 「HULFT 就是带重试的 SFTP」 | **完全不同的模型**：Store-and-Forward vs Streaming |
| 混淆 送信/受信 和 集信/配信 | 送信/受信 = **传输方向**；集信/配信 = **谁发起** |
| 认为 HULFT 只用于银行 | 广泛应用于制造、零售、物流等行业 |

---

## 小结

本课学习了：

| 概念 | 要点 |
|------|------|
| Store-and-Forward | 先存队列，确认后才暴露，保证数据完整性 |
| SFTP 对比 | Streaming 直写有部分文件风险 |
| 核心术语 | 送信/受信（方向）、集信/配信（发起方） |
| 银行拓扑 | Core HA + DMZ 中继 + JP1 调度 |

---

## 下一步

完成本课后，请继续：

- **[01 · 网络拓扑与安全基础（端口/防火墙/服务账户）](../01-network-security/)** — 学习 HULFT 端口配置和安全设计

---

## 系列导航 / Series Nav

| 课程 | 主题 |
|------|------|
| **00 · 概念与架构** | ← 当前课程 |
| 01 · 网络与安全 | 端口、防火墙、服务账户 |
| 02 · 安装配置 | HULFT8 双节点 Lab |
| 03 · 字符编码 | SJIS↔UTF-8, EBCDIC |
| 04 · 集信/配信实战 | 传输组、重试机制 |
| 05 · 作业联动 | JP1 集成、日志分析 |
| 06 · 云迁移 | HULFT Square, AWS VPC |
