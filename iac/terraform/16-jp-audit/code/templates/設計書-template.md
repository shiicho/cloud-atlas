# インフラ構成設計書

---

## 1. ドキュメント管理情報

| 項目 | 内容 |
|------|------|
| プロジェクト名 | {PROJECT_NAME} |
| システム名 | {SYSTEM_NAME} |
| 環境 | production / staging / development |
| 作成日 | YYYY-MM-DD |
| 作成者 | {AUTHOR_NAME} |
| 承認者 | {APPROVER_NAME} |
| 版数 | 1.0 |

### 改訂履歴

| 版数 | 日付 | 変更内容 | 変更者 |
|------|------|----------|--------|
| 1.0 | YYYY-MM-DD | 初版作成 | {AUTHOR_NAME} |
| | | | |

---

## 2. システム概要

### 2.1 システムの目的

{システムの目的・背景を記載}

### 2.2 システム構成概要

{システムの全体像を簡潔に記載}

---

## 3. システム構成図

### 3.1 全体構成図

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              AWS Cloud                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   ┌─────────────────────────────────────────────────────────────────┐  │
│   │                        VPC (10.0.0.0/16)                         │  │
│   │                                                                   │  │
│   │   ┌─────────────────────┐     ┌─────────────────────┐           │  │
│   │   │   Public Subnet     │     │   Private Subnet    │           │  │
│   │   │   (10.0.1.0/24)     │     │   (10.0.2.0/24)     │           │  │
│   │   │                     │     │                     │           │  │
│   │   │   ┌───────────┐     │     │   ┌───────────┐     │           │  │
│   │   │   │    ALB    │     │     │   │    EC2    │     │           │  │
│   │   │   └───────────┘     │     │   └───────────┘     │           │  │
│   │   │                     │     │                     │           │  │
│   │   └─────────────────────┘     └─────────────────────┘           │  │
│   │                                                                   │  │
│   └─────────────────────────────────────────────────────────────────┘  │
│                                                                         │
│   ┌─────────────────────┐                                              │
│   │        RDS          │                                              │
│   │   (db.t3.medium)    │                                              │
│   └─────────────────────┘                                              │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 ネットワーク構成図

{ネットワーク詳細図を挿入}

---

## 4. リソース一覧

### 4.1 コンピュート

| リソース名 | タイプ | スペック | 台数 | 用途 |
|-----------|--------|---------|------|------|
| web-server | EC2 | t3.medium | 2 | Web サーバー |
| app-server | EC2 | t3.large | 2 | アプリケーションサーバー |

### 4.2 ネットワーク

| リソース名 | タイプ | CIDR / 設定 | 用途 |
|-----------|--------|------------|------|
| main-vpc | VPC | 10.0.0.0/16 | メイン VPC |
| public-subnet-1a | Subnet | 10.0.1.0/24 | パブリックサブネット（AZ-a） |
| private-subnet-1a | Subnet | 10.0.2.0/24 | プライベートサブネット（AZ-a） |

### 4.3 データベース

| リソース名 | エンジン | インスタンスクラス | ストレージ | 用途 |
|-----------|---------|------------------|----------|------|
| main-db | PostgreSQL 15 | db.t3.medium | 100GB gp3 | メインデータベース |

### 4.4 ストレージ

| リソース名 | タイプ | 設定 | 用途 |
|-----------|--------|------|------|
| assets-bucket | S3 | Versioning ON, KMS 暗号化 | 静的アセット保存 |
| logs-bucket | S3 | Lifecycle 90日 | ログ保存 |

---

## 5. セキュリティ設計

### 5.1 アクセス制御

| 対象 | 制御方法 | 詳細 |
|------|---------|------|
| AWS コンソール | IAM + MFA | 管理者は MFA 必須 |
| EC2 | Security Group | 22/80/443 のみ許可 |
| RDS | Security Group | VPC 内からのみアクセス可 |

### 5.2 暗号化

| 対象 | 暗号化方式 | KMS キー |
|------|----------|---------|
| EBS | AES-256 | AWS Managed Key |
| RDS | AES-256 | AWS Managed Key |
| S3 | SSE-KMS | カスタマーマネージドキー |

### 5.3 ログ・監査

| ログ種別 | 保存先 | 保持期間 |
|---------|-------|---------|
| CloudTrail | S3 | 2555日（7年） |
| VPC Flow Logs | CloudWatch Logs | 90日 |
| ALB Access Logs | S3 | 365日 |

---

## 6. 可用性・信頼性設計

### 6.1 可用性要件

| 指標 | 目標値 | 備考 |
|------|-------|------|
| SLA | 99.9% | 月間ダウンタイム 43分以内 |
| RTO | 4時間 | 復旧目標時間 |
| RPO | 1時間 | 復旧目標地点 |

### 6.2 冗長化構成

| レイヤー | 冗長化方式 | 詳細 |
|---------|----------|------|
| Web/App | Multi-AZ + ALB | 2AZ に分散配置 |
| DB | RDS Multi-AZ | 自動フェイルオーバー |
| Storage | S3 Cross-Region | DR 用にリージョン間レプリケーション |

---

## 7. バックアップ設計

| 対象 | 方式 | 頻度 | 保持期間 |
|------|------|------|---------|
| RDS | 自動スナップショット | 日次 | 35日 |
| EC2 (AMI) | AWS Backup | 週次 | 4週間 |
| Terraform State | S3 Versioning | 変更時 | 365日 |

---

## 8. 運用設計

### 8.1 監視項目

| 監視対象 | メトリクス | 閾値 | アラート先 |
|---------|----------|------|----------|
| EC2 | CPU使用率 | 80% | ops-team@example.com |
| RDS | 空きストレージ | 20% | ops-team@example.com |
| ALB | 5XX エラー率 | 1% | ops-team@example.com |

### 8.2 障害対応

障害発生時は「障害復旧手順書」を参照

---

## 9. Terraform 管理情報

### 9.1 State 管理

| 項目 | 値 |
|------|---|
| Backend | S3 |
| State バケット | {BUCKET_NAME} |
| Lock テーブル | {DYNAMODB_TABLE} |
| 暗号化 | KMS ({KMS_KEY_ALIAS}) |

### 9.2 モジュール構成

| モジュール | バージョン | 用途 |
|-----------|----------|------|
| terraform-aws-modules/vpc/aws | 5.0.0 | VPC 構成 |
| terraform-aws-modules/alb/aws | 8.0.0 | ALB 構成 |

### 9.3 CI/CD 設定

| 項目 | 設定 |
|------|------|
| CI/CD ツール | GitHub Actions |
| Plan 実行 | PR 作成時（自動） |
| Apply 実行 | main マージ後（手動承認） |
| CODEOWNERS | @infra-team |

---

## 10. パラメータ一覧

別紙「パラメータ一覧.md」を参照

---

## 11. 関連ドキュメント

| ドキュメント名 | 概要 | 保管場所 |
|---------------|------|---------|
| パラメータ一覧 | 各リソースの詳細パラメータ | 本リポジトリ/templates/ |
| 障害復旧手順 | State 障害時の復旧手順 | 本リポジトリ/templates/ |
| 変更管理書テンプレート | 変更申請時のテンプレート | 本リポジトリ/templates/ |

---

## 12. 承認

| 役割 | 氏名 | 日付 | 署名 |
|------|------|------|------|
| 作成者 | | | |
| レビュー者 | | | |
| 承認者 | | | |
