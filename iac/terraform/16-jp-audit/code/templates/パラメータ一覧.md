# パラメータ一覧

---

## ドキュメント管理情報

| 項目 | 内容 |
|------|------|
| プロジェクト名 | {PROJECT_NAME} |
| 環境 | production / staging / development |
| 作成日 | YYYY-MM-DD |
| 作成者 | {AUTHOR_NAME} |
| 版数 | 1.0 |

---

## 1. VPC パラメータ

### 1.1 VPC 基本設定

| パラメータ名 | 開発環境 | ステージング | 本番環境 | 備考 |
|-------------|---------|-------------|---------|------|
| vpc_cidr | 10.0.0.0/16 | 10.1.0.0/16 | 10.2.0.0/16 | |
| enable_dns_hostnames | true | true | true | |
| enable_dns_support | true | true | true | |

### 1.2 サブネット設定

| サブネット名 | AZ | 開発環境 | ステージング | 本番環境 |
|-------------|-----|---------|-------------|---------|
| public-subnet-1a | ap-northeast-1a | 10.0.1.0/24 | 10.1.1.0/24 | 10.2.1.0/24 |
| public-subnet-1c | ap-northeast-1c | 10.0.2.0/24 | 10.1.2.0/24 | 10.2.2.0/24 |
| private-subnet-1a | ap-northeast-1a | 10.0.11.0/24 | 10.1.11.0/24 | 10.2.11.0/24 |
| private-subnet-1c | ap-northeast-1c | 10.0.12.0/24 | 10.1.12.0/24 | 10.2.12.0/24 |

---

## 2. EC2 パラメータ

### 2.1 インスタンス設定

| パラメータ名 | 開発環境 | ステージング | 本番環境 | 備考 |
|-------------|---------|-------------|---------|------|
| instance_type | t3.micro | t3.small | t3.medium | |
| instance_count | 1 | 1 | 2 | Multi-AZ |
| ami_id | SSM Parameter 参照 | SSM Parameter 参照 | SSM Parameter 参照 | Amazon Linux 2023 |
| key_name | dev-key | stg-key | prod-key | |
| monitoring | false | true | true | 詳細モニタリング |

### 2.2 EBS 設定

| パラメータ名 | 開発環境 | ステージング | 本番環境 | 備考 |
|-------------|---------|-------------|---------|------|
| volume_type | gp3 | gp3 | gp3 | |
| volume_size | 20 | 50 | 100 | GB |
| iops | 3000 | 3000 | 6000 | |
| encrypted | true | true | true | |

### 2.3 Security Group ルール

| タイプ | プロトコル | ポート | ソース | 用途 |
|-------|----------|-------|-------|------|
| Ingress | TCP | 22 | 10.0.0.0/8 | SSH（VPC内のみ） |
| Ingress | TCP | 80 | ALB SG | HTTP |
| Ingress | TCP | 443 | ALB SG | HTTPS |
| Egress | All | All | 0.0.0.0/0 | アウトバウンド |

---

## 3. RDS パラメータ

### 3.1 データベース設定

| パラメータ名 | 開発環境 | ステージング | 本番環境 | 備考 |
|-------------|---------|-------------|---------|------|
| engine | postgres | postgres | postgres | |
| engine_version | 15.4 | 15.4 | 15.4 | |
| instance_class | db.t3.micro | db.t3.small | db.t3.medium | |
| allocated_storage | 20 | 50 | 100 | GB |
| max_allocated_storage | 50 | 100 | 500 | Auto Scaling |
| storage_type | gp3 | gp3 | gp3 | |
| multi_az | false | false | true | |

### 3.2 バックアップ設定

| パラメータ名 | 開発環境 | ステージング | 本番環境 | 備考 |
|-------------|---------|-------------|---------|------|
| backup_retention_period | 7 | 14 | 35 | 日 |
| backup_window | 03:00-04:00 | 03:00-04:00 | 03:00-04:00 | UTC |
| maintenance_window | sun:04:00-sun:05:00 | sun:04:00-sun:05:00 | sun:04:00-sun:05:00 | UTC |
| deletion_protection | false | false | true | |

### 3.3 パラメータグループ設定

| パラメータ名 | 値 | 備考 |
|-------------|---|------|
| log_statement | all | 監査用 |
| log_min_duration_statement | 1000 | スロークエリログ（ms） |
| timezone | Asia/Tokyo | |

---

## 4. ALB パラメータ

### 4.1 ロードバランサー設定

| パラメータ名 | 開発環境 | ステージング | 本番環境 | 備考 |
|-------------|---------|-------------|---------|------|
| internal | false | false | false | |
| load_balancer_type | application | application | application | |
| enable_deletion_protection | false | false | true | |
| idle_timeout | 60 | 60 | 60 | 秒 |

### 4.2 ターゲットグループ設定

| パラメータ名 | 値 | 備考 |
|-------------|---|------|
| target_type | instance | |
| protocol | HTTP | |
| port | 80 | |
| health_check_path | /health | |
| health_check_interval | 30 | 秒 |
| healthy_threshold | 2 | |
| unhealthy_threshold | 3 | |

---

## 5. S3 パラメータ

### 5.1 State バケット設定

| パラメータ名 | 値 | 備考 |
|-------------|---|------|
| versioning | Enabled | 監査必須 |
| encryption | SSE-KMS | カスタマーマネージドキー |
| public_access_block | 全て true | |
| access_logging | Enabled | |
| lifecycle_noncurrent_version_expiration | 365日 | 監査要件 |

### 5.2 ログバケット設定

| パラメータ名 | 値 | 備考 |
|-------------|---|------|
| versioning | Suspended | ログは不要 |
| encryption | SSE-S3 | |
| lifecycle_transition_glacier | 90日 | ISMAP 対応 |
| lifecycle_expiration | 2555日 | 7年保持 |

---

## 6. CloudTrail パラメータ

| パラメータ名 | 値 | 備考 |
|-------------|---|------|
| is_multi_region_trail | true | 全リージョン記録 |
| include_global_service_events | true | IAM 等も記録 |
| enable_log_file_validation | true | 改竄検知 |
| s3_key_prefix | cloudtrail | |

---

## 7. DynamoDB パラメータ（State Lock）

| パラメータ名 | 値 | 備考 |
|-------------|---|------|
| billing_mode | PAY_PER_REQUEST | オンデマンド |
| hash_key | LockID | |
| point_in_time_recovery | true | PITR 有効 |

---

## 8. IAM パラメータ

### 8.1 Terraform 実行ロール

| ロール名 | 用途 | ポリシー |
|---------|------|---------|
| TerraformPlanRole | CI での plan 実行 | ReadOnly 系 + State 読取 |
| TerraformApplyRole | CD での apply 実行 | 必要なサービスの変更権限 |

### 8.2 IAM ポリシー（TerraformPlanRole）

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "ec2:Describe*",
        "rds:Describe*",
        "s3:Get*",
        "s3:List*",
        "dynamodb:GetItem",
        "dynamodb:DescribeTable"
      ],
      "Resource": "*"
    }
  ]
}
```

---

## 9. タグ付け規則

| タグキー | 必須 | 例 | 備考 |
|---------|------|---|------|
| Name | はい | web-server-1 | リソース名 |
| Environment | はい | production | 環境識別 |
| Project | はい | myproject | プロジェクト名 |
| Owner | はい | infra-team | 管理チーム |
| CostCenter | 推奨 | 12345 | コストセンター |
| ManagedBy | はい | terraform | 管理方法 |

---

## 10. 変更履歴

| 版数 | 日付 | 変更内容 | 変更者 |
|------|------|----------|--------|
| 1.0 | YYYY-MM-DD | 初版作成 | |
| | | | |
