# 02 - ç½‘ç»œæ¥å£é…ç½®ï¼ˆInterface Configurationï¼‰

> **ç›®æ ‡**ï¼šæŒæ¡ Linux ç½‘ç»œæ¥å£çš„æŸ¥çœ‹ã€é…ç½®ä¸æŒä¹…åŒ–æ–¹æ³•  
> **å‰ç½®**ï¼šå®Œæˆ [01-ç½‘ç»œåŸºç¡€](../01-fundamentals/)ï¼Œç†è§£ TCP/IP åˆ†å±‚æ¨¡å‹  
> **æ—¶é—´**ï¼šâš¡ 15 åˆ†é’Ÿï¼ˆé€Ÿè¯»ï¼‰/ ğŸ”¬ 60 åˆ†é’Ÿï¼ˆå®Œæ•´å®æ“ï¼‰  
> **å®æˆ˜åœºæ™¯**ï¼šæœåŠ¡å™¨ä¸Šçº¿å‰çš„é™æ€ IP é…ç½®  

---

## å°†å­¦åˆ°çš„å†…å®¹

1. ç†è§£ç°ä»£ Linux æ¥å£å‘½åè§„èŒƒï¼ˆPredictable Network Interface Namesï¼‰
2. ä½¿ç”¨ `ip` å‘½ä»¤æŸ¥çœ‹å’Œä¸´æ—¶é…ç½®æ¥å£
3. åŒºåˆ† `ip link`ã€`ip addr`ã€`ip route` çš„ç”¨é€”
4. ä½¿ç”¨ `nmcli` è¿›è¡ŒæŒä¹…åŒ–ç½‘ç»œé…ç½®
5. ç†è§£ NetworkManager vs systemd-networkd çš„é€‚ç”¨åœºæ™¯
6. Bridge å’Œ VLAN åŸºç¡€æ¦‚å¿µï¼ˆè™šæ‹ŸåŒ–å’Œå®¹å™¨ç½‘ç»œåŸºç¡€ï¼‰

---

## Step 1 - å…ˆè·‘èµ·æ¥ï¼šæŸ¥çœ‹ç½‘ç»œæ¥å£ï¼ˆ5 åˆ†é’Ÿï¼‰

> åœ¨å­¦ä¹ ç†è®ºä¹‹å‰ï¼Œå…ˆç”¨ 3 æ¡å‘½ä»¤çœ‹çœ‹ä½ çš„ç½‘ç»œæ¥å£ã€‚  
> è¿™å°±æ˜¯è¿ç»´å·¥ç¨‹å¸ˆæ¯å¤©éƒ½åœ¨ç”¨çš„æŠ€èƒ½ã€‚  

```bash
# 1. æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œæ¥å£
ip link show

# 2. æŸ¥çœ‹æ¥å£çš„ IP åœ°å€
ip addr show

# 3. æŸ¥çœ‹æ¥å£è¯¦ç»†ä¿¡æ¯ï¼ˆç½‘å¡å‹å·ã€é€Ÿåº¦ã€åŒå·¥æ¨¡å¼ï¼‰
# æ³¨æ„ï¼šethtool å¯èƒ½éœ€è¦ sudo
sudo ethtool eth0 2>/dev/null || sudo ethtool ens5 2>/dev/null || echo "å°è¯•ä½ å®é™…çš„æ¥å£å"
```

**ä½ åˆšåˆšæŸ¥çœ‹äº†ç³»ç»Ÿçš„ç½‘ç»œæ¥å£é…ç½®ï¼**

æ³¨æ„åˆ°æ¥å£åç§°äº†å—ï¼Ÿæ˜¯ `eth0` è¿˜æ˜¯ `ens5`ã€`enp0s3`ï¼Ÿ

è¿™ä¸ªå‘½åå·®å¼‚æ­£æ˜¯æˆ‘ä»¬ç¬¬ä¸€ä¸ªè¦ç†è§£çš„æ¦‚å¿µã€‚

---

## Step 1 -- æ¥å£å‘½åæ¼”è¿›ï¼ˆ10 åˆ†é’Ÿï¼‰

### 1.1 ä» ethX åˆ° Predictable Names

```
ä¼ ç»Ÿå‘½åï¼ˆ~2009ï¼‰                ç°ä»£å‘½åï¼ˆ2009+ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
eth0                   â†’        ens5, enp0s3, eno1
eth1                   â†’        enp0s8, ens33
wlan0                  â†’        wlp2s0
```

**ä¸ºä»€ä¹ˆæ”¹å˜ï¼Ÿ**

ä¼ ç»Ÿçš„ `eth0`ã€`eth1` å‘½åæœ‰ä¸€ä¸ªè‡´å‘½é—®é¢˜ï¼š**é‡å¯åé¡ºåºå¯èƒ½å˜åŒ–**ã€‚

æƒ³è±¡è¿™ä¸ªåœºæ™¯ï¼š
- æœåŠ¡å™¨æœ‰ä¸¤å¼ ç½‘å¡ï¼šç®¡ç†ç½‘ï¼ˆeth0ï¼‰å’Œä¸šåŠ¡ç½‘ï¼ˆeth1ï¼‰
- æŸæ¬¡é‡å¯åï¼Œå†…æ ¸ä»¥ä¸åŒé¡ºåºè¯†åˆ«ç½‘å¡
- eth0 å’Œ eth1 äº’æ¢äº†
- **ç»“æœ**ï¼šç®¡ç†æµé‡è¿›å…¥ä¸šåŠ¡ç½‘ï¼Œä¸šåŠ¡ä¸­æ–­

### 1.2 Predictable Network Interface Names

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ¥å£å‘½åè§„åˆ™                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å‰ç¼€     â”‚ å«ä¹‰                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ en       â”‚ Ethernetï¼ˆä»¥å¤ªç½‘ï¼‰                                   â”‚
â”‚ wl       â”‚ Wireless LANï¼ˆæ— çº¿ç½‘ï¼‰                               â”‚
â”‚ ww       â”‚ Wireless WANï¼ˆç§»åŠ¨ç½‘ç»œï¼‰                             â”‚
â”‚ lo       â”‚ Loopbackï¼ˆç¯å›æ¥å£ï¼‰                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åç¼€ç±»å‹ â”‚ å«ä¹‰                               â”‚ ç¤ºä¾‹            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ oN       â”‚ ä¸»æ¿é›†æˆç½‘å¡ï¼ˆon-boardï¼‰           â”‚ eno1, eno2      â”‚
â”‚ sN       â”‚ PCI çƒ­æ’æ‹”æ§½ä½ï¼ˆslotï¼‰             â”‚ ens5            â”‚
â”‚ pXsY     â”‚ PCI æ€»çº¿ä½ç½®ï¼ˆbus X slot Yï¼‰       â”‚ enp0s3          â”‚
â”‚ pXsYfZ   â”‚ å¤šåŠŸèƒ½è®¾å¤‡ï¼ˆfunction Zï¼‰           â”‚ enp0s3f0        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 åŠ¨æ‰‹æŸ¥çœ‹

```bash
# æŸ¥çœ‹æ¥å£åç§°æ¥æº
udevadm info /sys/class/net/$(ls /sys/class/net | grep -E '^en|^eth' | head -1) 2>/dev/null | grep ID_NET_NAME

# æŸ¥çœ‹ç½‘å¡é©±åŠ¨ä¿¡æ¯ï¼ˆå“ªä¸ªç¡¬ä»¶å¯¹åº”å“ªä¸ªæ¥å£ï¼‰
dmesg | grep -i eth | head -10

# åˆ—å‡ºæ‰€æœ‰ç½‘ç»œæ¥å£
ls /sys/class/net/
```

---

## Step 2 -- ip å‘½ä»¤å®¶æ—ï¼ˆ15 åˆ†é’Ÿï¼‰

### 2.1 iproute2 åŒ…

`ip` å‘½ä»¤æ˜¯ **iproute2** åŒ…çš„æ ¸å¿ƒå·¥å…·ï¼Œ2009 å¹´èµ·å–ä»£äº†ä¼ ç»Ÿçš„ `ifconfig`ã€`route`ã€`arp` ç­‰å‘½ä»¤ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ip å‘½ä»¤å®¶æ—                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å­å‘½ä»¤       â”‚ åŠŸèƒ½                         â”‚ æ›¿ä»£çš„æ—§å‘½ä»¤      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ip link      â”‚ æ¥å£çŠ¶æ€ï¼ˆup/downï¼‰          â”‚ ifconfig          â”‚
â”‚ ip addr      â”‚ IP åœ°å€ç®¡ç†                  â”‚ ifconfig          â”‚
â”‚ ip route     â”‚ è·¯ç”±è¡¨ç®¡ç†                   â”‚ route             â”‚
â”‚ ip neigh     â”‚ ARP/é‚»å±…è¡¨                   â”‚ arp               â”‚
â”‚ ip tunnel    â”‚ éš§é“é…ç½®                     â”‚ iptunnel          â”‚
â”‚ ip maddr     â”‚ ç»„æ’­åœ°å€                     â”‚ ipmaddr           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ip link -- æ¥å£çŠ¶æ€

```bash
# æŸ¥çœ‹æ‰€æœ‰æ¥å£
ip link show

# æŸ¥çœ‹ç‰¹å®šæ¥å£
ip link show ens5

# è¾“å‡ºè§£è¯»
# 2: ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9001 qdisc mq state UP mode DEFAULT group default qlen 1000
#    â”‚      â”‚                                   â”‚           â”‚
#    â”‚      â”‚                                   â”‚           â””â”€ æ¥å£çŠ¶æ€ï¼ˆUP/DOWNï¼‰
#    â”‚      â”‚                                   â””â”€ MTU å€¼
#    â”‚      â””â”€ æ¥å£æ ‡å¿—ï¼ˆBROADCAST=æ”¯æŒå¹¿æ’­ï¼ŒUP=ç®¡ç†å¯ç”¨ï¼ŒLOWER_UP=ç‰©ç†è¿æ¥ï¼‰
#    â””â”€ æ¥å£ç´¢å¼•

# å¯ç”¨/ç¦ç”¨æ¥å£ï¼ˆéœ€è¦ sudoï¼‰
sudo ip link set ens5 down
sudo ip link set ens5 up
```

### 2.3 ip addr -- IP åœ°å€ç®¡ç†

```bash
# æŸ¥çœ‹æ‰€æœ‰æ¥å£çš„ IP åœ°å€
ip addr show
ip a                # ç®€å†™

# åªçœ‹ IPv4 åœ°å€
ip -4 addr show

# åªçœ‹ IPv6 åœ°å€
ip -6 addr show

# æŸ¥çœ‹ç‰¹å®šæ¥å£
ip addr show dev ens5

# è¾“å‡ºè§£è¯»
# 2: ens5: <BROADCAST,MULTICAST,UP,LOWER_UP> ...
#     inet 192.168.1.10/24 brd 192.168.1.255 scope global ens5
#          â”‚              â”‚   â”‚               â”‚
#          â”‚              â”‚   â”‚               â””â”€ åœ°å€ä½œç”¨åŸŸ
#          â”‚              â”‚   â””â”€ å¹¿æ’­åœ°å€
#          â”‚              â””â”€ å­ç½‘æ©ç ï¼ˆCIDR è¡¨ç¤ºï¼‰
#          â””â”€ IP åœ°å€
```

### 2.4 ip neigh -- é‚»å±…è¡¨ï¼ˆARPï¼‰

```bash
# æŸ¥çœ‹ ARP è¡¨ï¼ˆIP åˆ° MAC åœ°å€çš„æ˜ å°„ï¼‰
ip neigh show

# è¾“å‡ºç¤ºä¾‹
# 192.168.1.1 dev ens5 lladdr 00:11:22:33:44:55 REACHABLE
#                       â”‚                       â”‚
#                       â”‚                       â””â”€ çŠ¶æ€ï¼ˆREACHABLE/STALE/FAILEDï¼‰
#                       â””â”€ MAC åœ°å€
```

---

## Step 3 -- ä¸´æ—¶ IP é…ç½®ï¼ˆLab 2ï¼‰ï¼ˆ15 åˆ†é’Ÿï¼‰

> **é‡è¦**ï¼š`ip` å‘½ä»¤çš„é…ç½®æ˜¯**ä¸´æ—¶çš„**ï¼Œé‡å¯åä¸¢å¤±ã€‚  
> è¿™åœ¨æµ‹è¯•å’Œæ’éšœæ—¶å¾ˆæœ‰ç”¨ï¼Œä½†ä¸é€‚åˆç”Ÿäº§ç¯å¢ƒçš„æ°¸ä¹…é…ç½®ã€‚  

### 3.1 æ·»åŠ  IP åœ°å€

```bash
# æ·»åŠ  IP åœ°å€
sudo ip addr add 192.168.100.10/24 dev ens5

# éªŒè¯
ip addr show dev ens5

# ä¸€ä¸ªæ¥å£å¯ä»¥æœ‰å¤šä¸ª IP åœ°å€ï¼ˆIP åˆ«åï¼‰
sudo ip addr add 192.168.100.11/24 dev ens5

# æŸ¥çœ‹æ‰€æœ‰åœ°å€
ip addr show dev ens5
```

### 3.2 åˆ é™¤ IP åœ°å€

```bash
# åˆ é™¤ç‰¹å®š IP
sudo ip addr del 192.168.100.11/24 dev ens5

# åˆ é™¤æ¥å£ä¸Šçš„æ‰€æœ‰ IP
sudo ip addr flush dev ens5
```

### 3.3 å¯ç”¨/ç¦ç”¨æ¥å£

```bash
# ç¦ç”¨æ¥å£
sudo ip link set ens5 down

# å¯ç”¨æ¥å£
sudo ip link set ens5 up

# æŸ¥çœ‹çŠ¶æ€
ip link show ens5
```

### 3.4 ä¸´æ—¶é…ç½®çš„ç”¨é€”

| åœºæ™¯ | è¯´æ˜ |
|------|------|
| **æ’éšœ** | å¿«é€Ÿæµ‹è¯•ä¸åŒçš„ IP é…ç½® |
| **æµ‹è¯•** | éªŒè¯ç½‘ç»œè¿é€šæ€§åå†æŒä¹…åŒ– |
| **ç´§æ€¥æ¢å¤** | ç½‘ç»œé…ç½®æŸåæ—¶çš„ä¸´æ—¶ä¿®å¤ |

---

## Step 4 -- NetworkManager æŒä¹…åŒ–é…ç½®ï¼ˆLab 3ï¼‰ï¼ˆ20 åˆ†é’Ÿï¼‰

### 4.1 NetworkManager vs systemd-networkd

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç½‘ç»œé…ç½®ç®¡ç†å™¨å¯¹æ¯”                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ NetworkManager     â”‚ systemd-networkd                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ¡Œé¢å’ŒæœåŠ¡å™¨é€šç”¨   â”‚ ä¸“æ³¨æœåŠ¡å™¨/å®¹å™¨                               â”‚
â”‚ æ”¯æŒ WiFiã€VPN     â”‚ ä¸æ”¯æŒ WiFi                                   â”‚
â”‚ ä¸°å¯Œçš„ GUI/TUI     â”‚ çº¯é…ç½®æ–‡ä»¶                                    â”‚
â”‚ nmcli/nmtui        â”‚ networkctl                                    â”‚
â”‚ RHEL/CentOS é»˜è®¤   â”‚ Ubuntu Server 18.04+ å¯é€‰                    â”‚
â”‚ Fedora/Ubuntu é»˜è®¤ â”‚ å®¹å™¨/åµŒå…¥å¼å¸¸ç”¨                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é€‰æ‹©å»ºè®®**ï¼š
- å¤§å¤šæ•°æƒ…å†µä¸‹ç”¨ **NetworkManager**ï¼ˆæœ¬è¯¾é‡ç‚¹ï¼‰
- æç®€æœåŠ¡å™¨/å®¹å™¨ç¯å¢ƒå¯è€ƒè™‘ **systemd-networkd**

### 4.2 nmcli åŸºç¡€

```bash
# æ£€æŸ¥ NetworkManager çŠ¶æ€
systemctl status NetworkManager

# æŸ¥çœ‹è®¾å¤‡çŠ¶æ€
nmcli device status

# è¾“å‡ºç¤ºä¾‹
# DEVICE  TYPE      STATE      CONNECTION
# ens5    ethernet  connected  Wired connection 1
# lo      loopback  unmanaged  --

# æŸ¥çœ‹è¿æ¥é…ç½®
nmcli connection show

# è¾“å‡ºç¤ºä¾‹
# NAME                UUID                                  TYPE      DEVICE
# Wired connection 1  a1b2c3d4-e5f6-7890-abcd-ef1234567890  ethernet  ens5
```

**å…³é”®æ¦‚å¿µ**ï¼šdeviceï¼ˆè®¾å¤‡ï¼‰ vs connectionï¼ˆè¿æ¥é…ç½®ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    device vs connection                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Deviceï¼ˆè®¾å¤‡ï¼‰              Connectionï¼ˆè¿æ¥é…ç½®ï¼‰              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”‚
â”‚  ç‰©ç†ç½‘å¡                    é…ç½®æ–‡ä»¶                            â”‚
â”‚  åªèƒ½æœ‰ä¸€ä¸ªæ´»åŠ¨è¿æ¥          å¯ä»¥æœ‰å¤šä¸ªé…ç½®                      â”‚
â”‚                                                                  â”‚
â”‚     ens5   â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚     (è®¾å¤‡)               â”‚                                       â”‚
â”‚                          â”‚ æ´»åŠ¨è¿æ¥                              â”‚
â”‚                          â”‚                                       â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚            â”‚                           â”‚                        â”‚
â”‚       office-lan               home-wifi                        â”‚
â”‚       (è¿æ¥é…ç½®1)              (è¿æ¥é…ç½®2)                       â”‚
â”‚       é™æ€ IP                  DHCP                              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 é…ç½®é™æ€ IP

```bash
# æ–¹æ³• 1ï¼šä¿®æ”¹ç°æœ‰è¿æ¥
nmcli connection modify "Wired connection 1" \
    ipv4.method manual \
    ipv4.addresses 192.168.1.100/24 \
    ipv4.gateway 192.168.1.1 \
    ipv4.dns "8.8.8.8 8.8.4.4"

# åº”ç”¨æ›´æ”¹
nmcli connection up "Wired connection 1"

# æ–¹æ³• 2ï¼šåˆ›å»ºæ–°è¿æ¥
nmcli connection add \
    type ethernet \
    con-name "static-lan" \
    ifname ens5 \
    ipv4.method manual \
    ipv4.addresses 192.168.1.100/24 \
    ipv4.gateway 192.168.1.1 \
    ipv4.dns "8.8.8.8"

# æ¿€æ´»æ–°è¿æ¥
nmcli connection up "static-lan"
```

### 4.4 é…ç½® DHCP

```bash
# åˆ‡æ¢å› DHCP
nmcli connection modify "Wired connection 1" \
    ipv4.method auto \
    ipv4.addresses "" \
    ipv4.gateway "" \
    ipv4.dns ""

# åº”ç”¨æ›´æ”¹
nmcli connection up "Wired connection 1"
```

### 4.5 nmtui -- æ–‡æœ¬ç•Œé¢

```bash
# å¯åŠ¨æ–‡æœ¬ç•Œé¢ï¼ˆæ›´ç›´è§‚ï¼‰
nmtui
```

è¿™ä¼šæ‰“å¼€ä¸€ä¸ªäº¤äº’å¼èœå•ï¼Œé€‚åˆä¸ç†Ÿæ‚‰ nmcli è¯­æ³•çš„ç”¨æˆ·ã€‚

### 4.6 éªŒè¯é…ç½®

```bash
# æŸ¥çœ‹è¿æ¥è¯¦æƒ…
nmcli connection show "Wired connection 1"

# æ£€æŸ¥å®é™…ç”Ÿæ•ˆçš„ IP
ip addr show ens5

# æµ‹è¯•ç½‘ç»œè¿é€šæ€§
ping -c 3 192.168.1.1
```

---

## Step 5 -- Bridge å’Œ VLAN åŸºç¡€ï¼ˆå¯é€‰ï¼Œ10 åˆ†é’Ÿï¼‰

### 5.1 Bridgeï¼ˆç½‘æ¡¥ï¼‰

ç½‘æ¡¥å°†å¤šä¸ªç½‘ç»œæ¥å£è¿æ¥åœ¨ä¸€èµ·ï¼Œåƒäº¤æ¢æœºä¸€æ ·å·¥ä½œã€‚

**å¸¸è§ç”¨é€”**ï¼š
- è™šæ‹Ÿæœºç½‘ç»œï¼ˆKVMã€VirtualBoxï¼‰
- å®¹å™¨ç½‘ç»œï¼ˆDocker bridgeï¼‰

```bash
# åˆ›å»ºç½‘æ¡¥
sudo nmcli connection add type bridge con-name br0 ifname br0

# å°†ç‰©ç†æ¥å£åŠ å…¥ç½‘æ¡¥
sudo nmcli connection add type bridge-slave con-name br0-slave ifname ens5 master br0

# é…ç½®ç½‘æ¡¥ IP
sudo nmcli connection modify br0 \
    ipv4.method manual \
    ipv4.addresses 192.168.1.100/24 \
    ipv4.gateway 192.168.1.1

# å¯ç”¨ç½‘æ¡¥
sudo nmcli connection up br0
```

### 5.2 VLAN

VLAN åœ¨åŒä¸€ç‰©ç†æ¥å£ä¸Šåˆ›å»ºå¤šä¸ªè™šæ‹Ÿæ¥å£ï¼Œæ¯ä¸ªå¯¹åº”ä¸åŒçš„ VLAN IDã€‚

```bash
# åˆ›å»º VLAN æ¥å£ï¼ˆVLAN ID 100ï¼‰
sudo nmcli connection add type vlan \
    con-name vlan100 \
    ifname ens5.100 \
    dev ens5 \
    id 100

# é…ç½® VLAN IP
sudo nmcli connection modify vlan100 \
    ipv4.method manual \
    ipv4.addresses 10.100.0.10/24

# å¯ç”¨ VLAN
sudo nmcli connection up vlan100
```

---

## IPv6 å¿«é€Ÿå…¥é—¨ï¼ˆå¯é€‰è¾¹æ ï¼‰

> å¤§å¤šæ•°æ—¥æœ¬ä¼ä¸šç¯å¢ƒä»ä»¥ IPv4 ä¸ºä¸»ï¼Œä½†äº†è§£ IPv6 åŸºç¡€è¶Šæ¥è¶Šé‡è¦ï¼Œ  
> å°¤å…¶æ˜¯äº‘ç¯å¢ƒå’Œæ–°éƒ¨ç½²è¶Šæ¥è¶Šå¤šå¯ç”¨ IPv6ã€‚  

### æŸ¥çœ‹ IPv6 åœ°å€

```bash
# æŸ¥çœ‹ IPv6 åœ°å€
ip -6 addr show

# æŸ¥çœ‹ IPv6 è·¯ç”±
ip -6 route show
```

### å¸¸è§åœ°å€ç±»å‹

| å‰ç¼€ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `fe80::` | é“¾è·¯æœ¬åœ°ï¼ˆLink-Localï¼‰ | è‡ªåŠ¨ç”Ÿæˆï¼Œä»…æœ¬åœ°é“¾è·¯é€šä¿¡ |
| `2001::` | å…¨å±€å•æ’­ï¼ˆGlobal Unicastï¼‰ | å…¬ç½‘å¯è·¯ç”±åœ°å€ |
| `::1` | ç¯å›ï¼ˆLoopbackï¼‰ | ç­‰åŒäº IPv4 çš„ 127.0.0.1 |
| `fd00::`| å”¯ä¸€æœ¬åœ°ï¼ˆULAï¼‰ | ç±»ä¼¼ IPv4 ç§æœ‰åœ°å€ |

### IPv6 è¿é€šæ€§æµ‹è¯•

```bash
# æµ‹è¯•ç¯å›åœ°å€
ping -6 ::1

# æµ‹è¯•é“¾è·¯æœ¬åœ°åœ°å€ï¼ˆéœ€è¦æŒ‡å®šæ¥å£ï¼‰
ping -6 fe80::1%ens5

# æµ‹è¯•å…¬ç½‘ IPv6
ping -6 2001:4860:4860::8888    # Google DNS
```

### ç¦ç”¨ IPv6ï¼ˆå¦‚æœä¸éœ€è¦ï¼‰

```bash
# ä¸´æ—¶ç¦ç”¨
sudo sysctl -w net.ipv6.conf.all.disable_ipv6=1
sudo sysctl -w net.ipv6.conf.default.disable_ipv6=1

# æ°¸ä¹…ç¦ç”¨ï¼ˆå†™å…¥ /etc/sysctl.confï¼‰
echo "net.ipv6.conf.all.disable_ipv6 = 1" | sudo tee -a /etc/sysctl.conf
echo "net.ipv6.conf.default.disable_ipv6 = 1" | sudo tee -a /etc/sysctl.conf
sudo sysctl -p
```

> **è­¦å‘Š**ï¼šç¦ç”¨å‰ç¡®è®¤åº”ç”¨ä¸ä¾èµ– IPv6ã€‚æŸäº›æœåŠ¡é»˜è®¤ç›‘å¬ IPv6 åœ°å€ã€‚  

---

## åæ¨¡å¼ï¼šå¸¸è§é”™è¯¯

### é”™è¯¯ 1ï¼šç”¨ ip å‘½ä»¤ä»¥ä¸ºæ˜¯æ°¸ä¹…çš„

```bash
# é”™è¯¯ï¼šä»¥ä¸ºè¿™æ ·é…ç½®å°±æ°¸ä¹…äº†
sudo ip addr add 192.168.1.10/24 dev ens5
# é‡å¯åé…ç½®ä¸¢å¤±ï¼

# æ­£ç¡®ï¼šä½¿ç”¨ nmcli æŒä¹…åŒ–
nmcli connection modify "Wired connection 1" \
    ipv4.method manual \
    ipv4.addresses 192.168.1.10/24
nmcli connection up "Wired connection 1"
```

**åæœ**ï¼šæœåŠ¡å™¨é‡å¯åå¤±å» IP åœ°å€ï¼Œæ— æ³•è¿œç¨‹è¿æ¥ã€‚

### é”™è¯¯ 2ï¼šä½¿ç”¨ ifconfig è€Œä¸æ˜¯ ip

```bash
# è¿‡æ—¶ï¼šifconfig ä» 2009 å¹´èµ·å·²å¼ƒç”¨
ifconfig eth0 192.168.1.10 netmask 255.255.255.0

# ç°ä»£ï¼šä½¿ç”¨ ip å‘½ä»¤
ip addr add 192.168.1.10/24 dev ens5
```

**é—®é¢˜**ï¼š
- `ifconfig` ä¸æ”¯æŒæŸäº›ç°ä»£åŠŸèƒ½ï¼ˆå¤šä¸ª IP åœ°å€ã€CIDR è¡¨ç¤ºæ³•ï¼‰
- å¾ˆå¤šæ–°ç³»ç»Ÿé»˜è®¤ä¸å®‰è£… `net-tools` åŒ…
- æ—¥æœ¬ IT ç°åœºä¹Ÿåœ¨é€æ­¥æ·˜æ±°

### é”™è¯¯ 3ï¼šä¸ç†è§£ connection profile vs device

```bash
# é”™è¯¯ç†è§£ï¼šä»¥ä¸ºæ¥å£åå°±æ˜¯è¿æ¥å
nmcli connection modify ens5 ipv4.method manual
# Error: Connection 'ens5' not found.

# æ­£ç¡®ï¼šå…ˆæŸ¥çœ‹è¿æ¥å
nmcli connection show
# NAME                UUID                                  TYPE      DEVICE
# Wired connection 1  a1b2c3d4-...                          ethernet  ens5

# ä½¿ç”¨æ­£ç¡®çš„è¿æ¥å
nmcli connection modify "Wired connection 1" ipv4.method manual
```

### é”™è¯¯ 4ï¼šä¿®æ”¹åä¸é‡æ–°æ¿€æ´»è¿æ¥

```bash
# é”™è¯¯ï¼šä¿®æ”¹åä¸åº”ç”¨
nmcli connection modify "Wired connection 1" ipv4.addresses 192.168.1.10/24
# é…ç½®å·²ä¿å­˜ä½†æœªç”Ÿæ•ˆ

# æ­£ç¡®ï¼šä¿®æ”¹åé‡æ–°æ¿€æ´»
nmcli connection modify "Wired connection 1" ipv4.addresses 192.168.1.10/24
nmcli connection up "Wired connection 1"
```

---

## èŒåœºå°è´´å£«ï¼ˆJapan IT Contextï¼‰

### ç½‘ç»œé…ç½®å˜æ›´ï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šå¤‰æ›´ï¼‰

åœ¨æ—¥æœ¬ IT ä¼ä¸šï¼Œç½‘ç»œé…ç½®å˜æ›´æ˜¯éœ€è¦è°¨æ…å¤„ç†çš„è¿ç»´æ“ä½œã€‚

| æ—¥è¯­æœ¯è¯­ | å«ä¹‰ | å…¸å‹åœºæ™¯ |
|----------|------|----------|
| è¨­å®šå¤‰æ›´ | é…ç½®å˜æ›´ | ä¿®æ”¹ IP åœ°å€ã€ç½‘å…³ |
| ç–é€šç¢ºèª | è¿é€šæ€§ç¡®è®¤ | ping æµ‹è¯•ç¡®è®¤ç½‘ç»œé€š |
| åˆ‡ã‚Šæˆ»ã— | å›æ»š | å˜æ›´å¤±è´¥æ—¶æ¢å¤åŸé…ç½® |
| ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ | è¯æ®/æˆªå›¾ | å˜æ›´å‰åçš„çŠ¶æ€è®°å½• |

### å˜æ›´æµç¨‹

```bash
# 1. å˜æ›´å‰ - è®°å½•å½“å‰çŠ¶æ€ï¼ˆã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ï¼‰
ip addr show > /tmp/before-change.txt
nmcli connection show "Wired connection 1" > /tmp/conn-before.txt

# 2. æ‰§è¡Œå˜æ›´
nmcli connection modify "Wired connection 1" ipv4.addresses 192.168.1.100/24

# 3. åº”ç”¨å˜æ›´
nmcli connection up "Wired connection 1"

# 4. ç–é€šç¢ºèª
ping -c 3 192.168.1.1

# 5. å˜æ›´å - è®°å½•æ–°çŠ¶æ€
ip addr show > /tmp/after-change.txt

# 6. å¦‚æœå¤±è´¥ - åˆ‡ã‚Šæˆ»ã—
nmcli connection modify "Wired connection 1" ipv4.addresses 192.168.1.50/24
nmcli connection up "Wired connection 1"
```

### è¿œç¨‹å˜æ›´çš„å®‰å…¨ç½‘

```bash
# å¦‚æœé€šè¿‡ SSH è¿œç¨‹ä¿®æ”¹ IPï¼Œè®¾ç½®è‡ªåŠ¨æ¢å¤
# é¿å…æ”¹é”™ IP åå¤±å»è¿æ¥

# æ–¹æ³•ï¼šä½¿ç”¨ at å‘½ä»¤è®¾ç½®å®šæ—¶æ¢å¤
echo "nmcli connection up 'Wired connection 1'" | at now + 5 minutes

# å¦‚æœå˜æ›´æˆåŠŸï¼Œå–æ¶ˆå®šæ—¶ä»»åŠ¡
atrm $(atq | awk '{print $1}')
```

---

## é¢è¯•é—®é¢˜ï¼ˆInterview Prepï¼‰

### Q1: ip ã‚³ãƒãƒ³ãƒ‰ã¨ ifconfig ã®é•ã„ã¯ï¼Ÿ

**A**: `ip` ã¯ iproute2 ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ç¾ä»£ãƒ„ãƒ¼ãƒ«ã§ã€2009 å¹´ã‹ã‚‰æ¨å¥¨ã•ã‚Œã¦ã„ã¾ã™ã€‚
`ifconfig` ã¯ net-tools ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§éæ¨å¥¨ã§ã™ã€‚

é•ã„ï¼š
- `ip` ã¯ CIDR è¡¨è¨˜ï¼ˆ/24ï¼‰ã‚’ã‚µãƒãƒ¼ãƒˆã€`ifconfig` ã¯ã‚µãƒ–ãƒãƒƒãƒˆãƒã‚¹ã‚¯è¡¨è¨˜
- `ip` ã¯è¤‡æ•° IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç°¡å˜ã«ç®¡ç†ã§ãã‚‹
- `ip` ã¯ã‚ˆã‚Šè©³ç´°ãªæƒ…å ±ã‚’è¡¨ç¤ºï¼ˆä¾‹ï¼šstate UP/DOWNï¼‰
- å¤šãã®æ–°ã—ã„ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§ net-tools ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„

### Q2: NetworkManager ã§é™çš„ IP ã‚’è¨­å®šã™ã‚‹æ–¹æ³•ã¯ï¼Ÿ

**A**: nmcli ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ï¼š

```bash
nmcli connection modify <conn-name> \
    ipv4.method manual \
    ipv4.addresses x.x.x.x/24 \
    ipv4.gateway y.y.y.y \
    ipv4.dns z.z.z.z
nmcli connection up <conn-name>
```

ãƒã‚¤ãƒ³ãƒˆï¼š
- `modify` ã§è¨­å®šå¤‰æ›´ã€`up` ã§é©ç”¨
- æ¥ç¶šåã¯ `nmcli connection show` ã§ç¢ºèª
- `--permanent` ã¯ä¸è¦ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æ°¸ç¶šåŒ–ï¼‰

---

## æ£€æŸ¥æ¸…å•

å®Œæˆæœ¬è¯¾åï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

- [ ] è§£é‡Š Predictable Network Interface Names çš„å‘½åè§„åˆ™
- [ ] åŒºåˆ† `ip link`ã€`ip addr`ã€`ip route` çš„ç”¨é€”
- [ ] ä½¿ç”¨ `ip addr add/del` ä¸´æ—¶é…ç½® IP åœ°å€
- [ ] ä½¿ç”¨ `ip link set up/down` æ§åˆ¶æ¥å£çŠ¶æ€
- [ ] ä½¿ç”¨ `nmcli device status` æŸ¥çœ‹è®¾å¤‡çŠ¶æ€
- [ ] ä½¿ç”¨ `nmcli connection show` æŸ¥çœ‹è¿æ¥é…ç½®
- [ ] ä½¿ç”¨ `nmcli connection modify` é…ç½®é™æ€ IP
- [ ] ç†è§£ NetworkManager çš„ device vs connection æ¦‚å¿µ
- [ ] çŸ¥é“ `ifconfig` å·²å¼ƒç”¨åŠåŸå› 
- [ ] äº†è§£ Bridge å’Œ VLAN çš„åŸºæœ¬æ¦‚å¿µ

---

## æœ¬è¯¾å°ç»“

| æ¦‚å¿µ | å‘½ä»¤ | è®°å¿†ç‚¹ |
|------|------|--------|
| æŸ¥çœ‹æ¥å£ | `ip link show` | æ¥å£çŠ¶æ€ï¼ˆUP/DOWNï¼‰ |
| æŸ¥çœ‹ IP | `ip addr show` | åœ°å€å’Œå­ç½‘æ©ç  |
| ä¸´æ—¶æ·»åŠ  IP | `ip addr add` | é‡å¯ä¸¢å¤±ï¼ |
| ä¸´æ—¶åˆ é™¤ IP | `ip addr del` | ç”¨äºæµ‹è¯• |
| æŸ¥çœ‹è®¾å¤‡ | `nmcli device status` | ç‰©ç†è®¾å¤‡çŠ¶æ€ |
| æŸ¥çœ‹è¿æ¥ | `nmcli connection show` | é…ç½®æ–‡ä»¶åˆ—è¡¨ |
| ä¿®æ”¹è¿æ¥ | `nmcli connection modify` | æŒä¹…åŒ–é…ç½® |
| åº”ç”¨å˜æ›´ | `nmcli connection up` | æ¿€æ´»é…ç½® |
| æ–‡æœ¬ç•Œé¢ | `nmtui` | äº¤äº’å¼é…ç½® |

---

## å»¶ä¼¸é˜…è¯»

- [Linux man page: ip](https://man7.org/linux/man-pages/man8/ip.8.html)
- [NetworkManager nmcli examples](https://networkmanager.dev/docs/api/latest/nmcli-examples.html)
- [Predictable Network Interface Names](https://www.freedesktop.org/wiki/Software/systemd/PredictableNetworkInterfaceNames/)
- ä¸‹ä¸€è¯¾ï¼š[03 - IP è·¯ç”±](../03-routing/) -- ç†è§£è·¯ç”±è¡¨å’Œé™æ€è·¯ç”±é…ç½®
- ç›¸å…³è¯¾ç¨‹ï¼š[systemd è¯¾ç¨‹](../../lx05-systemd/) -- systemd-networkd è¯¦è§£

---

## ç³»åˆ—å¯¼èˆª

[â† 01-ç½‘ç»œåŸºç¡€](../01-fundamentals/) | [ç³»åˆ—é¦–é¡µ](../) | [03-IP è·¯ç”± â†’](../03-routing/)
