#!/bin/bash
# =============================================================================
# redirect_demo.sh - 重定向操作演示脚本
# =============================================================================
#
# 用途：
#   演示各种重定向操作符的用法
#
# 运行方式：
#   ./redirect_demo.sh
#
# =============================================================================

# 创建工作目录
WORKDIR="/tmp/redirect_demo_$$"
mkdir -p "$WORKDIR"
cd "$WORKDIR"

echo "=== 重定向演示 ==="
echo "工作目录: $WORKDIR"
echo ""

# -----------------------------------------------------------------------------
# 演示 1: 基本输出重定向
# -----------------------------------------------------------------------------
echo "--- 演示 1: 输出重定向 ---"

# > 覆盖写入
echo "第一行内容" > output.txt
echo "文件内容 (覆盖写入后):"
cat output.txt

# >> 追加写入
echo "第二行内容" >> output.txt
echo "文件内容 (追加写入后):"
cat output.txt
echo ""

# -----------------------------------------------------------------------------
# 演示 2: 错误重定向
# -----------------------------------------------------------------------------
echo "--- 演示 2: 错误重定向 ---"

# 故意产生错误
echo "尝试列出不存在的目录..."
ls /this_directory_does_not_exist 2> error.log

echo "错误被保存到 error.log:"
cat error.log
echo ""

# -----------------------------------------------------------------------------
# 演示 3: 分离 stdout 和 stderr
# -----------------------------------------------------------------------------
echo "--- 演示 3: 分离 stdout 和 stderr ---"

# 同时产生正常输出和错误
{
    echo "这是正常输出"
    ls /nonexistent 2>&1 >/dev/null  # 这行故意产生错误
    echo "这也是正常输出"
} > stdout.log 2> stderr.log

echo "stdout.log 内容:"
cat stdout.log

echo "stderr.log 内容:"
cat stderr.log 2>/dev/null || echo "(空)"
echo ""

# -----------------------------------------------------------------------------
# 演示 4: 合并 stdout 和 stderr
# -----------------------------------------------------------------------------
echo "--- 演示 4: 合并输出流 ---"

# 方法 1: > file 2>&1
ls /home /nonexistent > combined1.log 2>&1

# 方法 2: &> (Bash 简写)
ls /home /nonexistent &> combined2.log

echo "两种方法结果相同:"
echo "combined1.log:"
head -2 combined1.log
echo ""

# -----------------------------------------------------------------------------
# 演示 5: 输入重定向
# -----------------------------------------------------------------------------
echo "--- 演示 5: 输入重定向 ---"

# 创建测试文件
cat > numbers.txt << EOF
3
1
4
1
5
9
2
6
EOF

echo "排序前:"
cat numbers.txt

echo "排序后 (使用输入重定向):"
sort -n < numbers.txt
echo ""

# -----------------------------------------------------------------------------
# 清理
# -----------------------------------------------------------------------------
echo "=== 演示结束 ==="
echo "文件保存在: $WORKDIR"
echo "运行以下命令清理: rm -rf $WORKDIR"
