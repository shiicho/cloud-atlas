# 09 - Core Dump ä¸å´©æºƒåˆ†æï¼ˆCore Dumps and Crash Analysisï¼‰

> **ç›®æ ‡**ï¼šæŒæ¡ core dump é…ç½®å’ŒåŸºç¡€å´©æºƒåˆ†æï¼Œå­¦ä¼šä½¿ç”¨ coredumpctl å’Œ GDB  
> **å‰ç½®**ï¼šLX10-08 strace åŸºç¡€ï¼Œç†è§£è¿›ç¨‹å’Œä¿¡å·  
> **æ—¶é—´**ï¼šâš¡ 30 åˆ†é’Ÿï¼ˆé€Ÿè¯»ï¼‰/ ğŸ”¬ 120 åˆ†é’Ÿï¼ˆå®Œæ•´å®æ“ï¼‰  
> **æ ¸å¿ƒç†å¿µ**ï¼šCore dump æ˜¯ç¨‹åºå´©æºƒæ—¶çš„"ç°åœºå¿«ç…§"ï¼Œæ˜¯å®šä½å´©æºƒåŸå› çš„å…³é”®è¯æ®  

---

## å°†å­¦åˆ°çš„å†…å®¹

1. é…ç½®ç³»ç»Ÿç”Ÿæˆ core dump
2. ä½¿ç”¨ coredumpctl ç®¡ç†å’ŒæŸ¥çœ‹ core dump
3. ä½¿ç”¨ GDB è¿›è¡ŒåŸºç¡€å´©æºƒåˆ†æ
4. ç†è§£å¸¸è§å´©æºƒä¿¡å·ï¼ˆSIGSEGV, SIGBUS, SIGABRT, SIGFPEï¼‰
5. é…ç½® debuginfod è‡ªåŠ¨è·å–è°ƒè¯•ç¬¦å·

---

## å…ˆè·‘èµ·æ¥ï¼ï¼ˆ5 åˆ†é’Ÿï¼‰

> åœ¨æ·±å…¥ç†è®ºä¹‹å‰ï¼Œå…ˆçœ‹çœ‹ä½ çš„ç³»ç»Ÿæœ‰æ²¡æœ‰ core dump è®°å½•ã€‚  
> è¿™äº›å‘½ä»¤ç«‹å³å‘Šè¯‰ä½ ç³»ç»Ÿæœ€è¿‘æ˜¯å¦æœ‰ç¨‹åºå´©æºƒã€‚  

```bash
# åˆ—å‡ºæ‰€æœ‰ core dump è®°å½•
coredumpctl list

# æŸ¥çœ‹æœ€è¿‘ä¸€æ¬¡ core dump çš„è¯¦ç»†ä¿¡æ¯ï¼ˆå« backtraceï¼‰
coredumpctl info -1
```

**ç¤ºä¾‹è¾“å‡º**ï¼š

```
TIME                           PID  UID  GID SIG     COREFILE EXE                          SIZE
Fri 2026-01-10 10:23:45 JST   1234 1000 1000 SIGSEGV present  /usr/local/bin/myapp         2.1M
Thu 2026-01-09 15:30:12 JST   5678 0    0    SIGABRT present  /usr/sbin/some-daemon        4.5M
```

**ä½ åˆšåˆšæ‰¾åˆ°äº†ç³»ç»Ÿä¸Šçš„å´©æºƒè®°å½•ï¼**

å¦‚æœè¾“å‡ºä¸ºç©ºï¼Œè¯´æ˜æœ€è¿‘æ²¡æœ‰ç¨‹åºå´©æºƒï¼ˆå¥½äº‹ï¼ï¼‰ã€‚ç°åœ¨è®©æˆ‘ä»¬å­¦ä¹ å¦‚ä½•é…ç½®å’Œåˆ†æ core dumpã€‚

---

## Step 1 -- ä»€ä¹ˆæ˜¯ Core Dumpï¼Ÿï¼ˆ10 åˆ†é’Ÿï¼‰

### 1.1 Core Dump å®šä¹‰

**Core dump** æ˜¯ç¨‹åºå¼‚å¸¸ç»ˆæ­¢æ—¶ï¼Œæ“ä½œç³»ç»Ÿå°†è¿›ç¨‹å†…å­˜çŠ¶æ€ä¿å­˜åˆ°ç£ç›˜çš„æ–‡ä»¶ã€‚

å®ƒåŒ…å«ï¼š
- ç¨‹åºå´©æºƒæ—¶çš„å†…å­˜å†…å®¹
- å¯„å­˜å™¨çŠ¶æ€
- è°ƒç”¨æ ˆä¿¡æ¯
- æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦

**ç±»æ¯”**ï¼šCore dump å°±åƒé£æœºçš„"é»‘åŒ£å­"ï¼Œè®°å½•äº†å´©æºƒç¬é—´çš„æ‰€æœ‰çŠ¶æ€ã€‚

### 1.2 Core Dump å·¥ä½œæµç¨‹

<!-- DIAGRAM: core-dump-workflow -->
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Core Dump ç”Ÿæˆå’Œåˆ†ææµç¨‹                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  ç¨‹åºè¿è¡Œ   â”‚     â”‚  å‘ç”Ÿå¼‚å¸¸   â”‚     â”‚  å†…æ ¸æ•è·ä¿¡å·       â”‚   â”‚
â”‚   â”‚  (Process)  â”‚ â”€â”€â–¶ â”‚  (Crash)    â”‚ â”€â”€â–¶ â”‚  (SIGSEGV etc.)     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                       â”‚              â”‚
â”‚                                                       â–¼              â”‚
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                       â”‚  core_pattern å†³å®šå¦‚ä½•å¤„ç†                 â”‚ â”‚
â”‚                       â”‚                                           â”‚ â”‚
â”‚                       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚                       â”‚  â”‚ ä¼ ç»Ÿæ–¹å¼        â”‚  â”‚ systemd æ–¹å¼   â”‚  â”‚ â”‚
â”‚                       â”‚  â”‚ /tmp/core.%p    â”‚  â”‚ systemd-coredumpâ”‚ â”‚ â”‚
â”‚                       â”‚  â”‚ (æ–‡ä»¶è·¯å¾„)      â”‚  â”‚ (æ¨è)         â”‚  â”‚ â”‚
â”‚                       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚                       â”‚           â”‚                    â”‚           â”‚ â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                   â”‚                    â”‚              â”‚
â”‚                                   â–¼                    â–¼              â”‚
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                       â”‚  core æ–‡ä»¶      â”‚  â”‚  coredumpctl        â”‚   â”‚
â”‚                       â”‚  (æ‰‹åŠ¨ç®¡ç†)     â”‚  â”‚  (ç»Ÿä¸€ç®¡ç†+å…ƒæ•°æ®)  â”‚   â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                       â”‚              â”‚
â”‚                                                       â–¼              â”‚
â”‚                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                                            â”‚  GDB åˆ†æ           â”‚   â”‚
â”‚                                            â”‚  â€¢ bt (backtrace)   â”‚   â”‚
â”‚                                            â”‚  â€¢ info registers   â”‚   â”‚
â”‚                                            â”‚  â€¢ thread apply all â”‚   â”‚
â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
<!-- /DIAGRAM -->

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦ Core Dumpï¼Ÿ

| åœºæ™¯ | æ²¡æœ‰ Core Dump | æœ‰ Core Dump |
|------|----------------|--------------|
| ç¨‹åºå´©æºƒ | åªçŸ¥é“"æŒ‚äº†" | çŸ¥é“åœ¨å“ªè¡Œä»£ç å´©æºƒ |
| é—´æ­‡æ€§å´©æºƒ | éš¾ä»¥å¤ç° | æœ‰è¯æ®å¯åˆ†æ |
| ç”Ÿäº§ç¯å¢ƒé—®é¢˜ | æ— æ³•è°ƒè¯• | å¯ä»¥ç¦»çº¿åˆ†æ |
| ä¸å¼€å‘æ²Ÿé€š | "ç¨‹åºæŒ‚äº†ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆ" | "åœ¨ foo.c:123 è¡Œç©ºæŒ‡é’ˆ" |

---

## Step 2 -- Core Dump é…ç½®ï¼ˆ20 åˆ†é’Ÿï¼‰

### 2.1 æ£€æŸ¥å½“å‰é…ç½®

```bash
# æ£€æŸ¥ ulimitï¼ˆç”¨æˆ·çº§é™åˆ¶ï¼‰
ulimit -c
# è¾“å‡ºï¼š0 = ç¦ç”¨ï¼Œunlimited = æ— é™åˆ¶

# æ£€æŸ¥ core_patternï¼ˆå†…æ ¸çº§é…ç½®ï¼‰
cat /proc/sys/kernel/core_pattern
# è¾“å‡ºå¯èƒ½æ˜¯ï¼š
# |/usr/lib/systemd/systemd-coredump ...  (systemd æ–¹å¼)
# core                                     (ä¼ ç»Ÿæ–¹å¼)
# /tmp/core.%p                             (è‡ªå®šä¹‰è·¯å¾„)
```

### 2.2 ä¸ºä»€ä¹ˆ Core Dump å¯èƒ½ç¼ºå¤±ï¼Ÿ

<!-- DIAGRAM: why-no-coredump -->
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ä¸ºä»€ä¹ˆ Core Dump å¯èƒ½"æ¶ˆå¤±"ï¼Ÿ                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  æ£€æŸ¥ç‚¹ 1: ulimit -c                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ulimit -c 0        â†’  ç¦ç”¨ core dumpï¼ˆæœ€å¸¸è§åŸå› ï¼‰            â”‚ â”‚
â”‚  â”‚  ulimit -c 1024     â†’  é™åˆ¶ 1024 å­—èŠ‚ï¼ˆæ–‡ä»¶å¤ªå°è¢«æˆªæ–­ï¼‰        â”‚ â”‚
â”‚  â”‚  ulimit -c unlimited â†’  æ— é™åˆ¶ï¼ˆæ¨èï¼‰                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                      â”‚
â”‚  æ£€æŸ¥ç‚¹ 2: core_pattern                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  è·¯å¾„ä¸å­˜åœ¨         â†’  core æ— æ³•å†™å…¥                           â”‚ â”‚
â”‚  â”‚  ç›®å½•æƒé™ä¸è¶³       â†’  æ²¡æœ‰å†™å…¥æƒé™                            â”‚ â”‚
â”‚  â”‚  ç£ç›˜ç©ºé—´ä¸è¶³       â†’  å†™å…¥å¤±è´¥                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                      â”‚
â”‚  æ£€æŸ¥ç‚¹ 3: è¿›ç¨‹é…ç½®                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  setuid ç¨‹åº        â†’  é»˜è®¤ç¦ç”¨ core dumpï¼ˆå®‰å…¨è€ƒè™‘ï¼‰          â”‚ â”‚
â”‚  â”‚  fs.suid_dumpable   â†’  éœ€è¦è®¾ä¸º 1 æˆ– 2 æ‰èƒ½ dump               â”‚ â”‚
â”‚  â”‚  prctl(PR_SET_DUMPABLE, 0)  â†’  ç¨‹åºè‡ªå·±ç¦ç”¨äº†                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                      â”‚
â”‚  æ£€æŸ¥ç‚¹ 4: systemd-coredump                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Storage=none       â†’  /etc/systemd/coredump.conf ç¦ç”¨å­˜å‚¨     â”‚ â”‚
â”‚  â”‚  ProcessSizeMax=0   â†’  è¿›ç¨‹å¤ªå¤§è¢«è·³è¿‡                          â”‚ â”‚
â”‚  â”‚  ExternalSizeMax=0  â†’  å¤–éƒ¨ç¨‹åº core è¢«è·³è¿‡                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
<!-- /DIAGRAM -->

### 2.3 å¯ç”¨ Core Dumpï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰

```bash
# 1. è®¾ç½® ulimitï¼ˆå½“å‰ shellï¼‰
ulimit -c unlimited

# 2. æ°¸ä¹…è®¾ç½®ï¼ˆç³»ç»Ÿçº§ï¼‰
sudo bash -c 'echo "* soft core unlimited" >> /etc/security/limits.conf'
sudo bash -c 'echo "* hard core unlimited" >> /etc/security/limits.conf'

# 3. è®¾ç½® core_patternï¼ˆæŒ‡å®šä¿å­˜ä½ç½®ï¼‰
# åˆ›å»ºç›®å½•
sudo mkdir -p /var/coredumps
sudo chmod 1777 /var/coredumps

# è®¾ç½®æ¨¡å¼ï¼ˆ%p=PID, %e=ç¨‹åºå, %t=æ—¶é—´æˆ³ï¼‰
echo '/var/coredumps/core.%e.%p.%t' | sudo tee /proc/sys/kernel/core_pattern

# æ°¸ä¹…ç”Ÿæ•ˆ
echo 'kernel.core_pattern = /var/coredumps/core.%e.%p.%t' | sudo tee -a /etc/sysctl.conf
sudo sysctl -p
```

### 2.4 å¯ç”¨ Core Dumpï¼ˆsystemd-coredump æ–¹å¼ï¼Œæ¨èï¼‰

ç°ä»£ Linux å‘è¡Œç‰ˆï¼ˆRHEL 8+, Ubuntu 20.04+, Fedoraï¼‰é»˜è®¤ä½¿ç”¨ systemd-coredumpã€‚

```bash
# æ£€æŸ¥æ˜¯å¦ä½¿ç”¨ systemd-coredump
cat /proc/sys/kernel/core_pattern
# è¾“å‡ºåº”è¯¥æ˜¯ï¼š|/usr/lib/systemd/systemd-coredump ...

# æ£€æŸ¥é…ç½®
cat /etc/systemd/coredump.conf
```

**é…ç½®æ–‡ä»¶ `/etc/systemd/coredump.conf`**ï¼š

```ini
[Coredump]
# Storage=external  # external=ä¿å­˜ï¼Œnone=ä¸ä¿å­˜ï¼Œjournal=åªè®°å½•åˆ°æ—¥å¿—
# Compress=yes      # å‹ç¼© core æ–‡ä»¶
# ProcessSizeMax=2G # æœ€å¤§è¿›ç¨‹å¤§å°
# ExternalSizeMax=2G # æœ€å¤§ core æ–‡ä»¶å¤§å°
# MaxUse=           # core æ–‡ä»¶æ€»å¤§å°é™åˆ¶
# KeepFree=         # ä¿ç•™ç£ç›˜ç©ºé—´
```

**æ¨èé…ç½®**ï¼ˆå¯ç”¨å¹¶è®¾ç½®åˆç†é™åˆ¶ï¼‰ï¼š

```bash
sudo tee /etc/systemd/coredump.conf << 'EOF'
[Coredump]
Storage=external
Compress=yes
ProcessSizeMax=2G
ExternalSizeMax=2G
MaxUse=10G
KeepFree=1G
EOF

# é‡å¯ systemd-coredump
sudo systemctl daemon-reload
```

### 2.5 ä¸ºä»€ä¹ˆ systemd-coredump æ›´å¥½ï¼Ÿ

| ç‰¹æ€§ | ä¼ ç»Ÿæ–¹å¼ | systemd-coredump |
|------|----------|------------------|
| å…ƒæ•°æ® | æ—  | PID, ä¿¡å·, æ—¶é—´æˆ³, å‘½ä»¤è¡Œ |
| ç®¡ç† | æ‰‹åŠ¨æ¸…ç† | è‡ªåŠ¨è½®è½¬ |
| æŸ¥è¯¢ | æ‰‹åŠ¨æ‰¾æ–‡ä»¶ | `coredumpctl list` |
| å‹ç¼© | æ—  | è‡ªåŠ¨å‹ç¼© |
| ç£ç›˜ç®¡ç† | å¯èƒ½å¡«æ»¡ç£ç›˜ | é…é¢é™åˆ¶ |

---

## Step 3 -- coredumpctl ä½¿ç”¨ï¼ˆ20 åˆ†é’Ÿï¼‰

### 3.1 åŸºç¡€å‘½ä»¤

```bash
# åˆ—å‡ºæ‰€æœ‰ core dump
coredumpctl list

# åˆ—å‡ºæŒ‡å®šç¨‹åºçš„ core dump
coredumpctl list nginx

# åˆ—å‡ºæŒ‡å®š PID çš„ core dump
coredumpctl list 12345

# åˆ—å‡ºä»Šå¤©çš„ core dump
coredumpctl list --since today

# åˆ—å‡ºæœ€è¿‘ 1 å°æ—¶çš„ core dump
coredumpctl list --since "1 hour ago"
```

### 3.2 æŸ¥çœ‹ Core Dump ä¿¡æ¯

```bash
# æŸ¥çœ‹æœ€è¿‘ä¸€æ¬¡ core dump çš„è¯¦ç»†ä¿¡æ¯
coredumpctl info -1

# æŸ¥çœ‹æŒ‡å®š PID çš„ core dump
coredumpctl info 12345

# æŸ¥çœ‹æŒ‡å®šç¨‹åºçš„æœ€è¿‘ core dump
coredumpctl info myapp
```

**ç¤ºä¾‹è¾“å‡º**ï¼š

```
           PID: 12345 (myapp)
           UID: 1000 (user)
           GID: 1000 (user)
        Signal: 11 (SEGV)
     Timestamp: Fri 2026-01-10 10:23:45 JST
  Command Line: /usr/local/bin/myapp --config /etc/myapp.conf
    Executable: /usr/local/bin/myapp
 Control Group: /user.slice/user-1000.slice/session-1.scope
          Unit: session-1.scope
        Coredump: /var/lib/systemd/coredump/core.myapp.1000.abc123.lz4

Message: Process 12345 (myapp) of user 1000 dumped core.

Stack trace of thread 12345:
#0  0x00007f1234567890 crash_function (myapp + 0x1234)
#1  0x00007f1234567abc main_loop (myapp + 0x5678)
#2  0x00007f1234567def main (myapp + 0x9abc)
#3  0x00007f12345678ab __libc_start_main (libc.so.6 + 0x21ab)
#4  0x00007f12345678cd _start (myapp + 0x1cd)
```

**å…³é”®ä¿¡æ¯è§£è¯»**ï¼š

| å­—æ®µ | å«ä¹‰ |
|------|------|
| Signal: 11 (SEGV) | æ®µé”™è¯¯ï¼ˆéæ³•å†…å­˜è®¿é—®ï¼‰ |
| Stack trace | å´©æºƒæ—¶çš„è°ƒç”¨æ ˆ |
| #0 | å´©æºƒå‘ç”Ÿçš„ä½ç½® |
| myapp + 0x1234 | ç¨‹åºå†…çš„åç§»åœ°å€ |

### 3.3 è°ƒè¯•å’Œå¯¼å‡º

```bash
# å¯åŠ¨ GDB è°ƒè¯•æœ€è¿‘çš„ core dump
coredumpctl debug -1

# è°ƒè¯•æŒ‡å®šç¨‹åºçš„æœ€è¿‘ core dump
coredumpctl debug myapp

# å¯¼å‡º core æ–‡ä»¶ï¼ˆç”¨äºç¦»çº¿åˆ†ææˆ–å‘é€ç»™å¼€å‘ï¼‰
coredumpctl dump -1 -o /tmp/core.myapp

# å¯¼å‡ºå¹¶å‹ç¼©
coredumpctl dump -1 | gzip > /tmp/core.myapp.gz
```

### 3.4 coredumpctl Cheatsheet

```bash
# ============================================
# coredumpctl é€ŸæŸ¥è¡¨
# ============================================

# åˆ—å‡ºæ‰€æœ‰ core dump
coredumpctl list

# åˆ—å‡ºæŒ‡å®šç¨‹åº
coredumpctl list <program>

# æŸ¥çœ‹æœ€è¿‘ core dump è¯¦æƒ…ï¼ˆå« backtraceï¼‰
coredumpctl info -1

# å¯åŠ¨ GDB è°ƒè¯•æœ€è¿‘ core
coredumpctl debug -1

# å¯¼å‡º core æ–‡ä»¶
coredumpctl dump -1 > /tmp/core

# æŒ‰æ—¶é—´è¿‡æ»¤
coredumpctl list --since "2026-01-10"
coredumpctl list --since "1 hour ago"

# æŒ‰ PID æŸ¥è¯¢
coredumpctl info <PID>
coredumpctl debug <PID>
```

---

## Step 4 -- GDB åŸºç¡€å´©æºƒåˆ†æï¼ˆ25 åˆ†é’Ÿï¼‰

### 4.1 GDB ç®€ä»‹

**GDB (GNU Debugger)** æ˜¯ Linux ä¸Šæœ€å¼ºå¤§çš„è°ƒè¯•å™¨ã€‚å¯¹äº core dump åˆ†æï¼Œæˆ‘ä»¬åªéœ€è¦æŒæ¡å‡ ä¸ªåŸºç¡€å‘½ä»¤ã€‚

### 4.2 å¯åŠ¨ GDB åˆ†æ Core Dump

```bash
# æ–¹å¼ 1ï¼šé€šè¿‡ coredumpctlï¼ˆæ¨èï¼‰
coredumpctl debug -1

# æ–¹å¼ 2ï¼šç›´æ¥ä½¿ç”¨ gdb
gdb /path/to/program /path/to/core

# æ–¹å¼ 3ï¼šé™„åŠ  core æ–‡ä»¶
gdb /path/to/program
(gdb) core /path/to/core
```

### 4.3 GDB æ ¸å¿ƒå‘½ä»¤

**è·å–è°ƒç”¨æ ˆï¼ˆæœ€é‡è¦ï¼‰**ï¼š

```gdb
# åŸºç¡€ backtrace
(gdb) bt
#0  0x00007f1234567890 in crash_function () at crash.c:42
#1  0x00007f1234567abc in process_data () at process.c:156
#2  0x00007f1234567def in main () at main.c:89

# å®Œæ•´ backtraceï¼ˆå«å±€éƒ¨å˜é‡ï¼‰
(gdb) bt full
#0  0x00007f1234567890 in crash_function () at crash.c:42
        ptr = 0x0
        len = 1024
#1  0x00007f1234567abc in process_data () at process.c:156
        buffer = 0x7ffc12345678 "input data..."

# æ‰€æœ‰çº¿ç¨‹çš„ backtrace
(gdb) thread apply all bt
```

**æŸ¥çœ‹æºä»£ç ä½ç½®**ï¼š

```gdb
# æ˜¾ç¤ºå´©æºƒä½ç½®çš„æºä»£ç 
(gdb) list
37      void crash_function(char *ptr) {
38          int len = strlen(ptr);  // ptr æ˜¯ NULLï¼
39          // ...
40      }

# æ˜¾ç¤ºæŒ‡å®šè¡Œ
(gdb) list crash.c:42
```

**æŸ¥çœ‹å¯„å­˜å™¨å’Œå†…å­˜**ï¼š

```gdb
# æŸ¥çœ‹å¯„å­˜å™¨
(gdb) info registers
rax            0x0                 0
rbx            0x7ffc12345678      140721234567800
rsp            0x7ffc12345600      0x7ffc12345600

# æŸ¥çœ‹æŒ‡å®šåœ°å€çš„å†…å­˜
(gdb) x/10x 0x7ffc12345678
```

**æŸ¥çœ‹å˜é‡å€¼**ï¼š

```gdb
# æ‰“å°å˜é‡
(gdb) print ptr
$1 = 0x0

# æ‰“å°æ•°ç»„
(gdb) print buffer
$2 = "input data..."

# æ‰“å°ç»“æ„ä½“
(gdb) print *config
$3 = {port = 8080, host = 0x55555555a0 "localhost"}
```

### 4.4 GDB Cheatsheet

```gdb
# ============================================
# GDB Core Dump åˆ†æé€ŸæŸ¥è¡¨
# ============================================

# è°ƒç”¨æ ˆåˆ†æ
bt                      # åŸºç¡€ backtrace
bt full                 # å«å±€éƒ¨å˜é‡
bt 10                   # åªæ˜¾ç¤º 10 å¸§
thread apply all bt     # æ‰€æœ‰çº¿ç¨‹

# æºä»£ç 
list                    # æ˜¾ç¤ºå½“å‰ä½ç½®
list file.c:42          # æ˜¾ç¤ºæŒ‡å®šè¡Œ

# å˜é‡
print var               # æ‰“å°å˜é‡
print *ptr              # è§£å¼•ç”¨æŒ‡é’ˆ
print array[0]          # æ•°ç»„å…ƒç´ 

# å¯„å­˜å™¨å’Œå†…å­˜
info registers          # æ‰€æœ‰å¯„å­˜å™¨
info reg rax            # æŒ‡å®šå¯„å­˜å™¨
x/10x addr              # æŸ¥çœ‹å†…å­˜

# çº¿ç¨‹
info threads            # çº¿ç¨‹åˆ—è¡¨
thread 2                # åˆ‡æ¢åˆ°çº¿ç¨‹ 2

# å¸§åˆ‡æ¢
frame 0                 # åˆ‡æ¢åˆ°å¸§ 0
up                      # ä¸Šä¸€å¸§
down                    # ä¸‹ä¸€å¸§

# é€€å‡º
quit                    # é€€å‡º GDB
```

### 4.5 å®æˆ˜ç¤ºä¾‹ï¼šåˆ†æç©ºæŒ‡é’ˆå´©æºƒ

**åœºæ™¯**ï¼šç¨‹åºå´©æºƒï¼Œcoredumpctl info æ˜¾ç¤º SIGSEGVã€‚

```bash
# 1. æŸ¥çœ‹ core dump ä¿¡æ¯
coredumpctl info -1

# è¾“å‡ºæ˜¾ç¤ºï¼š
# Signal: 11 (SEGV)
# Stack trace:
# #0  strlen () at strlen.S:42
# #1  process_input () at input.c:28
# #2  main () at main.c:15

# 2. å¯åŠ¨ GDB è¯¦ç»†åˆ†æ
coredumpctl debug -1
```

**GDB åˆ†æè¿‡ç¨‹**ï¼š

```gdb
# è¿›å…¥ GDB å
(gdb) bt
#0  0x00007f123456 in strlen () from /lib64/libc.so.6
#1  0x00000040089a in process_input (data=0x0) at input.c:28
#2  0x000000400756 in main () at main.c:15

# çœ‹åˆ° #1 å¸§çš„ data=0x0ï¼ˆç©ºæŒ‡é’ˆï¼ï¼‰

# åˆ‡æ¢åˆ° #1 å¸§æŸ¥çœ‹è¯¦æƒ…
(gdb) frame 1
#1  0x00000040089a in process_input (data=0x0) at input.c:28
28          len = strlen(data);

# ç¡®è®¤æ˜¯ç©ºæŒ‡é’ˆä¼ å…¥
(gdb) print data
$1 = 0x0

# æŸ¥çœ‹è°ƒç”¨è€…
(gdb) frame 2
#2  0x000000400756 in main () at main.c:15
15          process_input(user_data);

(gdb) print user_data
$2 = 0x0

# ç»“è®ºï¼šmain() ä¼ å…¥äº†ç©ºæŒ‡é’ˆ user_data åˆ° process_input()
```

---

## Step 5 -- å¸¸è§å´©æºƒä¿¡å·ï¼ˆ15 åˆ†é’Ÿï¼‰

### 5.1 ä¿¡å·æ¦‚è§ˆ

<!-- DIAGRAM: crash-signals -->
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¸¸è§å´©æºƒä¿¡å·é€ŸæŸ¥                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  ä¿¡å·       ç¼–å·    å«ä¹‰                  å¸¸è§åŸå›                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚                                                                      â”‚
â”‚  SIGSEGV    11     æ®µé”™è¯¯               â€¢ ç©ºæŒ‡é’ˆè§£å¼•ç”¨               â”‚
â”‚                    (Segmentation       â€¢ è®¿é—®å·²é‡Šæ”¾å†…å­˜              â”‚
â”‚                     Fault)             â€¢ æ•°ç»„è¶Šç•Œ                    â”‚
â”‚                                        â€¢ æ ˆæº¢å‡º                      â”‚
â”‚                                                                      â”‚
â”‚  SIGBUS      7     æ€»çº¿é”™è¯¯            â€¢ æœªå¯¹é½å†…å­˜è®¿é—®              â”‚
â”‚                    (Bus Error)         â€¢ æ˜ å°„æ–‡ä»¶è¢«æˆªæ–­              â”‚
â”‚                                        â€¢ ç¡¬ä»¶é—®é¢˜                    â”‚
â”‚                                                                      â”‚
â”‚  SIGABRT     6     ç¨‹åºè‡ªæˆ‘ç»ˆæ­¢        â€¢ assert() å¤±è´¥               â”‚
â”‚                    (Abort)             â€¢ abort() è°ƒç”¨                â”‚
â”‚                                        â€¢ å†…å­˜åˆ†é…å¤±è´¥                â”‚
â”‚                                        â€¢ C++ å¼‚å¸¸æœªæ•è·              â”‚
â”‚                                                                      â”‚
â”‚  SIGFPE      8     æµ®ç‚¹å¼‚å¸¸            â€¢ é™¤é›¶                        â”‚
â”‚                    (Floating Point     â€¢ æ•´æ•°æº¢å‡º                    â”‚
â”‚                     Exception)         â€¢ æ— æ•ˆæµ®ç‚¹æ“ä½œ                â”‚
â”‚                                                                      â”‚
â”‚  SIGILL      4     éæ³•æŒ‡ä»¤            â€¢ æŸåçš„äºŒè¿›åˆ¶                â”‚
â”‚                    (Illegal           â€¢ CPU ä¸æ”¯æŒçš„æŒ‡ä»¤             â”‚
â”‚                     Instruction)       â€¢ å†…å­˜æŸå                    â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
<!-- /DIAGRAM -->

### 5.2 ä¿¡å·è¯¦è§£

#### SIGSEGV (Signal 11) - æ®µé”™è¯¯

**æœ€å¸¸è§çš„å´©æºƒä¿¡å·**ã€‚è¡¨ç¤ºç¨‹åºè¯•å›¾è®¿é—®æ— æ•ˆå†…å­˜ã€‚

**å¸¸è§åŸå› **ï¼š
```c
// 1. ç©ºæŒ‡é’ˆè§£å¼•ç”¨
char *ptr = NULL;
printf("%s", ptr);  // SIGSEGV!

// 2. è®¿é—®å·²é‡Šæ”¾å†…å­˜
free(buffer);
printf("%s", buffer);  // SIGSEGV!

// 3. æ•°ç»„è¶Šç•Œ
int arr[10];
arr[100] = 42;  // SIGSEGV!

// 4. æ ˆæº¢å‡ºï¼ˆæ— é™é€’å½’ï¼‰
void recurse() { recurse(); }  // SIGSEGV!
```

**GDB åˆ†æè¦ç‚¹**ï¼š
```gdb
(gdb) bt
# æŸ¥çœ‹å´©æºƒä½ç½®ï¼Œé€šå¸¸æ˜¯æŸä¸ªæŒ‡é’ˆæ“ä½œ
(gdb) print ptr
# æ£€æŸ¥ç›¸å…³æŒ‡é’ˆæ˜¯å¦ä¸º 0x0 æˆ–å¼‚å¸¸åœ°å€
```

#### SIGBUS (Signal 7) - æ€»çº¿é”™è¯¯

**è®¿é—®ç‰©ç†ä¸Šä¸å­˜åœ¨æˆ–æœªå¯¹é½çš„å†…å­˜åœ°å€**ã€‚

**å¸¸è§åŸå› **ï¼š
```c
// 1. æœªå¯¹é½è®¿é—®ï¼ˆæŸäº›æ¶æ„ï¼‰
char buf[10];
int *ptr = (int*)(buf + 1);  // æœªå¯¹é½
*ptr = 42;  // SIGBUS!

// 2. mmap æ–‡ä»¶è¢«æˆªæ–­
int fd = open("file", O_RDWR);
char *map = mmap(..., fd, ...);
// å¦ä¸€ä¸ªè¿›ç¨‹ truncate äº†æ–‡ä»¶
map[1000] = 'x';  // SIGBUS!
```

#### SIGABRT (Signal 6) - ä¸­æ­¢ä¿¡å·

**ç¨‹åºä¸»åŠ¨è¯·æ±‚ç»ˆæ­¢**ã€‚é€šå¸¸æ˜¯æ£€æµ‹åˆ°å†…éƒ¨é”™è¯¯ã€‚

**å¸¸è§åŸå› **ï¼š
```c
// 1. assert å¤±è´¥
assert(ptr != NULL);  // å¦‚æœ ptr ä¸º NULLï¼ŒSIGABRT

// 2. æ˜¾å¼è°ƒç”¨ abort()
if (critical_error) {
    abort();  // SIGABRT
}

// 3. C++ æœªæ•è·å¼‚å¸¸
throw std::runtime_error("error");  // æœª catchï¼ŒSIGABRT

// 4. glibc æ£€æµ‹åˆ°å†…å­˜æŸå
// åŒé‡ freeã€å †æº¢å‡ºç­‰
free(ptr);
free(ptr);  // double freeï¼ŒSIGABRT
```

**GDB åˆ†æè¦ç‚¹**ï¼š
```gdb
(gdb) bt
# æŸ¥æ‰¾ __GI_abort, __assert_fail ç­‰
# å‘ä¸Šè¿½æº¯æ‰¾åˆ°çœŸæ­£çš„é”™è¯¯æ£€æŸ¥ç‚¹
```

#### SIGFPE (Signal 8) - æµ®ç‚¹å¼‚å¸¸

**ç®—æœ¯é”™è¯¯**ã€‚ä¸ä»…é™äºæµ®ç‚¹ï¼Œæ•´æ•°é™¤é›¶ä¹Ÿä¼šè§¦å‘ã€‚

**å¸¸è§åŸå› **ï¼š
```c
// 1. æ•´æ•°é™¤é›¶
int a = 10;
int b = 0;
int c = a / b;  // SIGFPE!

// 2. æµ®ç‚¹æº¢å‡º/ä¸‹æº¢ï¼ˆéœ€è¦å¯ç”¨ FPE é™·é˜±ï¼‰
```

### 5.3 ä¿¡å·ä¸ Core Dump çš„å…³ç³»

```bash
# æŸ¥çœ‹å“ªäº›ä¿¡å·ä¼šç”Ÿæˆ core dump
# é»˜è®¤ï¼šSIGQUIT, SIGILL, SIGTRAP, SIGABRT, SIGFPE, SIGSEGV, SIGBUS, SIGSYS, SIGXCPU, SIGXFSZ

# æ‰‹åŠ¨å‘é€ä¿¡å·ï¼ˆæµ‹è¯•ç”¨ï¼‰
kill -SIGSEGV <pid>   # å¼ºåˆ¶ SIGSEGVï¼ˆæ¨¡æ‹Ÿå´©æºƒï¼‰
kill -SIGABRT <pid>   # å¼ºåˆ¶ SIGABRT
```

---

## Step 6 -- debuginfod è‡ªåŠ¨ç¬¦å·è·å–ï¼ˆ10 åˆ†é’Ÿï¼‰

### 6.1 ä»€ä¹ˆæ˜¯ debuginfodï¼Ÿ

**é—®é¢˜**ï¼šç”Ÿäº§ç¯å¢ƒçš„ç¨‹åºé€šå¸¸æ²¡æœ‰è°ƒè¯•ç¬¦å·ï¼ˆstrippedï¼‰ï¼ŒGDB åªèƒ½æ˜¾ç¤ºåœ°å€ï¼Œä¸æ˜¾ç¤ºå‡½æ•°åå’Œè¡Œå·ã€‚

**ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆ**ï¼šæ‰‹åŠ¨ä¸‹è½½ debuginfo åŒ…ã€‚

**ç°ä»£æ–¹æ¡ˆ**ï¼šdebuginfod è‡ªåŠ¨ä»ç½‘ç»œè·å–è°ƒè¯•ç¬¦å·ã€‚

### 6.2 debuginfod å·¥ä½œåŸç†

<!-- DIAGRAM: debuginfod-flow -->
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    debuginfod å·¥ä½œæµç¨‹                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  GDB åˆ†æ   â”‚     â”‚  æ£€æŸ¥ ELF   â”‚     â”‚  æŸ¥è¯¢ debuginfod    â”‚   â”‚
â”‚   â”‚  core dump  â”‚ â”€â”€â–¶ â”‚  build-id   â”‚ â”€â”€â–¶ â”‚  æœåŠ¡å™¨             â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                       â”‚              â”‚
â”‚                                                       â–¼              â”‚
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                       â”‚  debuginfod æœåŠ¡å™¨                         â”‚ â”‚
â”‚                       â”‚  â€¢ Fedora: https://debuginfod.fedoraproject.org â”‚
â”‚                       â”‚  â€¢ Ubuntu: https://debuginfod.ubuntu.com   â”‚ â”‚
â”‚                       â”‚  â€¢ Debian: https://debuginfod.debian.net   â”‚ â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                       â”‚              â”‚
â”‚                                                       â–¼              â”‚
â”‚                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                                            â”‚  ä¸‹è½½è°ƒè¯•ç¬¦å·       â”‚   â”‚
â”‚                                            â”‚  ç¼“å­˜åˆ°æœ¬åœ°         â”‚   â”‚
â”‚                                            â”‚  ~/.cache/debuginfodâ”‚   â”‚
â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
<!-- /DIAGRAM -->

### 6.3 é…ç½® debuginfod

```bash
# æ£€æŸ¥æ˜¯å¦å·²é…ç½®
echo $DEBUGINFOD_URLS

# è®¾ç½® debuginfod æœåŠ¡å™¨ï¼ˆæ ¹æ®å‘è¡Œç‰ˆé€‰æ‹©ï¼‰

# Fedora / RHEL
export DEBUGINFOD_URLS="https://debuginfod.fedoraproject.org/"

# Ubuntu
export DEBUGINFOD_URLS="https://debuginfod.ubuntu.com/"

# Debian
export DEBUGINFOD_URLS="https://debuginfod.debian.net/"

# æ°¸ä¹…é…ç½®ï¼ˆæ·»åŠ åˆ° ~/.bashrc æˆ– /etc/profile.d/ï¼‰
echo 'export DEBUGINFOD_URLS="https://debuginfod.fedoraproject.org/"' >> ~/.bashrc
```

### 6.4 éªŒè¯ debuginfod

```bash
# å®‰è£… debuginfod-find å·¥å…·ï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
# RHEL/Fedora
sudo dnf install elfutils-debuginfod-client

# Ubuntu/Debian
sudo apt install debuginfod

# æµ‹è¯•ï¼šæŸ¥æ‰¾ libc çš„è°ƒè¯•ç¬¦å·
debuginfod-find debuginfo /lib64/libc.so.6
# åº”è¯¥ä¸‹è½½å¹¶æ˜¾ç¤ºè·¯å¾„
```

### 6.5 2025-2026 debuginfod é‡‡ç”¨çŠ¶æ€

| å‘è¡Œç‰ˆ | å®˜æ–¹æœåŠ¡å™¨ | çŠ¶æ€ |
|--------|------------|------|
| Fedora | debuginfod.fedoraproject.org | å®Œå…¨æ”¯æŒ |
| Ubuntu 22.04+ | debuginfod.ubuntu.com | å®Œå…¨æ”¯æŒ |
| Debian 12+ | debuginfod.debian.net | å®Œå…¨æ”¯æŒ |
| RHEL 8/9 | ä½¿ç”¨ Fedora æœåŠ¡å™¨ | æ”¯æŒ |
| Amazon Linux 2023 | æ— å®˜æ–¹æœåŠ¡å™¨ | éœ€æ‰‹åŠ¨ä¸‹è½½ |

**ç”Ÿäº§ç¯å¢ƒå»ºè®®**ï¼š
- å¦‚æœå…¬å¸æœ‰å®‰å…¨é™åˆ¶ï¼Œå¯ä»¥æ­å»ºå†…éƒ¨ debuginfod æœåŠ¡å™¨
- æˆ–é¢„å…ˆä¸‹è½½ debuginfo åŒ…åˆ°æœ¬åœ°

---

## Step 7 -- äº‹æ•…åœºæ™¯ï¼š"æ¶ˆå¤±çš„ Core Dump"ï¼ˆ15 åˆ†é’Ÿï¼‰

### 7.1 åœºæ™¯æè¿°

**èƒŒæ™¯**ï¼š
- ç”Ÿäº§ç¯å¢ƒçš„ Java åº”ç”¨æ¯å¤©å´©æºƒ 1-2 æ¬¡
- å¼€å‘è¦æ±‚æä¾› core dump åˆ†æ
- ä½†æ˜¯ `/var/coredumps` ç›®å½•æ˜¯ç©ºçš„
- coredumpctl list ä¹Ÿæ²¡æœ‰è®°å½•

**ç—‡çŠ¶**ï¼š
```bash
# æ£€æŸ¥ core dump è®°å½•
$ coredumpctl list
No coredumps found.

# æ£€æŸ¥ç›®å½•
$ ls /var/coredumps/
(empty)

# ä½†è¿›ç¨‹ç¡®å®å´©æºƒäº†
$ journalctl -u myapp --since "1 hour ago"
Jan 10 10:23:45 server systemd[1]: myapp.service: Main process exited, code=killed, status=11/SEGV
Jan 10 10:23:45 server systemd[1]: myapp.service: Failed with result 'signal'.
```

### 7.2 æ’æŸ¥æ­¥éª¤

**Step 1ï¼šæ£€æŸ¥ ulimit**

```bash
# æ£€æŸ¥æœåŠ¡çš„ ulimit
$ systemctl show myapp | grep LimitCORE
LimitCORE=0
LimitCORESoft=0

# é—®é¢˜æ‰¾åˆ°ï¼æœåŠ¡çš„ core é™åˆ¶æ˜¯ 0
```

**Step 2ï¼šæ£€æŸ¥ systemd service é…ç½®**

```bash
$ cat /etc/systemd/system/myapp.service
[Service]
# æ²¡æœ‰è®¾ç½® LimitCOREï¼Œé»˜è®¤å¯èƒ½æ˜¯ 0
```

**Step 3ï¼šä¿®å¤é…ç½®**

```bash
# ç¼–è¾‘ service æ–‡ä»¶
sudo systemctl edit myapp.service

# æ·»åŠ ä»¥ä¸‹å†…å®¹
[Service]
LimitCORE=infinity

# æˆ–è€…ç³»ç»Ÿçº§è®¾ç½®
sudo mkdir -p /etc/systemd/system.conf.d
sudo tee /etc/systemd/system.conf.d/core.conf << 'EOF'
[Manager]
DefaultLimitCORE=infinity
EOF

# é‡æ–°åŠ è½½
sudo systemctl daemon-reload
sudo systemctl restart myapp
```

**Step 4ï¼šéªŒè¯é…ç½®ç”Ÿæ•ˆ**

```bash
# æ£€æŸ¥æœåŠ¡çš„ ulimit
$ systemctl show myapp | grep LimitCORE
LimitCORE=infinity
LimitCORESoft=infinity

# æ£€æŸ¥ core_pattern
$ cat /proc/sys/kernel/core_pattern
|/usr/lib/systemd/systemd-coredump %P %u %g %s %t %c %h
```

**Step 5ï¼šæµ‹è¯• core dump ç”Ÿæˆ**

```bash
# æ‰‹åŠ¨è§¦å‘å´©æºƒï¼ˆæµ‹è¯•ç”¨ï¼‰
$ kill -SIGSEGV $(pgrep myapp)

# æ£€æŸ¥æ˜¯å¦ç”Ÿæˆ
$ coredumpctl list
TIME                           PID  UID  GID SIG     COREFILE EXE
Fri 2026-01-10 10:45:00 JST  12345 1000 1000 SIGSEGV present  /usr/local/bin/myapp

# æˆåŠŸï¼
```

### 7.3 å¸¸è§åŸå› æ¸…å•

| åŸå›  | æ£€æŸ¥æ–¹æ³• | ä¿®å¤æ–¹æ³• |
|------|----------|----------|
| ulimit -c 0 | `ulimit -c` | `ulimit -c unlimited` |
| service LimitCORE=0 | `systemctl show <svc>` | æ·»åŠ  `LimitCORE=infinity` |
| core_pattern è·¯å¾„ä¸å­˜åœ¨ | `cat /proc/sys/kernel/core_pattern` | åˆ›å»ºç›®å½•æˆ–æ”¹è·¯å¾„ |
| systemd-coredump Storage=none | `/etc/systemd/coredump.conf` | æ”¹ä¸º `Storage=external` |
| setuid ç¨‹åº | `ls -l <binary>` | è®¾ç½® `fs.suid_dumpable=2` |
| ç£ç›˜ç©ºé—´ä¸è¶³ | `df -h` | æ¸…ç†ç©ºé—´ |
| ProcessSizeMax å¤ªå° | `/etc/systemd/coredump.conf` | å¢å¤§é™åˆ¶ |

---

## åŠ¨æ‰‹å®éªŒï¼ˆ20 åˆ†é’Ÿï¼‰

### å®éªŒ 1ï¼šé…ç½® Core Dump æ”¶é›†

**ç›®æ ‡**ï¼šç¡®ä¿ç³»ç»Ÿèƒ½æ­£ç¡®æ”¶é›† core dumpã€‚

```bash
# 1. æ£€æŸ¥å½“å‰é…ç½®
ulimit -c
cat /proc/sys/kernel/core_pattern
coredumpctl list

# 2. ç¡®ä¿ systemd-coredump æ­£ç¡®é…ç½®
sudo cat /etc/systemd/coredump.conf

# 3. åˆ›å»ºæµ‹è¯•ç¨‹åº
cat > /tmp/crash.c << 'EOF'
#include <stdio.h>
#include <string.h>

int main() {
    char *ptr = NULL;
    printf("About to crash...\n");
    printf("%s\n", ptr);  // NULL pointer dereference
    return 0;
}
EOF

# 4. ç¼–è¯‘ï¼ˆä¿ç•™è°ƒè¯•ç¬¦å·ï¼‰
gcc -g -o /tmp/crash /tmp/crash.c

# 5. è¿è¡Œå´©æºƒç¨‹åº
/tmp/crash

# 6. æ£€æŸ¥ core dump
coredumpctl list
coredumpctl info -1
```

### å®éªŒ 2ï¼šä½¿ç”¨ GDB åˆ†æå´©æºƒ

**ç›®æ ‡**ï¼šä½¿ç”¨ GDB å®šä½å´©æºƒåŸå› ã€‚

```bash
# 1. å¯åŠ¨ GDB åˆ†æ
coredumpctl debug -1

# 2. åœ¨ GDB ä¸­æ‰§è¡Œ
(gdb) bt
# åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š
# #0  __strlen_sse2 () at strlen.S:xx
# #1  printf () at ...
# #2  main () at /tmp/crash.c:7

(gdb) bt full
# æŸ¥çœ‹å±€éƒ¨å˜é‡

(gdb) frame 2
# åˆ‡æ¢åˆ° main å¸§

(gdb) print ptr
# åº”è¯¥æ˜¾ç¤º $1 = 0x0

(gdb) list
# æ˜¾ç¤ºæºä»£ç 

(gdb) quit
```

### å®éªŒ 3ï¼šæ¨¡æ‹Ÿ"æ¶ˆå¤±çš„ Core Dump"å¹¶ä¿®å¤

**ç›®æ ‡**ï¼šä½“éªŒæ’æŸ¥ core dump ä¸ç”Ÿæˆçš„é—®é¢˜ã€‚

```bash
# 1. ä¸´æ—¶ç¦ç”¨ core dump
ulimit -c 0

# 2. å°è¯•ç”Ÿæˆå´©æºƒ
/tmp/crash

# 3. æ£€æŸ¥ - åº”è¯¥æ²¡æœ‰æ–°è®°å½•
coredumpctl list

# 4. ä¿®å¤
ulimit -c unlimited

# 5. å†æ¬¡å´©æºƒ
/tmp/crash

# 6. éªŒè¯
coredumpctl list
# ç°åœ¨åº”è¯¥æœ‰è®°å½•äº†
```

---

## æ—¥æœ¬ IT èŒåœºï¼šCore Dump å®è·µ

### 8.1 æ ¸å¿ƒæ—¥è¯­æœ¯è¯­

| æ—¥è¯­ | è¯»éŸ³ | å«ä¹‰ | ä½¿ç”¨åœºæ™¯ |
|------|------|------|----------|
| **ã‚³ã‚¢ãƒ€ãƒ³ãƒ—** | koa danpu | Core dump | "ã‚³ã‚¢ãƒ€ãƒ³ãƒ—ã‚’å–å¾—ã—ã¦ãã ã•ã„" |
| **ã‚¯ãƒ©ãƒƒã‚·ãƒ¥** | kurasshu | Crash | "ã‚¢ãƒ—ãƒªãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ãŸ" |
| **ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹** | sutakku toreesu | Stack trace | "ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’ç¢ºèª" |
| **ãƒ‡ãƒãƒƒã‚°æƒ…å ±** | debaggu jouhou | Debug info | "ãƒ‡ãƒãƒƒã‚°æƒ…å ±ä»˜ãã§ãƒ“ãƒ«ãƒ‰" |
| **ã‚»ã‚°ãƒ•ã‚©** | segufo | Segfault (ä¿—è¯­) | "ã‚»ã‚°ãƒ•ã‚©ã§è½ã¡ãŸ" |

### 8.2 ä¸å¼€å‘å›¢é˜Ÿåä½œ

```
è¿ç»´å‘ç°å´©æºƒ
     â”‚
     â–¼
åé›†ï¼ˆcore dump, ãƒ­ã‚°, ç’°å¢ƒæƒ…å ±ï¼‰
     â”‚
     â–¼
å ±å‘Šï¼ˆé–‹ç™ºãƒãƒ¼ãƒ ã¸ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
     â”‚
     â–¼
åˆ†æï¼ˆé–‹ç™ºã¨é‹ç¶­ã§å”åŠ›ï¼‰
     â”‚
     â–¼
ä¿®æ­£ï¼ˆé–‹ç™ºãŒãƒ‘ãƒƒãƒä½œæˆï¼‰
     â”‚
     â–¼
ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆé‹ç¶­ãŒæœ¬ç•ªé©ç”¨ï¼‰
```

**æŠ¥å‘Šæ¨¡æ¿**ï¼š

```markdown
# ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ãƒ¬ãƒãƒ¼ãƒˆ

## æ¦‚è¦
- ç™ºç”Ÿæ—¥æ™‚: 2026-01-10 10:23:45 JST
- å¯¾è±¡ã‚µãƒ¼ãƒãƒ¼: prod-web-01
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³: myapp v2.3.1
- ã‚·ã‚°ãƒŠãƒ«: SIGSEGV (11)

## ç’°å¢ƒæƒ…å ±
- OS: Rocky Linux 9.3
- ã‚«ãƒ¼ãƒãƒ«: 5.14.0-362.el9.x86_64
- ãƒ¡ãƒ¢ãƒª: 16GB (ä½¿ç”¨ç‡ 65%)

## ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹
(coredumpctl info ã‹ã‚‰ã‚³ãƒ”ãƒ¼)

## Core Dump
- å ´æ‰€: /var/lib/systemd/coredump/core.myapp.xxx
- ã‚µã‚¤ã‚º: 2.1MB
- â€»å¿…è¦ã§ã‚ã‚Œã°è»¢é€å¯èƒ½

## å†ç¾æ‰‹é †
1. XXX
2. XXX

## å‚™è€ƒ
- åŒæ§˜ã®ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã¯ä»Šé€± 3 å›ç™ºç”Ÿ
- ç›´å‰ã«ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ãŒæ€¥å¢—ã—ã¦ã„ãŸ
```

### 8.3 èŒåœºæç¤º

> **ã‚¯ãƒ©ãƒƒã‚·ãƒ¥åˆ†æã¯é–‹ç™ºã¨ã®é€£æºãŒå¤šã„**  
> (å´©æºƒåˆ†æéœ€è¦é¢‘ç¹ä¸å¼€å‘å›¢é˜Ÿåä½œ)  

- Core dump æ˜¯ä¸å¼€å‘æ²Ÿé€šçš„é‡è¦è¯æ®
- è¿ç»´è´Ÿè´£æ”¶é›†å’Œåˆæ­¥åˆ†æï¼Œå¼€å‘è´Ÿè´£æ·±å…¥ä¿®å¤
- ä¿å­˜ core dump ä½œä¸ºè¯æ®ï¼ˆä¸è¦ç«‹å³åˆ é™¤ï¼‰
- è®°å½•å´©æºƒæ—¶çš„ç¯å¢ƒçŠ¶æ€ï¼ˆå†…å­˜ã€CPUã€æ—¥å¿—ï¼‰

> **è¨¼æ‹ ã¨ã—ã¦ core dump ã‚’ä¿å­˜**  
> (ä½œä¸ºè¯æ®ä¿å­˜ core dump)  

- é»˜è®¤ systemd-coredump ä¼šè‡ªåŠ¨è½®è½¬åˆ é™¤æ—§çš„ core dump
- é‡è¦çš„ core dump åº”è¯¥å¯¼å‡ºå¹¶å½’æ¡£
- ä½¿ç”¨ `coredumpctl dump -o /path/to/archive/` å¯¼å‡º

---

## æ£€æŸ¥æ¸…å•

å®Œæˆæœ¬è¯¾åï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

- [ ] è§£é‡Šä»€ä¹ˆæ˜¯ core dump ä»¥åŠå®ƒçš„ä½œç”¨
- [ ] æ£€æŸ¥ç³»ç»Ÿçš„ core dump é…ç½®ï¼ˆulimit, core_patternï¼‰
- [ ] ä½¿ç”¨ `coredumpctl list` åˆ—å‡ºç³»ç»Ÿä¸Šçš„ core dump
- [ ] ä½¿ç”¨ `coredumpctl info` æŸ¥çœ‹ core dump è¯¦æƒ…
- [ ] ä½¿ç”¨ `coredumpctl debug` å¯åŠ¨ GDB åˆ†æ
- [ ] åœ¨ GDB ä¸­ä½¿ç”¨ `bt`, `bt full`, `print` å‘½ä»¤
- [ ] è§£é‡Š SIGSEGV, SIGBUS, SIGABRT, SIGFPE çš„å«ä¹‰
- [ ] é…ç½® debuginfod è‡ªåŠ¨è·å–è°ƒè¯•ç¬¦å·
- [ ] æ’æŸ¥ core dump ä¸ç”Ÿæˆçš„é—®é¢˜
- [ ] å¯¼å‡º core dump æ–‡ä»¶ç”¨äºå½’æ¡£æˆ–å‘é€ç»™å¼€å‘

---

## æœ¬è¯¾å°ç»“

| æ¦‚å¿µ | è¦ç‚¹ |
|------|------|
| Core Dump | ç¨‹åºå´©æºƒæ—¶çš„å†…å­˜å¿«ç…§ï¼Œæ˜¯åˆ†æå´©æºƒçš„å…³é”®è¯æ® |
| systemd-coredump | ç°ä»£ Linux æ¨èçš„ core dump ç®¡ç†æ–¹å¼ |
| coredumpctl | ç»Ÿä¸€ç®¡ç† core dump çš„å‘½ä»¤è¡Œå·¥å…· |
| GDB åŸºç¡€ | bt (backtrace), bt full, print, list |
| SIGSEGV | æ®µé”™è¯¯ï¼Œæœ€å¸¸è§çš„å´©æºƒä¿¡å·ï¼Œé€šå¸¸æ˜¯ç©ºæŒ‡é’ˆæˆ–è¶Šç•Œ |
| SIGABRT | ç¨‹åºä¸»åŠ¨ä¸­æ­¢ï¼Œassert å¤±è´¥æˆ– double free |
| debuginfod | 2025+ è‡ªåŠ¨è·å–è°ƒè¯•ç¬¦å·çš„ç°ä»£æ–¹æ¡ˆ |
| æ¶ˆå¤±çš„ Core | æ£€æŸ¥ ulimit, LimitCORE, core_pattern |

**æ ¸å¿ƒç†å¿µ**ï¼š

> Core dump æ˜¯ç¨‹åºå´©æºƒçš„"é»‘åŒ£å­"ã€‚  
> systemd-coredump + coredumpctl æ˜¯ç°ä»£æœ€ä½³å®è·µã€‚  
> coredumpctl info å·²åŒ…å«åŸºç¡€ backtraceã€‚  
> ä¿å­˜ core dump ä½œä¸ºè¯æ®ï¼Œä¸å¼€å‘åä½œåˆ†æã€‚  

---

## é¢è¯•å‡†å¤‡

### ã‚ˆãã‚ã‚‹è³ªå•ï¼ˆå¸¸è§é—®é¢˜ï¼‰

**Q: Core dump ã¨ã¯ä½•ã§ã™ã‹ï¼Ÿ**

A: ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒç•°å¸¸çµ‚äº†ã—ãŸæ™‚ã«ã€ãã®æ™‚ç‚¹ã®ãƒ¡ãƒ¢ãƒªçŠ¶æ…‹ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ãŸã‚‚ã®ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã®åŸå› ã‚’å¾Œã‹ã‚‰åˆ†æã§ãã¾ã™ã€‚ã€Œé£›è¡Œæ©Ÿã®ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã€ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚

**Q: Core dump ãŒç”Ÿæˆã•ã‚Œãªã„å ´åˆã€ã©ã†ã‚„ã£ã¦èª¿æŸ»ã—ã¾ã™ã‹ï¼Ÿ**

A: ä»¥ä¸‹ã®é †åºã§ç¢ºèªã—ã¾ã™ï¼š
1. `ulimit -c` ã§ã‚·ã‚§ãƒ«ã®åˆ¶é™ã‚’ç¢ºèª
2. `systemctl show <service>` ã§ LimitCORE ã‚’ç¢ºèª
3. `/proc/sys/kernel/core_pattern` ã§ãƒ‘ã‚¹ã‚’ç¢ºèª
4. `/etc/systemd/coredump.conf` ã§ Storage è¨­å®šã‚’ç¢ºèª
5. ãƒ‡ã‚£ã‚¹ã‚¯ç©ºãå®¹é‡ã‚’ç¢ºèª

**Q: SIGSEGV ã¨ SIGABRT ã®é•ã„ã¯ï¼Ÿ**

A:
- **SIGSEGV (11)**: ã‚«ãƒ¼ãƒãƒ«ãŒæ¤œå‡ºã—ãŸä¸æ­£ãƒ¡ãƒ¢ãƒªã‚¢ã‚¯ã‚»ã‚¹ã€‚NULL ãƒã‚¤ãƒ³ã‚¿ã‚„é…åˆ—è¶Šå¢ƒãŒä¸»ãªåŸå› 
- **SIGABRT (6)**: ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒè‡ªã‚‰çµ‚äº†ã‚’è¦æ±‚ã€‚assert å¤±æ•—ã‚„ double free ã§ glibc ãŒæ¤œå‡º

**Q: coredumpctl ã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ã‚’æ•™ãˆã¦ãã ã•ã„**

A:
```bash
coredumpctl list          # ä¸€è¦§è¡¨ç¤º
coredumpctl info -1       # æœ€æ–°ã®è©³ç´°ï¼ˆã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹å«ã‚€ï¼‰
coredumpctl debug -1      # GDB ã§åˆ†æ
coredumpctl dump -1 > file  # ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
```

**Q: debuginfod ã¨ã¯ä½•ã§ã™ã‹ï¼Ÿ**

A: ãƒ‡ãƒãƒƒã‚°ã‚·ãƒ³ãƒœãƒ«ã‚’è‡ªå‹•çš„ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰å–å¾—ã™ã‚‹ä»•çµ„ã¿ã§ã™ã€‚2025 å¹´ç¾åœ¨ã€ä¸»è¦ãª Linux ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆFedora, Ubuntu, Debianï¼‰ãŒå…¬å¼ã‚µãƒ¼ãƒãƒ¼ã‚’æä¾›ã—ã¦ãŠã‚Šã€GDB åˆ†ææ™‚ã«ã‚·ãƒ³ãƒœãƒ«æƒ…å ±ã‚’è‡ªå‹•å–å¾—ã§ãã¾ã™ã€‚

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆæœ¬èª²è‡ªä½“ã®å•é¡Œè§£æ±ºï¼‰

### coredumpctl ã‚³ãƒãƒ³ãƒ‰ãŒè¦‹ã¤ã‹ã‚‰ãªã„

```bash
# RHEL/Fedora
sudo dnf install systemd-coredump

# Ubuntu/Debian
sudo apt install systemd-coredump
```

### GDB ã§ã‚·ãƒ³ãƒœãƒ«ãŒè¡¨ç¤ºã•ã‚Œãªã„

```bash
# debuginfo ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

# RHEL/Fedora
sudo dnf debuginfo-install <package>

# Ubuntu/Debian
# -dbgsym ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æœ‰åŠ¹åŒ–ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt install <package>-dbgsym

# ã¾ãŸã¯ debuginfod ã‚’è¨­å®š
export DEBUGINFOD_URLS="https://debuginfod.fedoraproject.org/"
```

### core dump ãŒã™ãã«æ¶ˆãˆã‚‹

```bash
# systemd-coredump ã®ä¿æŒè¨­å®šã‚’ç¢ºèª
cat /etc/systemd/coredump.conf

# MaxUse ã‚„ KeepFree ã‚’èª¿æ•´
sudo vim /etc/systemd/coredump.conf
# MaxUse=10G  # ä¿æŒã™ã‚‹æœ€å¤§ã‚µã‚¤ã‚º
```

---

## å»¶ä¼¸é˜…è¯»

- [systemd-coredump å®˜æ–¹æ–‡æ¡£](https://www.freedesktop.org/software/systemd/man/systemd-coredump.html)
- [GDB å®˜æ–¹æ–‡æ¡£](https://sourceware.org/gdb/current/onlinedocs/gdb/)
- [debuginfod é¡¹ç›®](https://sourceware.org/elfutils/Debuginfod.html)
- [Brendan Gregg - Core Dump åˆ†æ](https://www.brendangregg.com/)
- ä¸Šä¸€è¯¾ï¼š[08 - strace ç³»ç»Ÿè°ƒç”¨è¿½è¸ª](../08-strace/)
- ä¸‹ä¸€è¯¾ï¼š[10 - Capstone: æ ¹å› åˆ†æä¸éšœå®³å ±å‘Šæ›¸](../10-rca-capstone/)

---

## ç³»åˆ—å¯¼èˆª

[<-- 08 - strace](../08-strace/) | [ç³»åˆ—é¦–é¡µ](../) | [10 - RCA Capstone -->](../10-rca-capstone/)
