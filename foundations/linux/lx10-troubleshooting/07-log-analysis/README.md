# 07 - æ—¥å¿—åˆ†æï¼šjournalctl ä¸æ—¶é—´çº¿é‡å»ºï¼ˆLog Analysis: journalctl and Timeline Reconstructionï¼‰

> **ç›®æ ‡**ï¼šç²¾é€š journalctl è¿‡æ»¤æŸ¥è¯¢ï¼ŒæŒæ¡å¤šæºæ—¥å¿—å…³è”åˆ†æï¼Œå­¦ä¼šé‡å»ºäº‹ä»¶æ—¶é—´çº¿  
> **å‰ç½®**ï¼šLX03 æ–‡æœ¬å¤„ç†ã€LX05 systemdã€Lesson 01 æ–¹æ³•è®º  
> **æ—¶é—´**ï¼šâš¡ 30 åˆ†é’Ÿï¼ˆé€Ÿè¯»ï¼‰/ ğŸ”¬ 120 åˆ†é’Ÿï¼ˆå®Œæ•´å®æ“ï¼‰  
> **æ ¸å¿ƒç†å¿µ**ï¼šæ—¥å¿—æ˜¯è¯æ®ï¼Œæ—¶é—´çº¿æ˜¯çœŸç›¸  

---

## å‰ç½®æŠ€èƒ½æé†’

> **é‡è¦**ï¼šæœ¬è¯¾å¤§é‡ä½¿ç”¨ LX03 å­¦åˆ°çš„æ–‡æœ¬å¤„ç†æŠ€èƒ½ã€‚  
> å¦‚æœä¸ç†Ÿæ‚‰ä»¥ä¸‹å†…å®¹ï¼Œå»ºè®®å…ˆå¤ä¹  LX03-TEXTï¼š  
>
> - **grep æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤**ï¼š`grep -E 'error|fail|timeout' /var/log/messages`  
> - **awk å­—æ®µæå–**ï¼š`awk '{print $1, $3, $NF}' access.log`  
> - **å¤šæ–‡ä»¶æ—¥å¿—å…³è”**ï¼š`grep -h 'request-id' *.log | sort -k2`  
> - **æ—¶é—´èŒƒå›´è¿‡æ»¤**ï¼š`awk '$2 >= "14:00" && $2 <= "15:00"' log.txt`  
>
> å¦‚æœä¸ç†Ÿæ‚‰ä»¥ä¸ŠæŠ€èƒ½ï¼Œå»ºè®®å…ˆå®Œæˆ LX03-TEXT è¯¾ç¨‹ã€‚  

---

## å°†å­¦åˆ°çš„å†…å®¹

1. ç²¾é€š journalctl è¿‡æ»¤å’ŒæŸ¥è¯¢ï¼ˆ-u, -p, --since, -g, -o jsonï¼‰
2. ç†è§£ä¼ ç»Ÿæ—¥å¿—æ–‡ä»¶ä½ç½®å’Œæ ¼å¼
3. è¿›è¡Œå¤šæºæ—¥å¿—å…³è”åˆ†æï¼ˆ3-Source Ruleï¼‰
4. é‡å»ºäº‹ä»¶æ—¶é—´çº¿ï¼ˆæ—¶åŒºè§„èŒƒåŒ–ï¼‰
5. è¯†åˆ«æ—¥å¿—åˆ†æåæ¨¡å¼

---

## å…ˆè·‘èµ·æ¥ï¼ï¼ˆ10 åˆ†é’Ÿï¼‰

> åœ¨å­¦ä¹ æ—¥å¿—åˆ†æç†è®ºä¹‹å‰ï¼Œå…ˆä½“éªŒ"ç²¾å‡†å®šä½"çš„å¨åŠ›ã€‚  
> ä¸€æ¡å‘½ä»¤ç«‹å³ç»™ä½ ç»“æ„åŒ–çš„é”™è¯¯ä¿¡æ¯ã€‚  

```bash
# è·å–æœ€è¿‘ 1 å°æ—¶çš„é”™è¯¯æ—¥å¿—ï¼Œè¾“å‡ºä¸º JSON æ ¼å¼ï¼Œæå–æ¶ˆæ¯
journalctl -p err --since '1 hour ago' -o json | jq -r '.MESSAGE' | head -20
```

**è¾“å‡ºç¤ºä¾‹**ï¼š

```
Failed to start nginx.service: Unit nginx.service not found.
error: PAM: Authentication failure for root from 192.168.1.100
kernel: ata1.00: exception Emask 0x0 SAct 0x0 SErr 0x0 action 0x6
sshd[12345]: Connection closed by authenticating user admin 192.168.1.50 port 22
```

**ä½ åˆšåˆšåšåˆ°çš„**ï¼š
- æŒ‰ä¼˜å…ˆçº§è¿‡æ»¤ï¼ˆåªçœ‹ err åŠä»¥ä¸Šï¼‰
- æŒ‰æ—¶é—´èŒƒå›´è¿‡æ»¤ï¼ˆæœ€è¿‘ 1 å°æ—¶ï¼‰
- è·å–ç»“æ„åŒ–è¾“å‡ºï¼ˆJSON æ ¼å¼ï¼‰
- ç”¨ jq æå–å…³é”®å­—æ®µï¼ˆMESSAGEï¼‰

**è¿™å°±æ˜¯ç°ä»£æ—¥å¿—åˆ†æçš„å¨åŠ›** -- ä¸éœ€è¦ grep åœ¨æ–‡æœ¬é‡Œå¤§æµ·æé’ˆã€‚ç°åœ¨è®©æˆ‘ä»¬ç³»ç»Ÿå­¦ä¹ æ—¥å¿—åˆ†æçš„æ–¹æ³•è®ºã€‚

---

## Step 1 -- journalctl ç²¾é€šï¼ˆ30 åˆ†é’Ÿï¼‰

### 1.1 systemd journal vs ä¼ ç»Ÿæ—¥å¿—

<!-- DIAGRAM: journal-vs-traditional -->
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              systemd journal vs ä¼ ç»Ÿæ—¥å¿—                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ä¼ ç»Ÿæ—¥å¿— (syslog)                  systemd journal              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ çº¯æ–‡æœ¬æ–‡ä»¶         â”‚           â”‚ â€¢ äºŒè¿›åˆ¶ç»“æ„åŒ–å­˜å‚¨       â”‚  â”‚
â”‚  â”‚ â€¢ æŒ‰æ–‡ä»¶åˆ†ç±»         â”‚           â”‚ â€¢ ç»Ÿä¸€å…¥å£               â”‚  â”‚
â”‚  â”‚ â€¢ grep/awk æœç´¢     â”‚           â”‚ â€¢ å­—æ®µæŸ¥è¯¢               â”‚  â”‚
â”‚  â”‚ â€¢ æ‰‹åŠ¨è½®è½¬          â”‚           â”‚ â€¢ è‡ªåŠ¨ç©ºé—´ç®¡ç†           â”‚  â”‚
â”‚  â”‚ â€¢ æ— å…ƒæ•°æ®          â”‚           â”‚ â€¢ ä¸°å¯Œå…ƒæ•°æ®             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  æ–‡ä»¶ä½ç½®ï¼š                         å­˜å‚¨ä½ç½®ï¼š                    â”‚
â”‚  â€¢ /var/log/messages               â€¢ /var/log/journal/           â”‚
â”‚  â€¢ /var/log/syslog                 â€¢ æˆ– /run/log/journal/ (å†…å­˜) â”‚
â”‚  â€¢ /var/log/secure                                               â”‚
â”‚  â€¢ /var/log/auth.log                                             â”‚
â”‚                                                                  â”‚
â”‚  ä¸¤è€…å…±å­˜ï¼š                                                       â”‚
â”‚  â€¢ RHEL/CentOS: journal + rsyslog å¹¶å­˜                           â”‚
â”‚  â€¢ Ubuntu: journal + rsyslog å¹¶å­˜                                â”‚
â”‚  â€¢ çº¯ systemd ç³»ç»Ÿ: å¯ç¦ç”¨ rsyslog                               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
<!-- /DIAGRAM -->

### 1.2 journalctl åŸºç¡€è¿‡æ»¤

**æŒ‰æœåŠ¡è¿‡æ»¤ (-u)**ï¼š

```bash
# æŸ¥çœ‹ç‰¹å®šæœåŠ¡çš„æ—¥å¿—
journalctl -u sshd
journalctl -u nginx
journalctl -u mysql

# å¤šä¸ªæœåŠ¡
journalctl -u sshd -u nginx

# æŸ¥çœ‹æœåŠ¡çš„æœ€æ–°æ—¥å¿—ï¼ˆç­‰åŒäº tailï¼‰
journalctl -u sshd -n 50

# å®æ—¶è·Ÿè¸ªï¼ˆç­‰åŒäº tail -fï¼‰
journalctl -u nginx -f
```

**æŒ‰ä¼˜å…ˆçº§è¿‡æ»¤ (-p)**ï¼š

```bash
# åªçœ‹é”™è¯¯åŠä»¥ä¸Š (err, crit, alert, emerg)
journalctl -p err

# åªçœ‹è­¦å‘ŠåŠä»¥ä¸Š
journalctl -p warning

# æŒ‡å®šä¼˜å…ˆçº§èŒƒå›´
journalctl -p warning..err
```

**ä¼˜å…ˆçº§çº§åˆ«å‚è€ƒ**ï¼š

| æ•°å­— | åç§° | å«ä¹‰ |
|------|------|------|
| 0 | emerg | ç³»ç»Ÿä¸å¯ç”¨ |
| 1 | alert | å¿…é¡»ç«‹å³å¤„ç† |
| 2 | crit | ä¸¥é‡é”™è¯¯ |
| 3 | err | é”™è¯¯ |
| 4 | warning | è­¦å‘Š |
| 5 | notice | æ­£å¸¸ä½†é‡è¦ |
| 6 | info | ä¿¡æ¯ |
| 7 | debug | è°ƒè¯• |

### 1.3 æ—¶é—´èŒƒå›´è¿‡æ»¤

**--since å’Œ --until**ï¼š

```bash
# ç›¸å¯¹æ—¶é—´
journalctl --since '1 hour ago'
journalctl --since '30 minutes ago'
journalctl --since 'yesterday'
journalctl --since 'today'

# ç»å¯¹æ—¶é—´
journalctl --since '2026-01-10 14:00' --until '2026-01-10 15:00'
journalctl --since '2026-01-10 14:00:00' --until '2026-01-10 14:30:00'

# ç»„åˆä½¿ç”¨
journalctl -u nginx --since '1 hour ago' -p err

# æŸ¥çœ‹æœ¬æ¬¡å¯åŠ¨ä»¥æ¥çš„æ—¥å¿—
journalctl -b

# æŸ¥çœ‹ä¸Šæ¬¡å¯åŠ¨çš„æ—¥å¿—
journalctl -b -1
```

**æ—¶é—´æ ¼å¼æ”¯æŒ**ï¼š

```
# ç»å¯¹æ ¼å¼
YYYY-MM-DD HH:MM:SS
YYYY-MM-DD HH:MM
YYYY-MM-DD

# ç›¸å¯¹æ ¼å¼
"X minutes ago"
"X hours ago"
"X days ago"
"yesterday"
"today"
"now"
```

### 1.4 æ­£åˆ™æœç´¢ (-g)

```bash
# æœç´¢åŒ…å«ç‰¹å®šæ¨¡å¼çš„æ—¥å¿—
journalctl -g 'error|fail|timeout'
journalctl -g 'sshd.*Failed'
journalctl -g 'OOM\|killed'

# ç»„åˆè¿‡æ»¤
journalctl -u sshd --since '1 hour ago' -g 'Failed password'

# åŒºåˆ†å¤§å°å†™ï¼ˆé»˜è®¤ä¸åŒºåˆ†ï¼‰
journalctl --case-sensitive=true -g 'Error'
```

### 1.5 è¾“å‡ºæ ¼å¼ (-o)

```bash
# é»˜è®¤æ ¼å¼ï¼ˆäººç±»å¯è¯»ï¼‰
journalctl -u nginx

# JSON æ ¼å¼ï¼ˆè„šæœ¬å¤„ç†ï¼‰
journalctl -u nginx -o json

# å•è¡Œ JSONï¼ˆæ¯æ¡æ—¥å¿—ä¸€è¡Œï¼‰
journalctl -u nginx -o json --no-pager

# ç®€çŸ­æ ¼å¼
journalctl -u nginx -o short

# å¸¦å¾®ç§’æ—¶é—´æˆ³
journalctl -u nginx -o short-precise

# å¯¼å‡ºæ ¼å¼ï¼ˆç”¨äºä¼ è¾“ï¼‰
journalctl -u nginx -o export
```

**JSON è¾“å‡ºç»“åˆ jq**ï¼š

```bash
# æå–æ¶ˆæ¯å­—æ®µ
journalctl -u nginx -o json | jq -r '.MESSAGE'

# æå–æ—¶é—´å’Œæ¶ˆæ¯
journalctl -u nginx -o json | jq -r '[.__REALTIME_TIMESTAMP, .MESSAGE] | @tsv'

# ç»Ÿè®¡é”™è¯¯ç±»å‹
journalctl -p err -o json --since '1 hour ago' | \
  jq -r '.MESSAGE' | \
  sort | uniq -c | sort -rn | head -10
```

### 1.6 å…¶ä»–å¸¸ç”¨é€‰é¡¹

```bash
# å†…æ ¸æ—¥å¿—
journalctl -k
journalctl --dmesg

# æŒ‰è¿›ç¨‹ ID
journalctl _PID=1234

# æŒ‰ç”¨æˆ·
journalctl _UID=1000

# æŒ‰å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„
journalctl _EXE=/usr/sbin/sshd

# åå‘æ˜¾ç¤ºï¼ˆæœ€æ–°åœ¨å‰ï¼‰
journalctl -r

# ä¸åˆ†é¡µ
journalctl --no-pager

# æ˜¾ç¤ºæ—¥å¿—å ç”¨ç©ºé—´
journalctl --disk-usage

# æ¸…ç†æ—§æ—¥å¿—
sudo journalctl --vacuum-time=7d  # ä¿ç•™ 7 å¤©
sudo journalctl --vacuum-size=500M  # ä¿ç•™ 500MB
```

---

## Step 2 -- ä¼ ç»Ÿæ—¥å¿—ä½ç½®ä¸æ ¼å¼ï¼ˆ20 åˆ†é’Ÿï¼‰

### 2.1 ä¸»è¦æ—¥å¿—æ–‡ä»¶

è™½ç„¶ systemd journal æ˜¯ç°ä»£æ ‡å‡†ï¼Œä½†ä¼ ç»Ÿæ—¥å¿—æ–‡ä»¶ä»ç„¶å¹¿æ³›ä½¿ç”¨ï¼š

<!-- DIAGRAM: traditional-log-locations -->
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¼ ç»Ÿæ—¥å¿—æ–‡ä»¶ä½ç½®                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ç³»ç»Ÿæ—¥å¿—                                                     â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ RHEL/CentOS              Debian/Ubuntu                      â”‚â”‚
â”‚  â”‚ /var/log/messages        /var/log/syslog      (ç³»ç»Ÿæ¶ˆæ¯)    â”‚â”‚
â”‚  â”‚ /var/log/secure          /var/log/auth.log    (è®¤è¯æ—¥å¿—)    â”‚â”‚
â”‚  â”‚ /var/log/maillog         /var/log/mail.log    (é‚®ä»¶æ—¥å¿—)    â”‚â”‚
â”‚  â”‚ /var/log/cron            /var/log/cron.log    (å®šæ—¶ä»»åŠ¡)    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ é€šç”¨æ—¥å¿—                                                     â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ /var/log/dmesg           - å¯åŠ¨æ—¶å†…æ ¸æ¶ˆæ¯                    â”‚â”‚
â”‚  â”‚ /var/log/boot.log        - å¯åŠ¨æœåŠ¡æ—¥å¿—                      â”‚â”‚
â”‚  â”‚ /var/log/lastlog         - æœ€åç™»å½•è®°å½•ï¼ˆäºŒè¿›åˆ¶ï¼‰            â”‚â”‚
â”‚  â”‚ /var/log/wtmp            - ç™»å½•å†å²ï¼ˆäºŒè¿›åˆ¶ï¼‰                â”‚â”‚
â”‚  â”‚ /var/log/btmp            - å¤±è´¥ç™»å½•ï¼ˆäºŒè¿›åˆ¶ï¼‰                â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ åº”ç”¨æ—¥å¿—                                                     â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ /var/log/nginx/          - Nginx æ—¥å¿—                        â”‚â”‚
â”‚  â”‚ /var/log/httpd/          - Apache æ—¥å¿—                       â”‚â”‚
â”‚  â”‚ /var/log/mysql/          - MySQL æ—¥å¿—                        â”‚â”‚
â”‚  â”‚ /var/log/postgresql/     - PostgreSQL æ—¥å¿—                   â”‚â”‚
â”‚  â”‚ /var/log/audit/          - å®¡è®¡æ—¥å¿—                          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
<!-- /DIAGRAM -->

### 2.2 syslog vs messages æ ¼å¼

**ä¼ ç»Ÿ syslog æ ¼å¼**ï¼š

```
# /var/log/messages æˆ– /var/log/syslog
Jan 10 14:30:45 hostname sshd[12345]: Failed password for root from 192.168.1.100 port 22 ssh2
 â†‘           â†‘        â†‘     â†‘           â†‘
 æ—¶é—´æˆ³      ä¸»æœºå   ç¨‹åº  PID         æ¶ˆæ¯å†…å®¹
```

**å­—æ®µæå–**ï¼š

```bash
# æå–æ—¶é—´ã€ç¨‹åºã€æ¶ˆæ¯
awk '{print $1, $2, $3, $5, $6}' /var/log/messages

# ç»Ÿè®¡ç¨‹åºå‡ºç°æ¬¡æ•°
awk '{print $5}' /var/log/messages | cut -d'[' -f1 | sort | uniq -c | sort -rn | head -10

# æŒ‰æ—¶é—´èŒƒå›´è¿‡æ»¤ï¼ˆsyslog æ ¼å¼æ²¡æœ‰å¹´ä»½ï¼ï¼‰
grep 'Jan 10' /var/log/messages | awk '$3 >= "14:00" && $3 <= "15:00"'
```

### 2.3 è®¤è¯æ—¥å¿—

**RHEL/CentOS: /var/log/secure**
**Debian/Ubuntu: /var/log/auth.log**

```bash
# æŸ¥çœ‹ SSH ç™»å½•å¤±è´¥
grep 'Failed password' /var/log/secure

# ç»Ÿè®¡ç™»å½•å¤±è´¥çš„ IP
grep 'Failed password' /var/log/secure | \
  awk '{print $(NF-3)}' | sort | uniq -c | sort -rn | head -10

# æŸ¥çœ‹æˆåŠŸç™»å½•
grep 'Accepted' /var/log/secure | tail -20

# æŸ¥çœ‹ sudo ä½¿ç”¨
grep 'sudo:' /var/log/secure
```

### 2.4 å†…æ ¸æ—¥å¿— (dmesg)

```bash
# æŸ¥çœ‹å†…æ ¸æ—¥å¿—
dmesg

# å¸¦æ—¶é—´æˆ³
dmesg -T

# åªçœ‹é”™è¯¯å’Œè­¦å‘Š
dmesg -l err,warn

# æœç´¢ç‰¹å®šå†…å®¹
dmesg | grep -i 'error\|fail\|oom'

# ç£ç›˜ç›¸å…³
dmesg | grep -i 'ata\|scsi\|sda'

# OOM Killer
dmesg | grep -i 'oom\|killed'
```

### 2.5 äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶

**wtmp/btmp/lastlog æ˜¯äºŒè¿›åˆ¶æ ¼å¼**ï¼Œéœ€è¦ä¸“ç”¨å‘½ä»¤ï¼š

```bash
# ç™»å½•å†å² (wtmp)
last
last -n 20
last reboot  # é‡å¯å†å²

# å¤±è´¥ç™»å½• (btmp) - éœ€è¦ root
sudo lastb
sudo lastb -n 20

# æœ€åç™»å½•æ—¶é—´ (lastlog)
lastlog
lastlog -u username
```

---

## Step 3 -- å¤šæºæ—¥å¿—å…³è”ï¼š3-Source Ruleï¼ˆ25 åˆ†é’Ÿï¼‰

### 3.1 ä»€ä¹ˆæ˜¯ 3-Source Ruleï¼Ÿ

**æ ¸å¿ƒåŸåˆ™**ï¼šè¯Šæ–­é—®é¢˜æ—¶ï¼Œè‡³å°‘å…³è” 3 ä¸ªæ¥æºçš„æ—¥å¿—ã€‚

<!-- DIAGRAM: three-source-rule -->
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    3-Source Rule æ—¥å¿—å…³è”                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚                        é—®é¢˜å‘ç”Ÿ                                  â”‚
â”‚                           â”‚                                      â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚           â–¼               â–¼               â–¼                      â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚    â”‚ 1. åº”ç”¨æ—¥å¿— â”‚ â”‚ 2. ç³»ç»Ÿæ—¥å¿— â”‚ â”‚ 3. å¤–éƒ¨æ•°æ® â”‚              â”‚
â”‚    â”‚             â”‚ â”‚             â”‚ â”‚             â”‚              â”‚
â”‚    â”‚ â€¢ ä¸šåŠ¡æ—¥å¿—  â”‚ â”‚ â€¢ journal   â”‚ â”‚ â€¢ ç›‘æ§æŒ‡æ ‡  â”‚              â”‚
â”‚    â”‚ â€¢ é”™è¯¯å †æ ˆ  â”‚ â”‚ â€¢ dmesg     â”‚ â”‚ â€¢ ç½‘ç»œæµé‡  â”‚              â”‚
â”‚    â”‚ â€¢ è¯·æ±‚æ—¥å¿—  â”‚ â”‚ â€¢ secure    â”‚ â”‚ â€¢ å˜æ›´è®°å½•  â”‚              â”‚
â”‚    â”‚ â€¢ å®¡è®¡æ—¥å¿—  â”‚ â”‚ â€¢ messages  â”‚ â”‚ â€¢ éƒ¨ç½²æ—¥å¿—  â”‚              â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚           â”‚               â”‚               â”‚                      â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                           â–¼                                      â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚                    â”‚  æ—¶é—´çº¿é‡å»º  â”‚                               â”‚
â”‚                    â”‚  å› æœæ¨æ–­    â”‚                               â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                  â”‚
â”‚  ä¸ºä»€ä¹ˆéœ€è¦å¤šæºï¼Ÿ                                                 â”‚
â”‚  â€¢ å•æºå¯èƒ½ç¼ºå¤±å…³é”®ä¿¡æ¯                                          â”‚
â”‚  â€¢ åº”ç”¨æ—¥å¿—å¯èƒ½æ²¡æœ‰è®°å½•ç³»ç»Ÿçº§é—®é¢˜                                â”‚
â”‚  â€¢ ç³»ç»Ÿæ—¥å¿—å¯èƒ½æ²¡æœ‰ä¸šåŠ¡ä¸Šä¸‹æ–‡                                    â”‚
â”‚  â€¢ å¤–éƒ¨æ•°æ®æä¾›è§¦å‘å› ç´ çº¿ç´¢                                      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
<!-- /DIAGRAM -->

### 3.2 æ—¥å¿—å…³è”å®æˆ˜

**åœºæ™¯**ï¼šAPI æœåŠ¡åœ¨ 14:30 å¼€å§‹è¿”å› 500 é”™è¯¯ã€‚

**Step 1: åº”ç”¨æ—¥å¿—**

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—ä¸­çš„é”™è¯¯
grep -E '14:3[0-5].*ERROR' /var/log/myapp/app.log

# è¾“å‡ºï¼š
# 2026-01-10 14:30:15 ERROR Database connection timeout
# 2026-01-10 14:30:16 ERROR Failed to execute query
# 2026-01-10 14:30:17 ERROR Database connection timeout
```

**Step 2: ç³»ç»Ÿæ—¥å¿—**

```bash
# åŒæ—¶é—´æ®µçš„ç³»ç»Ÿäº‹ä»¶
journalctl --since '2026-01-10 14:25' --until '2026-01-10 14:35' -p warning

# è¾“å‡ºï¼š
# Jan 10 14:28:30 server kernel: ata1: exception Emask 0x10 SAct 0x0
# Jan 10 14:29:00 server kernel: ata1.00: failed command: READ DMA
# Jan 10 14:30:00 server mysqld[5678]: Disk I/O error
```

**Step 3: å¤–éƒ¨æ•°æ®**

```bash
# æ£€æŸ¥åŒæ—¶é—´çš„ç£ç›˜æŒ‡æ ‡ï¼ˆå‡è®¾ä¿å­˜äº†ç›‘æ§æ•°æ®ï¼‰
cat /var/log/sar/sa10 | sar -d -s 14:25:00 -e 14:35:00

# æˆ–æ£€æŸ¥å˜æ›´è®°å½•
grep '14:2[0-9]' /var/log/deploy.log

# è¾“å‡ºï¼š
# 2026-01-10 14:20:00 Started backup job on /dev/sda
```

**å› æœé“¾æ¨æ–­**ï¼š

```
14:20 å¤‡ä»½ä»»åŠ¡å¯åŠ¨ â†’ 14:28 ç£ç›˜ I/O å‹åŠ› â†’ 14:29 ç£ç›˜é”™è¯¯ â†’
14:30 MySQL I/O å¤±è´¥ â†’ 14:30 åº”ç”¨æ•°æ®åº“è¶…æ—¶ â†’ 500 é”™è¯¯
```

### 3.3 å…³è”æŠ€å·§

**æŒ‰æ—¶é—´æˆ³å¯¹é½**ï¼š

```bash
# åˆå¹¶å¤šä¸ªæ—¥å¿—ï¼ŒæŒ‰æ—¶é—´æ’åº
(
  awk '{print "APP:", $0}' /var/log/myapp/app.log
  awk '{print "SYS:", $0}' /var/log/messages
  awk '{print "SEC:", $0}' /var/log/secure
) | sort -k2,3 | grep '14:3[0-5]'
```

**æŒ‰ Request ID è¿½è¸ª**ï¼ˆå¦‚æœåº”ç”¨æ”¯æŒï¼‰ï¼š

```bash
# æ‰¾åˆ°é—®é¢˜è¯·æ±‚çš„ ID
grep '500' /var/log/nginx/access.log | head -1
# è¾“å‡º: ... request_id=abc123 ...

# åœ¨æ‰€æœ‰æ—¥å¿—ä¸­æœç´¢è¿™ä¸ª ID
grep -rh 'abc123' /var/log/myapp/ /var/log/nginx/
```

**æŒ‰ PID å…³è”**ï¼š

```bash
# æ‰¾åˆ°å´©æºƒè¿›ç¨‹çš„ PID
journalctl -p err --since '14:30' | grep -oP 'PID \K\d+'

# æŸ¥çœ‹è¿™ä¸ªè¿›ç¨‹ä¹‹å‰çš„æ´»åŠ¨
journalctl _PID=12345 --since '14:00'
```

---

## Step 4 -- æ—¶é—´çº¿é‡å»ºï¼ˆ20 åˆ†é’Ÿï¼‰

### 4.1 æ—¶åŒºè§„èŒƒåŒ–ï¼ˆå…³é”®ï¼ï¼‰

**æ—¥æœ¬ IT ç¯å¢ƒçš„æ—¶åŒºé—®é¢˜**ï¼š

- æœåŠ¡å™¨å¯èƒ½æ˜¯ UTC æˆ– JST
- æ—¥å¿—æ–‡ä»¶å¯èƒ½æ··åˆä¸åŒæ—¶åŒº
- æ—¶é—´çº¿å¿…é¡»ç»Ÿä¸€åˆ°ä¸€ä¸ªæ—¶åŒº

<!-- DIAGRAM: timezone-normalization -->
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ—¶åŒºè§„èŒƒåŒ–                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  é—®é¢˜åœºæ™¯ï¼š                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ æœåŠ¡å™¨ A (UTC):    2026-01-10 05:30:00 ERROR              â”‚â”‚
â”‚  â”‚ æœåŠ¡å™¨ B (JST):    2026-01-10 14:30:00 ERROR              â”‚â”‚
â”‚  â”‚                    â†‘                                        â”‚â”‚
â”‚  â”‚                    è¿™æ˜¯åŒä¸€æ—¶åˆ»ï¼                            â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â”‚  æ—¶åŒºè½¬æ¢ï¼š                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  UTC â†’ JST: +9 å°æ—¶                                         â”‚â”‚
â”‚  â”‚  JST â†’ UTC: -9 å°æ—¶                                         â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚  UTC 05:30 = JST 14:30                                      â”‚â”‚
â”‚  â”‚  UTC 00:00 = JST 09:00                                      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â”‚  æ—¥æœ¬ä¼ä¸šæ ‡å‡†ï¼š                                                   â”‚
â”‚  â€¢ éšœå®³å ±å‘Šæ›¸ æ—¶é—´çº¿ä½¿ç”¨ JST                                     â”‚
â”‚  â€¢ æ‰€æœ‰æ—¶é—´æ ‡æ³¨ (JST) æˆ– (UTC)                                   â”‚
â”‚                                                                  â”‚
â”‚  æ£€æŸ¥ç³»ç»Ÿæ—¶åŒºï¼š                                                   â”‚
â”‚  $ timedatectl                                                  â”‚
â”‚  $ date +%Z  # æ˜¾ç¤ºæ—¶åŒºç®€å†™ (JST/UTC)                           â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
<!-- /DIAGRAM -->

**æ£€æŸ¥å’Œè½¬æ¢æ—¶åŒº**ï¼š

```bash
# æ£€æŸ¥ç³»ç»Ÿæ—¶åŒº
timedatectl
date +%Z

# journalctl è¾“å‡ºæ—¶é—´æ ¼å¼
journalctl -o short           # æœ¬åœ°æ—¶åŒº
journalctl -o short-iso       # ISO æ ¼å¼å¸¦æ—¶åŒº
journalctl -o short-precise   # ç²¾ç¡®åˆ°å¾®ç§’

# åœ¨æŸ¥è¯¢ä¸­æŒ‡å®šæ—¶åŒºï¼ˆjournalctl ä½¿ç”¨æœ¬åœ°æ—¶åŒºï¼‰
TZ=UTC journalctl --since '05:30' --until '05:35'  # UTC æ—¶é—´
TZ=Asia/Tokyo journalctl --since '14:30' --until '14:35'  # JST æ—¶é—´

# è½¬æ¢ UTC åˆ° JST
date -d '2026-01-10 05:30 UTC' '+%Y-%m-%d %H:%M:%S JST'
```

### 4.2 ç™»å½•å†å²è¿½è¸ª (wtmp/btmp)

```bash
# æŸ¥çœ‹ç™»å½•å†å²
last
last -t 20260110143000  # æŸæ—¶é—´ç‚¹ä¹‹å‰çš„ç™»å½•
last -F  # å®Œæ•´æ—¶é—´æ ¼å¼

# æŸ¥çœ‹ç‰¹å®šç”¨æˆ·
last username
last root

# æŸ¥çœ‹å¤±è´¥ç™»å½•
sudo lastb
sudo lastb -F

# è°åœ¨ä»€ä¹ˆæ—¶å€™ç™»å½•çš„ï¼Ÿ
who /var/log/wtmp
```

### 4.3 å‘½ä»¤å†å²è¿½è¸ª (bash_history)

**æ³¨æ„**ï¼šbash_history é»˜è®¤ä¸è®°å½•æ—¶é—´æˆ³ï¼Œéœ€è¦é…ç½®ã€‚

```bash
# æŸ¥çœ‹ç”¨æˆ·å‘½ä»¤å†å²
cat /home/username/.bash_history
cat /root/.bash_history

# å¯ç”¨æ—¶é—´æˆ³ï¼ˆåœ¨ .bashrc ä¸­æ·»åŠ ï¼‰
export HISTTIMEFORMAT="%Y-%m-%d %H:%M:%S "
export HISTSIZE=10000
export HISTFILESIZE=20000

# æŸ¥çœ‹å¸¦æ—¶é—´æˆ³çš„å†å²ï¼ˆå¦‚æœå·²å¯ç”¨ï¼‰
history
```

### 4.4 æ–‡ä»¶æ—¶é—´æˆ³è¿½è¸ª (stat)

```bash
# æŸ¥çœ‹æ–‡ä»¶æ—¶é—´æˆ³
stat /etc/nginx/nginx.conf

# è¾“å‡ºè§£è¯»ï¼š
# Access: æœ€åè®¿é—®æ—¶é—´
# Modify: æœ€åä¿®æ”¹å†…å®¹æ—¶é—´ï¼ˆé‡è¦ï¼ï¼‰
# Change: æœ€åä¿®æ”¹å…ƒæ•°æ®æ—¶é—´ï¼ˆæƒé™ã€å±ä¸»ç­‰ï¼‰

# æ‰¾æœ€è¿‘ä¿®æ”¹çš„é…ç½®æ–‡ä»¶
find /etc -name '*.conf' -mtime -1  # æœ€è¿‘ 1 å¤©ä¿®æ”¹

# æ‰¾ç‰¹å®šæ—¶é—´èŒƒå›´å†…ä¿®æ”¹çš„æ–‡ä»¶
find /etc -newermt '2026-01-10 14:00' ! -newermt '2026-01-10 15:00'
```

### 4.5 æ—¶é—´çº¿é‡å»ºæ¨¡æ¿

**éšœå®³å ±å‘Šæ›¸æ—¶é—´çº¿æ ¼å¼**ï¼š

```markdown
## æ™‚ç³»åˆ— (Timeline)

| æ™‚åˆ» (JST) | äº‹è±¡ | æ¥æº |
|------------|------|------|
| 14:20:00 | ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¸ãƒ§ãƒ–é–‹å§‹ | /var/log/cron |
| 14:28:30 | ãƒ‡ã‚£ã‚¹ã‚¯ I/O ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ | dmesg |
| 14:29:00 | MySQL ãƒ‡ã‚£ã‚¹ã‚¯ I/O å¤±æ•— | journalctl -u mysql |
| 14:30:15 | API 500 ã‚¨ãƒ©ãƒ¼é–‹å§‹ | /var/log/myapp/app.log |
| 14:32:00 | ç›£è¦–ã‚¢ãƒ©ãƒ¼ãƒˆç™ºå ± | Zabbix |
| 14:35:00 | æ‹…å½“è€…ãƒ­ã‚°ã‚¤ãƒ³ | last |
| 14:40:00 | ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¸ãƒ§ãƒ–åœæ­¢ | æ‰‹å‹•æ“ä½œ |
| 14:45:00 | æ­£å¸¸å¾©æ—§ç¢ºèª | å‹•ä½œç¢ºèª |
```

---

## Step 5 -- æ—¥å¿—åˆ†æåæ¨¡å¼ï¼ˆ15 åˆ†é’Ÿï¼‰

### 5.1 åæ¨¡å¼è¯†åˆ«

| åæ¨¡å¼ | é”™è¯¯åšæ³• | åæœ | æ­£ç¡®åšæ³• |
|--------|----------|------|----------|
| **åªç”¨ grep** | ä¸ä½¿ç”¨ journalctl å­—æ®µè¿‡æ»¤ | æ•ˆç‡ä½ï¼Œé”™è¿‡ç»“æ„åŒ–ä¿¡æ¯ | ç”¨ journalctl -u, -p, -g |
| **å¿½ç•¥æ—¶åŒº** | æ··åˆ UTC/JST æ—¶é—´ | æ—¶é—´çº¿æ··ä¹±ï¼Œå› æœé”™è¯¯ | ç»Ÿä¸€åˆ° JSTï¼Œæ ‡æ³¨æ—¶åŒº |
| **åªçœ‹æœ€è¿‘æ—¥å¿—** | åª tail æœ€åå‡ è¡Œ | é”™è¿‡é—®é¢˜å¼€å§‹çš„çº¿ç´¢ | ç”¨ --since å›æº¯åˆ°é—®é¢˜å‰ |
| **å•æºåˆ†æ** | åªçœ‹åº”ç”¨æ—¥å¿— | é”™è¿‡ç³»ç»Ÿçº§åŸå›  | 3-Source Rule å¤šæºå…³è” |
| **å¿½ç•¥æ­£å¸¸æ—¥å¿—** | åªæœç´¢ error | é”™è¿‡å¼‚å¸¸ä½†éé”™è¯¯çš„æ¨¡å¼ | å¯¹æ¯”æ­£å¸¸æ—¶çš„æ—¥å¿—æ¨¡å¼ |

### 5.2 åæ¨¡å¼æ¡ˆä¾‹

**æ¡ˆä¾‹ï¼šåªç”¨ grep çš„ä½æ•ˆåˆ†æ**

```bash
# åæ¨¡å¼ï¼šåœ¨å¤§æ–‡ä»¶ä¸­ grep
grep 'error' /var/log/messages | tail -100
# é—®é¢˜ï¼š
# - æ²¡æœ‰æ—¶é—´èŒƒå›´ï¼Œæ‰«ææ•´ä¸ªæ–‡ä»¶
# - å¤§å°å†™æ•æ„Ÿï¼Œå¯èƒ½æ¼æ‰ Error, ERROR
# - æ²¡æœ‰ä¼˜å…ˆçº§è¿‡æ»¤

# æ­£ç¡®åšæ³•ï¼šä½¿ç”¨ journalctl
journalctl -p err --since '1 hour ago'
# ä¼˜ç‚¹ï¼š
# - æœ‰ç´¢å¼•ï¼ŒæŸ¥è¯¢å¿«
# - è‡ªåŠ¨å¤„ç†å¤§å°å†™
# - ç»“æ„åŒ–è¾“å‡º
```

**æ¡ˆä¾‹ï¼šå¿½ç•¥æ—¶åŒºçš„é”™è¯¯æ—¶é—´çº¿**

```bash
# åæ¨¡å¼ï¼šæ··åˆä¸åŒæ—¶åŒºæ—¥å¿—
14:30:00 [åº”ç”¨æ—¥å¿—-JST] ERROR: Database timeout
05:32:00 [ç³»ç»Ÿæ—¥å¿—-UTC] MySQL connection failed
# é—®é¢˜ï¼šçœ‹èµ·æ¥åº”ç”¨é”™è¯¯åœ¨ç³»ç»Ÿé”™è¯¯ä¹‹å‰ï¼Œå®é™…ç›¸åï¼

# æ­£ç¡®åšæ³•ï¼šç»Ÿä¸€æ—¶åŒº
14:30:00 JST [åº”ç”¨æ—¥å¿—] ERROR: Database timeout
14:32:00 JST [ç³»ç»Ÿæ—¥å¿—] MySQL connection failed  # UTC 05:32 = JST 14:32
# ç°åœ¨å› æœå…³ç³»æ¸…æ¥šäº†
```

**æ¡ˆä¾‹ï¼šåªçœ‹æœ€è¿‘æ—¥å¿—é”™è¿‡æ ¹å› **

```bash
# åæ¨¡å¼ï¼šåªçœ‹æœ€è¿‘é”™è¯¯
journalctl -p err -n 10
# é—®é¢˜ï¼šå¯èƒ½åªçœ‹åˆ°ç—‡çŠ¶ï¼ˆ500 é”™è¯¯ï¼‰ï¼Œçœ‹ä¸åˆ°æ ¹å› ï¼ˆç£ç›˜é”™è¯¯ï¼‰

# æ­£ç¡®åšæ³•ï¼šå›æº¯åˆ°é—®é¢˜å¼€å§‹å‰
journalctl -p warning --since '30 minutes ago'
# å¯ä»¥çœ‹åˆ°é—®é¢˜å‘å±•çš„å®Œæ•´è¿‡ç¨‹
```

---

## Step 6 -- journalctl é€ŸæŸ¥è¡¨ï¼ˆCheatsheetï¼‰

### 6.1 å¸¸ç”¨æŸ¥è¯¢

```bash
# === æŒ‰æœåŠ¡ ===
journalctl -u sshd                 # SSH æœåŠ¡
journalctl -u nginx                # Nginx
journalctl -u sshd -u nginx        # å¤šä¸ªæœåŠ¡

# === æŒ‰ä¼˜å…ˆçº§ ===
journalctl -p err                  # é”™è¯¯åŠä»¥ä¸Š
journalctl -p warning              # è­¦å‘ŠåŠä»¥ä¸Š
journalctl -p err..crit            # err åˆ° crit èŒƒå›´

# === æŒ‰æ—¶é—´ ===
journalctl --since '1 hour ago'
journalctl --since '2026-01-10 14:00' --until '2026-01-10 15:00'
journalctl --since yesterday
journalctl --since today

# === æŒ‰å¯åŠ¨ ===
journalctl -b                      # æœ¬æ¬¡å¯åŠ¨
journalctl -b -1                   # ä¸Šæ¬¡å¯åŠ¨
journalctl --list-boots            # åˆ—å‡ºæ‰€æœ‰å¯åŠ¨

# === æ­£åˆ™æœç´¢ ===
journalctl -g 'error|fail|timeout'
journalctl -g 'sshd.*Failed'

# === å†…æ ¸æ—¥å¿— ===
journalctl -k                      # ç­‰åŒäº dmesg
journalctl -k --since '1 hour ago'

# === è¾“å‡ºæ ¼å¼ ===
journalctl -o json                 # JSON æ ¼å¼
journalctl -o json | jq '.MESSAGE' # æå–å­—æ®µ
journalctl -o short-precise        # ç²¾ç¡®æ—¶é—´æˆ³

# === å®æ—¶è·Ÿè¸ª ===
journalctl -f                      # è·Ÿè¸ªæ‰€æœ‰
journalctl -u nginx -f             # è·Ÿè¸ªç‰¹å®šæœåŠ¡

# === ç©ºé—´ç®¡ç† ===
journalctl --disk-usage            # æŸ¥çœ‹å ç”¨
sudo journalctl --vacuum-time=7d   # æ¸…ç† 7 å¤©å‰
sudo journalctl --vacuum-size=500M # é™åˆ¶å¤§å°
```

### 6.2 é«˜çº§ç»„åˆ

```bash
# ç»„åˆå¤šä¸ªæ¡ä»¶
journalctl -u nginx -p err --since '1 hour ago' -o json | jq '.MESSAGE'

# å¯¼å‡ºç‰¹å®šæ—¶é—´æ®µæ—¥å¿—
journalctl --since '2026-01-10 14:00' --until '2026-01-10 15:00' > /tmp/incident.log

# ç»Ÿè®¡é”™è¯¯ç±»å‹
journalctl -p err --since '1 hour ago' -o json | \
  jq -r '._SYSTEMD_UNIT // "kernel"' | \
  sort | uniq -c | sort -rn

# å®æ—¶ç›‘æ§é”™è¯¯
journalctl -p err -f -o json | jq -r '[.SYSLOG_IDENTIFIER, .MESSAGE] | @tsv'
```

---

## Step 7 -- åŠ¨æ‰‹å®éªŒï¼ˆ30 åˆ†é’Ÿï¼‰

### å®éªŒ 1ï¼šæ—¶é—´çº¿é‡å»ºç»ƒä¹ 

**åœºæ™¯**ï¼šç”¨æˆ·æŠ¥å‘Š Web åº”ç”¨åœ¨ 14:30 å·¦å³æ— æ³•è®¿é—®ã€‚è¯·é‡å»ºæ—¶é—´çº¿ã€‚

```bash
# Step 1: æ”¶é›†ç³»ç»Ÿæ—¥å¿—
journalctl --since '14:25' --until '14:40' > /tmp/timeline/journal.log

# Step 2: æ”¶é›†å†…æ ¸æ—¥å¿—
dmesg -T > /tmp/timeline/dmesg.log

# Step 3: æ”¶é›†åº”ç”¨æ—¥å¿—ï¼ˆå‡è®¾ nginxï¼‰
journalctl -u nginx --since '14:25' --until '14:40' > /tmp/timeline/nginx.log

# Step 4: æ£€æŸ¥ç™»å½•å†å²
last -t 20260110144000 > /tmp/timeline/logins.log

# Step 5: æ£€æŸ¥é…ç½®å˜æ›´
find /etc -newermt '14:00' ! -newermt '14:40' -type f 2>/dev/null > /tmp/timeline/changes.log

# Step 6: æ•´åˆåˆ†æ
# æŒ‰æ—¶é—´æ’åºæ‰€æœ‰æ—¥å¿—æ¡ç›®
cat /tmp/timeline/*.log | sort | less
```

**ç»ƒä¹ ä»»åŠ¡**ï¼š
1. åˆ›å»ºä¸€ä¸ªç»Ÿä¸€çš„æ—¶é—´çº¿
2. è¯†åˆ«é—®é¢˜çš„ç¬¬ä¸€ä¸ªå¼‚å¸¸ä¿¡å·
3. ç¡®å®šæ ¹å› å’Œè§¦å‘å› ç´ 
4. ç”¨éšœå®³å ±å‘Šæ›¸æ ¼å¼è®°å½•

### å®éªŒ 2ï¼šjournalctl é«˜çº§æŸ¥è¯¢

å®Œæˆä»¥ä¸‹æŸ¥è¯¢ä»»åŠ¡ï¼š

```bash
# ä»»åŠ¡ 1: æ‰¾å‡ºæœ€è¿‘ 24 å°æ—¶å†…æ‰€æœ‰å¤±è´¥çš„ SSH ç™»å½•å°è¯•
# ä½ çš„å‘½ä»¤ï¼š
journalctl -u sshd --since '24 hours ago' -g 'Failed'

# ä»»åŠ¡ 2: ç»Ÿè®¡æœ€è¿‘ 1 å°æ—¶å†…å„æœåŠ¡çš„é”™è¯¯æ•°é‡
# ä½ çš„å‘½ä»¤ï¼š
journalctl -p err --since '1 hour ago' -o json | \
  jq -r '._SYSTEMD_UNIT // "other"' | sort | uniq -c | sort -rn

# ä»»åŠ¡ 3: æ‰¾å‡ºä¸Šæ¬¡é‡å¯å‰åçš„å†…æ ¸é”™è¯¯
# ä½ çš„å‘½ä»¤ï¼š
journalctl -k -b -1 -p err  # ä¸Šæ¬¡å¯åŠ¨
journalctl -k -b 0 -p err   # æœ¬æ¬¡å¯åŠ¨

# ä»»åŠ¡ 4: å¯¼å‡º JSON æ ¼å¼æ—¥å¿—ç”¨äºè„šæœ¬å¤„ç†
# ä½ çš„å‘½ä»¤ï¼š
journalctl -u nginx --since '1 hour ago' -o json --no-pager > nginx.json

# ä»»åŠ¡ 5: å®æ—¶ç›‘æ§æ‰€æœ‰é”™è¯¯å¹¶é«˜äº®æ˜¾ç¤º
# ä½ çš„å‘½ä»¤ï¼š
journalctl -p err -f | grep --color -E 'error|fail|timeout|$'
```

### å®éªŒ 3ï¼šæ—¥å¿—åˆ†æè„šæœ¬

åˆ›å»ºä¸€ä¸ªæ—¥å¿—åˆ†æè„šæœ¬ï¼š

```bash
#!/bin/bash
# log-analyzer.sh - æ—¥å¿—å¿«é€Ÿåˆ†æè„šæœ¬

SINCE="${1:-1 hour ago}"

echo "=== Log Analysis Report ==="
echo "Time Range: $SINCE to now"
echo "Generated: $(date)"
echo ""

echo "=== Error Summary by Service ==="
journalctl -p err --since "$SINCE" -o json 2>/dev/null | \
  jq -r '._SYSTEMD_UNIT // "kernel"' | \
  sort | uniq -c | sort -rn | head -10

echo ""
echo "=== Recent Critical/Emergency Messages ==="
journalctl -p crit --since "$SINCE" 2>/dev/null | head -20

echo ""
echo "=== OOM Killer Events ==="
journalctl -k --since "$SINCE" 2>/dev/null | grep -i 'oom\|killed' | head -10

echo ""
echo "=== Failed SSH Logins ==="
journalctl -u sshd --since "$SINCE" 2>/dev/null | grep -i 'failed' | head -10

echo ""
echo "=== Disk Errors ==="
dmesg -T 2>/dev/null | grep -i 'error\|fail\|ata\|scsi' | tail -10
```

ä½¿ç”¨æ–¹æ³•ï¼š

```bash
chmod +x log-analyzer.sh
./log-analyzer.sh '2 hours ago'
```

---

## æ£€æŸ¥æ¸…å•

å®Œæˆæœ¬è¯¾åï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

- [ ] ä½¿ç”¨ journalctl -u æŒ‰æœåŠ¡è¿‡æ»¤æ—¥å¿—
- [ ] ä½¿ç”¨ journalctl -p æŒ‰ä¼˜å…ˆçº§è¿‡æ»¤æ—¥å¿—
- [ ] ä½¿ç”¨ --since/--until æŒ‰æ—¶é—´èŒƒå›´è¿‡æ»¤
- [ ] ä½¿ç”¨ -g è¿›è¡Œæ­£åˆ™è¡¨è¾¾å¼æœç´¢
- [ ] ä½¿ç”¨ -o json è¾“å‡ºç»“æ„åŒ–æ•°æ®
- [ ] è§£é‡Šä¼ ç»Ÿæ—¥å¿—æ–‡ä»¶çš„ä½ç½®å’Œç”¨é€”
- [ ] åº”ç”¨ 3-Source Rule è¿›è¡Œå¤šæºæ—¥å¿—å…³è”
- [ ] è§„èŒƒåŒ–æ—¶åŒºå¹¶é‡å»ºäº‹ä»¶æ—¶é—´çº¿
- [ ] ä½¿ç”¨ wtmp/lastb/stat è¿½è¸ªç™»å½•å’Œæ–‡ä»¶å˜æ›´å†å²
- [ ] è¯†åˆ«å¹¶é¿å…æ—¥å¿—åˆ†æçš„å¸¸è§åæ¨¡å¼

---

## æœ¬è¯¾å°ç»“

| æ¦‚å¿µ | è¦ç‚¹ |
|------|------|
| journalctl | systemd çš„ç»Ÿä¸€æ—¥å¿—æŸ¥è¯¢å·¥å…·ï¼Œæ”¯æŒå­—æ®µè¿‡æ»¤ |
| -u service | æŒ‰æœåŠ¡è¿‡æ»¤ |
| -p priority | æŒ‰ä¼˜å…ˆçº§è¿‡æ»¤ï¼ˆerr, warning, info...ï¼‰|
| --since/--until | æ—¶é—´èŒƒå›´è¿‡æ»¤ï¼Œæ”¯æŒç›¸å¯¹å’Œç»å¯¹æ—¶é—´ |
| -g pattern | æ­£åˆ™è¡¨è¾¾å¼æœç´¢ |
| -o json | ç»“æ„åŒ–è¾“å‡ºï¼Œä¾¿äºè„šæœ¬å¤„ç† |
| 3-Source Rule | å…³è”åº”ç”¨æ—¥å¿— + ç³»ç»Ÿæ—¥å¿— + å¤–éƒ¨æ•°æ® |
| æ—¶åŒºè§„èŒƒåŒ– | ç»Ÿä¸€åˆ° JSTï¼Œæ ‡æ³¨æ—¶åŒºï¼Œé¿å…æ··ä¹± |
| wtmp/btmp | ç™»å½•å†å²ï¼Œç”¨ last/lastb æŸ¥çœ‹ |
| stat | æ–‡ä»¶æ—¶é—´æˆ³ï¼Œè¿½è¸ªé…ç½®å˜æ›´ |

**æ ¸å¿ƒç†å¿µ**ï¼š

> journalctl å­—æ®µè¿‡æ»¤æ¯” grep é«˜æ•ˆå¾—å¤šã€‚  
> å¤šæºå…³è”æ‰èƒ½çœ‹æ¸…é—®é¢˜å…¨è²Œã€‚  
> æ—¶åŒºè§„èŒƒåŒ–æ˜¯æ—¶é—´çº¿é‡å»ºçš„å‰æã€‚  
> æ—¥å¿—æ˜¯è¯æ®ï¼Œæ—¶é—´çº¿æ˜¯çœŸç›¸ã€‚  

---

## æ—¥æœ¬ IT èŒåœºè´´å£«

### ãƒ­ã‚°åˆ†æã¯éšœå®³å ±å‘Šæ›¸ã®è¨¼æ‹ ï¼ˆæ—¥å¿—åˆ†ææ˜¯æ•…éšœæŠ¥å‘Šçš„è¯æ®ï¼‰

åœ¨æ—¥æœ¬ä¼ä¸šçš„æ•…éšœæŠ¥å‘Šä¸­ï¼Œæ—¥å¿—æ˜¯æœ€é‡è¦çš„è¯æ®ï¼š

| æ—¥è¯­æœ¯è¯­ | å«ä¹‰ | åœºæ™¯ |
|----------|------|------|
| **ãƒ­ã‚°åˆ†æ** | æ—¥å¿—åˆ†æ | "ãƒ­ã‚°åˆ†æã®çµæœã€..." |
| **æ™‚ç³»åˆ—** | æ—¶é—´çº¿ | éšœå®³å ±å‘Šæ›¸å¿…é¡»é¡¹ |
| **è¨¼è·¡** | è¯æ®/ç—•è¿¹ | "è¨¼è·¡ã¨ã—ã¦ä¿å­˜" |
| **ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³** | æ—¶åŒº | "JST ã§çµ±ä¸€" |

### ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã¯ JST ã§çµ±ä¸€ï¼ˆæ—¶åŒºç»Ÿä¸€ä¸º JSTï¼‰

æ—¥æœ¬ä¼ä¸šçš„æ•…éšœæŠ¥å‘Šæ—¶é—´çº¿**å¿…é¡»**ä½¿ç”¨ JSTï¼š

```markdown
## æ™‚ç³»åˆ— (Timeline)

| æ™‚åˆ» (JST) | äº‹è±¡ |
|------------|------|
| 14:30:00 | ç›£è¦–ã‚¢ãƒ©ãƒ¼ãƒˆç™ºå ± |
| 14:32:00 | æ‹…å½“è€…å¯¾å¿œé–‹å§‹ |
| 14:45:00 | åŸå› ç‰¹å®š |
| 15:00:00 | å¾©æ—§å®Œäº† |

â€» å…¨æ™‚åˆ»ã¯ JST (æ—¥æœ¬æ¨™æº–æ™‚) ã§è¨˜è¼‰
```

### æŠ¥å‘Šæ—¶çš„è¡¨è¾¾

```
# æ—¥å¿—åˆ†æç»“æœæŠ¥å‘Šæ¨¡æ¿
ã€ãƒ­ã‚°åˆ†æçµæœã€‘
ãƒ»ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚åˆ»: 14:30:00 JST
ãƒ»åˆå›ã‚¨ãƒ©ãƒ¼: "Database connection timeout"
ãƒ»åŸå› : ãƒ‡ã‚£ã‚¹ã‚¯ I/O éšœå®³ã«ã‚ˆã‚Š MySQL æ¥ç¶šå¤±æ•—
ãƒ»è¨¼è·¡: journalctl -u mysql --since "14:25" ã®å‡ºåŠ›ã‚’æ·»ä»˜

ã€æ ¹æœ¬åŸå› ã€‘
dmesg ãƒ­ã‚°ã‚ˆã‚Šã€14:28 ã«ãƒ‡ã‚£ã‚¹ã‚¯ I/O ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã€‚
ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¸ãƒ§ãƒ–ã¨ã® I/O ç«¶åˆãŒåŸå› ã¨æ¨å®šã€‚
```

---

## é¢è¯•å‡†å¤‡

### ã‚ˆãã‚ã‚‹è³ªå•ï¼ˆå¸¸è§é—®é¢˜ï¼‰

**Q: journalctl ã§ç‰¹å®šã®ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’è¦‹ã‚‹æ–¹æ³•ã¯ï¼Ÿ**

A: ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã„ã¾ã™ï¼š
```bash
journalctl -u <ã‚µãƒ¼ãƒ“ã‚¹å> -p err
```
ä¾‹ãˆã° nginx ã®ã‚¨ãƒ©ãƒ¼ã‚’è¦‹ã‚‹å ´åˆï¼š
```bash
journalctl -u nginx -p err --since '1 hour ago'
```
-u ã§ã‚µãƒ¼ãƒ“ã‚¹æŒ‡å®šã€-p ã§ãƒ—ãƒ©ã‚¤ã‚ªãƒªãƒ†ã‚£æŒ‡å®šã€--since ã§æ™‚é–“ç¯„å›²ã‚’æŒ‡å®šã§ãã¾ã™ã€‚

**Q: è¤‡æ•°ã®ãƒ­ã‚°ã‚½ãƒ¼ã‚¹ã‚’é–¢é€£ä»˜ã‘ã¦åˆ†æã™ã‚‹æ–¹æ³•ã¯ï¼Ÿ**

A: 3-Source Rule ã‚’ä½¿ã„ã¾ã™ï¼š
1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°ï¼ˆæ¥­å‹™ã‚¨ãƒ©ãƒ¼ï¼‰
2. ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ï¼ˆOS ãƒ¬ãƒ™ãƒ«ã®ã‚¤ãƒ™ãƒ³ãƒˆï¼‰
3. å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ï¼ˆç›£è¦–ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã€ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ­ã‚°ï¼‰

ã“ã‚Œã‚‰ã‚’ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã§é–¢é€£ä»˜ã‘ã¦ã€å› æœé–¢ä¿‚ã‚’æ¨è«–ã—ã¾ã™ã€‚
é‡è¦ãªã®ã¯ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã®çµ±ä¸€ã§ã™ã€‚UTC ã¨ JST ãŒæ··åœ¨ã™ã‚‹ã¨æ™‚ç³»åˆ—ãŒç‹‚ã„ã¾ã™ã€‚

**Q: éšœå®³ç™ºç”Ÿæ™‚ã€æœ€åˆã«ã©ã®ãƒ­ã‚°ã‚’ç¢ºèªã—ã¾ã™ã‹ï¼Ÿ**

A: ã¾ãš journalctl ã§æ¦‚è¦ã‚’æŠŠæ¡ã—ã¾ã™ï¼š
```bash
journalctl -p err --since '30 minutes ago'
```
æ¬¡ã«é–¢é€£ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ­ã‚°ã‚’ç¢ºèªã—ã€æœ€å¾Œã« dmesg ã§ã‚«ãƒ¼ãƒãƒ«ãƒ¬ãƒ™ãƒ«ã®å•é¡Œã‚’ç¢ºèªã—ã¾ã™ã€‚
è¤‡æ•°ã‚½ãƒ¼ã‚¹ã‚’é–¢é€£ä»˜ã‘ã‚‹ã“ã¨ã§ã€ç—‡çŠ¶ã ã‘ã§ãªãæ ¹æœ¬åŸå› ã‚’ç‰¹å®šã§ãã¾ã™ã€‚

**Q: ãƒ­ã‚°ã®æ™‚ç³»åˆ—ã‚’ä½œæˆã™ã‚‹éš›ã®æ³¨æ„ç‚¹ã¯ï¼Ÿ**

A: ä¸»ãªæ³¨æ„ç‚¹ã¯ï¼š
1. **ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³çµ±ä¸€**: å¿…ãš JST ã§çµ±ä¸€ã—ã€(JST) ã¨æ˜è¨˜
2. **è¤‡æ•°ã‚½ãƒ¼ã‚¹**: ã‚¢ãƒ—ãƒªã€ã‚·ã‚¹ãƒ†ãƒ ã€ç›£è¦–ã®3ã¤ä»¥ä¸Šã‚’å‚ç…§
3. **æ™‚ç³»åˆ—é †**: äº‹è±¡ã®ç™ºç”Ÿé †ã«ä¸¦ã¹ã€å› æœé–¢ä¿‚ã‚’æ˜ç¢ºã«
4. **è¨¼è·¡è¨˜éŒ²**: å„ã‚¨ãƒ³ãƒˆãƒªã«ãƒ­ã‚°ã®å‡ºå…¸ã‚’è¨˜è¼‰

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆæœ¬èª²è‡ªä½“ã®å•é¡Œè§£æ±ºï¼‰

### journalctl ã®å‡ºåŠ›ãŒå°‘ãªã„ãƒ»ç©º

```bash
# ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ã®ä¿æŒè¨­å®šã‚’ç¢ºèª
journalctl --disk-usage

# ä¿æŒè¨­å®š
cat /etc/systemd/journald.conf
# Storage=auto/persistent/volatile/none
# SystemMaxUse=500M

# æ°¸ç¶šåŒ–ã‚’æœ‰åŠ¹ã«ã™ã‚‹
sudo mkdir -p /var/log/journal
sudo systemd-tmpfiles --create --prefix /var/log/journal
sudo systemctl restart systemd-journald
```

### jq ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„

```bash
# RHEL/CentOS
sudo yum install jq

# Debian/Ubuntu
sudo apt install jq

# jq ãªã—ã§ JSON ã‚’å‡¦ç†
journalctl -o json | python3 -c "import json,sys; [print(json.loads(l).get('MESSAGE','')) for l in sys.stdin]"
```

### æ™‚é–“æŒ‡å®šãŒåŠ¹ã‹ãªã„

```bash
# ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’ç¢ºèª
timedatectl

# æ˜ç¤ºçš„ã«ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’æŒ‡å®š
TZ=Asia/Tokyo journalctl --since '14:30'

# ISO å½¢å¼ã§æŒ‡å®š
journalctl --since '2026-01-10T14:30:00+09:00'
```

### å¤ã„ãƒ­ã‚°ãŒè¦‹ã‚Œãªã„

```bash
# ãƒ–ãƒ¼ãƒˆä¸€è¦§ã‚’ç¢ºèª
journalctl --list-boots

# æ°¸ç¶šåŒ–ã•ã‚Œã¦ã„ãªã„å ´åˆã€å†èµ·å‹•ã§ãƒ­ã‚°ãŒæ¶ˆãˆã‚‹
# /var/log/journal/ ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
ls -la /var/log/journal/

# å­˜åœ¨ã—ãªã„å ´åˆã¯ä½œæˆ
sudo mkdir -p /var/log/journal
sudo systemctl restart systemd-journald
```

---

## å»¶ä¼¸é˜…è¯»

- [systemd Journal Documentation](https://www.freedesktop.org/software/systemd/man/journalctl.html)
- [Linux Logging Best Practices](https://www.loggly.com/ultimate-guide/linux-logging-basics/)
- [jq Manual](https://stedolan.github.io/jq/manual/)
- ä¸Šä¸€è¯¾ï¼š[06 - æ€§èƒ½é—®é¢˜](../06-performance/) -- USE æ–¹æ³•è®ºå®æˆ˜
- ä¸‹ä¸€è¯¾ï¼š[08 - strace è°ƒè¯•](../08-strace/) -- ç³»ç»Ÿè°ƒç”¨è¿½è¸ª

---

## ç³»åˆ—å¯¼èˆª

[<-- 06 - æ€§èƒ½é—®é¢˜](../06-performance/) | [ç³»åˆ—é¦–é¡µ](../) | [08 - strace è°ƒè¯• -->](../08-strace/)
