# 07 - æ•°ç»„ï¼ˆArraysï¼‰

> **ç›®æ ‡**ï¼šæŒæ¡ç´¢å¼•æ•°ç»„å’Œå…³è”æ•°ç»„ï¼Œæ„å»ºé…ç½®æ–‡ä»¶è§£æå™¨  
> **å‰ç½®**ï¼š[06 - å‡½æ•°](../06-functions/)  
> **æ—¶é—´**ï¼šâš¡ 25 åˆ†é’Ÿï¼ˆé€Ÿè¯»ï¼‰/ ğŸ”¬ 90 åˆ†é’Ÿï¼ˆå®Œæ•´å®æ“ï¼‰  
> **ç¯å¢ƒ**ï¼šBash 4.x+ï¼ˆRHEL 7/8/9, Ubuntu 18.04+ å‡å¯ï¼‰  
> **æ³¨æ„**ï¼šå…³è”æ•°ç»„éœ€è¦ Bash 4.0+ï¼Œç´¢å¼•æ•°ç»„åœ¨ Bash 3.x ä¹Ÿå¯ç”¨  

---

## å°†å­¦åˆ°çš„å†…å®¹

1. åˆ›å»ºå’Œä½¿ç”¨ç´¢å¼•æ•°ç»„
2. åˆ›å»ºå’Œä½¿ç”¨å…³è”æ•°ç»„ï¼ˆBash 4+ï¼‰
3. æ•°ç»„éå†ä¸æ“ä½œ
4. æ•°ç»„ä¸å¾ªç¯çš„ç»“åˆ
5. å®é™…åº”ç”¨ï¼šé…ç½®è§£æã€å‚æ•°æ”¶é›†

---

## å…ˆè·‘èµ·æ¥ï¼ï¼ˆ5 åˆ†é’Ÿï¼‰

> åœ¨ç†è§£åŸç†ä¹‹å‰ï¼Œå…ˆè®©æ•°ç»„è·‘èµ·æ¥ã€‚  
> ä½“éªŒæ•°ç»„å­˜å‚¨å¤šä¸ªå€¼çš„ä¾¿åˆ©ã€‚  

```bash
# åˆ›å»ºç»ƒä¹ ç›®å½•
mkdir -p ~/array-lab && cd ~/array-lab

# åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªæ•°ç»„è„šæœ¬
cat > first-array.sh << 'EOF'
#!/bin/bash
# æˆ‘çš„ç¬¬ä¸€ä¸ªæ•°ç»„è„šæœ¬

# ç´¢å¼•æ•°ç»„ï¼šå­˜å‚¨æœåŠ¡å™¨åˆ—è¡¨
servers=("web01" "web02" "db01" "cache01")

echo "=== æœåŠ¡å™¨åˆ—è¡¨ ==="
echo "ç¬¬ä¸€å°: ${servers[0]}"
echo "ç¬¬äºŒå°: ${servers[1]}"
echo "æœåŠ¡å™¨æ€»æ•°: ${#servers[@]}"
echo "æ‰€æœ‰æœåŠ¡å™¨: ${servers[@]}"

echo ""

# å…³è”æ•°ç»„ï¼šå­˜å‚¨é…ç½®ï¼ˆéœ€è¦ Bash 4+ï¼‰
declare -A config
config[host]="192.168.1.100"
config[port]="8080"
config[user]="admin"

echo "=== åº”ç”¨é…ç½® ==="
echo "ä¸»æœº: ${config[host]}"
echo "ç«¯å£: ${config[port]}"
echo "ç”¨æˆ·: ${config[user]}"
EOF

# è¿è¡Œå®ƒï¼
bash first-array.sh
```

**ä½ åº”è¯¥çœ‹åˆ°ç±»ä¼¼çš„è¾“å‡ºï¼š**

```
=== æœåŠ¡å™¨åˆ—è¡¨ ===
ç¬¬ä¸€å°: web01
ç¬¬äºŒå°: web02
æœåŠ¡å™¨æ€»æ•°: 4
æ‰€æœ‰æœåŠ¡å™¨: web01 web02 db01 cache01

=== åº”ç”¨é…ç½® ===
ä¸»æœº: 192.168.1.100
ç«¯å£: 8080
ç”¨æˆ·: admin
```

**æ­å–œï¼ä½ åˆšåˆšä½¿ç”¨äº† Shell çš„ä¸¤ç§æ•°ç»„ï¼**

æ•°ç»„æ˜¯å¤„ç†æ‰¹é‡æ•°æ®çš„åˆ©å™¨â€”â€”æœåŠ¡å™¨åˆ—è¡¨ã€é…ç½®å‚æ•°ã€æ–‡ä»¶é›†åˆéƒ½èƒ½ç”¨æ•°ç»„ä¼˜é›…å¤„ç†ã€‚

ç°åœ¨è®©æˆ‘ä»¬æ·±å…¥ç†è§£æ•°ç»„çš„å„ä¸ªæ–¹é¢ã€‚

---

## Step 1 â€” ç´¢å¼•æ•°ç»„åŸºç¡€ï¼ˆ20 åˆ†é’Ÿï¼‰

### 1.1 ä»€ä¹ˆæ˜¯ç´¢å¼•æ•°ç»„ï¼Ÿ

ç´¢å¼•æ•°ç»„ä½¿ç”¨æ•°å­—ä¸‹æ ‡ï¼ˆä» 0 å¼€å§‹ï¼‰æ¥è®¿é—®å…ƒç´ ï¼š

![Indexed Array](images/indexed-array.png)

<details>
<summary>View ASCII source</summary>

<!-- DIAGRAM: indexed-array -->
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç´¢å¼•æ•°ç»„ï¼ˆIndexed Arrayï¼‰                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  servers=("web01" "web02" "db01" "cache01")                     â”‚
â”‚                                                                  â”‚
â”‚  å†…å­˜å¸ƒå±€ï¼š                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚ web01  â”‚ web02  â”‚  db01  â”‚cache01 â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚  ç´¢å¼•ï¼š0       1        2        3                              â”‚
â”‚                                                                  â”‚
â”‚  è®¿é—®è¯­æ³•ï¼š                                                      â”‚
â”‚  ${servers[0]}    â†’ "web01"     ï¼ˆç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰                   â”‚
â”‚  ${servers[3]}    â†’ "cache01"   ï¼ˆç¬¬å››ä¸ªå…ƒç´ ï¼‰                   â”‚
â”‚  ${servers[@]}    â†’ æ‰€æœ‰å…ƒç´                                     â”‚
â”‚  ${#servers[@]}   â†’ 4           ï¼ˆå…ƒç´ ä¸ªæ•°ï¼‰                    â”‚
â”‚                                                                  â”‚
â”‚  æ³¨æ„ï¼šç´¢å¼•ä» 0 å¼€å§‹ï¼Œä¸æ˜¯ 1ï¼                                   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
<!-- /DIAGRAM -->

</details>

### 1.2 åˆ›å»ºç´¢å¼•æ•°ç»„

æœ‰å¤šç§æ–¹å¼åˆ›å»ºç´¢å¼•æ•°ç»„ï¼š

```bash
cd ~/array-lab

cat > create-arrays.sh << 'EOF'
#!/bin/bash

# æ–¹å¼ 1ï¼šä¸€æ¬¡æ€§èµ‹å€¼ï¼ˆæœ€å¸¸ç”¨ï¼‰
fruits=("apple" "banana" "cherry" "date")

# æ–¹å¼ 2ï¼šé€ä¸ªèµ‹å€¼
colors[0]="red"
colors[1]="green"
colors[2]="blue"

# æ–¹å¼ 3ï¼šä½¿ç”¨ declareï¼ˆæ˜¾å¼å£°æ˜ï¼‰
declare -a numbers=(1 2 3 4 5)

# æ–¹å¼ 4ï¼šä»å‘½ä»¤è¾“å‡ºåˆ›å»º
files=($(ls /etc/*.conf 2>/dev/null | head -5))

# æ–¹å¼ 5ï¼šå¸¦ç©ºæ ¼çš„å…ƒç´ 
paths=("/home/user/My Documents" "/tmp/test file.txt")

echo "=== å„ç§åˆ›å»ºæ–¹å¼çš„ç»“æœ ==="
echo "fruits: ${fruits[@]}"
echo "colors: ${colors[@]}"
echo "numbers: ${numbers[@]}"
echo "files: ${files[@]}"
echo "paths[0]: ${paths[0]}"
echo "paths[1]: ${paths[1]}"
EOF

bash create-arrays.sh
```

### 1.3 è®¿é—®æ•°ç»„å…ƒç´ 

```bash
cd ~/array-lab

cat > access-arrays.sh << 'EOF'
#!/bin/bash

servers=("web01" "web02" "db01" "cache01" "monitor01")

echo "=== è®¿é—®æ•°ç»„å…ƒç´  ==="

# å•ä¸ªå…ƒç´ ï¼ˆæ³¨æ„å¿…é¡»ç”¨èŠ±æ‹¬å·ï¼‰
echo "ç¬¬ä¸€ä¸ª: ${servers[0]}"
echo "æœ€åä¸€ä¸ª: ${servers[-1]}"       # Bash 4.3+
echo "å€’æ•°ç¬¬äºŒä¸ª: ${servers[-2]}"     # Bash 4.3+

# æ‰€æœ‰å…ƒç´ 
echo ""
echo "æ‰€æœ‰å…ƒç´  (\${servers[@]}): ${servers[@]}"
echo "æ‰€æœ‰å…ƒç´  (\${servers[*]}): ${servers[*]}"

# æ•°ç»„é•¿åº¦
echo ""
echo "å…ƒç´ ä¸ªæ•°: ${#servers[@]}"

# è·å–æ‰€æœ‰ç´¢å¼•
echo "æ‰€æœ‰ç´¢å¼•: ${!servers[@]}"

# å…ƒç´ é•¿åº¦
echo "ç¬¬ä¸€ä¸ªå…ƒç´ çš„å­—ç¬¦æ•°: ${#servers[0]}"
EOF

bash access-arrays.sh
```

**é‡è¦**ï¼š`$servers` åªä¼šè¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¿…é¡»ç”¨ `${servers[@]}` è·å–æ‰€æœ‰å…ƒç´ ï¼

### 1.4 æ•°ç»„åˆ‡ç‰‡

```bash
cd ~/array-lab

cat > array-slice.sh << 'EOF'
#!/bin/bash

letters=("a" "b" "c" "d" "e" "f" "g")

echo "åŸæ•°ç»„: ${letters[@]}"
echo ""

# åˆ‡ç‰‡è¯­æ³•: ${array[@]:start:count}
echo "=== æ•°ç»„åˆ‡ç‰‡ ==="
echo "ä»ç´¢å¼• 2 å¼€å§‹å– 3 ä¸ª: ${letters[@]:2:3}"    # c d e
echo "ä»ç´¢å¼• 0 å¼€å§‹å– 2 ä¸ª: ${letters[@]:0:2}"    # a b
echo "ä»ç´¢å¼• 3 å¼€å§‹åˆ°æœ«å°¾: ${letters[@]:3}"       # d e f g

# è´Ÿæ•°ç´¢å¼•åˆ‡ç‰‡ï¼ˆBash 4.3+ï¼‰
echo ""
echo "=== è´Ÿæ•°ç´¢å¼•åˆ‡ç‰‡ ==="
echo "æœ€å 3 ä¸ªå…ƒç´ : ${letters[@]: -3}"           # æ³¨æ„ç©ºæ ¼ï¼
echo "ä»å€’æ•°ç¬¬ 4 ä¸ªå¼€å§‹å– 2 ä¸ª: ${letters[@]: -4:2}"
EOF

bash array-slice.sh
```

> **æ³¨æ„**ï¼šè´Ÿæ•°ç´¢å¼•å‰å¿…é¡»æœ‰ç©ºæ ¼ï¼Œå¦‚ `${arr[@]: -3}`ï¼Œå¦åˆ™ä¼šè¢«è§£æä¸ºé»˜è®¤å€¼è¯­æ³•ã€‚  

---

## Step 2 â€” æ•°ç»„ä¿®æ”¹æ“ä½œï¼ˆ15 åˆ†é’Ÿï¼‰

### 2.1 æ·»åŠ å…ƒç´ 

```bash
cd ~/array-lab

cat > array-modify.sh << 'EOF'
#!/bin/bash

# åˆå§‹æ•°ç»„
servers=("web01" "web02")
echo "åˆå§‹: ${servers[@]} (å…± ${#servers[@]} ä¸ª)"

# è¿½åŠ å•ä¸ªå…ƒç´ 
servers+=("db01")
echo "è¿½åŠ  db01: ${servers[@]}"

# è¿½åŠ å¤šä¸ªå…ƒç´ 
servers+=("cache01" "monitor01")
echo "è¿½åŠ å¤šä¸ª: ${servers[@]}"

# åœ¨æŒ‡å®šä½ç½®æ’å…¥ï¼ˆé€šè¿‡åˆ‡ç‰‡ï¼‰
# åœ¨ç´¢å¼• 2 å¤„æ’å…¥ "new-server"
temp=("${servers[@]:0:2}" "new-server" "${servers[@]:2}")
servers=("${temp[@]}")
echo "åœ¨ä½ç½® 2 æ’å…¥: ${servers[@]}"
EOF

bash array-modify.sh
```

### 2.2 åˆ é™¤å…ƒç´ 

```bash
cd ~/array-lab

cat > array-delete.sh << 'EOF'
#!/bin/bash

servers=("web01" "web02" "db01" "cache01" "monitor01")
echo "åˆå§‹: ${servers[@]}"
echo "ç´¢å¼•: ${!servers[@]}"

# åˆ é™¤æŒ‡å®šç´¢å¼•çš„å…ƒç´ 
unset 'servers[2]'  # åˆ é™¤ db01
echo ""
echo "åˆ é™¤ç´¢å¼• 2 å: ${servers[@]}"
echo "ç´¢å¼•: ${!servers[@]}"  # æ³¨æ„ç´¢å¼•ä¸ä¼šé‡æ–°æ’åˆ—ï¼

# å¦‚æœéœ€è¦é‡æ–°æ’åˆ—ç´¢å¼•
servers=("${servers[@]}")
echo ""
echo "é‡æ–°æ’åˆ—å: ${servers[@]}"
echo "ç´¢å¼•: ${!servers[@]}"

# åˆ é™¤æ•´ä¸ªæ•°ç»„
# unset servers
EOF

bash array-delete.sh
```

![Array Delete Behavior](images/array-delete.png)

<details>
<summary>View ASCII source</summary>

<!-- DIAGRAM: array-delete -->
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°ç»„åˆ é™¤è¡Œä¸º                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  åˆå§‹çŠ¶æ€ï¼š                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ web01  â”‚ web02  â”‚  db01  â”‚cache01 â”‚monitor01 â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚  ç´¢å¼•ï¼š0       1        2        3        4                     â”‚
â”‚                                                                  â”‚
â”‚  æ‰§è¡Œ unset 'arr[2]' åï¼š                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ web01  â”‚ web02  â”‚ (ç©º)   â”‚cache01 â”‚monitor01 â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚  ç´¢å¼•ï¼š0       1      (æ— )      3        4                      â”‚
â”‚                                                                  â”‚
â”‚  æ³¨æ„ï¼šç´¢å¼•ä¸ä¼šè‡ªåŠ¨é‡æ–°æ’åˆ—ï¼                                     â”‚
â”‚  ${!arr[@]} è¿”å› "0 1 3 4"                                      â”‚
â”‚                                                                  â”‚
â”‚  è¦é‡æ–°æ’åˆ—ï¼šarr=("${arr[@]}")                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ web01  â”‚ web02  â”‚cache01 â”‚monitor01 â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚  ç´¢å¼•ï¼š0       1        2        3                              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
<!-- /DIAGRAM -->

</details>

### 2.3 ä¿®æ”¹å…ƒç´ 

```bash
cd ~/array-lab

cat > array-update.sh << 'EOF'
#!/bin/bash

servers=("web01" "web02" "db01")

echo "ä¿®æ”¹å‰: ${servers[@]}"

# ç›´æ¥é€šè¿‡ç´¢å¼•ä¿®æ”¹
servers[1]="web02-new"
echo "ä¿®æ”¹ç´¢å¼• 1: ${servers[@]}"

# æ‰¹é‡æ›¿æ¢ï¼ˆä½¿ç”¨å‚æ•°å±•å¼€ï¼‰
# æŠŠæ‰€æœ‰ web æ›¿æ¢ä¸º nginx
echo ""
echo "=== æ‰¹é‡æ›¿æ¢ ==="
echo "åŸæ•°ç»„: ${servers[@]}"
echo "æ›¿æ¢å: ${servers[@]/web/nginx}"

# æ³¨æ„ï¼šè¿™ä¸ä¼šä¿®æ”¹åŸæ•°ç»„ï¼Œåªè¿”å›æ›¿æ¢åçš„ç»“æœ
# è¦çœŸæ­£ä¿®æ”¹ï¼Œéœ€è¦é‡æ–°èµ‹å€¼ï¼š
# servers=("${servers[@]/web/nginx}")
EOF

bash array-update.sh
```

---

## Step 3 â€” å…³è”æ•°ç»„ï¼ˆBash 4+ï¼‰ï¼ˆ20 åˆ†é’Ÿï¼‰

### 3.1 ä»€ä¹ˆæ˜¯å…³è”æ•°ç»„ï¼Ÿ

å…³è”æ•°ç»„ä½¿ç”¨å­—ç¬¦ä¸²ä½œä¸ºé”®ï¼ˆkeyï¼‰ï¼Œç±»ä¼¼äºå…¶ä»–è¯­è¨€çš„ Hashã€Map æˆ– Dictionaryï¼š

![Associative Array](images/associative-array.png)

<details>
<summary>View ASCII source</summary>

<!-- DIAGRAM: associative-array -->
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…³è”æ•°ç»„ï¼ˆAssociative Arrayï¼‰                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ç´¢å¼•æ•°ç»„ vs å…³è”æ•°ç»„ï¼š                                          â”‚
â”‚                                                                  â”‚
â”‚  ç´¢å¼•æ•°ç»„ï¼š                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  â”‚  val1  â”‚  val2  â”‚  val3  â”‚                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚  é”®ï¼š  0       1       2        ï¼ˆæ•°å­—ï¼‰                         â”‚
â”‚                                                                  â”‚
â”‚  å…³è”æ•°ç»„ï¼š                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  â”‚  val1  â”‚  val2  â”‚  val3  â”‚                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚  é”®ï¼š"host"  "port"  "user"    ï¼ˆå­—ç¬¦ä¸²ï¼‰                        â”‚
â”‚                                                                  â”‚
â”‚  å£°æ˜æ–¹å¼ï¼ˆå¿…é¡»ï¼ï¼‰ï¼š                                             â”‚
â”‚  declare -A config     # å¿…é¡»ç”¨ declare -A å£°æ˜                  â”‚
â”‚                                                                  â”‚
â”‚  èµ‹å€¼ï¼š                                                          â”‚
â”‚  config[host]="192.168.1.1"                                     â”‚
â”‚  config[port]="8080"                                            â”‚
â”‚                                                                  â”‚
â”‚  è®¿é—®ï¼š                                                          â”‚
â”‚  ${config[host]}     â†’ "192.168.1.1"                            â”‚
â”‚  ${config[@]}        â†’ æ‰€æœ‰å€¼                                   â”‚
â”‚  ${!config[@]}       â†’ æ‰€æœ‰é”®                                   â”‚
â”‚                                                                  â”‚
â”‚  æ³¨æ„ï¼šå¿…é¡»ç”¨ declare -Aï¼Œå¦åˆ™ä¼šè¢«å½“ä½œç´¢å¼•æ•°ç»„å¤„ç†ï¼              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
<!-- /DIAGRAM -->

</details>

### 3.2 åˆ›å»ºå’Œä½¿ç”¨å…³è”æ•°ç»„

```bash
cd ~/array-lab

cat > assoc-array.sh << 'EOF'
#!/bin/bash

# æ£€æŸ¥ Bash ç‰ˆæœ¬
if ((BASH_VERSINFO[0] < 4)); then
    echo "é”™è¯¯ï¼šå…³è”æ•°ç»„éœ€è¦ Bash 4.0+" >&2
    echo "å½“å‰ç‰ˆæœ¬: $BASH_VERSION" >&2
    exit 1
fi

# åˆ›å»ºå…³è”æ•°ç»„ï¼ˆå¿…é¡»ç”¨ declare -Aï¼‰
declare -A server_info

# é€ä¸ªèµ‹å€¼
server_info[hostname]="prod-web-01"
server_info[ip]="10.0.1.100"
server_info[role]="webserver"
server_info[os]="RHEL 8"

echo "=== æœåŠ¡å™¨ä¿¡æ¯ ==="
echo "ä¸»æœºå: ${server_info[hostname]}"
echo "IP åœ°å€: ${server_info[ip]}"
echo "è§’è‰²: ${server_info[role]}"
echo "æ“ä½œç³»ç»Ÿ: ${server_info[os]}"

# æˆ–è€…ä¸€æ¬¡æ€§èµ‹å€¼
declare -A db_config=(
    [host]="db.example.com"
    [port]="5432"
    [name]="production"
    [user]="app_user"
)

echo ""
echo "=== æ•°æ®åº“é…ç½® ==="
echo "è¿æ¥å­—ç¬¦ä¸²: postgresql://${db_config[user]}@${db_config[host]}:${db_config[port]}/${db_config[name]}"
EOF

bash assoc-array.sh
```

### 3.3 å…³è”æ•°ç»„çš„éå†

```bash
cd ~/array-lab

cat > assoc-iterate.sh << 'EOF'
#!/bin/bash

declare -A metrics=(
    [cpu_usage]="45%"
    [memory_usage]="78%"
    [disk_usage]="62%"
    [network_in]="1.2 Gbps"
    [network_out]="0.8 Gbps"
)

echo "=== ç³»ç»Ÿç›‘æ§æŒ‡æ ‡ ==="

# è·å–æ‰€æœ‰é”®
echo "æ‰€æœ‰é”®: ${!metrics[@]}"

# è·å–æ‰€æœ‰å€¼
echo "æ‰€æœ‰å€¼: ${metrics[@]}"

# éå†é”®å€¼å¯¹
echo ""
echo "=== è¯¦ç»†æŒ‡æ ‡ ==="
for key in "${!metrics[@]}"; do
    printf "  %-15s : %s\n" "$key" "${metrics[$key]}"
done

# æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨
echo ""
if [[ -v metrics[cpu_usage] ]]; then
    echo "cpu_usage é”®å­˜åœ¨"
fi

if [[ ! -v metrics[gpu_usage] ]]; then
    echo "gpu_usage é”®ä¸å­˜åœ¨"
fi
EOF

bash assoc-iterate.sh
```

### 3.4 å¸¸è§é”™è¯¯ï¼šå¿˜è®° declare -A

```bash
cd ~/array-lab

cat > assoc-mistake.sh << 'EOF'
#!/bin/bash

echo "=== é”™è¯¯ç¤ºèŒƒ ==="

# é”™è¯¯ï¼šæ²¡æœ‰ declare -A
wrong[host]="localhost"
wrong[port]="8080"

echo "wrong æ•°ç»„å†…å®¹: ${wrong[@]}"
echo "wrong æ•°ç»„é”®: ${!wrong[@]}"
echo "wrong[host]: ${wrong[host]}"
# ç»“æœï¼šåªæœ‰æœ€åä¸€ä¸ªå€¼ç”Ÿæ•ˆï¼Œé”®è¢«å½“ä½œæ•°å­—ç´¢å¼• 0

echo ""
echo "=== æ­£ç¡®åšæ³• ==="

# æ­£ç¡®ï¼šä½¿ç”¨ declare -A
declare -A correct
correct[host]="localhost"
correct[port]="8080"

echo "correct æ•°ç»„å†…å®¹: ${correct[@]}"
echo "correct æ•°ç»„é”®: ${!correct[@]}"
echo "correct[host]: ${correct[host]}"
EOF

bash assoc-mistake.sh
```

---

## Step 4 â€” æ•°ç»„éå†æœ€ä½³å®è·µï¼ˆ15 åˆ†é’Ÿï¼‰

### 4.1 æ­£ç¡®éå†æ•°ç»„ï¼ˆé‡è¦ï¼ï¼‰

æ•°ç»„éå†æ˜¯æœ€å®¹æ˜“å‡ºé”™çš„åœ°æ–¹ï¼Œå…³é”®åœ¨äºæ­£ç¡®ä½¿ç”¨å¼•å·ï¼š

![Array Iteration](images/array-iteration.png)

<details>
<summary>View ASCII source</summary>

<!-- DIAGRAM: array-iteration -->
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°ç»„éå†ï¼šå¼•å·çš„é‡è¦æ€§                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  arr=("file one.txt" "file two.txt" "file three.txt")           â”‚
â”‚                                                                  â”‚
â”‚  é”™è¯¯ï¼šfor item in ${arr[@]}                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  file  â”‚ one â”‚  file  â”‚ two â”‚  file    â”‚threeâ”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜              â”‚
â”‚  ç»“æœï¼š6 æ¬¡å¾ªç¯ï¼ç©ºæ ¼å¯¼è‡´å…ƒç´ è¢«åˆ†å‰²                              â”‚
â”‚                                                                  â”‚
â”‚  æ­£ç¡®ï¼šfor item in "${arr[@]}"                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  file one.txt  â”‚  file two.txt  â”‚  file three.txt  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  ç»“æœï¼š3 æ¬¡å¾ªç¯ï¼æ¯ä¸ªå…ƒç´ ä¿æŒå®Œæ•´                                â”‚
â”‚                                                                  â”‚
â”‚  é»„é‡‘æ³•åˆ™ï¼š                                                      â”‚
â”‚  éå†æ•°ç»„æ—¶ï¼Œæ°¸è¿œä½¿ç”¨ "${arr[@]}" è€Œä¸æ˜¯ ${arr[@]}              â”‚
â”‚                                                                  â”‚
â”‚  ${arr[@]} vs ${arr[*]} çš„åŒºåˆ«ï¼š                                â”‚
â”‚  "${arr[@]}"  â†’ "elem1" "elem2" "elem3"  ï¼ˆå„è‡ªç‹¬ç«‹ï¼Œæ¨èï¼‰     â”‚
â”‚  "${arr[*]}"  â†’ "elem1 elem2 elem3"      ï¼ˆåˆå¹¶ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼‰   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
<!-- /DIAGRAM -->

</details>

### 4.2 éå†ç¤ºä¾‹

```bash
cd ~/array-lab

cat > iterate-correct.sh << 'EOF'
#!/bin/bash

# å¸¦ç©ºæ ¼çš„æ–‡ä»¶åæ•°ç»„
files=("My Document.txt" "Project Report.pdf" "2024 Budget.xlsx")

echo "=== é”™è¯¯çš„éå†æ–¹å¼ ==="
echo "ä½¿ç”¨ \${files[@]} ä¸åŠ å¼•å·ï¼š"
count=0
for file in ${files[@]}; do
    ((count++))
    echo "  $count: $file"
done
echo "å¾ªç¯æ¬¡æ•°: $countï¼ˆé”™è¯¯ï¼åº”è¯¥æ˜¯ 3ï¼‰"

echo ""
echo "=== æ­£ç¡®çš„éå†æ–¹å¼ ==="
echo "ä½¿ç”¨ \"\${files[@]}\" åŠ å¼•å·ï¼š"
count=0
for file in "${files[@]}"; do
    ((count++))
    echo "  $count: $file"
done
echo "å¾ªç¯æ¬¡æ•°: $countï¼ˆæ­£ç¡®ï¼ï¼‰"
EOF

bash iterate-correct.sh
```

### 4.3 å¸¦ç´¢å¼•çš„éå†

```bash
cd ~/array-lab

cat > iterate-with-index.sh << 'EOF'
#!/bin/bash

servers=("web01" "web02" "db01" "cache01")

echo "=== å¸¦ç´¢å¼•çš„éå† ==="

# æ–¹å¼ 1ï¼šä½¿ç”¨ ${!arr[@]} è·å–ç´¢å¼•
for i in "${!servers[@]}"; do
    echo "servers[$i] = ${servers[$i]}"
done

echo ""

# æ–¹å¼ 2ï¼šä½¿ç”¨è®¡æ•°å™¨
echo "=== ä½¿ç”¨è®¡æ•°å™¨ ==="
i=0
for server in "${servers[@]}"; do
    echo "æœåŠ¡å™¨ $((i+1)): $server"
    ((i++))
done

echo ""

# æ–¹å¼ 3ï¼šC é£æ ¼å¾ªç¯
echo "=== C é£æ ¼å¾ªç¯ ==="
for ((i=0; i<${#servers[@]}; i++)); do
    echo "servers[$i] = ${servers[$i]}"
done
EOF

bash iterate-with-index.sh
```

### 4.4 å…³è”æ•°ç»„çš„é”®å€¼éå†

```bash
cd ~/array-lab

cat > iterate-assoc.sh << 'EOF'
#!/bin/bash

declare -A env_vars=(
    [APP_NAME]="my-application"
    [APP_ENV]="production"
    [APP_PORT]="8080"
    [APP_DEBUG]="false"
)

echo "=== éå†å…³è”æ•°ç»„ ==="

# éå†é”®
echo "æ‰€æœ‰é”®ï¼š"
for key in "${!env_vars[@]}"; do
    echo "  - $key"
done

echo ""

# éå†é”®å€¼å¯¹ï¼ˆæœ€å¸¸ç”¨ï¼‰
echo "é”®å€¼å¯¹ï¼š"
for key in "${!env_vars[@]}"; do
    echo "  export $key=\"${env_vars[$key]}\""
done

echo ""

# æ£€æŸ¥å¹¶ä½¿ç”¨
echo "=== ç”Ÿæˆç¯å¢ƒé…ç½® ==="
for key in "${!env_vars[@]}"; do
    if [[ -n "${env_vars[$key]}" ]]; then
        export "$key=${env_vars[$key]}"
        echo "å·²è®¾ç½®: $key"
    fi
done
EOF

bash iterate-assoc.sh
```

---

## Step 5 â€” æ•°ç»„å‚æ•°ä¼ é€’ï¼ˆ10 åˆ†é’Ÿï¼‰

### 5.1 ä¼ é€’æ•°ç»„ç»™å‡½æ•°

æ•°ç»„å‚æ•°ä¼ é€’æ˜¯ Shell è„šæœ¬çš„ä¸€ä¸ªæ£˜æ‰‹é—®é¢˜ï¼š

```bash
cd ~/array-lab

cat > array-params.sh << 'EOF'
#!/bin/bash

# æ–¹å¼ 1ï¼šå±•å¼€ä¸ºå¤šä¸ªå‚æ•°ï¼ˆæ¨èï¼‰
function print_all() {
    echo "=== æ¥æ”¶åˆ° $# ä¸ªå‚æ•° ==="
    local i=1
    for arg in "$@"; do
        echo "  å‚æ•° $i: $arg"
        ((i++))
    done
}

# æ–¹å¼ 2ï¼šä¼ é€’æ•°ç»„åï¼ˆä½¿ç”¨ namerefï¼ŒBash 4.3+ï¼‰
function process_array() {
    local -n arr_ref="$1"  # nameref å¼•ç”¨
    echo "=== é€šè¿‡ nameref è®¿é—® ==="
    echo "æ•°ç»„é•¿åº¦: ${#arr_ref[@]}"
    for item in "${arr_ref[@]}"; do
        echo "  - $item"
    done
}

# æµ‹è¯•
servers=("web01" "web02" "db01")

echo "=== æ–¹å¼ 1ï¼šå±•å¼€ä¼ é€’ ==="
print_all "${servers[@]}"

echo ""
echo "=== æ–¹å¼ 2ï¼šä¼ é€’æ•°ç»„åï¼ˆBash 4.3+ï¼‰==="
process_array servers
EOF

bash array-params.sh
```

### 5.2 ä»å‡½æ•°è¿”å›æ•°ç»„

```bash
cd ~/array-lab

cat > array-return.sh << 'EOF'
#!/bin/bash

# æ–¹å¼ 1ï¼šé€šè¿‡æ ‡å‡†è¾“å‡ºè¿”å›ï¼ˆç”¨æ¢è¡Œåˆ†éš”ï¼‰
function get_servers() {
    echo "web01"
    echo "web02"
    echo "db01"
}

# æ–¹å¼ 2ï¼šé€šè¿‡ nameref è¾“å‡ºï¼ˆBash 4.3+ï¼‰
function get_servers_v2() {
    local -n result="$1"
    result=("web01" "web02" "db01")
}

echo "=== æ–¹å¼ 1ï¼šè¯»å–è¾“å‡º ==="
# ä½¿ç”¨ mapfile/readarray è¯»å–
mapfile -t servers1 < <(get_servers)
echo "è·å–åˆ° ${#servers1[@]} å°æœåŠ¡å™¨: ${servers1[@]}"

echo ""
echo "=== æ–¹å¼ 2ï¼šé€šè¿‡ nameref ==="
declare -a servers2
get_servers_v2 servers2
echo "è·å–åˆ° ${#servers2[@]} å°æœåŠ¡å™¨: ${servers2[@]}"
EOF

bash array-return.sh
```

---

## Step 6 â€” Mini Projectï¼šé…ç½®æ–‡ä»¶è§£æå™¨ï¼ˆ25 åˆ†é’Ÿï¼‰

> **é¡¹ç›®ç›®æ ‡**ï¼šä½¿ç”¨å…³è”æ•°ç»„è§£æ key=value æ ¼å¼çš„é…ç½®æ–‡ä»¶ã€‚  

### 6.1 é¡¹ç›®éœ€æ±‚

åˆ›å»ºä¸€ä¸ªé…ç½®è§£æå™¨ï¼Œèƒ½å¤Ÿï¼š

1. è¯»å– `key=value` æ ¼å¼çš„é…ç½®æ–‡ä»¶
2. æ”¯æŒæ³¨é‡Šï¼ˆ# å¼€å¤´ï¼‰å’Œç©ºè¡Œ
3. æ”¯æŒå€¼ä¸­åŒ…å« `=` ç¬¦å·
4. å°†é…ç½®å­˜å‚¨åœ¨å…³è”æ•°ç»„ä¸­
5. æä¾›æŸ¥è¯¢å’ŒéªŒè¯åŠŸèƒ½

### 6.2 åˆ›å»ºç¤ºä¾‹é…ç½®æ–‡ä»¶

```bash
cd ~/array-lab

# åˆ›å»ºç¤ºä¾‹é…ç½®æ–‡ä»¶
cat > app.conf << 'EOF'
# Application Configuration
# åº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶

# Server settings
APP_NAME=my-application
APP_VERSION=1.2.3
APP_ENV=production

# Database settings
DB_HOST=db.example.com
DB_PORT=5432
DB_NAME=myapp_production
DB_USER=app_user
# æ³¨æ„ï¼šå¯†ç ä¸­å¯èƒ½åŒ…å« = å·
DB_PASSWORD=p@ss=word123

# Feature flags
FEATURE_NEW_UI=true
FEATURE_DARK_MODE=false

# Empty value example
EMPTY_VALUE=

# Logging
LOG_LEVEL=INFO
LOG_PATH=/var/log/myapp
EOF

echo "é…ç½®æ–‡ä»¶å·²åˆ›å»º: app.conf"
cat app.conf
```

### 6.3 å®Œæ•´å®ç°

```bash
cd ~/array-lab

cat > config-parser.sh << 'EOF'
#!/bin/bash
# =============================================================================
# æ–‡ä»¶åï¼šconfig-parser.sh
# åŠŸèƒ½ï¼šé…ç½®æ–‡ä»¶è§£æå™¨ï¼ˆä½¿ç”¨å…³è”æ•°ç»„ï¼‰
# ç”¨æ³•ï¼š./config-parser.sh <é…ç½®æ–‡ä»¶>
# =============================================================================

set -euo pipefail

# æ£€æŸ¥ Bash ç‰ˆæœ¬
if ((BASH_VERSINFO[0] < 4)); then
    echo "é”™è¯¯ï¼šæœ¬è„šæœ¬éœ€è¦ Bash 4.0+ï¼ˆå½“å‰: $BASH_VERSIONï¼‰" >&2
    exit 1
fi

# å…¨å±€å…³è”æ•°ç»„å­˜å‚¨é…ç½®
declare -gA CONFIG

# =============================================================================
# å‡½æ•°å®šä¹‰
# =============================================================================

# è§£æé…ç½®æ–‡ä»¶
# å‚æ•°: $1 - é…ç½®æ–‡ä»¶è·¯å¾„
# è¿”å›: 0 æˆåŠŸ, 1 å¤±è´¥
function parse_config() {
    local config_file="$1"
    local line_num=0
    local key value

    # éªŒè¯æ–‡ä»¶å­˜åœ¨
    if [[ ! -f "$config_file" ]]; then
        echo "é”™è¯¯ï¼šé…ç½®æ–‡ä»¶ä¸å­˜åœ¨: $config_file" >&2
        return 1
    fi

    # æ¸…ç©ºç°æœ‰é…ç½®
    CONFIG=()

    # é€è¡Œè¯»å–
    while IFS= read -r line || [[ -n "$line" ]]; do
        ((line_num++))

        # å»é™¤é¦–å°¾ç©ºç™½
        line="${line#"${line%%[![:space:]]*}"}"
        line="${line%"${line##*[![:space:]]}"}"

        # è·³è¿‡ç©ºè¡Œå’Œæ³¨é‡Š
        [[ -z "$line" || "$line" == \#* ]] && continue

        # è§£æ key=value
        if [[ "$line" =~ ^([a-zA-Z_][a-zA-Z0-9_]*)=(.*)$ ]]; then
            key="${BASH_REMATCH[1]}"
            value="${BASH_REMATCH[2]}"
            CONFIG["$key"]="$value"
        else
            echo "è­¦å‘Šï¼šç¬¬ $line_num è¡Œæ ¼å¼æ— æ•ˆ: $line" >&2
        fi
    done < "$config_file"

    echo "å·²åŠ è½½ ${#CONFIG[@]} ä¸ªé…ç½®é¡¹" >&2
    return 0
}

# è·å–é…ç½®å€¼
# å‚æ•°: $1 - é”®å, $2 - é»˜è®¤å€¼ï¼ˆå¯é€‰ï¼‰
function config_get() {
    local key="$1"
    local default="${2:-}"

    if [[ -v CONFIG[$key] ]]; then
        echo "${CONFIG[$key]}"
    else
        echo "$default"
    fi
}

# æ£€æŸ¥é…ç½®é¡¹æ˜¯å¦å­˜åœ¨
function config_has() {
    local key="$1"
    [[ -v CONFIG[$key] ]]
}

# åˆ—å‡ºæ‰€æœ‰é…ç½®
function config_list() {
    echo "=== å½“å‰é…ç½®ï¼ˆå…± ${#CONFIG[@]} é¡¹ï¼‰==="
    for key in $(printf '%s\n' "${!CONFIG[@]}" | sort); do
        local value="${CONFIG[$key]}"
        # æ•æ„Ÿä¿¡æ¯è„±æ•
        if [[ "$key" =~ PASSWORD|SECRET|KEY ]]; then
            value="********"
        fi
        printf "  %-20s = %s\n" "$key" "$value"
    done
}

# éªŒè¯å¿…éœ€çš„é…ç½®é¡¹
# å‚æ•°: $@ - å¿…éœ€çš„é”®ååˆ—è¡¨
function config_validate() {
    local missing=()
    for key in "$@"; do
        if ! config_has "$key"; then
            missing+=("$key")
        fi
    done

    if [[ ${#missing[@]} -gt 0 ]]; then
        echo "é”™è¯¯ï¼šç¼ºå°‘å¿…éœ€çš„é…ç½®é¡¹: ${missing[*]}" >&2
        return 1
    fi
    return 0
}

# å¯¼å‡ºé…ç½®ä¸ºç¯å¢ƒå˜é‡
function config_export() {
    for key in "${!CONFIG[@]}"; do
        export "$key=${CONFIG[$key]}"
    done
    echo "å·²å¯¼å‡º ${#CONFIG[@]} ä¸ªç¯å¢ƒå˜é‡" >&2
}

# =============================================================================
# ä¸»ç¨‹åº
# =============================================================================

function main() {
    local config_file="${1:-}"

    if [[ -z "$config_file" ]]; then
        echo "ç”¨æ³•: $0 <é…ç½®æ–‡ä»¶>" >&2
        exit 1
    fi

    echo "=== é…ç½®æ–‡ä»¶è§£æå™¨ ==="
    echo ""

    # è§£æé…ç½®
    parse_config "$config_file" || exit 1

    # åˆ—å‡ºæ‰€æœ‰é…ç½®
    echo ""
    config_list

    # æ¼”ç¤ºè·å–å•ä¸ªé…ç½®
    echo ""
    echo "=== è·å–å•ä¸ªé…ç½® ==="
    echo "APP_NAME: $(config_get APP_NAME)"
    echo "DB_HOST: $(config_get DB_HOST)"
    echo "NOT_EXIST: $(config_get NOT_EXIST "é»˜è®¤å€¼")"

    # éªŒè¯å¿…éœ€é…ç½®
    echo ""
    echo "=== éªŒè¯å¿…éœ€é…ç½® ==="
    if config_validate APP_NAME APP_ENV DB_HOST DB_PORT; then
        echo "é…ç½®éªŒè¯é€šè¿‡ï¼"
    else
        echo "é…ç½®éªŒè¯å¤±è´¥ï¼"
    fi

    # æ£€æŸ¥å¸ƒå°”é…ç½®
    echo ""
    echo "=== æ£€æŸ¥åŠŸèƒ½å¼€å…³ ==="
    if [[ "$(config_get FEATURE_NEW_UI)" == "true" ]]; then
        echo "æ–° UI åŠŸèƒ½å·²å¯ç”¨"
    else
        echo "æ–° UI åŠŸèƒ½æœªå¯ç”¨"
    fi
}

# å¦‚æœç›´æ¥è¿è¡Œï¼ˆä¸æ˜¯è¢« sourceï¼‰
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    main "$@"
fi
EOF

chmod +x config-parser.sh
./config-parser.sh app.conf
```

### 6.4 ä½œä¸ºåº“ä½¿ç”¨

```bash
cd ~/array-lab

cat > use-config.sh << 'EOF'
#!/bin/bash
# æ¼”ç¤ºå¦‚ä½•å°† config-parser.sh ä½œä¸ºåº“ä½¿ç”¨

# å¼•å…¥é…ç½®è§£æå™¨
source ./config-parser.sh

# è§£æé…ç½®æ–‡ä»¶
parse_config "app.conf"

# ä½¿ç”¨é…ç½®
echo "=== åº”ç”¨å¯åŠ¨ ==="
echo "åº”ç”¨åç§°: $(config_get APP_NAME)"
echo "ç¯å¢ƒ: $(config_get APP_ENV)"
echo "ç‰ˆæœ¬: $(config_get APP_VERSION)"

# æ„å»ºæ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
db_conn="postgresql://$(config_get DB_USER):$(config_get DB_PASSWORD)@$(config_get DB_HOST):$(config_get DB_PORT)/$(config_get DB_NAME)"
echo ""
echo "æ•°æ®åº“è¿æ¥: postgresql://$(config_get DB_USER):******@$(config_get DB_HOST):$(config_get DB_PORT)/$(config_get DB_NAME)"

# æ£€æŸ¥æ—¥å¿—é…ç½®
echo ""
echo "æ—¥å¿—çº§åˆ«: $(config_get LOG_LEVEL INFO)"
echo "æ—¥å¿—è·¯å¾„: $(config_get LOG_PATH /tmp)"
EOF

bash use-config.sh
```

---

## åæ¨¡å¼ï¼šå¸¸è§é”™è¯¯

### é”™è¯¯ 1ï¼š${arr[*]} ä¸åŠ å¼•å·

```bash
# é”™è¯¯ï¼šå…ƒç´ è¾¹ç•Œä¸¢å¤±
files=("file one.txt" "file two.txt")
for f in ${files[*]}; do
    echo "$f"    # è¾“å‡º 4 æ¬¡ï¼Œä¸æ˜¯ 2 æ¬¡ï¼
done

# æ­£ç¡®ï¼šä½¿ç”¨ "${arr[@]}"
for f in "${files[@]}"; do
    echo "$f"    # è¾“å‡º 2 æ¬¡
done
```

### é”™è¯¯ 2ï¼šå¿˜è®° declare -A

```bash
# é”™è¯¯ï¼šæ²¡æœ‰ declare -Aï¼Œè¢«å½“ä½œç´¢å¼•æ•°ç»„
config[host]="localhost"
config[port]="8080"
echo "${config[host]}"  # å¯èƒ½æ˜¯ç©ºæˆ–è€…å¥‡æ€ªçš„å€¼

# æ­£ç¡®ï¼šæ˜¾å¼å£°æ˜å…³è”æ•°ç»„
declare -A config
config[host]="localhost"
config[port]="8080"
echo "${config[host]}"  # localhost
```

### é”™è¯¯ 3ï¼šåœ¨ sh ä¸­ä½¿ç”¨æ•°ç»„

```bash
#!/bin/sh
# é”™è¯¯ï¼šsh ä¸æ”¯æŒæ•°ç»„ï¼
arr=(a b c)    # è¯­æ³•é”™è¯¯

# æ­£ç¡®ï¼šä½¿ç”¨ #!/bin/bash æˆ–æ£€æŸ¥å…¼å®¹æ€§
#!/bin/bash
arr=(a b c)    # OK
```

### é”™è¯¯ 4ï¼šè´Ÿæ•°ç´¢å¼•å‰å¿˜è®°ç©ºæ ¼

```bash
arr=(a b c d e)

# é”™è¯¯ï¼šä¼šè¢«è§£æä¸ºé»˜è®¤å€¼è¯­æ³•
echo "${arr[@]:-3}"    # é”™è¯¯ï¼

# æ­£ç¡®ï¼šè´Ÿæ•°å‰åŠ ç©ºæ ¼
echo "${arr[@]: -3}"   # d eï¼ˆæœ€å 3 ä¸ªï¼‰
```

---

## èŒåœºå°è´´å£«ï¼ˆJapan IT Contextï¼‰

### æ•°ç»„åœ¨è¿ç»´ä¸­çš„åº”ç”¨

åœ¨æ—¥æœ¬ IT ä¼ä¸šï¼Œæ•°ç»„å¸¸ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š

| æ—¥è¯­æœ¯è¯­ | å«ä¹‰ | ä½¿ç”¨åœºæ™¯ |
|----------|------|----------|
| ã‚µãƒ¼ãƒãƒ¼ãƒªã‚¹ãƒˆ | æœåŠ¡å™¨åˆ—è¡¨ | æ‰¹é‡æ“ä½œå¤šå°æœåŠ¡å™¨ |
| è¨­å®šå€¤ | é…ç½®å€¼ | å…³è”æ•°ç»„å­˜å‚¨é…ç½® |
| ãƒãƒƒãƒå‡¦ç† | æ‰¹å¤„ç† | å¤„ç†æ–‡ä»¶åˆ—è¡¨ |
| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç®¡ç† | å‚æ•°ç®¡ç† | å‘½ä»¤è¡Œå‚æ•°æ”¶é›† |

### æ—¥æœ¬ä¼ä¸šçš„é…ç½®ç®¡ç†

```bash
#!/bin/bash
# ==============================================================================
# ãƒ•ã‚¡ã‚¤ãƒ«åï¼šserver_check.sh
# æ¦‚è¦ï¼šè¤‡æ•°ã‚µãƒ¼ãƒãƒ¼ã®ä¸€æ‹¬ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
# ä½œæˆè€…ï¼šå±±ç”°å¤ªéƒ
# ==============================================================================

# ã‚µãƒ¼ãƒãƒ¼ãƒªã‚¹ãƒˆ
declare -a SERVERS=(
    "web01.example.jp"
    "web02.example.jp"
    "db01.example.jp"
    "cache01.example.jp"
)

# å„ã‚µãƒ¼ãƒãƒ¼ã‚’ãƒã‚§ãƒƒã‚¯
for server in "${SERVERS[@]}"; do
    echo "Checking: $server"
    if ping -c 1 -W 2 "$server" &>/dev/null; then
        echo "  [OK] $server is reachable"
    else
        echo "  [NG] $server is unreachable"
    fi
done
```

### éšœå®³å¯¾å¿œã§ã®ä½¿ç”¨ä¾‹

```bash
#!/bin/bash
# éšœå®³ç™ºç”Ÿæ™‚ã®ãƒ­ã‚°åé›†ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

# åé›†å¯¾è±¡ã‚µãƒ¼ãƒãƒ¼ï¼ˆé–¢é€£ã‚·ã‚¹ãƒ†ãƒ ï¼‰
declare -A SYSTEMS=(
    [web]="web01.example.jp"
    [app]="app01.example.jp"
    [db]="db01.example.jp"
    [cache]="cache01.example.jp"
)

# ãƒ­ã‚°åé›†å…ˆ
LOG_DIR="/var/log/incident/$(date +%Y%m%d_%H%M%S)"
mkdir -p "$LOG_DIR"

# å„ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰ãƒ­ã‚°åé›†
for system in "${!SYSTEMS[@]}"; do
    host="${SYSTEMS[$system]}"
    echo "Collecting logs from $system ($host)..."
    ssh "$host" "journalctl -n 1000" > "$LOG_DIR/${system}.log" 2>&1 || \
        echo "  [WARN] Failed to collect from $system"
done

echo "Logs collected in: $LOG_DIR"
```

---

## æ£€æŸ¥æ¸…å•

å®Œæˆæœ¬è¯¾åï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

- [ ] åˆ›å»ºå’Œä½¿ç”¨ç´¢å¼•æ•°ç»„ `arr=(a b c)`
- [ ] è®¿é—®æ•°ç»„å…ƒç´  `${arr[0]}`, `${arr[@]}`, `${#arr[@]}`
- [ ] ä½¿ç”¨æ•°ç»„åˆ‡ç‰‡ `${arr[@]:start:count}`
- [ ] æ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹æ•°ç»„å…ƒç´ 
- [ ] ä½¿ç”¨ `declare -A` åˆ›å»ºå…³è”æ•°ç»„
- [ ] éå†å…³è”æ•°ç»„çš„é”®å’Œå€¼
- [ ] æ­£ç¡®ä½¿ç”¨å¼•å·éå†æ•°ç»„ `"${arr[@]}"`
- [ ] åŒºåˆ† `${arr[@]}` å’Œ `${arr[*]}`
- [ ] ä¼ é€’æ•°ç»„ç»™å‡½æ•°
- [ ] ä½¿ç”¨å…³è”æ•°ç»„è§£æé…ç½®æ–‡ä»¶

**éªŒè¯å‘½ä»¤ï¼š**

```bash
cd ~/array-lab

# æµ‹è¯• 1: ç´¢å¼•æ•°ç»„
bash -c 'arr=(a b c); echo ${#arr[@]}'
# é¢„æœŸ: 3

# æµ‹è¯• 2: å…³è”æ•°ç»„
bash -c 'declare -A m; m[k]=v; echo ${m[k]}'
# é¢„æœŸ: v

# æµ‹è¯• 3: æ­£ç¡®éå†
bash -c 'arr=("a b" "c d"); for i in "${arr[@]}"; do echo "[$i]"; done'
# é¢„æœŸ: [a b] å’Œ [c d] å„ä¸€è¡Œ

# æµ‹è¯• 4: é…ç½®è§£æå™¨
./config-parser.sh app.conf | grep -q "APP_NAME"
echo "é…ç½®è§£æå™¨: $([[ $? -eq 0 ]] && echo "OK" || echo "FAIL")"
```

---

## æœ¬è¯¾å°ç»“

| æ¦‚å¿µ | è¯­æ³•/è¦ç‚¹ |
|------|-----------|
| ç´¢å¼•æ•°ç»„åˆ›å»º | `arr=(a b c)` æˆ– `arr[0]=a` |
| å…³è”æ•°ç»„åˆ›å»º | `declare -A map; map[key]=value` |
| è®¿é—®å•ä¸ªå…ƒç´  | `${arr[0]}`, `${map[key]}` |
| æ‰€æœ‰å…ƒç´  | `${arr[@]}`ï¼ˆæ¨èï¼‰æˆ– `${arr[*]}` |
| å…ƒç´ ä¸ªæ•° | `${#arr[@]}` |
| æ‰€æœ‰ç´¢å¼•/é”® | `${!arr[@]}` |
| æ•°ç»„åˆ‡ç‰‡ | `${arr[@]:start:count}` |
| è¿½åŠ å…ƒç´  | `arr+=(new)` |
| åˆ é™¤å…ƒç´  | `unset 'arr[index]'` |
| éå†é»„é‡‘æ³•åˆ™ | æ°¸è¿œç”¨ `"${arr[@]}"` å¸¦å¼•å· |

---

## é¢è¯•å‡†å¤‡

### **é…åˆ—ã®å…¨è¦ç´ ã‚’æ­£ã—ãå±•é–‹ã™ã‚‹æ–¹æ³•ã¯ï¼Ÿ**

`"${arr[@]}"` ã‚’ä½¿ã„ã¾ã™ã€‚ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã§å›²ã‚€ã“ã¨ã§ã€ã‚¹ãƒšãƒ¼ã‚¹ã‚’å«ã‚€è¦ç´ ã‚‚æ­£ã—ãå€‹åˆ¥ã«å‡¦ç†ã•ã‚Œã¾ã™ã€‚

```bash
files=("file one.txt" "file two.txt")

# é–“é•ã„ï¼šã‚¹ãƒšãƒ¼ã‚¹ã§åˆ†å‰²ã•ã‚Œã‚‹
for f in ${files[@]}; do echo "$f"; done  # 4å›ãƒ«ãƒ¼ãƒ—

# æ­£è§£ï¼šå„è¦ç´ ãŒä¿æŒã•ã‚Œã‚‹
for f in "${files[@]}"; do echo "$f"; done  # 2å›ãƒ«ãƒ¼ãƒ—
```

### **é€£æƒ³é…åˆ—ã‚’ä½œæˆã™ã‚‹ã«ã¯ï¼Ÿ**

`declare -A` ã§å®£è¨€ã—ã¦ã‹ã‚‰ã€ã‚­ãƒ¼ã¨å€¤ã‚’è¨­å®šã—ã¾ã™ã€‚Bash 4.0 ä»¥ä¸ŠãŒå¿…è¦ã§ã™ã€‚

```bash
declare -A config
config[host]="localhost"
config[port]="8080"

# ã¾ãŸã¯ä¸€æ‹¬ã§
declare -A config=(
    [host]="localhost"
    [port]="8080"
)

echo "${config[host]}"  # localhost
```

---

## å»¶ä¼¸é˜…è¯»

- [Bash Arrays](https://www.gnu.org/software/bash/manual/html_node/Arrays.html) - GNU Bash å®˜æ–¹æ–‡æ¡£
- [Associative Arrays](https://wiki.bash-hackers.org/syntax/arrays#associative_arrays) - Bash Hackers Wiki
- ä¸Šä¸€è¯¾ï¼š[06 - å‡½æ•°](../06-functions/) â€” å‡½æ•°å®šä¹‰ä¸å¤ç”¨
- ä¸‹ä¸€è¯¾ï¼š[08 - å‚æ•°å±•å¼€](../08-expansion/) â€” å¼ºå¤§çš„å­—ç¬¦ä¸²å¤„ç†

---

## æ¸…ç†

```bash
# æ¸…ç†ç»ƒä¹ æ–‡ä»¶
cd ~
rm -rf ~/array-lab
```

---

## ç³»åˆ—å¯¼èˆª

[<-- 06 - å‡½æ•°](../06-functions/) | [è¯¾ç¨‹é¦–é¡µ](../) | [08 - å‚æ•°å±•å¼€ -->](../08-expansion/)
