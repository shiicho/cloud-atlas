# 10 - è½¯ä»¶åŒ…ç®¡ç† (DEB/APT)

> **ç›®æ ‡**ï¼šæŒæ¡ Debian/Ubuntu ç³»ç»Ÿçš„è½¯ä»¶åŒ…ç®¡ç†ï¼Œå­¦ä¼šæŸ¥è¯¢ã€å®‰è£…ã€æ›´æ–°æ“ä½œ  
> **å‰ç½®**ï¼šåŸºç¡€ Linux å‘½ä»¤è¡Œæ“ä½œï¼Œäº†è§£ RPM/DNF æ¦‚å¿µï¼ˆ[ä¸Šä¸€è¯¾](../09-package-management-rpm-dnf/)ï¼‰  
> **æ—¶é—´**ï¼šâš¡ 25 åˆ†é’Ÿï¼ˆé€Ÿè¯»ï¼‰/ ğŸ”¬ 90 åˆ†é’Ÿï¼ˆå®Œæ•´å®æ“ï¼‰  
> **å®æˆ˜åœºæ™¯**ï¼šUbuntu/Debian ç¯å¢ƒä¸‹çš„è½¯ä»¶åŒ…ç”Ÿå‘½å‘¨æœŸç®¡ç†  

---

## å°†å­¦åˆ°çš„å†…å®¹

1. ç†è§£ DEB è½¯ä»¶åŒ…çš„ç»“æ„ï¼ˆcontrol.tar.gz + data.tar.xzï¼‰
2. ä½¿ç”¨ dpkg å‘½ä»¤æŸ¥è¯¢å·²å®‰è£…è½¯ä»¶åŒ…
3. ä½¿ç”¨ apt å®‰è£…ã€åˆ é™¤ã€æ›´æ–°è½¯ä»¶åŒ…
4. ä½¿ç”¨ apt search/show/list æŸ¥æ‰¾è½¯ä»¶åŒ…ä¿¡æ¯
5. ç†è§£ apt vs apt-get çš„åŒºåˆ«ï¼ˆäº¤äº’ vs è„šæœ¬ï¼‰
6. ä½¿ç”¨ apt-cache æŸ¥è¯¢è½¯ä»¶åŒ…ä¿¡æ¯
7. æŒæ¡ RPM å‘½ä»¤åˆ° DEB å‘½ä»¤çš„æ˜ å°„

---

## å…ˆè·‘èµ·æ¥ï¼ï¼ˆ5 åˆ†é’Ÿï¼‰

> åœ¨å­¦ä¹ ç†è®ºä¹‹å‰ï¼Œå…ˆä½“éªŒ DEB è½¯ä»¶åŒ…ç®¡ç†çš„åŸºæœ¬æ“ä½œã€‚  
> è¿è¡Œè¿™äº›å‘½ä»¤ï¼Œè§‚å¯Ÿè¾“å‡º -- è¿™å°±æ˜¯ä½ å°†è¦æŒæ¡çš„æŠ€èƒ½ã€‚  

```bash
# æŸ¥çœ‹ç³»ç»Ÿå·²å®‰è£…çš„è½¯ä»¶åŒ…æ•°é‡
dpkg -l | tail -n +6 | wc -l

# æŸ¥çœ‹ bash è½¯ä»¶åŒ…çš„è¯¦ç»†ä¿¡æ¯
dpkg -s bash

# æŸ¥çœ‹ bash åŒ…å«å“ªäº›æ–‡ä»¶
dpkg -L bash | head -10

# æŸ¥æ‰¾æŸä¸ªæ–‡ä»¶å±äºå“ªä¸ªè½¯ä»¶åŒ…
dpkg -S /bin/bash

# æœç´¢å¯ç”¨çš„è½¯ä»¶åŒ…
apt search htop

# æŸ¥çœ‹è½¯ä»¶åŒ…è¯¦ç»†ä¿¡æ¯
apt show htop
```

**ä½ åˆšåˆšä½¿ç”¨äº† dpkg å’Œ apt -- Debian ç³»ç»Ÿçš„æ ¸å¿ƒè½¯ä»¶åŒ…ç®¡ç†å·¥å…·ï¼**

å¦‚æœä½ å­¦è¿‡ä¸Šä¸€è¯¾çš„ RPM/DNFï¼Œä¼šå‘ç°é€»è¾‘éå¸¸ç›¸ä¼¼ï¼š
- dpkg ç›¸å½“äº rpmï¼ˆåº•å±‚å·¥å…·ï¼Œæ“ä½œå•ä¸ªåŒ…ï¼‰
- apt ç›¸å½“äº dnfï¼ˆé«˜å±‚å·¥å…·ï¼Œè‡ªåŠ¨å¤„ç†ä¾èµ–ï¼‰

ç°åœ¨è®©æˆ‘ä»¬æ·±å…¥ç†è§£ DEB è½¯ä»¶åŒ…ç®¡ç†çš„åŸç†ã€‚

---

## Step 1 -- DEB è½¯ä»¶åŒ…ç»“æ„ï¼ˆ10 åˆ†é’Ÿï¼‰

### 1.1 ä»€ä¹ˆæ˜¯ DEBï¼Ÿ

DEB æ˜¯ Debianã€Ubuntuã€Linux Mintã€Raspberry Pi OS ç­‰å‘è¡Œç‰ˆä½¿ç”¨çš„è½¯ä»¶åŒ…æ ¼å¼ã€‚

![DEB Package Structure](images/deb-structure.png)

<details>
<summary>View ASCII source</summary>

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DEB è½¯ä»¶åŒ…ç»“æ„                               â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    debian-binary                         â”‚    â”‚
â”‚  â”‚              ç‰ˆæœ¬å·æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ "2.0"ï¼‰                   â”‚    â”‚
â”‚  â”‚              æ ‡è¯† DEB åŒ…æ ¼å¼ç‰ˆæœ¬                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                   control.tar.gz                         â”‚    â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚    â”‚  control     - åŒ…åã€ç‰ˆæœ¬ã€ä¾èµ–ã€æè¿°            â”‚  â”‚    â”‚
â”‚  â”‚    â”‚  md5sums     - æ–‡ä»¶æ ¡éªŒå’Œ                        â”‚  â”‚    â”‚
â”‚  â”‚    â”‚  conffiles   - é…ç½®æ–‡ä»¶åˆ—è¡¨                      â”‚  â”‚    â”‚
â”‚  â”‚    â”‚  preinst     - å®‰è£…å‰è„šæœ¬                        â”‚  â”‚    â”‚
â”‚  â”‚    â”‚  postinst    - å®‰è£…åè„šæœ¬                        â”‚  â”‚    â”‚
â”‚  â”‚    â”‚  prerm       - å¸è½½å‰è„šæœ¬                        â”‚  â”‚    â”‚
â”‚  â”‚    â”‚  postrm      - å¸è½½åè„šæœ¬                        â”‚  â”‚    â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    data.tar.xz                           â”‚    â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚    â”‚  /usr/bin/myapp                                â”‚   â”‚    â”‚
â”‚  â”‚    â”‚  /etc/myapp/config.conf                        â”‚   â”‚    â”‚
â”‚  â”‚    â”‚  /usr/share/doc/myapp/README                   â”‚   â”‚    â”‚
â”‚  â”‚    â”‚  /usr/share/man/man1/myapp.1.gz                â”‚   â”‚    â”‚
â”‚  â”‚    â”‚  ...ï¼ˆå®é™…å®‰è£…çš„æ–‡ä»¶ï¼‰                          â”‚   â”‚    â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚              å‹ç¼©æ ¼å¼ï¼šxz, gzip, bzip2, zstd            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚  æ³¨æ„ï¼šDEB å®é™…ä¸Šæ˜¯ä¸€ä¸ª ar å½’æ¡£æ–‡ä»¶                             â”‚
â”‚        å¯ä»¥ç”¨ ar -x package.deb è§£å¼€æŸ¥çœ‹                        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

</details>

### 1.2 DEB vs RPM ç»“æ„å¯¹æ¯”

| ç‰¹æ€§ | DEB | RPM |
|------|-----|-----|
| å½’æ¡£æ ¼å¼ | ar å½’æ¡£ | cpio å½’æ¡£ |
| å…ƒæ•°æ® | control.tar.gz | Header æ®µ |
| æ•°æ® | data.tar.xz | Payload (cpio) |
| ç­¾å | å¯é€‰ï¼ˆå¤–éƒ¨ï¼‰ | å†…åµŒ GPG ç­¾å |
| æ ¡éªŒå’Œ | md5sums æ–‡ä»¶ | Header ä¸­è®°å½• |

### 1.3 DEB æ–‡ä»¶å‘½åè§„èŒƒ

```
nginx_1.24.0-1ubuntu1_amd64.deb
  â”‚     â”‚    â”‚    â”‚      â”‚    â”‚
  â”‚     â”‚    â”‚    â”‚      â”‚    â””â”€ æ‰©å±•å
  â”‚     â”‚    â”‚    â”‚      â””â”€â”€â”€â”€â”€â”€ æ¶æ„ (amd64, arm64, all)
  â”‚     â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å‘è¡Œç‰ˆä¿®è®¢ (ubuntu1)
  â”‚     â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Debian ä¿®è®¢ç‰ˆæœ¬
  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ä¸Šæ¸¸ç‰ˆæœ¬
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ è½¯ä»¶åç§°
```

**å¸¸è§æ¶æ„**ï¼š

| æ¶æ„ | å«ä¹‰ | å¯¹åº” RPM |
|------|------|----------|
| amd64 | 64ä½ Intel/AMD | x86_64 |
| arm64 | 64ä½ ARM | aarch64 |
| all | æ¶æ„æ— å…³ | noarch |
| i386 | 32ä½ x86 | i686 |

### 1.4 æŸ¥çœ‹ DEB åŒ…å†…éƒ¨ç»“æ„

```bash
# ä¸‹è½½ä¸€ä¸ªåŒ…ï¼ˆä¸å®‰è£…ï¼‰ç”¨äºç ”ç©¶
apt download htop

# æŸ¥çœ‹ ar å½’æ¡£å†…å®¹
ar -t htop_*.deb

# è¾“å‡ºï¼š
# debian-binary
# control.tar.xz
# data.tar.xz

# è§£å‹æŸ¥çœ‹å†…å®¹
ar -x htop_*.deb
tar -tf control.tar.xz
tar -tf data.tar.xz | head -20

# æ¸…ç†
rm -f htop_*.deb debian-binary control.tar.xz data.tar.xz
```

---

## Step 2 -- dpkg æŸ¥è¯¢å‘½ä»¤ï¼ˆ15 åˆ†é’Ÿï¼‰

### 2.1 åˆ—å‡ºå·²å®‰è£…çš„è½¯ä»¶åŒ…

```bash
# -l = listï¼ˆåˆ—å‡ºï¼‰
dpkg -l                          # åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…çš„è½¯ä»¶åŒ…
dpkg -l | tail -n +6 | wc -l     # ç»Ÿè®¡å·²å®‰è£…åŒ…æ•°é‡ï¼ˆè·³è¿‡å¤´éƒ¨ï¼‰
dpkg -l | grep nginx             # æŸ¥æ‰¾åŒ…å« nginx çš„åŒ…
dpkg -l 'nginx*'                 # é€šé…ç¬¦åŒ¹é…
```

**dpkg -l è¾“å‡ºæ ¼å¼**ï¼š

```
Desired=Unknown/Install/Remove/Purge/Hold
| Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend
|/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)
||/ Name           Version      Architecture Description
+++-==============-============-============-=================================
ii  bash           5.2-2ubuntu1 amd64        GNU Bourne Again SHell
```

**çŠ¶æ€æ ‡è®°å«ä¹‰**ï¼š

| ç¬¬ä¸€åˆ—ï¼ˆæœŸæœ›ï¼‰ | ç¬¬äºŒåˆ—ï¼ˆçŠ¶æ€ï¼‰ | å«ä¹‰ |
|----------------|----------------|------|
| i | i | å·²å®‰è£…ä¸”æ­£å¸¸ |
| i | c | å·²åˆ é™¤ä½†ä¿ç•™é…ç½® |
| r | c | å¾…åˆ é™¤ï¼Œä¿ç•™é…ç½® |
| p | c | å¾…æ¸…é™¤ï¼ˆpurgeï¼‰ |
| h | i | å·²å®‰è£…ï¼Œç‰ˆæœ¬é”å®š |

### 2.2 æŸ¥è¯¢è½¯ä»¶åŒ…ä¿¡æ¯

```bash
# -s = statusï¼ˆçŠ¶æ€ï¼‰
dpkg -s bash

# è¾“å‡ºç¤ºä¾‹ï¼š
# Package: bash
# Status: install ok installed
# Priority: required
# Section: shells
# Installed-Size: 1892
# Maintainer: Ubuntu Developers <ubuntu-devel-discuss@lists.ubuntu.com>
# Architecture: amd64
# Version: 5.2-2ubuntu1
# Depends: base-files (>= 2.1.12), debianutils (>= 2.15)
# Pre-Depends: libc6 (>= 2.36), libtinfo6 (>= 6)
# Recommends: bash-completion
# Suggests: bash-doc
# Conffiles:
#  /etc/bash.bashrc 89269e1298235f1b12b4c24b6c37e94b
#  /etc/skel/.bashrc 3de8f8e4e67780e51d8f9a8866a7c6ec
# Description: GNU Bourne Again SHell
#  Bash is an sh-compatible command language interpreter ...
```

### 2.3 åˆ—å‡ºè½¯ä»¶åŒ…æ–‡ä»¶

```bash
# -L = List filesï¼ˆåˆ—å‡ºæ–‡ä»¶ï¼‰
dpkg -L bash                   # åˆ—å‡º bash åŒ…å«çš„æ‰€æœ‰æ–‡ä»¶
dpkg -L bash | wc -l           # ç»Ÿè®¡æ–‡ä»¶æ•°é‡
dpkg -L bash | grep bin        # åªçœ‹å¯æ‰§è¡Œæ–‡ä»¶

# æŸ¥çœ‹è½¯ä»¶åŒ…å®‰è£…çš„é…ç½®æ–‡ä»¶
dpkg -L nginx | grep /etc
```

### 2.4 åå‘æŸ¥è¯¢ï¼šæ–‡ä»¶å±äºå“ªä¸ªåŒ…

```bash
# -S = Searchï¼ˆæœç´¢ï¼‰
dpkg -S /bin/bash              # æŸ¥æ‰¾æ–‡ä»¶å±äºå“ªä¸ªåŒ…
dpkg -S /etc/passwd            # æŸ¥æ‰¾é…ç½®æ–‡ä»¶å±äºå“ªä¸ªåŒ…
dpkg -S /usr/lib/x86_64-linux-gnu/libc.so.6  # æŸ¥æ‰¾åº“æ–‡ä»¶

# æ¨¡ç³Šæœç´¢ï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰
dpkg -S '*nginx*'              # åŒ…å« nginx çš„æ‰€æœ‰æ–‡ä»¶
dpkg -S '/usr/bin/vim*'        # vim ç›¸å…³å¯æ‰§è¡Œæ–‡ä»¶

# å®ç”¨åœºæ™¯ï¼šå‘ç°æœªçŸ¥è¿›ç¨‹æ—¶
ps aux | grep suspicious
dpkg -S /path/to/suspicious    # ç¡®è®¤è¿›ç¨‹æ¥æº
```

### 2.5 dpkg å‘½ä»¤é€ŸæŸ¥è¡¨

| å‘½ä»¤ | å«ä¹‰ | RPM ç­‰ä»· |
|------|------|----------|
| `dpkg -l` | åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…åŒ… | `rpm -qa` |
| `dpkg -l <pattern>` | æŒ‰æ¨¡å¼åˆ—å‡ºåŒ… | `rpm -qa \| grep` |
| `dpkg -s <pkg>` | æ˜¾ç¤ºåŒ…çŠ¶æ€/ä¿¡æ¯ | `rpm -qi <pkg>` |
| `dpkg -L <pkg>` | åˆ—å‡ºåŒ…æ–‡ä»¶ | `rpm -ql <pkg>` |
| `dpkg -S <file>` | æŸ¥æ‰¾æ–‡ä»¶æ‰€å±åŒ… | `rpm -qf <file>` |
| `dpkg -c <deb>` | åˆ—å‡º deb åŒ…å†…å®¹ | `rpm -qlp <rpm>` |
| `dpkg -I <deb>` | æ˜¾ç¤º deb åŒ…ä¿¡æ¯ | `rpm -qip <rpm>` |

---

## Step 3 -- apt åŸºç¡€æ“ä½œï¼ˆ20 åˆ†é’Ÿï¼‰

### 3.1 apt vs apt-getï¼šä½•æ—¶ç”¨å“ªä¸ª

**å…³é”®åŒºåˆ«**ï¼š

| ç‰¹æ€§ | apt | apt-get |
|------|-----|---------|
| ç›®æ ‡ç”¨æˆ· | äº¤äº’ä½¿ç”¨ | è„šæœ¬/è‡ªåŠ¨åŒ– |
| è¾“å‡ºæ ¼å¼ | å½©è‰²ã€è¿›åº¦æ¡ | çº¯æ–‡æœ¬ã€ç¨³å®šæ ¼å¼ |
| å‘½ä»¤ç®€æ´ | æ›´çŸ­ | æ›´é•¿ä½†æ›´æ˜ç¡® |
| ç¨³å®šæ€§ | å¯èƒ½å˜åŒ– | ä¿è¯å‘åå…¼å®¹ |
| æ¨èåœºæ™¯ | ç»ˆç«¯æ‰‹åŠ¨æ“ä½œ | Shell è„šæœ¬ã€CI/CD |

**è®°å¿†æ³•**ï¼š
- **apt** = "Awesome for People in Terminals"ï¼ˆäººç”¨ï¼‰
- **apt-get** = "Get it done in scripts"ï¼ˆè„šæœ¬ç”¨ï¼‰

```bash
# äº¤äº’ä½¿ç”¨ï¼ˆæ¨è aptï¼‰
apt update
apt install nginx

# è„šæœ¬ä¸­ï¼ˆæ¨è apt-getï¼‰
#!/bin/bash
apt-get update
apt-get install -y nginx
```

### 3.2 æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨

```bash
# æ›´æ–°æœ¬åœ°è½¯ä»¶åŒ…ç´¢å¼•ï¼ˆå¿…é¡»å…ˆæ‰§è¡Œï¼ï¼‰
sudo apt update

# è¾“å‡ºç¤ºä¾‹ï¼š
# Hit:1 http://archive.ubuntu.com/ubuntu jammy InRelease
# Get:2 http://archive.ubuntu.com/ubuntu jammy-updates InRelease [119 kB]
# Get:3 http://security.ubuntu.com/ubuntu jammy-security InRelease [110 kB]
# ...
# Reading package lists... Done
# Building dependency tree... Done
# 15 packages can be upgraded. Run 'apt list --upgradable' to see them.
```

**é‡è¦**ï¼š`apt update` åªæ›´æ–°ç´¢å¼•ï¼Œä¸å®‰è£…ä»»ä½•è½¯ä»¶ï¼

### 3.3 å®‰è£…è½¯ä»¶åŒ…

```bash
# å®‰è£…å•ä¸ªè½¯ä»¶åŒ…
sudo apt install htop

# å®‰è£…å¤šä¸ªè½¯ä»¶åŒ…
sudo apt install htop vim tmux

# è‡ªåŠ¨ç¡®è®¤ï¼ˆè„šæœ¬ä¸­ä½¿ç”¨ï¼‰
sudo apt install -y htop

# å®‰è£…ç‰¹å®šç‰ˆæœ¬
sudo apt install nginx=1.24.0-1ubuntu1

# å®‰è£…æœ¬åœ° deb æ–‡ä»¶ï¼ˆè‡ªåŠ¨è§£å†³ä¾èµ–ï¼‰
sudo apt install ./package.deb

# åªä¸‹è½½ä¸å®‰è£…
apt download htop
```

### 3.4 åˆ é™¤è½¯ä»¶åŒ…

```bash
# åˆ é™¤è½¯ä»¶åŒ…ï¼ˆä¿ç•™é…ç½®æ–‡ä»¶ï¼‰
sudo apt remove nginx

# åˆ é™¤è½¯ä»¶åŒ…åŠå…¶é…ç½®æ–‡ä»¶
sudo apt purge nginx

# åˆ é™¤ä¸å†éœ€è¦çš„ä¾èµ–
sudo apt autoremove

# ç»„åˆï¼šåˆ é™¤åŒ… + æ¸…ç†é…ç½® + åˆ é™¤ä¾èµ–
sudo apt purge nginx && sudo apt autoremove
```

**remove vs purge**ï¼š

| æ“ä½œ | åˆ é™¤ç¨‹åº | åˆ é™¤é…ç½® | ä½¿ç”¨åœºæ™¯ |
|------|----------|----------|----------|
| remove | Yes | No | å¯èƒ½é‡è£…ï¼Œä¿ç•™è®¾ç½® |
| purge | Yes | Yes | å½»åº•æ¸…é™¤ |

### 3.5 å‡çº§è½¯ä»¶åŒ…

```bash
# å‡çº§æ‰€æœ‰å¯å‡çº§çš„è½¯ä»¶åŒ…
sudo apt upgrade

# å‡çº§å•ä¸ªè½¯ä»¶åŒ…
sudo apt install --only-upgrade nginx

# æ£€æŸ¥å¯å‡çº§çš„è½¯ä»¶åŒ…
apt list --upgradable

# å®Œå…¨å‡çº§ï¼ˆå¯èƒ½åˆ é™¤åŒ…ä»¥è§£å†³ä¾èµ–ï¼‰
sudo apt full-upgrade
# æ³¨æ„ï¼šfull-upgrade æ¯” upgrade æ›´æ¿€è¿›ï¼Œå¯èƒ½åˆ é™¤åŒ…

# åªä¸‹è½½å‡çº§åŒ…ï¼ˆä¸å®‰è£…ï¼‰
sudo apt upgrade --download-only
```

### 3.6 APT äº‹åŠ¡æµç¨‹

![APT Installation Workflow](images/apt-workflow.png)

<details>
<summary>View ASCII source</summary>

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      APT å®‰è£…æµç¨‹                                â”‚
â”‚                                                                  â”‚
â”‚  sudo apt install nginx                                         â”‚
â”‚      â”‚                                                           â”‚
â”‚      â–¼                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. æ£€æŸ¥æœ¬åœ°ç¼“å­˜                                          â”‚   â”‚
â”‚  â”‚     /var/lib/apt/lists/ æ˜¯å¦æœ‰æœ€æ–°ç´¢å¼•ï¼Ÿ                  â”‚   â”‚
â”‚  â”‚     å¦‚æœå¤ªæ—§ï¼Œæç¤ºè¿è¡Œ apt update                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚      â”‚                                                           â”‚
â”‚      â–¼                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  2. è§£æä¾èµ–å…³ç³»                                          â”‚   â”‚
â”‚  â”‚     nginx éœ€è¦:                                           â”‚   â”‚
â”‚  â”‚       - libnginx-mod-http-geoip2                         â”‚   â”‚
â”‚  â”‚       - nginx-common                                      â”‚   â”‚
â”‚  â”‚       - libc6 (>= 2.34)                                  â”‚   â”‚
â”‚  â”‚       ...                                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚      â”‚                                                           â”‚
â”‚      â–¼                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  3. æ˜¾ç¤ºå®‰è£…è®¡åˆ’                                          â”‚   â”‚
â”‚  â”‚     The following NEW packages will be installed:         â”‚   â”‚
â”‚  â”‚       nginx nginx-common libnginx-mod-...                â”‚   â”‚
â”‚  â”‚     0 upgraded, 5 newly installed, 0 to remove           â”‚   â”‚
â”‚  â”‚     Need to get 1,234 kB of archives.                    â”‚   â”‚
â”‚  â”‚     Do you want to continue? [Y/n]                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚      â”‚                                                           â”‚
â”‚      â–¼                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  4. ä¸‹è½½è½¯ä»¶åŒ…                                            â”‚   â”‚
â”‚  â”‚     ä» /etc/apt/sources.list ä¸­çš„é•œåƒä¸‹è½½                â”‚   â”‚
â”‚  â”‚     ä¿å­˜åˆ° /var/cache/apt/archives/                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚      â”‚                                                           â”‚
â”‚      â–¼                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  5. éªŒè¯è½¯ä»¶åŒ…                                            â”‚   â”‚
â”‚  â”‚     æ£€æŸ¥ GPG ç­¾åå’Œæ ¡éªŒå’Œ                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚      â”‚                                                           â”‚
â”‚      â–¼                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  6. å®‰è£…è½¯ä»¶åŒ…ï¼ˆdpkg æ‰§è¡Œï¼‰                               â”‚   â”‚
â”‚  â”‚     - è¿è¡Œ preinst è„šæœ¬                                   â”‚   â”‚
â”‚  â”‚     - è§£å‹æ–‡ä»¶åˆ°ç›®æ ‡ä½ç½®                                  â”‚   â”‚
â”‚  â”‚     - è¿è¡Œ postinst è„šæœ¬                                  â”‚   â”‚
â”‚  â”‚     - æ›´æ–° dpkg æ•°æ®åº“ (/var/lib/dpkg/)                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

</details>

---

## Step 4 -- apt search/show/listï¼ˆ10 åˆ†é’Ÿï¼‰

### 4.1 æœç´¢è½¯ä»¶åŒ…

```bash
# æœç´¢è½¯ä»¶åŒ…ï¼ˆåç§°å’Œæè¿°ï¼‰
apt search nginx

# åªæœç´¢åŒ…å
apt search --names-only nginx

# ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼
apt search '^nginx'    # ä»¥ nginx å¼€å¤´çš„åŒ…

# æœç´¢ç»“æœç¤ºä¾‹ï¼š
# nginx/jammy-updates 1.24.0-1ubuntu1 amd64
#   high performance web server
# nginx-core/jammy-updates 1.24.0-1ubuntu1 amd64
#   nginx web/proxy server (standard version)
```

### 4.2 æŸ¥çœ‹è½¯ä»¶åŒ…è¯¦æƒ…

```bash
# æ˜¾ç¤ºè½¯ä»¶åŒ…è¯¦ç»†ä¿¡æ¯
apt show nginx

# è¾“å‡ºç¤ºä¾‹ï¼š
# Package: nginx
# Version: 1.24.0-1ubuntu1
# Priority: optional
# Section: web
# Maintainer: Ubuntu Developers <ubuntu-devel-discuss@lists.ubuntu.com>
# Installed-Size: 44.0 kB
# Depends: nginx-core (<< 1.24.0-1ubuntu1.1~) | nginx-full ...
# Suggests: nginx-doc
# Homepage: https://nginx.org
# Download-Size: 3,596 B
# APT-Sources: http://archive.ubuntu.com/ubuntu jammy-updates/main amd64
# Description: small, powerful, scalable web/proxy server

# æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨ç‰ˆæœ¬
apt show -a nginx
```

### 4.3 åˆ—å‡ºè½¯ä»¶åŒ…

```bash
# åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…çš„è½¯ä»¶åŒ…
apt list --installed

# åˆ—å‡ºå¯å‡çº§çš„è½¯ä»¶åŒ…
apt list --upgradable

# åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„è½¯ä»¶åŒ…
apt list

# æŒ‰æ¨¡å¼åˆ—å‡º
apt list 'nginx*'
apt list --installed 'python3-*'
```

### 4.4 apt-cache å‘½ä»¤ï¼ˆè¡¥å……ï¼‰

`apt-cache` æä¾›æ›´è¯¦ç»†çš„ç¼“å­˜æŸ¥è¯¢åŠŸèƒ½ï¼š

```bash
# æœç´¢ï¼ˆç±»ä¼¼ apt searchï¼‰
apt-cache search nginx

# æ˜¾ç¤ºåŒ…ä¿¡æ¯ï¼ˆç±»ä¼¼ apt showï¼‰
apt-cache show nginx

# æ˜¾ç¤ºä¾èµ–å…³ç³»
apt-cache depends nginx

# æ˜¾ç¤ºåå‘ä¾èµ–ï¼ˆè°ä¾èµ–è¿™ä¸ªåŒ…ï¼‰
apt-cache rdepends nginx

# æ˜¾ç¤ºåŒ…çš„ç­–ç•¥ï¼ˆç‰ˆæœ¬ä¼˜å…ˆçº§ï¼‰
apt-cache policy nginx

# è¾“å‡ºç¤ºä¾‹ï¼š
# nginx:
#   Installed: 1.24.0-1ubuntu1
#   Candidate: 1.24.0-1ubuntu1
#   Version table:
#  *** 1.24.0-1ubuntu1 500
#         500 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64
#      1.22.0-1ubuntu1 500
#         500 http://archive.ubuntu.com/ubuntu jammy/main amd64
```

---

## Step 5 -- RPM åˆ° DEB å‘½ä»¤æ˜ å°„ï¼ˆ10 åˆ†é’Ÿï¼‰

å¦‚æœä½ ç†Ÿæ‚‰ RPM/DNFï¼Œä¸‹è¡¨å¸®åŠ©ä½ å¿«é€ŸæŒæ¡ DEB/APT å‘½ä»¤ï¼š

### 5.1 å®Œæ•´æ˜ å°„è¡¨

| æ“ä½œ | RPM/DNF | DEB/APT |
|------|---------|---------|
| **å®‰è£…** | | |
| å®‰è£…è½¯ä»¶åŒ… | `dnf install <pkg>` | `apt install <pkg>` |
| å®‰è£…æœ¬åœ°åŒ… | `dnf install ./pkg.rpm` | `apt install ./pkg.deb` |
| **åˆ é™¤** | | |
| åˆ é™¤è½¯ä»¶åŒ… | `dnf remove <pkg>` | `apt remove <pkg>` |
| åˆ é™¤åŒ…åŠé…ç½® | `dnf remove <pkg>` | `apt purge <pkg>` |
| æ¸…ç†æ— ç”¨ä¾èµ– | `dnf autoremove` | `apt autoremove` |
| **æ›´æ–°** | | |
| æ›´æ–°ç´¢å¼• | `dnf check-update` | `apt update` |
| å‡çº§æ‰€æœ‰åŒ… | `dnf update` | `apt upgrade` |
| å‡çº§å•ä¸ªåŒ… | `dnf update <pkg>` | `apt install --only-upgrade <pkg>` |
| **æŸ¥è¯¢ï¼ˆåº•å±‚ï¼‰** | | |
| åˆ—å‡ºæ‰€æœ‰å·²å®‰è£… | `rpm -qa` | `dpkg -l` |
| æ˜¾ç¤ºåŒ…ä¿¡æ¯ | `rpm -qi <pkg>` | `dpkg -s <pkg>` |
| åˆ—å‡ºåŒ…æ–‡ä»¶ | `rpm -ql <pkg>` | `dpkg -L <pkg>` |
| æŸ¥æ‰¾æ–‡ä»¶æ‰€å±åŒ… | `rpm -qf <file>` | `dpkg -S <file>` |
| éªŒè¯åŒ…å®Œæ•´æ€§ | `rpm -V <pkg>` | `debsums <pkg>` |
| **æŸ¥è¯¢ï¼ˆé«˜å±‚ï¼‰** | | |
| æœç´¢è½¯ä»¶åŒ… | `dnf search <key>` | `apt search <key>` |
| æ˜¾ç¤ºåŒ…è¯¦æƒ… | `dnf info <pkg>` | `apt show <pkg>` |
| åˆ—å‡ºå¯ç”¨åŒ… | `dnf list available` | `apt list` |
| åˆ—å‡ºå·²å®‰è£…åŒ… | `dnf list installed` | `apt list --installed` |
| **ä»“åº“** | | |
| åˆ—å‡ºä»“åº“ | `dnf repolist` | `apt-cache policy` |
| æ˜¾ç¤ºåŒ…æ¥æº | `dnf info <pkg>` | `apt-cache policy <pkg>` |

### 5.2 å¿«é€Ÿå¯¹ç…§å¡ç‰‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               RPM â†’ DEB å‘½ä»¤é€ŸæŸ¥å¡                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  rpm -qa              â†’  dpkg -l                              â”‚
â”‚  rpm -qi bash         â†’  dpkg -s bash                         â”‚
â”‚  rpm -ql bash         â†’  dpkg -L bash                         â”‚
â”‚  rpm -qf /bin/bash    â†’  dpkg -S /bin/bash                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  dnf install nginx    â†’  apt install nginx                    â”‚
â”‚  dnf remove nginx     â†’  apt remove nginx / apt purge nginx   â”‚
â”‚  dnf update           â†’  apt update && apt upgrade            â”‚
â”‚  dnf search nginx     â†’  apt search nginx                     â”‚
â”‚  dnf info nginx       â†’  apt show nginx                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Step 6 -- åŠ¨æ‰‹å®éªŒï¼ˆ25 åˆ†é’Ÿï¼‰

### å®éªŒ 1ï¼šdpkg æŸ¥è¯¢ç»ƒä¹ 

```bash
# 1. ç»Ÿè®¡ç³»ç»Ÿå·²å®‰è£…çš„è½¯ä»¶åŒ…
echo "=== å·²å®‰è£…è½¯ä»¶åŒ…ç»Ÿè®¡ ==="
dpkg -l | tail -n +6 | wc -l

# 2. æŸ¥çœ‹ coreutils åŒ…çš„ä¿¡æ¯
echo "=== coreutils åŒ…ä¿¡æ¯ ==="
dpkg -s coreutils

# 3. æ‰¾å‡º /usr/bin/ls å±äºå“ªä¸ªåŒ…
echo "=== ls å‘½ä»¤å±äº ==="
dpkg -S /usr/bin/ls

# 4. åˆ—å‡º coreutils åŒ…çš„å‰ 20 ä¸ªæ–‡ä»¶
echo "=== coreutils åŒ…æ–‡ä»¶åˆ—è¡¨ ==="
dpkg -L coreutils | head -20

# 5. æŸ¥æ‰¾åŒ…å« "curl" çš„å·²å®‰è£…åŒ…
echo "=== åŒ…å« curl çš„åŒ… ==="
dpkg -l '*curl*'
```

### å®éªŒ 2ï¼šapt æ“ä½œç»ƒä¹ 

```bash
# 1. æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•ï¼ˆå¿…é¡»å…ˆæ‰§è¡Œï¼ï¼‰
echo "=== æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼• ==="
sudo apt update

# 2. æœç´¢ htop
echo "=== æœç´¢ htop ==="
apt search --names-only htop

# 3. æŸ¥çœ‹ htop ä¿¡æ¯
echo "=== htop ä¿¡æ¯ ==="
apt show htop

# 4. å®‰è£… htop
echo "=== å®‰è£… htop ==="
sudo apt install -y htop

# 5. éªŒè¯å®‰è£…
echo "=== éªŒè¯å®‰è£… ==="
dpkg -s htop | grep -E "^(Package|Status|Version)"
which htop

# 6. æ£€æŸ¥ htop ä¾èµ–äº†å“ªäº›åŒ…
echo "=== htop ä¾èµ– ==="
apt-cache depends htop
```

### å®éªŒ 3ï¼šè½¯ä»¶åŒ…ç‰ˆæœ¬ç®¡ç†

```bash
# 1. æŸ¥çœ‹ nginx çš„æ‰€æœ‰å¯ç”¨ç‰ˆæœ¬
echo "=== nginx ç‰ˆæœ¬ç­–ç•¥ ==="
apt-cache policy nginx

# 2. æŸ¥çœ‹ç³»ç»Ÿä¸­å¯å‡çº§çš„è½¯ä»¶åŒ…
echo "=== å¯å‡çº§çš„è½¯ä»¶åŒ… ==="
apt list --upgradable

# 3. æ¨¡æ‹Ÿå‡çº§ï¼ˆä¸å®é™…æ‰§è¡Œï¼‰
echo "=== æ¨¡æ‹Ÿå‡çº§ ==="
apt upgrade --simulate
# æˆ–è€…
apt upgrade -s
```

### å®éªŒ 4ï¼šremove vs purge å¯¹æ¯”

```bash
# å®‰è£…ä¸€ä¸ªç”¨äºæµ‹è¯•çš„è½¯ä»¶åŒ…
sudo apt install -y cowsay

# æ£€æŸ¥é…ç½®æ–‡ä»¶
dpkg -L cowsay | grep /etc

# ä½¿ç”¨ remove åˆ é™¤ï¼ˆä¿ç•™é…ç½®ï¼‰
sudo apt remove cowsay

# æ£€æŸ¥çŠ¶æ€ï¼ˆåº”è¯¥æ˜¯ rc = removed, config-filesï¼‰
dpkg -l cowsay

# ä½¿ç”¨ purge å½»åº•æ¸…é™¤
sudo apt purge cowsay

# å†æ¬¡æ£€æŸ¥ï¼ˆåº”è¯¥æ‰¾ä¸åˆ°äº†ï¼‰
dpkg -l cowsay 2>/dev/null || echo "åŒ…å·²å®Œå…¨åˆ é™¤"
```

### å®éªŒ 5ï¼šæ¢ç´¢ DEB åŒ…ç»“æ„

```bash
# åˆ›å»ºå·¥ä½œç›®å½•
mkdir -p ~/deb-lab && cd ~/deb-lab

# ä¸‹è½½ä¸€ä¸ªå°è½¯ä»¶åŒ…
apt download cowsay

# æŸ¥çœ‹ ar å½’æ¡£å†…å®¹
ar -t cowsay_*.deb

# è§£å‹ deb åŒ…
ar -x cowsay_*.deb
ls -la

# æŸ¥çœ‹æ§åˆ¶ä¿¡æ¯
tar -tf control.tar.* | head -10
tar -xf control.tar.* ./control 2>/dev/null || tar -xf control.tar.* control
cat control

# æŸ¥çœ‹æ•°æ®æ–‡ä»¶åˆ—è¡¨
tar -tf data.tar.* | head -20

# æ¸…ç†
cd ~ && rm -rf ~/deb-lab
```

---

## åæ¨¡å¼ï¼šå¸¸è§é”™è¯¯

### é”™è¯¯ 1ï¼šåœ¨è„šæœ¬ä¸­ä½¿ç”¨ apt

```bash
# ä¸æ¨èï¼šapt çš„è¾“å‡ºæ ¼å¼å¯èƒ½å˜åŒ–
#!/bin/bash
apt install -y nginx

# æ¨èï¼šapt-get è¾“å‡ºç¨³å®šï¼Œé€‚åˆè‡ªåŠ¨åŒ–
#!/bin/bash
apt-get update
apt-get install -y nginx
```

**åŸå› **ï¼š`apt` è®¾è®¡ç”¨äºäººæœºäº¤äº’ï¼Œè¾“å‡ºæ ¼å¼å¯èƒ½éšç‰ˆæœ¬å˜åŒ–ã€‚`apt-get` ä¿è¯å‘åå…¼å®¹ã€‚

### é”™è¯¯ 2ï¼šä¸è¿è¡Œ apt update å°±å®‰è£…

```bash
# é”™è¯¯ï¼šç›´æ¥å®‰è£…å¯èƒ½æ‰¾ä¸åˆ°åŒ…æˆ–å®‰è£…æ—§ç‰ˆæœ¬
sudo apt install some-new-package
# E: Unable to locate package some-new-package

# æ­£ç¡®ï¼šå…ˆæ›´æ–°ç´¢å¼•
sudo apt update
sudo apt install some-new-package
```

**æœ€ä½³å®è·µ**ï¼š

```bash
# è„šæœ¬ä¸­çš„æ ‡å‡†æ¨¡å¼
sudo apt-get update && sudo apt-get install -y package-name
```

### é”™è¯¯ 3ï¼šç”¨ dpkg -i å®‰è£…æœ‰ä¾èµ–çš„åŒ…

```bash
# é”™è¯¯ï¼šdpkg ä¸è§£å†³ä¾èµ–
sudo dpkg -i package-with-deps.deb
# dpkg: dependency problems prevent configuration of package...

# æ­£ç¡®ï¼šä½¿ç”¨ apt å®‰è£…æœ¬åœ° debï¼ˆè‡ªåŠ¨è§£å†³ä¾èµ–ï¼‰
sudo apt install ./package-with-deps.deb

# æˆ–è€…ï¼šå…ˆ dpkgï¼Œå†ä¿®å¤ä¾èµ–
sudo dpkg -i package.deb
sudo apt-get install -f    # -f = fix broken
```

### é”™è¯¯ 4ï¼šå¿½ç•¥ apt upgrade å’Œ apt full-upgrade çš„åŒºåˆ«

```bash
# apt upgrade: ä¿å®ˆå‡çº§ï¼Œä¸ä¼šåˆ é™¤åŒ…
sudo apt upgrade

# apt full-upgrade: æ¿€è¿›å‡çº§ï¼Œå¯èƒ½åˆ é™¤åŒ…ä»¥è§£å†³ä¾èµ–
sudo apt full-upgrade

# ç”Ÿäº§ç¯å¢ƒå»ºè®®ï¼š
# 1. å…ˆç”¨ upgrade
# 2. ä»”ç»†å®¡æŸ¥ full-upgrade çš„åˆ é™¤åˆ—è¡¨
# 3. åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯åå†ç”¨äºç”Ÿäº§
```

### é”™è¯¯ 5ï¼šremove åå¿˜è®° autoremove

```bash
# é—®é¢˜ï¼šremove åªåˆ é™¤æŒ‡å®šåŒ…ï¼Œä¾èµ–æ®‹ç•™
sudo apt remove nginx
# nginx åˆ é™¤äº†ï¼Œä½†å…¶ä¾èµ–è¿˜åœ¨

# æœ€ä½³å®è·µï¼š
sudo apt remove nginx
sudo apt autoremove    # æ¸…ç†ä¸å†éœ€è¦çš„ä¾èµ–

# æˆ–è€…ä¸€æ­¥å®Œæˆ
sudo apt remove nginx && sudo apt autoremove -y
```

---

## èŒåœºå°è´´å£«ï¼ˆJapan IT Contextï¼‰

### Ubuntu åœ¨æ—¥æœ¬ä¼ä¸šçš„ä½¿ç”¨æƒ…å†µ

åœ¨æ—¥æœ¬ä¼ä¸š IT ç¯å¢ƒä¸­ï¼ŒUbuntu/Debian çš„ä½¿ç”¨åœºæ™¯æœ‰é™ï¼š

| ç¯å¢ƒ | å¸¸è§ç³»ç»Ÿ | è¯´æ˜ |
|------|----------|------|
| ä¼ä¸šæœåŠ¡å™¨ | RHEL, CentOS | å†…éƒ¨æ¨™æº–ï¼ˆå†…éƒ¨æ ‡å‡†ï¼‰é€šå¸¸æ˜¯ RHEL |
| AWS EC2 é»˜è®¤ | Amazon Linux 2/2023 | åŸºäº RHEL/Fedora |
| å¼€å‘ç¯å¢ƒ | Ubuntu | å¼€å‘è€…ä¸ªäººé€‰æ‹©è¾ƒå¤š |
| å®¹å™¨åŸºç¡€é•œåƒ | Alpine, Debian | è½»é‡åŒ–éœ€æ±‚ |
| IoT/åµŒå…¥å¼ | Raspbian, Ubuntu Core | æ ‘è“æ´¾ç­‰è®¾å¤‡ |

**æ—¥è¯­æœ¯è¯­**ï¼š

| æ—¥è¯­ | å«ä¹‰ | åœºæ™¯ |
|------|------|------|
| ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç† | è½¯ä»¶åŒ…ç®¡ç† | é€šç”¨æœ¯è¯­ |
| ä¾å­˜é–¢ä¿‚ | ä¾èµ–å…³ç³» | apt depends |
| æ›´æ–° / ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ | æ›´æ–° | apt update/upgrade |
| ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« | å®‰è£… | apt install |

### ä¸ºä»€ä¹ˆè¿˜è¦å­¦ DEB/APTï¼Ÿ

1. **å®¹å™¨æ—¶ä»£**ï¼šDockerfile ä¸­å¤§é‡ä½¿ç”¨ Debian/Ubuntu ä½œä¸ºåŸºç¡€é•œåƒ
2. **CI/CD ç¯å¢ƒ**ï¼šGitHub Actionsã€GitLab CI é»˜è®¤ä½¿ç”¨ Ubuntu
3. **äº‘æœåŠ¡**ï¼šä¸€äº› SaaS è¦æ±‚ç‰¹å®š Ubuntu ç‰ˆæœ¬
4. **è·¨å‘è¡Œç‰ˆèƒ½åŠ›**ï¼šè¿ç»´å·¥ç¨‹å¸ˆéœ€è¦æŒæ¡ä¸¤å¥—ä½“ç³»

```dockerfile
# å¸¸è§çš„ Dockerfile æ¨¡å¼
FROM ubuntu:22.04
RUN apt-get update && apt-get install -y \
    nginx \
    && rm -rf /var/lib/apt/lists/*
```

### è„šæœ¬æœ€ä½³å®è·µ

```bash
#!/bin/bash
# é€‚ç”¨äº CI/CD æˆ–è‡ªåŠ¨åŒ–åœºæ™¯çš„æ ‡å‡†æ¨¡å¼

# 1. è®¾ç½®éäº¤äº’æ¨¡å¼
export DEBIAN_FRONTEND=noninteractive

# 2. æ›´æ–°ç´¢å¼•
apt-get update

# 3. å®‰è£…è½¯ä»¶åŒ…ï¼ˆæ— ç¡®è®¤æç¤ºï¼‰
apt-get install -y --no-install-recommends package-name

# 4. æ¸…ç†ç¼“å­˜ï¼ˆå‡å°é•œåƒä½“ç§¯ï¼‰
rm -rf /var/lib/apt/lists/*
```

**é€‰é¡¹è¯´æ˜**ï¼š

| é€‰é¡¹ | ä½œç”¨ |
|------|------|
| `-y` | è‡ªåŠ¨ç¡®è®¤ |
| `--no-install-recommends` | ä¸å®‰è£…æ¨èåŒ…ï¼ˆå‡å°ä½“ç§¯ï¼‰ |
| `DEBIAN_FRONTEND=noninteractive` | ç¦æ­¢äº¤äº’å¼é…ç½®å¯¹è¯æ¡† |

---

## æ£€æŸ¥æ¸…å•

å®Œæˆæœ¬è¯¾åï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

- [ ] è§£é‡Š DEB è½¯ä»¶åŒ…çš„ç»“æ„ï¼ˆcontrol.tar.gz + data.tar.xzï¼‰
- [ ] ä½¿ç”¨ `dpkg -l` åˆ—å‡ºå·²å®‰è£…çš„è½¯ä»¶åŒ…
- [ ] ä½¿ç”¨ `dpkg -s` æŸ¥çœ‹è½¯ä»¶åŒ…ä¿¡æ¯
- [ ] ä½¿ç”¨ `dpkg -L` åˆ—å‡ºè½¯ä»¶åŒ…æ–‡ä»¶
- [ ] ä½¿ç”¨ `dpkg -S` æŸ¥æ‰¾æ–‡ä»¶æ‰€å±çš„è½¯ä»¶åŒ…
- [ ] ç†è§£ `apt` vs `apt-get` çš„åŒºåˆ«ï¼ˆäº¤äº’ vs è„šæœ¬ï¼‰
- [ ] ä½¿ç”¨ `apt update` æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•
- [ ] ä½¿ç”¨ `apt install/remove/purge` ç®¡ç†è½¯ä»¶åŒ…
- [ ] ä½¿ç”¨ `apt search/show/list` æŸ¥æ‰¾è½¯ä»¶åŒ…ä¿¡æ¯
- [ ] å°† RPM å‘½ä»¤æ˜ å°„åˆ° DEB ç­‰æ•ˆå‘½ä»¤
- [ ] é¿å…åœ¨è„šæœ¬ä¸­ä½¿ç”¨ `apt`ï¼ˆåº”ä½¿ç”¨ `apt-get`ï¼‰
- [ ] é¿å…ä¸è¿è¡Œ `apt update` å°±å®‰è£…è½¯ä»¶åŒ…

---

## æœ¬è¯¾å°ç»“

| æ¦‚å¿µ | å‘½ä»¤ | RPM ç­‰ä»· |
|------|------|----------|
| åˆ—å‡ºæ‰€æœ‰åŒ… | `dpkg -l` | `rpm -qa` |
| æŸ¥çœ‹åŒ…ä¿¡æ¯ | `dpkg -s <pkg>` | `rpm -qi <pkg>` |
| åˆ—å‡ºåŒ…æ–‡ä»¶ | `dpkg -L <pkg>` | `rpm -ql <pkg>` |
| æŸ¥æ‰¾æ–‡ä»¶æ‰€å±åŒ… | `dpkg -S <file>` | `rpm -qf <file>` |
| æ›´æ–°ç´¢å¼• | `apt update` | `dnf check-update` |
| å®‰è£…è½¯ä»¶åŒ… | `apt install <pkg>` | `dnf install <pkg>` |
| åˆ é™¤è½¯ä»¶åŒ… | `apt remove <pkg>` | `dnf remove <pkg>` |
| å½»åº•åˆ é™¤ | `apt purge <pkg>` | - |
| å‡çº§è½¯ä»¶åŒ… | `apt upgrade` | `dnf update` |
| æœç´¢è½¯ä»¶åŒ… | `apt search <key>` | `dnf search <key>` |
| æ˜¾ç¤ºåŒ…è¯¦æƒ… | `apt show <pkg>` | `dnf info <pkg>` |
| æ¸…ç†ä¾èµ– | `apt autoremove` | `dnf autoremove` |

---

## å»¶ä¼¸é˜…è¯»

- [Debian Package Management](https://www.debian.org/doc/manuals/debian-reference/ch02.en.html)
- [Ubuntu Package Management](https://help.ubuntu.com/community/AptGet/Howto)
- [apt vs apt-get](https://itsfoss.com/apt-vs-apt-get-difference/)
- ä¸Šä¸€è¯¾ï¼š[09 - è½¯ä»¶åŒ…ç®¡ç† (RPM/DNF)](../09-package-management-rpm-dnf/) -- RHEL ç³»è½¯ä»¶åŒ…ç®¡ç†
- ä¸‹ä¸€è¯¾ï¼š[11 - è½¯ä»¶æºä¸ GPG](../11-repository-gpg/) -- ä»“åº“å’Œç­¾åç®¡ç†

---

## ç³»åˆ—å¯¼èˆª

[<-- 09 - è½¯ä»¶åŒ…ç®¡ç† (RPM/DNF)](../09-package-management-rpm-dnf/) | [ç³»åˆ—é¦–é¡µ](../) | [11 - è½¯ä»¶æºä¸ GPG -->](../11-repository-gpg/)
