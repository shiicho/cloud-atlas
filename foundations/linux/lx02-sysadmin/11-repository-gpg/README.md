# 11 - è½¯ä»¶æºä¸ GPG (Repository and GPG)

> **ç›®æ ‡**ï¼šæŒæ¡è½¯ä»¶æºçš„é…ç½®ä¸ç®¡ç†ï¼Œç†è§£ GPG ç­¾åéªŒè¯æœºåˆ¶ï¼Œå­¦ä¼šå®‰å…¨åœ°æ·»åŠ ç¬¬ä¸‰æ–¹ä»“åº“  
> **å‰ç½®**ï¼šåŸºç¡€ Linux å‘½ä»¤è¡Œæ“ä½œï¼Œè½¯ä»¶åŒ…ç®¡ç†åŸºç¡€ (Lesson 09-10)  
> **æ—¶é—´**ï¼šâš¡ 25 åˆ†é’Ÿï¼ˆé€Ÿè¯»ï¼‰/ ğŸ”¬ 90 åˆ†é’Ÿï¼ˆå®Œæ•´å®æ“ï¼‰  
> **å®æˆ˜åœºæ™¯**ï¼šä¼ä¸šç¯å¢ƒä¸‹çš„è½¯ä»¶æºç®¡ç†ä¸å®‰å…¨éªŒè¯  

---

## å°†å­¦åˆ°çš„å†…å®¹

1. é…ç½®å’Œç®¡ç† DNF/YUM ä»“åº“ (`/etc/yum.repos.d/`)
2. é…ç½®å’Œç®¡ç† APT ä»“åº“ (`sources.list` å’Œ `sources.list.d/`)
3. ç†è§£ GPG ç­¾åå’ŒéªŒè¯çš„æ ¸å¿ƒæ¦‚å¿µ
4. ä½¿ç”¨ `rpm --import` å¯¼å…¥ GPG å¯†é’¥
5. ä½¿ç”¨ç°ä»£æ–¹æ³•é…ç½® APT ä»“åº“ (`/etc/apt/keyrings/`)
6. é…ç½®ä»“åº“ä¼˜å…ˆçº§
7. æ·»åŠ  EPEL ç­‰ç¬¬ä¸‰æ–¹ä»“åº“
8. ç†è§£ä¼ä¸šç¯å¢ƒçš„é•œåƒé…ç½®

---

## å…ˆè·‘èµ·æ¥ï¼ï¼ˆ5 åˆ†é’Ÿï¼‰

> åœ¨å­¦ä¹ ç†è®ºä¹‹å‰ï¼Œå…ˆä½“éªŒè½¯ä»¶æºç®¡ç†çš„åŸºæœ¬æ“ä½œã€‚  
> è¿è¡Œè¿™äº›å‘½ä»¤ï¼Œè§‚å¯Ÿè¾“å‡º -- è¿™å°±æ˜¯ä½ å°†è¦æŒæ¡çš„æŠ€èƒ½ã€‚  

### RHEL/CentOS/AlmaLinux ç”¨æˆ·

```bash
# æŸ¥çœ‹å½“å‰å¯ç”¨çš„ä»“åº“
dnf repolist

# æŸ¥çœ‹ä»“åº“é…ç½®æ–‡ä»¶
ls /etc/yum.repos.d/

# æŸ¥çœ‹æŸä¸ªä»“åº“çš„è¯¦ç»†é…ç½®
cat /etc/yum.repos.d/almalinux.repo 2>/dev/null || \
cat /etc/yum.repos.d/rocky.repo 2>/dev/null || \
cat /etc/yum.repos.d/redhat.repo 2>/dev/null | head -20

# æŸ¥çœ‹å·²å¯¼å…¥çš„ GPG å¯†é’¥
rpm -qa gpg-pubkey* | head -5
```

### Debian/Ubuntu ç”¨æˆ·

```bash
# æŸ¥çœ‹å½“å‰è½¯ä»¶æº
cat /etc/apt/sources.list

# æŸ¥çœ‹é¢å¤–çš„æºé…ç½®
ls /etc/apt/sources.list.d/

# æŸ¥çœ‹æ–°å¼ GPG å¯†é’¥å­˜æ”¾ä½ç½®
ls /etc/apt/keyrings/ 2>/dev/null || echo "ç›®å½•ä¸å­˜åœ¨ï¼ˆæ­£å¸¸ï¼‰"

# æŸ¥çœ‹å·²é…ç½®çš„ä»“åº“
apt-cache policy | head -20
```

**ä½ åˆšåˆšæŸ¥çœ‹äº†ç³»ç»Ÿçš„è½¯ä»¶æºé…ç½®ï¼**

è½¯ä»¶æºï¼ˆRepositoryï¼‰å°±åƒæ˜¯è½¯ä»¶çš„"ä»“åº“"ï¼Œå‘Šè¯‰åŒ…ç®¡ç†å™¨å»å“ªé‡Œä¸‹è½½è½¯ä»¶ã€‚
GPG ç­¾åç¡®ä¿ä½ ä¸‹è½½çš„è½¯ä»¶æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚

ç°åœ¨è®©æˆ‘ä»¬æ·±å…¥ç†è§£è½¯ä»¶æºå’Œ GPG çš„åŸç†ã€‚

---

## Step 1 -- ç†è§£è½¯ä»¶æºçš„ä¿¡ä»»é“¾ï¼ˆ10 åˆ†é’Ÿï¼‰

### 1.1 ä¸ºä»€ä¹ˆéœ€è¦ GPG ç­¾åï¼Ÿ

å½“ä½ è¿è¡Œ `dnf install nginx` æ—¶ï¼Œè½¯ä»¶åŒ…ä»è¿œç¨‹æœåŠ¡å™¨ä¸‹è½½ã€‚å¦‚ä½•ç¡®ä¿ï¼š
- è½¯ä»¶åŒ…ç¡®å®æ¥è‡ªå®˜æ–¹ä»“åº“ï¼Ÿ
- ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰è¢«ç¯¡æ”¹ï¼Ÿ
- æ²¡æœ‰è¢«ä¸­é—´äººæ”»å‡»æ›¿æ¢ï¼Ÿ

**ç­”æ¡ˆï¼šGPG æ•°å­—ç­¾åã€‚**

![Repository Trust Chain](images/repository-trust-chain.png)

<details>
<summary>View ASCII source</summary>

<!-- DIAGRAM: repository-trust-chain -->
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          è½¯ä»¶åŒ…ä¿¡ä»»é“¾ (Trust Chain)                           â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                        è½¯ä»¶åŒ…å‘å¸ƒæ–¹                                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚    â”‚
â”‚  â”‚  â”‚  Source Code â”‚â”€â”€â”€â”€â–¶â”‚    Build     â”‚â”€â”€â”€â”€â–¶â”‚  RPM / DEB   â”‚        â”‚    â”‚
â”‚  â”‚  â”‚    æºä»£ç      â”‚     â”‚   ç¼–è¯‘æ„å»º    â”‚     â”‚   è½¯ä»¶åŒ…      â”‚        â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚    â”‚
â”‚  â”‚                                                    â”‚                â”‚    â”‚
â”‚  â”‚                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚   GPG Sign    â”‚       â”‚    â”‚
â”‚  â”‚  â”‚ Private Key  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   ç­¾åè½¯ä»¶åŒ…   â”‚       â”‚    â”‚
â”‚  â”‚  â”‚  ç§é’¥ (ä¿å¯†)  â”‚                          â”‚               â”‚       â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                       â”‚                     â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                              â”‚         Repository Server               â”‚   â”‚
â”‚                              â”‚           è½¯ä»¶æºæœåŠ¡å™¨                   â”‚   â”‚
â”‚                              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚                              â”‚  â”‚ pkg.rpm â”‚  â”‚ pkg.rpm â”‚  â”‚ pkg.rpm â”‚ â”‚   â”‚
â”‚                              â”‚  â”‚ (signed)â”‚  â”‚ (signed)â”‚  â”‚ (signed)â”‚ â”‚   â”‚
â”‚                              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚                              â”‚                                         â”‚   â”‚
â”‚                              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚                              â”‚  â”‚   repomd.xml (ç­¾åçš„å…ƒæ•°æ®)     â”‚   â”‚   â”‚
â”‚                              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                               â”‚                            â”‚
â”‚                                               â”‚ https (ä¼ è¾“åŠ å¯†)           â”‚
â”‚                                               â–¼                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                          ä½ çš„æœåŠ¡å™¨                                  â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  â”‚
â”‚  â”‚  â”‚ Public Key   â”‚     â”‚   Download   â”‚     â”‚   Verify     â”‚        â”‚  â”‚
â”‚  â”‚  â”‚  å…¬é’¥ (å…¬å¼€)  â”‚â”€â”€â”€â”€â–¶â”‚   ä¸‹è½½è½¯ä»¶åŒ…  â”‚â”€â”€â”€â”€â–¶â”‚   éªŒè¯ç­¾å    â”‚        â”‚  â”‚
â”‚  â”‚  â”‚              â”‚     â”‚              â”‚     â”‚              â”‚        â”‚  â”‚
â”‚  â”‚  â”‚ rpm --import â”‚     â”‚              â”‚     â”‚  ç­¾ååŒ¹é…ï¼Ÿ   â”‚        â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚
â”‚  â”‚                                                    â”‚                â”‚  â”‚
â”‚  â”‚                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚
â”‚  â”‚                                     â”‚              â”‚              â”‚â”‚  â”‚
â”‚  â”‚                                     â–¼              â–¼              â”‚â”‚  â”‚
â”‚  â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚â”‚  â”‚
â”‚  â”‚                              â”‚  âœ“ å®‰è£…    â”‚ â”‚  âœ— æ‹’ç»    â”‚     â”‚â”‚  â”‚
â”‚  â”‚                              â”‚  Install   â”‚ â”‚  Reject    â”‚     â”‚â”‚  â”‚
â”‚  â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚
â”‚                                                                        â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
<!-- /DIAGRAM -->

</details>

### 1.2 GPG ç­¾åéªŒè¯æµç¨‹

![GPG Verification Flow](images/gpg-verification-flow.png)

<details>
<summary>View ASCII source</summary>

<!-- DIAGRAM: gpg-verification-flow -->
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      GPG ç­¾åéªŒè¯æµç¨‹                                â”‚
â”‚                                                                      â”‚
â”‚   å‘å¸ƒæ–¹ï¼ˆå¦‚ Red Hatï¼‰                    ä½ çš„æœåŠ¡å™¨                  â”‚
â”‚                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚
â”‚   â”‚ Private Key â”‚                                                   â”‚
â”‚   â”‚   ç§é’¥       â”‚                                                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚          â”‚                                                          â”‚
â”‚          â”‚ ç­¾å                                                     â”‚
â”‚          â–¼                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         ä¸‹è½½          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚   Package   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚   Package   â”‚            â”‚
â”‚   â”‚  + Signatureâ”‚                       â”‚  + Signatureâ”‚            â”‚
â”‚   â”‚  (è½¯ä»¶åŒ…+ç­¾å)â”‚                       â”‚  (è½¯ä»¶åŒ…+ç­¾å)â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                â”‚                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         å‘å¸ƒ          â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚ Public Key  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚ Public Key  â”‚            â”‚
â”‚   â”‚   å…¬é’¥       â”‚   (rpm --import)      â”‚   å…¬é’¥       â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                â”‚                    â”‚
â”‚                                                â”‚ éªŒè¯               â”‚
â”‚                                                â–¼                    â”‚
â”‚                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚                                         â”‚   æ¯”è¾ƒ      â”‚            â”‚
â”‚                                         â”‚             â”‚            â”‚
â”‚                                         â”‚ å…¬é’¥è§£å¯†ç­¾å â”‚            â”‚
â”‚                                         â”‚     ||      â”‚            â”‚
â”‚                                         â”‚ è½¯ä»¶åŒ…å“ˆå¸Œï¼Ÿ â”‚            â”‚
â”‚                                         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                â”‚                    â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                              â”‚                                   â”‚ â”‚
â”‚                              â–¼                                   â–¼ â”‚
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       â”‚  âœ“ åŒ¹é…    â”‚                   â”‚  âœ— ä¸åŒ¹é…   â”‚
â”‚                       â”‚  è½¯ä»¶åŒ…å¯ä¿¡ â”‚                   â”‚  å¯èƒ½è¢«ç¯¡æ”¹  â”‚
â”‚                       â”‚  å…è®¸å®‰è£…   â”‚                   â”‚  æ‹’ç»å®‰è£…   â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
<!-- /DIAGRAM -->

</details>

### 1.3 å…¬é’¥åŠ å¯†ç®€ä»‹

| æ¦‚å¿µ | è¯´æ˜ |
|------|------|
| **Private Keyï¼ˆç§é’¥ï¼‰** | åªæœ‰å‘å¸ƒæ–¹æŒæœ‰ï¼Œç”¨äºç­¾åè½¯ä»¶åŒ… |
| **Public Keyï¼ˆå…¬é’¥ï¼‰** | å…¬å¼€å‘å¸ƒï¼Œç”¨äºéªŒè¯ç­¾å |
| **æ•°å­—ç­¾å** | ç”¨ç§é’¥å¯¹è½¯ä»¶åŒ…å“ˆå¸Œå€¼åŠ å¯†çš„ç»“æœ |
| **éªŒè¯è¿‡ç¨‹** | ç”¨å…¬é’¥è§£å¯†ç­¾åï¼Œä¸è½¯ä»¶åŒ…å“ˆå¸Œæ¯”å¯¹ |

**å…³é”®ç†è§£**ï¼š
- ç§é’¥ç­¾å = åªæœ‰çœŸæ­£çš„å‘å¸ƒæ–¹èƒ½åˆ›å»ºæœ‰æ•ˆç­¾å
- å…¬é’¥éªŒè¯ = ä»»ä½•äººéƒ½èƒ½éªŒè¯ç­¾åæ˜¯å¦æœ‰æ•ˆ
- ç­¾åæ— æ•ˆ = è½¯ä»¶åŒ…è¢«ç¯¡æ”¹æˆ–æ¥æºä¸å¯ä¿¡

---

## Step 2 -- DNF/YUM ä»“åº“é…ç½®ï¼ˆ20 åˆ†é’Ÿï¼‰

### 2.1 ä»“åº“é…ç½®æ–‡ä»¶ä½ç½®

```bash
# ä»“åº“é…ç½®ç›®å½•
ls -la /etc/yum.repos.d/

# å…¸å‹è¾“å‡ºï¼ˆAlmaLinux 9ï¼‰ï¼š
# almalinux-appstream.repo
# almalinux-baseos.repo
# almalinux-crb.repo
# almalinux-extras.repo
```

### 2.2 ä»“åº“é…ç½®æ–‡ä»¶ç»“æ„

```bash
cat /etc/yum.repos.d/almalinux-baseos.repo
```

```ini
# ä»“åº“é…ç½®è¯¦è§£
[baseos]                          # ä»“åº“ IDï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰
name=AlmaLinux $releasever - BaseOS    # ä»“åº“åç§°ï¼ˆäººç±»å¯è¯»ï¼‰
mirrorlist=https://mirrors.almalinux.org/mirrorlist/$releasever/baseos
# æˆ–è€…ä½¿ç”¨å›ºå®š URLï¼š
# baseurl=https://repo.almalinux.org/almalinux/$releasever/BaseOS/$basearch/os/
enabled=1                         # 1=å¯ç”¨, 0=ç¦ç”¨
gpgcheck=1                        # 1=éªŒè¯ç­¾å, 0=ä¸éªŒè¯ï¼ˆå±é™©ï¼ï¼‰
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9
                                  # GPG å…¬é’¥ä½ç½®
countme=1                         # ç»Ÿè®¡è®¡æ•°ï¼ˆå¯é€‰ï¼‰
metadata_expire=86400             # å…ƒæ•°æ®è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
```

### 2.3 é‡è¦é…ç½®é€‰é¡¹

| é€‰é¡¹ | è¯´æ˜ | æ¨èå€¼ |
|------|------|--------|
| `enabled` | æ˜¯å¦å¯ç”¨ä»“åº“ | æŒ‰éœ€è®¾ç½® |
| `gpgcheck` | æ˜¯å¦éªŒè¯ GPG ç­¾å | **å¿…é¡»ä¸º 1** |
| `gpgkey` | GPG å…¬é’¥è·¯å¾„ | æŒ‡å‘æœ‰æ•ˆå¯†é’¥ |
| `baseurl` | å›ºå®šä»“åº“åœ°å€ | ç”¨äºå†…éƒ¨é•œåƒ |
| `mirrorlist` | é•œåƒåˆ—è¡¨åœ°å€ | è‡ªåŠ¨é€‰æ‹©æœ€å¿«é•œåƒ |
| `priority` | ä¼˜å…ˆçº§ï¼ˆ1-99ï¼Œä½ä¼˜å…ˆï¼‰ | é»˜è®¤ 99 |
| `sslverify` | éªŒè¯ HTTPS è¯ä¹¦ | **å¿…é¡»ä¸º 1** |
| `metadata_expire` | å…ƒæ•°æ®ç¼“å­˜æ—¶é—´ | æ ¹æ®éœ€æ±‚è°ƒæ•´ |

### 2.4 æ‰‹åŠ¨åˆ›å»ºä»“åº“é…ç½®

```bash
# ç¤ºä¾‹ï¼šæ·»åŠ å†…éƒ¨é•œåƒä»“åº“
sudo tee /etc/yum.repos.d/internal-mirror.repo << 'EOF'
[internal-baseos]
name=Internal Mirror - BaseOS
baseurl=https://mirror.internal.company.co.jp/almalinux/9/BaseOS/x86_64/os/
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9
priority=10

[internal-appstream]
name=Internal Mirror - AppStream
baseurl=https://mirror.internal.company.co.jp/almalinux/9/AppStream/x86_64/os/
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9
priority=10
EOF

# éªŒè¯é…ç½®
dnf repolist
```

### 2.5 ä»“åº“ç®¡ç†å‘½ä»¤

```bash
# åˆ—å‡ºæ‰€æœ‰ä»“åº“ï¼ˆåŒ…æ‹¬ç¦ç”¨çš„ï¼‰
dnf repolist all

# å¯ç”¨ä»“åº“
sudo dnf config-manager --set-enabled crb

# ç¦ç”¨ä»“åº“
sudo dnf config-manager --set-disabled crb

# ä¸´æ—¶ç¦ç”¨ä»“åº“å®‰è£…è½¯ä»¶
sudo dnf install --disablerepo=epel package-name

# åªä»ç‰¹å®šä»“åº“å®‰è£…
sudo dnf install --enablerepo=epel --disablerepo=* htop

# æ¸…é™¤ä»“åº“ç¼“å­˜
sudo dnf clean all

# é‡å»ºç¼“å­˜
sudo dnf makecache
```

---

## Step 3 -- GPG å¯†é’¥ç®¡ç† (RPM)ï¼ˆ15 åˆ†é’Ÿï¼‰

### 3.1 æŸ¥çœ‹å·²å¯¼å…¥çš„ GPG å¯†é’¥

```bash
# åˆ—å‡ºæ‰€æœ‰å¯¼å…¥çš„ GPG å¯†é’¥
rpm -qa gpg-pubkey*

# æŸ¥çœ‹å¯†é’¥è¯¦ç»†ä¿¡æ¯
rpm -qi gpg-pubkey-xxxxxxxx-xxxxxxxx

# è¾“å‡ºç¤ºä¾‹ï¼š
# Name        : gpg-pubkey
# Version     : d36cb86c
# Release     : 5ed6b326
# Summary     : gpg(AlmaLinux OS 9 <packager@almalinux.org>)
# Description :
# -----BEGIN PGP PUBLIC KEY BLOCK-----
# ...
```

### 3.2 å¯¼å…¥ GPG å¯†é’¥

```bash
# æ–¹æ³• 1ï¼šä» URL å¯¼å…¥
sudo rpm --import https://repo.almalinux.org/almalinux/RPM-GPG-KEY-AlmaLinux-9

# æ–¹æ³• 2ï¼šä»æœ¬åœ°æ–‡ä»¶å¯¼å…¥
sudo rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9

# æ–¹æ³• 3ï¼šDNF å®‰è£…æ—¶è‡ªåŠ¨å¯¼å…¥ï¼ˆä¼šæç¤ºç¡®è®¤ï¼‰
sudo dnf install package-from-new-repo
# "Importing GPG key... Is this ok [y/N]:"
```

### 3.3 éªŒè¯è½¯ä»¶åŒ…ç­¾å

```bash
# æ£€æŸ¥ RPM æ–‡ä»¶çš„ç­¾å
rpm --checksig package.rpm
# æˆ–
rpm -K package.rpm

# è¾“å‡ºç¤ºä¾‹ï¼ˆæˆåŠŸï¼‰ï¼š
# package.rpm: digests signatures OK

# è¾“å‡ºç¤ºä¾‹ï¼ˆå¤±è´¥ï¼‰ï¼š
# package.rpm: digests SIGNATURES NOT OK

# æŸ¥çœ‹è½¯ä»¶åŒ…çš„ç­¾åä¿¡æ¯
rpm -qpi package.rpm | grep Signature
```

### 3.4 åˆ é™¤ GPG å¯†é’¥ï¼ˆè°¨æ…æ“ä½œï¼‰

```bash
# æ‰¾åˆ°å¯†é’¥çš„å®Œæ•´åç§°
rpm -qa gpg-pubkey*

# åˆ é™¤ç‰¹å®šå¯†é’¥ï¼ˆæå°‘éœ€è¦è¿™æ ·åšï¼‰
sudo rpm -e gpg-pubkey-xxxxxxxx-xxxxxxxx
```

---

## Step 4 -- APT ä»“åº“é…ç½®ï¼ˆ15 åˆ†é’Ÿï¼‰

### 4.1 ä¼ ç»Ÿé…ç½®æ–¹å¼ï¼ˆsources.listï¼‰

```bash
# ä¸»é…ç½®æ–‡ä»¶
cat /etc/apt/sources.list
```

```
# æ ¼å¼ï¼šdeb [é€‰é¡¹] ä»“åº“åœ°å€ å‘è¡Œç‰ˆä»£å· ç»„ä»¶
deb http://archive.ubuntu.com/ubuntu noble main restricted
deb http://archive.ubuntu.com/ubuntu noble universe multiverse
deb http://archive.ubuntu.com/ubuntu noble-updates main restricted
deb http://security.ubuntu.com/ubuntu noble-security main restricted

# deb-src è¡Œç”¨äºæºä»£ç åŒ…
deb-src http://archive.ubuntu.com/ubuntu noble main restricted
```

### 4.2 ç»„ä»¶è¯´æ˜

| ç»„ä»¶ | Debian | Ubuntu | è¯´æ˜ |
|------|--------|--------|------|
| main | main | main | å®˜æ–¹æ”¯æŒçš„è‡ªç”±è½¯ä»¶ |
| contrib | contrib | restricted | ä¾èµ–éè‡ªç”±è½¯ä»¶çš„è‡ªç”±è½¯ä»¶ |
| non-free | non-free | multiverse | éè‡ªç”±è½¯ä»¶ |
| non-free-firmware | - | - | Debian 12+ éè‡ªç”±å›ºä»¶ |
| - | - | universe | ç¤¾åŒºç»´æŠ¤çš„è‡ªç”±è½¯ä»¶ |

### 4.3 ç°ä»£é…ç½®æ–¹å¼ï¼ˆDEB822 æ ¼å¼ï¼‰

ä» Ubuntu 24.04 / Debian 12 å¼€å§‹ï¼Œæ¨èä½¿ç”¨ `.sources` æ–‡ä»¶ï¼š

```bash
# æŸ¥çœ‹æ–°æ ¼å¼é…ç½®
cat /etc/apt/sources.list.d/ubuntu.sources
```

```
Types: deb
URIs: http://archive.ubuntu.com/ubuntu
Suites: noble noble-updates noble-backports
Components: main restricted universe multiverse
Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg

Types: deb
URIs: http://security.ubuntu.com/ubuntu
Suites: noble-security
Components: main restricted universe multiverse
Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg
```

### 4.4 sources.list.d ç›®å½•

```bash
# ç¬¬ä¸‰æ–¹ä»“åº“æ”¾åœ¨è¿™ä¸ªç›®å½•
ls /etc/apt/sources.list.d/

# æ¯ä¸ªä»“åº“ä¸€ä¸ªæ–‡ä»¶ï¼Œä¾¿äºç®¡ç†
# ä¾‹å¦‚ï¼š
# docker.list
# google-chrome.list
# kubernetes.list
```

---

## Step 5 -- APT GPG å¯†é’¥ç®¡ç†ï¼ˆç°ä»£æ–¹æ³•ï¼‰ï¼ˆ15 åˆ†é’Ÿï¼‰

### 5.1 apt-key å·²å¼ƒç”¨ï¼

```bash
# æ—§æ–¹æ³•ï¼ˆå·²å¼ƒç”¨ï¼Œä¸è¦ä½¿ç”¨ï¼ï¼‰
# apt-key add key.gpg              # ä¸å®‰å…¨ï¼
# apt-key list                      # å³å°†ç§»é™¤

# è­¦å‘Šä¿¡æ¯ï¼š
# Warning: apt-key is deprecated. Manage keyring files in trusted.gpg.d instead.
```

**ä¸ºä»€ä¹ˆå¼ƒç”¨ apt-keyï¼Ÿ**
- å…¨å±€ä¿¡ä»»ï¼šæ·»åŠ çš„å¯†é’¥ä¿¡ä»»æ‰€æœ‰ä»“åº“
- å®‰å…¨é£é™©ï¼šæ¶æ„ä»“åº“å¯èƒ½ç¯¡æ”¹å…¶ä»–ä»“åº“çš„åŒ…
- ç®¡ç†å›°éš¾ï¼šå¯†é’¥ä¸ä»“åº“æ²¡æœ‰ç»‘å®šå…³ç³»

### 5.2 ç°ä»£æ–¹æ³•ï¼šsigned-by æŒ‡ä»¤

ç°ä»£ APT ä½¿ç”¨ `signed-by` é€‰é¡¹ï¼Œå°†å¯†é’¥ä¸ç‰¹å®šä»“åº“ç»‘å®šï¼š

```bash
# å¯†é’¥å­˜æ”¾ç›®å½•
ls /etc/apt/keyrings/

# å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œåˆ›å»ºå®ƒ
sudo mkdir -p /etc/apt/keyrings/
```

### 5.3 æ·»åŠ ç¬¬ä¸‰æ–¹ä»“åº“ï¼ˆç°ä»£æ–¹æ³•ï¼‰

ä»¥ Docker å®˜æ–¹ä»“åº“ä¸ºä¾‹ï¼š

```bash
# 1. ä¸‹è½½ GPG å¯†é’¥å¹¶è½¬æ¢æ ¼å¼
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | \
    sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

# 2. è®¾ç½®æ­£ç¡®æƒé™
sudo chmod a+r /etc/apt/keyrings/docker.gpg

# 3. æ·»åŠ ä»“åº“é…ç½®ï¼ˆä½¿ç”¨ signed-by ç»‘å®šå¯†é’¥ï¼‰
echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] \
    https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | \
    sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# 4. æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
sudo apt update

# 5. éªŒè¯ä»“åº“å·²æ·»åŠ 
apt-cache policy docker-ce
```

### 5.4 å¯†é’¥æ ¼å¼è¯´æ˜

| æ ¼å¼ | æ‰©å±•å | è¯´æ˜ |
|------|--------|------|
| ASCII armored | `.asc`, `.gpg` (æ–‡æœ¬) | å¯ç›´æ¥æŸ¥çœ‹çš„æ–‡æœ¬æ ¼å¼ |
| Binary | `.gpg` (äºŒè¿›åˆ¶) | éœ€è¦ `gpg --dearmor` è½¬æ¢ |

```bash
# è½¬æ¢ ASCII æ ¼å¼åˆ°äºŒè¿›åˆ¶æ ¼å¼
gpg --dearmor < key.asc > key.gpg

# æŸ¥çœ‹å¯†é’¥ä¿¡æ¯
gpg --show-keys /etc/apt/keyrings/docker.gpg
```

### 5.5 å®Œæ•´ç¤ºä¾‹ï¼šæ·»åŠ  Node.js ä»“åº“

```bash
#!/bin/bash
# add-nodejs-repo.sh - æ·»åŠ  Node.js å®˜æ–¹ä»“åº“ï¼ˆç°ä»£æ–¹æ³•ï¼‰

set -e

# å˜é‡
KEYRING_PATH="/etc/apt/keyrings/nodesource.gpg"
SOURCES_PATH="/etc/apt/sources.list.d/nodesource.list"
NODE_MAJOR="22"  # Node.js LTS ä¸»ç‰ˆæœ¬ï¼ˆ22.x æ”¯æŒåˆ° 2027-04ï¼‰

# 1. ä¸‹è½½å¹¶å®‰è£… GPG å¯†é’¥
echo "ä¸‹è½½ GPG å¯†é’¥..."
curl -fsSL https://deb.nodesource.com/gpgkey/nodesource-repo.gpg.key | \
    sudo gpg --dearmor -o "$KEYRING_PATH"

# 2. åˆ›å»ºä»“åº“é…ç½®
echo "åˆ›å»ºä»“åº“é…ç½®..."
echo "deb [signed-by=$KEYRING_PATH] https://deb.nodesource.com/node_$NODE_MAJOR.x nodistro main" | \
    sudo tee "$SOURCES_PATH"

# 3. æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
echo "æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨..."
sudo apt update

# 4. éªŒè¯
echo "éªŒè¯ä»“åº“é…ç½®..."
apt-cache policy nodejs

echo "å®Œæˆï¼å¯ä»¥ä½¿ç”¨ 'sudo apt install nodejs' å®‰è£… Node.js"
```

---

## Step 6 -- æ·»åŠ  EPEL ä»“åº“ï¼ˆ10 åˆ†é’Ÿï¼‰

### 6.1 ä»€ä¹ˆæ˜¯ EPELï¼Ÿ

**EPEL**ï¼ˆExtra Packages for Enterprise Linuxï¼‰æ˜¯ Fedora é¡¹ç›®ä¸º RHEL åŠå…¶è¡ç”Ÿç‰ˆæä¾›çš„é¢å¤–è½¯ä»¶åŒ…ä»“åº“ã€‚

```bash
# åŒ…å«è®¸å¤šåœ¨ RHEL é»˜è®¤ä»“åº“ä¸­æ²¡æœ‰çš„è½¯ä»¶ï¼š
# - htop, tmux, ansible
# - nginx (æ›´æ–°ç‰ˆæœ¬), python3-pip
# - å¼€å‘å·¥å…·å’Œåº“
```

### 6.2 å®‰è£… EPELï¼ˆRHEL/AlmaLinux/Rockyï¼‰

```bash
# æ–¹æ³• 1ï¼šä½¿ç”¨ dnf å®‰è£…ï¼ˆæ¨èï¼‰
sudo dnf install epel-release -y

# æ–¹æ³• 2ï¼šæ‰‹åŠ¨å®‰è£… RPM
# RHEL 9
sudo dnf install https://dl.fedoraproject.org/pub/epel/epel-release-latest-9.noarch.rpm

# éªŒè¯å®‰è£…
dnf repolist | grep epel

# è¾“å‡ºç¤ºä¾‹ï¼š
# epel                   Extra Packages for Enterprise Linux 9 - x86_64
```

### 6.3 éªŒè¯ EPEL GPG å¯†é’¥

```bash
# æŸ¥çœ‹ EPEL å¯†é’¥
rpm -qi gpg-pubkey-* | grep -A 1 "Summary.*EPEL"

# éªŒè¯æŸä¸ª EPEL è½¯ä»¶åŒ…
rpm --checksig /var/cache/dnf/epel-*/packages/htop-*.rpm
```

### 6.4 EPEL ä½¿ç”¨ç¤ºä¾‹

```bash
# æœç´¢ EPEL ä¸­çš„è½¯ä»¶åŒ…
dnf --enablerepo=epel search htop

# ä» EPEL å®‰è£…è½¯ä»¶
sudo dnf install htop

# ä»…ä» EPEL å®‰è£…ï¼ˆæ’é™¤å…¶ä»–ä»“åº“ï¼‰
sudo dnf install --disablerepo="*" --enablerepo="epel" htop
```

---

## Step 7 -- ä»“åº“ä¼˜å…ˆçº§é…ç½®ï¼ˆ10 åˆ†é’Ÿï¼‰

### 7.1 ä¸ºä»€ä¹ˆéœ€è¦ä¼˜å…ˆçº§ï¼Ÿ

å½“å¤šä¸ªä»“åº“æä¾›åŒä¸€è½¯ä»¶åŒ…æ—¶ï¼Œéœ€è¦æ§åˆ¶ä½¿ç”¨å“ªä¸ªç‰ˆæœ¬ï¼š

```
åœºæ™¯ï¼š
- BaseOS æä¾› nginx-1.22
- EPEL æä¾› nginx-1.24
- å†…éƒ¨é•œåƒæä¾› nginx-1.22ï¼ˆç»è¿‡å®‰å…¨å®¡æŸ¥ï¼‰

éœ€æ±‚ï¼šä¼˜å…ˆä½¿ç”¨å†…éƒ¨é•œåƒçš„ç‰ˆæœ¬
```

### 7.2 DNF ä¼˜å…ˆçº§é…ç½®

```bash
# å®‰è£…ä¼˜å…ˆçº§æ’ä»¶ï¼ˆé€šå¸¸å·²é¢„è£…ï¼‰
sudo dnf install dnf-plugins-core

# åœ¨ä»“åº“é…ç½®ä¸­æ·»åŠ  priority
# /etc/yum.repos.d/internal-mirror.repo
[internal-baseos]
name=Internal Mirror - BaseOS
baseurl=https://mirror.internal.company.co.jp/almalinux/9/BaseOS/x86_64/os/
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9
priority=10    # æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼ˆ1-99ï¼‰

# EPEL é…ç½®è¾ƒä½ä¼˜å…ˆçº§
# /etc/yum.repos.d/epel.repo
[epel]
name=Extra Packages for Enterprise Linux 9
...
priority=90    # è¾ƒä½ä¼˜å…ˆçº§
```

### 7.3 APT ä¼˜å…ˆçº§é…ç½®ï¼ˆpinningï¼‰

```bash
# åˆ›å»ºä¼˜å…ˆçº§é…ç½®æ–‡ä»¶
sudo tee /etc/apt/preferences.d/docker << 'EOF'
Package: docker-*
Pin: origin download.docker.com
Pin-Priority: 1000
EOF

# ä¼˜å…ˆçº§è¯´æ˜ï¼š
# 1001+   : å¼ºåˆ¶å®‰è£…ï¼ˆå³ä½¿é™çº§ï¼‰
# 990-1000: ä¼˜å…ˆäºå·²å®‰è£…ç‰ˆæœ¬
# 500-989 : ä¼˜å…ˆäºæœªå®‰è£…ç‰ˆæœ¬
# 100-499 : ä¸ä¼˜å…ˆ
# < 100   : æ°¸ä¸å®‰è£…
```

```bash
# æŸ¥çœ‹è½¯ä»¶åŒ…ä¼˜å…ˆçº§
apt-cache policy docker-ce
```

---

## Step 8 -- åŠ¨æ‰‹å®éªŒï¼ˆ25 åˆ†é’Ÿï¼‰

### å®éªŒ 1ï¼šæ·»åŠ  EPEL ä»“åº“ï¼ˆRHEL ç³»ï¼‰

```bash
# 1. æ£€æŸ¥å½“å‰ä»“åº“
echo "=== å½“å‰ä»“åº“ ==="
dnf repolist

# 2. å®‰è£… EPEL
echo "=== å®‰è£… EPEL ==="
sudo dnf install -y epel-release

# 3. éªŒè¯ GPG å¯†é’¥å·²å¯¼å…¥
echo "=== GPG å¯†é’¥ ==="
rpm -qa gpg-pubkey* | grep -i epel || echo "EPEL å¯†é’¥å·²å¯¼å…¥ï¼ˆä½œä¸ºä¾èµ–ï¼‰"

# 4. æŸ¥çœ‹ EPEL ä»“åº“é…ç½®
echo "=== EPEL é…ç½® ==="
cat /etc/yum.repos.d/epel.repo | head -20

# 5. ä» EPEL å®‰è£…è½¯ä»¶
echo "=== å®‰è£… htop ==="
sudo dnf install -y htop

# 6. éªŒè¯è½¯ä»¶åŒ…æ¥æº
echo "=== éªŒè¯æ¥æº ==="
dnf info htop | grep Repository
```

### å®éªŒ 2ï¼šGPG å¯†é’¥éªŒè¯ï¼ˆRHEL ç³»ï¼‰

```bash
# 1. åˆ—å‡ºæ‰€æœ‰ GPG å¯†é’¥
echo "=== å·²å¯¼å…¥çš„ GPG å¯†é’¥ ==="
rpm -qa gpg-pubkey*

# 2. æŸ¥çœ‹æŸä¸ªå¯†é’¥çš„è¯¦ç»†ä¿¡æ¯
echo "=== å¯†é’¥è¯¦æƒ… ==="
KEY=$(rpm -qa gpg-pubkey* | head -1)
rpm -qi $KEY

# 3. ä¸‹è½½ä¸€ä¸ª RPM åŒ…ï¼ˆä¸å®‰è£…ï¼‰
echo "=== ä¸‹è½½è½¯ä»¶åŒ… ==="
dnf download htop

# 4. éªŒè¯ç­¾å
echo "=== éªŒè¯ç­¾å ==="
rpm --checksig htop-*.rpm

# 5. æŸ¥çœ‹ç­¾åè¯¦æƒ…
echo "=== ç­¾åè¯¦æƒ… ==="
rpm -qpi htop-*.rpm | grep -E "(Signature|Vendor|Packager)"

# 6. æ¸…ç†
rm -f htop-*.rpm
```

### å®éªŒ 3ï¼šæ·»åŠ ç¬¬ä¸‰æ–¹ APT ä»“åº“ï¼ˆDebian/Ubuntuï¼‰

```bash
# 1. åˆ›å»º keyrings ç›®å½•
echo "=== å‡†å¤‡ç›®å½• ==="
sudo mkdir -p /etc/apt/keyrings

# 2. ä»¥ GitHub CLI ä¸ºä¾‹
echo "=== ä¸‹è½½ GPG å¯†é’¥ ==="
curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | \
    sudo gpg --dearmor -o /etc/apt/keyrings/githubcli.gpg

# 3. è®¾ç½®æƒé™
sudo chmod a+r /etc/apt/keyrings/githubcli.gpg

# 4. æ·»åŠ ä»“åº“é…ç½®
echo "=== æ·»åŠ ä»“åº“ ==="
echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/githubcli.gpg] \
    https://cli.github.com/packages stable main" | \
    sudo tee /etc/apt/sources.list.d/github-cli.list

# 5. æ›´æ–°å¹¶éªŒè¯
echo "=== éªŒè¯ä»“åº“ ==="
sudo apt update
apt-cache policy gh

# 6. æŸ¥çœ‹å¯†é’¥ä¿¡æ¯
echo "=== å¯†é’¥ä¿¡æ¯ ==="
gpg --show-keys /etc/apt/keyrings/githubcli.gpg
```

---

## åæ¨¡å¼ï¼šå¸¸è§é”™è¯¯

### é”™è¯¯ 1ï¼šgpgcheck=0ï¼ˆä¸¥é‡å®‰å…¨é£é™©ï¼‰

```bash
# æå…¶å±é™©ï¼ç»å¯¹ä¸è¦è¿™æ ·åšï¼
[some-repo]
name=Some Repository
baseurl=https://repo.example.com/packages/
enabled=1
gpgcheck=0    # â† è‡´å‘½é”™è¯¯ï¼

# åæœï¼š
# 1. å…è®¸å®‰è£…æœªç­¾åçš„è½¯ä»¶åŒ…
# 2. æ— æ³•æ£€æµ‹è½¯ä»¶åŒ…æ˜¯å¦è¢«ç¯¡æ”¹
# 3. ä¾›åº”é“¾æ”»å‡»çš„å…¥å£
# 4. è¿åä¼ä¸šå®‰å…¨åˆè§„

# æ­£ç¡®åšæ³•ï¼šå§‹ç»ˆå¯ç”¨ GPG æ£€æŸ¥
gpgcheck=1
gpgkey=https://repo.example.com/RPM-GPG-KEY
```

**å®‰å…¨é£é™©ï¼šCRITICAL** - è¿™æ˜¯ä¾›åº”é“¾æ”»å‡»çš„ä¸»è¦å…¥å£ã€‚æ”»å‡»è€…å¯ä»¥ï¼š
- ä¸­é—´äººæ”»å‡»æ›¿æ¢è½¯ä»¶åŒ…
- åœ¨è½¯ä»¶åŒ…ä¸­æ¤å…¥åé—¨
- å®Œå…¨æ§åˆ¶ä½ çš„ç³»ç»Ÿ

### é”™è¯¯ 2ï¼šéšæ„æ·»åŠ ç¬¬ä¸‰æ–¹ä»“åº“

```bash
# å±é™©ï¼ä»ä¸æ˜æ¥æºæ·»åŠ ä»“åº“
# æŸè®ºå›å¸–å­è¯´"è¿è¡Œè¿™ä¸ªå‘½ä»¤å°±èƒ½è§£å†³é—®é¢˜"
curl http://random-site.com/setup.sh | sudo bash

# æ­£ç¡®åšæ³•ï¼š
# 1. åªä½¿ç”¨å®˜æ–¹æˆ–å¯ä¿¡çš„ä»“åº“
# 2. éªŒè¯ä»“åº“çš„ GPG å¯†é’¥
# 3. æ£€æŸ¥ä»“åº“çš„ç»´æŠ¤çŠ¶æ€
# 4. åœ¨æµ‹è¯•ç¯å¢ƒå…ˆéªŒè¯
# 5. éµå¾ªä¼ä¸šå®¡æ‰¹æµç¨‹
```

### é”™è¯¯ 3ï¼šä½¿ç”¨å·²å¼ƒç”¨çš„ apt-key

```bash
# æ—§æ–¹æ³•ï¼ˆå·²å¼ƒç”¨ï¼‰
curl -fsSL https://example.com/key.gpg | sudo apt-key add -

# é—®é¢˜ï¼š
# 1. å¯†é’¥å…¨å±€ä¿¡ä»»ï¼Œå½±å“æ‰€æœ‰ä»“åº“
# 2. apt-key å°†è¢«å®Œå…¨ç§»é™¤
# 3. å®‰å…¨æ¨¡å‹å­˜åœ¨ç¼ºé™·

# æ­£ç¡®åšæ³•ï¼šä½¿ç”¨ signed-by ç»‘å®š
curl -fsSL https://example.com/key.gpg | \
    sudo gpg --dearmor -o /etc/apt/keyrings/example.gpg

echo "deb [signed-by=/etc/apt/keyrings/example.gpg] https://repo.example.com stable main" | \
    sudo tee /etc/apt/sources.list.d/example.list
```

### é”™è¯¯ 4ï¼šå¿½ç•¥ HTTPS è¯ä¹¦éªŒè¯

```bash
# å±é™©ï¼ç¦ç”¨ SSL éªŒè¯
[insecure-repo]
name=Insecure Repository
baseurl=https://repo.example.com/packages/
sslverify=0    # â† å±é™©ï¼

# åæœï¼š
# - ä¸­é—´äººæ”»å‡»å¯ä»¥æ‹¦æˆªæµé‡
# - æ— æ³•ç¡®ä¿è¿æ¥åˆ°çœŸæ­£çš„æœåŠ¡å™¨
# - GPG éªŒè¯ä¹Ÿå¯èƒ½è¢«ç»•è¿‡

# æ­£ç¡®åšæ³•ï¼š
sslverify=1    # é»˜è®¤å€¼ï¼Œä¿æŒå¯ç”¨
sslcacert=/etc/pki/tls/certs/ca-bundle.crt
```

---

## èŒåœºå°è´´å£«ï¼ˆJapan IT Contextï¼‰

### å†…éƒ¨é•œåƒæ˜¯æ ‡å‡†é…ç½®ï¼ˆå†…éƒ¨ãƒŸãƒ©ãƒ¼ï¼‰

åœ¨æ—¥æœ¬ä¼ä¸šç¯å¢ƒä¸­ï¼ŒæœåŠ¡å™¨é€šå¸¸ä¸èƒ½ç›´æ¥è®¿é—®äº’è”ç½‘ã€‚è½¯ä»¶åŒ…é€šè¿‡å†…éƒ¨é•œåƒåˆ†å‘ï¼š

```bash
# ä¼ä¸šå¸¸è§çš„é•œåƒè§£å†³æ–¹æ¡ˆï¼š

# 1. Red Hat Satelliteï¼ˆå®˜æ–¹ä¼ä¸šç‰ˆï¼‰
#    - é›†ä¸­ç®¡ç†è®¢é˜…å’Œè½¯ä»¶åŒ…
#    - æä¾›å†…å®¹è§†å›¾å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†
#    - å¤§å‹ä¼ä¸šé¦–é€‰

# 2. Nexus Repository Manager
#    - æ”¯æŒå¤šç§æ ¼å¼ï¼ˆRPM, DEB, Docker, npm...ï¼‰
#    - å¼€æºç‰ˆå…è´¹
#    - ä¸­å°å‹ä¼ä¸šå¸¸ç”¨

# 3. Artifactory
#    - ä¼ä¸šçº§åˆ¶å“ç®¡ç†
#    - æ”¯æŒæ‰€æœ‰ä¸»æµåŒ…æ ¼å¼
#    - é›†æˆ CI/CD ç®¡é“

# å†…éƒ¨ä»“åº“é…ç½®ç¤ºä¾‹
[internal-mirror]
name=Internal Mirror Repository
baseurl=https://nexus.internal.company.co.jp/repository/rhel-9-baseos/
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-AlmaLinux-9
sslverify=1
sslcacert=/etc/pki/ca-trust/source/anchors/company-ca.crt
```

### å˜æ›´ç”³è¯·æ˜¯å¿…é¡»çš„ï¼ˆå¤‰æ›´ç”³è«‹ï¼‰

æ·»åŠ æˆ–ä¿®æ”¹è½¯ä»¶æºéœ€è¦æ­£å¼çš„å˜æ›´ç”³è¯·ï¼š

| æ—¥è¯­æœ¯è¯­ | å«ä¹‰ | è¯´æ˜ |
|----------|------|------|
| å¤‰æ›´ç”³è«‹ | å˜æ›´ç”³è¯· | æ­£å¼çš„å˜æ›´è¯·æ±‚è¡¨å• |
| æ‰¿èªãƒ•ãƒ­ãƒ¼ | å®¡æ‰¹æµç¨‹ | éœ€è¦å¤šçº§å®¡æ‰¹ |
| å½±éŸ¿èª¿æŸ» | å½±å“è°ƒæŸ¥ | è¯„ä¼°å˜æ›´çš„é£é™© |
| å®Ÿæ–½æ‰‹é †æ›¸ | å®æ–½æ‰‹å†Œ | è¯¦ç»†çš„æ“ä½œæ­¥éª¤ |
| åˆ‡ã‚Šæˆ»ã—æ‰‹é † | å›æ»šæ‰‹å†Œ | å¤±è´¥æ—¶çš„æ¢å¤æ­¥éª¤ |

```
å…¸å‹çš„å˜æ›´ç”³è¯·å†…å®¹ï¼š

1. å¤‰æ›´å†…å®¹ï¼ˆå˜æ›´å†…å®¹ï¼‰
   - æ·»åŠ  EPEL ä»“åº“åˆ° XX æœåŠ¡å™¨ç¾¤

2. å¤‰æ›´ç†ç”±ï¼ˆå˜æ›´åŸå› ï¼‰
   - éœ€è¦å®‰è£… htop ç”¨äºæ€§èƒ½ç›‘æ§

3. å½±éŸ¿ç¯„å›²ï¼ˆå½±å“èŒƒå›´ï¼‰
   - æœ¬ç•ªç’°å¢ƒ Web ã‚µãƒ¼ãƒãƒ¼ 10 å°

4. ãƒªã‚¹ã‚¯è©•ä¾¡ï¼ˆé£é™©è¯„ä¼°ï¼‰
   - ä½ï¼šä»…æ·»åŠ ä»“åº“é…ç½®ï¼Œä¸å®‰è£…è½¯ä»¶
   - GPG éªŒè¯ç¡®ä¿è½¯ä»¶åŒ…å®‰å…¨

5. å®Ÿæ–½æ—¥æ™‚ï¼ˆå®æ–½æ—¶é—´ï¼‰
   - 2026å¹´1æœˆ15æ—¥ 22:00-23:00

6. åˆ‡ã‚Šæˆ»ã—æ‰‹é †ï¼ˆå›æ»šæ‰‹å†Œï¼‰
   - åˆ é™¤ /etc/yum.repos.d/epel*.repo
   - è¿è¡Œ dnf clean all
```

### ç‰ˆæœ¬æ§åˆ¶å¾ˆé‡è¦

ä¼ä¸šç¯å¢ƒä¸­ï¼Œè½¯ä»¶åŒ…ç‰ˆæœ¬éœ€è¦ä¸¥æ ¼æ§åˆ¶ï¼š

```bash
# ä½¿ç”¨ç‰ˆæœ¬é”å®šé˜²æ­¢æ„å¤–æ›´æ–°
sudo dnf versionlock add nginx-1.24.0-1.el9

# åœ¨ Satellite/Nexus ä¸­è®¾ç½®å†…å®¹è§†å›¾
# åªå…è®¸ç»è¿‡æµ‹è¯•çš„ç‰ˆæœ¬è¿›å…¥ç”Ÿäº§ç¯å¢ƒ

# ç¤ºä¾‹ï¼šè½¯ä»¶åŒ…ç”Ÿå‘½å‘¨æœŸ
# å¼€ç™ºç’°å¢ƒ â†’ æ¤œè¨¼ç’°å¢ƒ â†’ ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚° â†’ æœ¬ç•ªç’°å¢ƒ
# (å¼€å‘)    â†’ (æµ‹è¯•)   â†’ (é¢„å‘å¸ƒ)    â†’ (ç”Ÿäº§)
```

---

## æ£€æŸ¥æ¸…å•

å®Œæˆæœ¬è¯¾åï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

- [ ] è§£é‡Š GPG ç­¾åéªŒè¯çš„å·¥ä½œåŸç†
- [ ] ç†è§£ä¸ºä»€ä¹ˆ**ç»ä¸**è®¾ç½® `gpgcheck=0`
- [ ] é…ç½® DNF/YUM ä»“åº“ (`/etc/yum.repos.d/`)
- [ ] ä½¿ç”¨ `rpm --import` å¯¼å…¥ GPG å¯†é’¥
- [ ] ä½¿ç”¨ `rpm --checksig` éªŒè¯è½¯ä»¶åŒ…ç­¾å
- [ ] é…ç½® APT ä»“åº“ï¼ˆä½¿ç”¨ç°ä»£ `signed-by` æ–¹æ³•ï¼‰
- [ ] å°† GPG å¯†é’¥æ”¾åœ¨ `/etc/apt/keyrings/` ç›®å½•
- [ ] æ·»åŠ  EPEL ä»“åº“
- [ ] é…ç½®ä»“åº“ä¼˜å…ˆçº§
- [ ] ç†è§£ä¼ä¸šç¯å¢ƒçš„é•œåƒé…ç½®éœ€æ±‚
- [ ] é¿å…ä½¿ç”¨å·²å¼ƒç”¨çš„ `apt-key`

---

## æœ¬è¯¾å°ç»“

| æ¦‚å¿µ | RPM/DNF | DEB/APT | è®°å¿†ç‚¹ |
|------|---------|---------|--------|
| ä»“åº“é…ç½®ç›®å½• | `/etc/yum.repos.d/` | `/etc/apt/sources.list.d/` | æ¯ä¸ªä»“åº“å•ç‹¬æ–‡ä»¶ |
| GPG å¯†é’¥ä½ç½® | `/etc/pki/rpm-gpg/` | `/etc/apt/keyrings/` | æ–°ç‰ˆ APT æ¨è |
| å¯¼å…¥å¯†é’¥ | `rpm --import` | `gpg --dearmor` | APT éœ€è¦è½¬æ¢æ ¼å¼ |
| éªŒè¯ç­¾å | `rpm --checksig` | APT è‡ªåŠ¨éªŒè¯ | ç¡®ä¿åŒ…æœªè¢«ç¯¡æ”¹ |
| å¯ç”¨ç­¾åæ£€æŸ¥ | `gpgcheck=1` | `signed-by=` | **å¿…é¡»å¯ç”¨** |
| ä»“åº“ä¼˜å…ˆçº§ | `priority=10` | `Pin-Priority:` | æ§åˆ¶ç‰ˆæœ¬é€‰æ‹© |
| æ¸…é™¤ç¼“å­˜ | `dnf clean all` | `apt clean` | æ›´æ–°é…ç½®åæ‰§è¡Œ |

---

## å®‰å…¨è¦ç‚¹é€ŸæŸ¥

| æ“ä½œ | æ­£ç¡®åšæ³• | é”™è¯¯åšæ³• | é£é™© |
|------|----------|----------|------|
| GPG æ£€æŸ¥ | `gpgcheck=1` | `gpgcheck=0` | CRITICAL |
| HTTPS éªŒè¯ | `sslverify=1` | `sslverify=0` | HIGH |
| æ·»åŠ ä»“åº“ | ä½¿ç”¨å®˜æ–¹æº | éšæœºç¬¬ä¸‰æ–¹æº | HIGH |
| APT å¯†é’¥ | `signed-by=` | `apt-key add` | MEDIUM |
| ä»“åº“æ¥æº | éªŒè¯åæ·»åŠ  | ç›´æ¥æ‰§è¡Œè„šæœ¬ | HIGH |

---

## å»¶ä¼¸é˜…è¯»

- [DNF Documentation](https://dnf.readthedocs.io/)
- [Debian Repository Format](https://wiki.debian.org/DebianRepository/Format)
- [APT Secure](https://wiki.debian.org/SecureApt)
- [Red Hat: Signing RPM Packages](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/packaging_and_distributing_software/signing-packages_packaging-software)
- ä¸Šä¸€è¯¾ï¼š[10 - è½¯ä»¶åŒ…ç®¡ç† (DEB/APT)](../10-package-management-deb-apt/) -- Debian ç³»è½¯ä»¶åŒ…ç®¡ç†
- ä¸‹ä¸€è¯¾ï¼š[12 - ç»¼åˆå®æˆ˜ï¼šå¤šç”¨æˆ·ç¯å¢ƒ](../12-capstone-multiuser-environment/) -- è¯¾ç¨‹ç»¼åˆé¡¹ç›®
- ç›¸å…³è¯¾ç¨‹ï¼š[09 - è½¯ä»¶åŒ…ç®¡ç† (RPM/DNF)](../09-package-management-rpm-dnf/) -- RPM åŸºç¡€çŸ¥è¯†

---

## ç³»åˆ—å¯¼èˆª

[<-- 10 - è½¯ä»¶åŒ…ç®¡ç† (DEB/APT)](../10-package-management-deb-apt/) | [ç³»åˆ—é¦–é¡µ](../) | [12 - ç»¼åˆå®æˆ˜ï¼šå¤šç”¨æˆ·ç¯å¢ƒ -->](../12-capstone-multiuser-environment/)
