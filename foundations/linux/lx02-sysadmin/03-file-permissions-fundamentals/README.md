# 03 Â· æ–‡ä»¶æƒé™åŸºç¡€ï¼ˆFile Permissions Fundamentalsï¼‰

> **ç›®æ ‡**ï¼šæŒæ¡ Linux æƒé™æ¨¡å‹ï¼Œå­¦ä¼šæ­£ç¡®è®¾ç½®æ–‡ä»¶å’Œç›®å½•æƒé™  
> **å‰ç½®**ï¼šå®Œæˆ Lesson 01-02ï¼ˆç”¨æˆ·ä¸ç”¨æˆ·ç»„ç®¡ç†ï¼‰  
> **æ—¶é—´**ï¼šâš¡ 30 åˆ†é’Ÿï¼ˆé€Ÿè¯»ï¼‰/ ğŸ”¬ 120 åˆ†é’Ÿï¼ˆå®Œæ•´å®æ“ï¼‰  
> **å®æˆ˜åœºæ™¯**ï¼šå›¢é˜Ÿåä½œç›®å½•é…ç½®ã€å®‰å…¨æƒé™å®¡è®¡  

---

## å°†å­¦åˆ°çš„å†…å®¹

1. ç†è§£ Linux æƒé™æ¨¡å‹ï¼ˆowner, group, othersï¼‰
2. è¯»æ‡‚æƒé™å­—ç¬¦ä¸²ï¼ˆrwxrwxrwxï¼‰å’Œå…«è¿›åˆ¶è¡¨ç¤º
3. ä½¿ç”¨ chmod ä¿®æ”¹æƒé™ï¼ˆç¬¦å·æ¨¡å¼å’Œæ•°å­—æ¨¡å¼ï¼‰
4. ä½¿ç”¨ chown/chgrp æ›´æ”¹æ–‡ä»¶æ‰€æœ‰æƒ
5. ç†è§£ umask å¯¹æ–°å»ºæ–‡ä»¶çš„å½±å“
6. **é¿å…è‡´å‘½é”™è¯¯**ï¼šä¸ºä»€ä¹ˆ `chmod 777` æ˜¯å®‰å…¨ç¾éš¾

---

## å…ˆè·‘èµ·æ¥ï¼ï¼ˆ5 åˆ†é’Ÿï¼‰

> åœ¨å­¦ä¹ ç†è®ºä¹‹å‰ï¼Œå…ˆä½“éªŒæƒé™æ§åˆ¶çš„å¨åŠ›ã€‚  
> è¿è¡Œè¿™äº›å‘½ä»¤ï¼Œè§‚å¯Ÿè¾“å‡º â€” è¿™å°±æ˜¯ä½ å°†è¦æŒæ¡çš„æŠ€èƒ½ã€‚  

```bash
# åˆ›å»ºç»ƒä¹ ç›®å½•
mkdir -p ~/perm-lab && cd ~/perm-lab

# åˆ›å»ºä¸€ä¸ªæµ‹è¯•æ–‡ä»¶
echo "æœºå¯†æ•°æ®" > secret.txt

# æŸ¥çœ‹å½“å‰æƒé™
ls -l secret.txt
# è¾“å‡ºç±»ä¼¼: -rw-r--r-- 1 youruser youruser 13 Jan  4 10:00 secret.txt

# å»æ‰å…¶ä»–ç”¨æˆ·çš„è¯»å–æƒé™
chmod o-r secret.txt
ls -l secret.txt
# è¾“å‡º: -rw-r----- 1 youruser youruser 13 Jan  4 10:00 secret.txt

# è®©æ–‡ä»¶åªæœ‰è‡ªå·±èƒ½è¯»å†™
chmod 600 secret.txt
ls -l secret.txt
# è¾“å‡º: -rw------- 1 youruser youruser 13 Jan  4 10:00 secret.txt

# åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œä½“éªŒç›®å½•æƒé™
mkdir testdir
ls -ld testdir
# è¾“å‡º: drwxr-xr-x 2 youruser youruser 64 Jan  4 10:00 testdir
```

**ä½ åˆšåˆšæ§åˆ¶äº†è°èƒ½è®¿é—®ä½ çš„æ–‡ä»¶ï¼**

è¿™å°±æ˜¯ Linux å®‰å…¨çš„åŸºçŸ³ï¼š**ç²¾ç¡®æ§åˆ¶æ¯ä¸ªæ–‡ä»¶çš„è®¿é—®æƒé™**ã€‚

ç°åœ¨è®©æˆ‘ä»¬ç†è§£èƒŒåçš„åŸç†ã€‚

---

## Step 1 â€” æƒé™æ¨¡å‹ï¼šè°èƒ½åšä»€ä¹ˆï¼ˆ15 åˆ†é’Ÿï¼‰

### 1.1 ä¸‰ç±»ç”¨æˆ·ï¼Œä¸‰ç§æƒé™

Linux å°†è®¿é—®è€…åˆ†ä¸ºä¸‰ç±»ï¼Œæ¯ç±»æœ‰ä¸‰ç§æ“ä½œæƒé™ï¼š

![Linux Permission Model](images/permission-model.png)

<details>
<summary>View ASCII source</summary>

```
Linux æƒé™æ¨¡å‹ (Permission Model)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚         æ–‡ä»¶ (File)              â”‚
                        â”‚         secret.txt              â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                              â”‚                              â”‚
        â–¼                              â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Owner (u)   â”‚            â”‚   Group (g)   â”‚            â”‚  Others (o)   â”‚
â”‚   æ–‡ä»¶æ‰€æœ‰è€…   â”‚            â”‚   æ‰€å±ç”¨æˆ·ç»„   â”‚            â”‚   å…¶ä»–ç”¨æˆ·    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  r  w  x      â”‚            â”‚  r  w  x      â”‚            â”‚  r  w  x      â”‚
â”‚  è¯» å†™ æ‰§è¡Œ    â”‚            â”‚  è¯» å†™ æ‰§è¡Œ    â”‚            â”‚  è¯» å†™ æ‰§è¡Œ    â”‚
â”‚  4  2  1      â”‚            â”‚  4  2  1      â”‚            â”‚  4  2  1      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æƒé™å­—ç¬¦ä¸²è§£è¯»:
-rw-r--r--  â†’  ç±»å‹ | owneræƒé™ | groupæƒé™ | othersæƒé™
 â”‚â””â”¬â”˜â””â”¬â”˜â””â”¬â”˜
 â”‚ â”‚  â”‚  â””â”€â”€ others: r-- (åªè¯»)
 â”‚ â”‚  â””â”€â”€â”€â”€â”€ group:  r-- (åªè¯»)
 â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€ owner:  rw- (è¯»å†™)
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ–‡ä»¶ç±»å‹: - (æ™®é€šæ–‡ä»¶)

å…«è¿›åˆ¶æ¢ç®—:
r = 4    w = 2    x = 1
rw- = 4+2+0 = 6
r-- = 4+0+0 = 4
r-x = 4+0+1 = 5

å¸¸è§æƒé™ç»„åˆ:
644 = rw-r--r--  (æ™®é€šæ–‡ä»¶é»˜è®¤)
755 = rwxr-xr-x  (ç›®å½•/å¯æ‰§è¡Œæ–‡ä»¶)
600 = rw-------  (ç§å¯†æ–‡ä»¶)
700 = rwx------  (ç§å¯†ç›®å½•)
```

</details>

### 1.2 æƒé™å­—ç¬¦ä¸²è§£è¯»

```bash
# æŸ¥çœ‹è¯¦ç»†æƒé™
ls -l secret.txt
# -rw-r--r-- 1 alice developers 13 Jan  4 10:00 secret.txt
#  â”‚â””â”€â”€â”¬â”€â”€â”˜â”‚ â”‚  â”‚     â”‚
#  â”‚   â”‚   â”‚ â”‚  â”‚     â””â”€â”€ æ‰€å±ç»„ (group)
#  â”‚   â”‚   â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€ æ‰€æœ‰è€… (owner)
#  â”‚   â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ç¡¬é“¾æ¥æ•°
#  â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æƒé™ä½ (9ä¸ªå­—ç¬¦)
#  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ è¯¦è§ä¸‹è¡¨
#  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ–‡ä»¶ç±»å‹
```

**æ–‡ä»¶ç±»å‹æ ‡è¯†**ï¼š

| å­—ç¬¦ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `-` | æ™®é€šæ–‡ä»¶ | æ–‡æœ¬ã€äºŒè¿›åˆ¶ã€è„šæœ¬ç­‰ |
| `d` | ç›®å½• | directory |
| `l` | ç¬¦å·é“¾æ¥ | symbolic link |
| `b` | å—è®¾å¤‡ | ç£ç›˜ç­‰ |
| `c` | å­—ç¬¦è®¾å¤‡ | ç»ˆç«¯ç­‰ |

### 1.3 rwx åœ¨æ–‡ä»¶å’Œç›®å½•ä¸Šçš„åŒºåˆ«

è¿™æ˜¯**æœ€å®¹æ˜“æ··æ·†**çš„æ¦‚å¿µä¹‹ä¸€ï¼š

| æƒé™ | å¯¹æ–‡ä»¶ | å¯¹ç›®å½• |
|------|--------|--------|
| r (read) | è¯»å–å†…å®¹ | åˆ—å‡ºç›®å½•å†…å®¹ï¼ˆlsï¼‰ |
| w (write) | ä¿®æ”¹å†…å®¹ | åˆ›å»º/åˆ é™¤/é‡å‘½åæ–‡ä»¶ |
| x (execute) | æ‰§è¡Œç¨‹åº | **è¿›å…¥ç›®å½•**ï¼ˆcdï¼‰ |

**é‡è¦**ï¼šç›®å½•çš„ `x` æƒé™æ˜¯**è®¿é—®**ç›®å½•çš„é’¥åŒ™ï¼

```bash
# å®éªŒï¼šç›®å½•æƒé™çš„å½±å“
mkdir testdir
touch testdir/file.txt

# å»æ‰ç›®å½•çš„ x æƒé™
chmod a-x testdir

# å°è¯•è¿›å…¥ç›®å½• â€” å¤±è´¥ï¼
cd testdir
# bash: cd: testdir: Permission denied

# å°è¯•åˆ—å‡ºå†…å®¹ â€” ä¹Ÿå¤±è´¥ï¼ï¼ˆæœ‰ r ä½†æ²¡æœ‰ xï¼‰
ls testdir
# ls: cannot access 'testdir': Permission denied

# æ¢å¤ x æƒé™
chmod a+x testdir
cd testdir  # ç°åœ¨å¯ä»¥äº†
```

### 1.4 è®°å¿†å£è¯€

```
æ–‡ä»¶ rwxï¼šè¯»å†…å®¹ã€æ”¹å†…å®¹ã€è·‘ç¨‹åº
ç›®å½• rwxï¼šçœ‹æ¸…å•ã€æ”¹æ–‡ä»¶ã€èƒ½è¿›é—¨ï¼ˆx = é—¨é’¥åŒ™ï¼‰
```

---

## Step 2 â€” chmodï¼šä¿®æ”¹æƒé™ï¼ˆ20 åˆ†é’Ÿï¼‰

### 2.1 ç¬¦å·æ¨¡å¼ï¼ˆSymbolic Modeï¼‰

ç¬¦å·æ¨¡å¼ç›´è§‚æ˜“è¯»ï¼Œé€‚åˆæ—¥å¸¸ä½¿ç”¨ï¼š

```bash
chmod [who][operator][permission] file

# who: u(owner), g(group), o(others), a(all)
# operator: +(æ·»åŠ ), -(ç§»é™¤), =(è®¾ç½®)
# permission: r, w, x
```

**å®æˆ˜ç¤ºä¾‹**ï¼š

```bash
cd ~/perm-lab

# åˆ›å»ºæµ‹è¯•æ–‡ä»¶
touch demo.sh
ls -l demo.sh
# -rw-r--r-- 1 youruser youruser 0 Jan  4 10:00 demo.sh

# ç»™æ‰€æœ‰è€…æ·»åŠ æ‰§è¡Œæƒé™
chmod u+x demo.sh
ls -l demo.sh
# -rwxr--r-- 1 youruser youruser 0 Jan  4 10:00 demo.sh

# ç§»é™¤å…¶ä»–ç”¨æˆ·çš„æ‰€æœ‰æƒé™
chmod o-rwx demo.sh
ls -l demo.sh
# -rwxr----- 1 youruser youruser 0 Jan  4 10:00 demo.sh

# ç»™ç»„æ·»åŠ å†™æƒé™
chmod g+w demo.sh
ls -l demo.sh
# -rwxrw---- 1 youruser youruser 0 Jan  4 10:00 demo.sh

# è®¾ç½®æ‰€æœ‰äººåªè¯»
chmod a=r demo.sh
ls -l demo.sh
# -r--r--r-- 1 youruser youruser 0 Jan  4 10:00 demo.sh

# å¤šä¸ªæ“ä½œç»„åˆ
chmod u+wx,g+x,o= demo.sh
ls -l demo.sh
# -rwxr-x--- 1 youruser youruser 0 Jan  4 10:00 demo.sh
```

### 2.2 å…«è¿›åˆ¶æ¨¡å¼ï¼ˆOctal Modeï¼‰

å…«è¿›åˆ¶æ¨¡å¼ç®€æ´é«˜æ•ˆï¼Œé€‚åˆè„šæœ¬å’Œå¿«é€Ÿè®¾ç½®ï¼š

```bash
# æ¯ä½æ•°å­— = r(4) + w(2) + x(1)
chmod 755 file  # rwxr-xr-x
chmod 644 file  # rw-r--r--
chmod 600 file  # rw-------
chmod 700 dir   # rwx------
```

**å¸¸ç”¨æƒé™ç»„åˆé€ŸæŸ¥**ï¼š

| å…«è¿›åˆ¶ | æƒé™å­—ç¬¦ | å…¸å‹ç”¨é€” |
|--------|----------|----------|
| 755 | rwxr-xr-x | ç›®å½•ã€å¯æ‰§è¡Œè„šæœ¬ |
| 644 | rw-r--r-- | æ™®é€šæ–‡ä»¶ã€é…ç½®æ–‡ä»¶ |
| 600 | rw------- | ç§å¯†æ–‡ä»¶ï¼ˆSSH å¯†é’¥ï¼‰ |
| 700 | rwx------ | ç§å¯†ç›®å½• |
| 640 | rw-r----- | ç»„å†…å…±äº«æ–‡ä»¶ |
| 750 | rwxr-x--- | ç»„å†…å…±äº«ç›®å½• |
| 444 | r--r--r-- | åªè¯»æ–‡ä»¶ |

### 2.3 é€’å½’ä¿®æ”¹ï¼ˆ-R å‚æ•°ï¼‰

```bash
# é€’å½’ä¿®æ”¹ç›®å½•åŠå…¶æ‰€æœ‰å†…å®¹
chmod -R 755 /path/to/dir

# ä½†æ˜¯ï¼è¿™ä¼šæŠŠæ–‡ä»¶ä¹Ÿè®¾æˆå¯æ‰§è¡Œ â€” é€šå¸¸ä¸æ˜¯ä½ æƒ³è¦çš„
# æ­£ç¡®åšæ³•ï¼šåˆ†åˆ«è®¾ç½®ç›®å½•å’Œæ–‡ä»¶
find /path/to/dir -type d -exec chmod 755 {} \;
find /path/to/dir -type f -exec chmod 644 {} \;
```

---

## Step 3 â€” chown å’Œ chgrpï¼šæ›´æ”¹æ‰€æœ‰æƒï¼ˆ15 åˆ†é’Ÿï¼‰

### 3.1 chown åŸºç¡€

```bash
# åˆ‡æ¢åˆ° rootï¼ˆéœ€è¦ sudoï¼‰
# æ›´æ”¹æ–‡ä»¶æ‰€æœ‰è€…
sudo chown newuser file.txt

# åŒæ—¶æ›´æ”¹æ‰€æœ‰è€…å’Œç»„
sudo chown newuser:newgroup file.txt
# æˆ–ä½¿ç”¨ç‚¹å·ï¼ˆæ—§è¯­æ³•ï¼Œä¸æ¨èï¼‰
sudo chown newuser.newgroup file.txt

# åªæ›´æ”¹ç»„ï¼ˆçœç•¥ç”¨æˆ·åï¼‰
sudo chown :newgroup file.txt

# é€’å½’æ›´æ”¹ç›®å½•
sudo chown -R newuser:newgroup /path/to/dir
```

### 3.2 chgrpï¼šå•ç‹¬æ›´æ”¹ç»„

```bash
# æ›´æ”¹æ–‡ä»¶æ‰€å±ç»„
sudo chgrp developers file.txt

# é€’å½’æ›´æ”¹
sudo chgrp -R developers /path/to/dir

# æ™®é€šç”¨æˆ·åªèƒ½æ”¹æˆè‡ªå·±æ‰€å±çš„ç»„
groups  # æŸ¥çœ‹è‡ªå·±çš„ç»„
chgrp mygroup file.txt  # åªèƒ½æ”¹æˆè‡ªå·±æ‰€å±çš„ç»„
```

### 3.3 å®æˆ˜ï¼šå›¢é˜Ÿåä½œç›®å½•

```bash
# åœºæ™¯ï¼šåˆ›å»ºä¸€ä¸ª devteam ç»„çš„å…±äº«ç›®å½•

# 1. åˆ›å»ºç›®å½•
sudo mkdir /opt/project

# 2. åˆ›å»ºç»„ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
sudo groupadd devteam

# 3. è®¾ç½®ç›®å½•æ‰€æœ‰æƒ
sudo chown root:devteam /opt/project

# 4. è®¾ç½®æƒé™ï¼šç»„æˆå‘˜å¯è¯»å†™æ‰§è¡Œ
sudo chmod 775 /opt/project

# 5. éªŒè¯
ls -ld /opt/project
# drwxrwxr-x 2 root devteam 64 Jan  4 10:00 /opt/project

# 6. æŠŠç”¨æˆ·åŠ å…¥ç»„
sudo usermod -aG devteam alice
sudo usermod -aG devteam bob

# 7. ç”¨æˆ·éœ€è¦é‡æ–°ç™»å½•æ‰èƒ½ç”Ÿæ•ˆ
# æˆ–ä½¿ç”¨ newgrp devteam
```

---

## Step 4 â€” umaskï¼šæ§åˆ¶é»˜è®¤æƒé™ï¼ˆ15 åˆ†é’Ÿï¼‰

### 4.1 umask æ˜¯ä»€ä¹ˆï¼Ÿ

`umask` æ˜¯ä¸€ä¸ª**æ©ç **ï¼Œå†³å®šæ–°å»ºæ–‡ä»¶å’Œç›®å½•çš„**é»˜è®¤æƒé™**ã€‚

```bash
# æŸ¥çœ‹å½“å‰ umask
umask
# è¾“å‡º: 0022 (å¸¸è§é»˜è®¤å€¼)

# ä»¥ç¬¦å·å½¢å¼æ˜¾ç¤º
umask -S
# è¾“å‡º: u=rwx,g=rx,o=rx
```

### 4.2 umask è®¡ç®—é€»è¾‘

```
æ–°æ–‡ä»¶æƒé™ = 666 - umask  (æ–‡ä»¶ä¸å¸¦æ‰§è¡Œæƒé™)
æ–°ç›®å½•æƒé™ = 777 - umask

umask = 0022 æ—¶ï¼š
- æ–°æ–‡ä»¶: 666 - 022 = 644 (rw-r--r--)
- æ–°ç›®å½•: 777 - 022 = 755 (rwxr-xr-x)

umask = 0077 æ—¶ï¼ˆæ›´å®‰å…¨ï¼‰ï¼š
- æ–°æ–‡ä»¶: 666 - 077 = 600 (rw-------)
- æ–°ç›®å½•: 777 - 077 = 700 (rwx------)
```

![umask Calculation](images/umask-calculation.png)

<details>
<summary>View ASCII source</summary>

```
umask æƒé™è®¡ç®— (Permission Calculation)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

é»˜è®¤æœ€å¤§æƒé™:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    æ–°æ–‡ä»¶        â”‚    æ–°ç›®å½•        â”‚
â”‚    666          â”‚    777          â”‚
â”‚  rw-rw-rw-      â”‚  rwxrwxrwx      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                 â”‚
         â”‚  å‡å» umask     â”‚
         â”‚                 â”‚
         â–¼                 â–¼
    umask = 022       umask = 022
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 0 2 2 â”‚         â”‚ 0 2 2 â”‚
    â”‚ --- -w- -w- â”‚   â”‚ --- -w- -w- â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                 â”‚
         â–¼                 â–¼
    æœ€ç»ˆæƒé™           æœ€ç»ˆæƒé™
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 6 4 4 â”‚         â”‚ 7 5 5 â”‚
    â”‚ rw-r--r-- â”‚     â”‚ rwxr-xr-x â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”˜

å¸¸è§ umask è®¾ç½®:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ umask   â”‚ æ–‡ä»¶æƒé™    â”‚ ç›®å½•æƒé™    â”‚ ä½¿ç”¨åœºæ™¯                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0022    â”‚ 644        â”‚ 755        â”‚ ç³»ç»Ÿé»˜è®¤ï¼ˆå¤šç”¨æˆ·å…±äº«ï¼‰    â”‚
â”‚ 0027    â”‚ 640        â”‚ 750        â”‚ ç»„å†…åä½œ                 â”‚
â”‚ 0077    â”‚ 600        â”‚ 700        â”‚ ç§å¯†ç¯å¢ƒï¼ˆæ¨èï¼‰         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

</details>

### 4.3 ä¸´æ—¶å’Œæ°¸ä¹…è®¾ç½® umask

```bash
# ä¸´æ—¶è®¾ç½®ï¼ˆåªå¯¹å½“å‰ shell æœ‰æ•ˆï¼‰
umask 0077

# éªŒè¯
touch secure_file
mkdir secure_dir
ls -l secure_file
# -rw------- 1 youruser youruser 0 Jan  4 10:00 secure_file
ls -ld secure_dir
# drwx------ 2 youruser youruser 64 Jan  4 10:00 secure_dir

# æ°¸ä¹…è®¾ç½® â€” æ·»åŠ åˆ° ~/.bashrc æˆ– ~/.profile
echo "umask 0077" >> ~/.bashrc

# ç³»ç»Ÿçº§è®¾ç½®ï¼ˆå½±å“æ‰€æœ‰ç”¨æˆ·ï¼‰
# ç¼–è¾‘ /etc/profile æˆ– /etc/login.defs
```

### 4.4 å®æˆ˜ç»ƒä¹ ï¼šè§‚å¯Ÿ umask æ•ˆæœ

```bash
cd ~/perm-lab

# å½“å‰ umask
umask
# å‡è®¾è¾“å‡º 0022

# åˆ›å»ºæ–‡ä»¶å’Œç›®å½•
touch file1
mkdir dir1
ls -l file1
# -rw-r--r-- (644)
ls -ld dir1
# drwxr-xr-x (755)

# æ›´æ”¹ umask
umask 0077

# å†åˆ›å»º
touch file2
mkdir dir2
ls -l file2
# -rw------- (600)
ls -ld dir2
# drwx------ (700)

# æ¢å¤é»˜è®¤
umask 0022
```

---

## Step 5 â€” åŠ¨æ‰‹å®éªŒï¼šæƒé™åœºæ™¯å®æˆ˜ï¼ˆ25 åˆ†é’Ÿï¼‰

### 5.1 åœºæ™¯ Aï¼šä¿æŠ¤ SSH å¯†é’¥

SSH å¯†é’¥æƒé™**å¿…é¡»**æ­£ç¡®è®¾ç½®ï¼Œå¦åˆ™ SSH ä¼šæ‹’ç»ä½¿ç”¨ï¼š

```bash
# åˆ›å»ºæ¨¡æ‹Ÿ SSH ç›®å½•
mkdir -p ~/.ssh-test
touch ~/.ssh-test/id_rsa
touch ~/.ssh-test/id_rsa.pub

# é”™è¯¯çš„æƒé™ï¼ˆå¤ªå¼€æ”¾ï¼‰
chmod 644 ~/.ssh-test/id_rsa

# SSH ä¼šæŠ¥é”™:
# WARNING: UNPROTECTED PRIVATE KEY FILE!
# Permissions 0644 for 'id_rsa' are too open.

# æ­£ç¡®çš„æƒé™
chmod 700 ~/.ssh-test        # ç›®å½•åªæœ‰æ‰€æœ‰è€…èƒ½è®¿é—®
chmod 600 ~/.ssh-test/id_rsa     # ç§é’¥åªæœ‰æ‰€æœ‰è€…èƒ½è¯»å†™
chmod 644 ~/.ssh-test/id_rsa.pub # å…¬é’¥å¯ä»¥å…¬å¼€

# éªŒè¯
ls -la ~/.ssh-test/
```

### 5.2 åœºæ™¯ Bï¼šWeb æœåŠ¡å™¨ç›®å½•

```bash
# æ¨¡æ‹Ÿ Web ç›®å½•ç»“æ„
sudo mkdir -p /var/www/mysite
sudo touch /var/www/mysite/index.html
sudo mkdir /var/www/mysite/uploads

# è®¾ç½®æ‰€æœ‰æƒï¼ˆWeb æœåŠ¡å™¨ç”¨æˆ·é€šå¸¸æ˜¯ www-data æˆ– nginxï¼‰
sudo chown -R www-data:www-data /var/www/mysite

# ç›®å½•æƒé™ï¼š755ï¼ˆWeb æœåŠ¡å™¨éœ€è¦è¿›å…¥å’Œåˆ—å‡ºï¼‰
sudo chmod 755 /var/www/mysite

# æ–‡ä»¶æƒé™ï¼š644ï¼ˆWeb æœåŠ¡å™¨éœ€è¦è¯»å–ï¼‰
sudo chmod 644 /var/www/mysite/index.html

# uploads ç›®å½•éœ€è¦å†™æƒé™ï¼ˆä½†ä¸æ˜¯ 777ï¼ï¼‰
sudo chmod 755 /var/www/mysite/uploads

# éªŒè¯
ls -laR /var/www/mysite/
```

### 5.3 åœºæ™¯ Cï¼šå›¢é˜Ÿå…±äº«å¼€å‘ç›®å½•

```bash
# åˆ›å»ºå¼€å‘å›¢é˜Ÿå…±äº«ç›®å½•
sudo mkdir /opt/dev-project
sudo groupadd devs 2>/dev/null  # å¦‚æœç»„ä¸å­˜åœ¨åˆ™åˆ›å»º
sudo chown :devs /opt/dev-project
sudo chmod 775 /opt/dev-project

# æŠŠå½“å‰ç”¨æˆ·åŠ å…¥ç»„
sudo usermod -aG devs $USER

# åˆ‡æ¢ç»„ï¼ˆä¸ç”¨é‡æ–°ç™»å½•ï¼‰
newgrp devs

# åˆ›å»ºæ–‡ä»¶æµ‹è¯•
touch /opt/dev-project/mycode.py
ls -l /opt/dev-project/
# æ³¨æ„ï¼šæ–°æ–‡ä»¶çš„ç»„å¯èƒ½æ˜¯ä¸ªäººç»„ï¼Œè€Œä¸æ˜¯ devs
# è§£å†³æ–¹æ¡ˆè§ Lesson 04ï¼ˆSGIDï¼‰
```

---

## åæ¨¡å¼ï¼šè‡´å‘½çš„æƒé™é”™è¯¯

### åæ¨¡å¼ 1ï¼šchmod 777ï¼ˆä¸–ç•Œå¯å†™ï¼‰

```bash
# æåº¦å±é™©ï¼
chmod 777 file.txt    # ä»»ä½•äººéƒ½èƒ½ä¿®æ”¹/åˆ é™¤
chmod 777 /var/www/   # ä»»ä½•äººéƒ½èƒ½ä¿®æ”¹ç½‘ç«™æ–‡ä»¶
```

**ä¸ºä»€ä¹ˆæ˜¯å®‰å…¨ç¾éš¾ï¼Ÿ**

1. **ä»»ä½•ç”¨æˆ·éƒ½èƒ½ä¿®æ”¹/åˆ é™¤** â€” æ¶æ„ç”¨æˆ·ã€è¢«å…¥ä¾µçš„è¿›ç¨‹
2. **æ”»å‡»è€…å¯ä»¥æ³¨å…¥æ¶æ„ä»£ç ** â€” ä¿®æ”¹è„šæœ¬ã€æ¤å…¥åé—¨
3. **æ— æ³•è¿½æº¯è´£ä»»** â€” æ‰€æœ‰äººéƒ½æœ‰æƒé™
4. **è¿åæœ€å°æƒé™åŸåˆ™** â€” å®‰å…¨çš„åŸºæœ¬åŸåˆ™

**æ­£ç¡®åšæ³•**ï¼š

```bash
# åˆ†æéœ€æ±‚ï¼Œç»™æœ€å°å¿…è¦æƒé™
chmod 755 /var/www/           # ç›®å½•ï¼šæ‰€æœ‰è€…è¯»å†™æ‰§è¡Œï¼Œå…¶ä»–äººåªè¯»
chmod 644 /var/www/index.html # æ–‡ä»¶ï¼šæ‰€æœ‰è€…è¯»å†™ï¼Œå…¶ä»–äººåªè¯»
```

### åæ¨¡å¼ 2ï¼šchmod -R 777 /ï¼ˆç³»ç»Ÿçº§ç¾éš¾ï¼‰

```bash
# ç»å¯¹ä¸è¦è¿è¡Œï¼
sudo chmod -R 777 /        # ç ´åæ•´ä¸ªç³»ç»Ÿ
sudo chmod -R 777 /etc     # ç ´åç³»ç»Ÿé…ç½®
sudo chmod -R 777 /var     # ç ´åæ—¥å¿—å’Œæ•°æ®
```

**åæœ**ï¼š

1. **ç³»ç»Ÿå¯èƒ½æ— æ³•å¯åŠ¨** â€” æŸäº›æ–‡ä»¶è¦æ±‚ç‰¹å®šæƒé™
2. **SSH æ‹’ç»å·¥ä½œ** â€” SSH è¦æ±‚å¯†é’¥æƒé™ä¸¥æ ¼
3. **å®‰å…¨å®¡è®¡å¤±è´¥** â€” è¿åæ‰€æœ‰å®‰å…¨åˆè§„æ ‡å‡†
4. **å¯èƒ½éœ€è¦é‡è£…ç³»ç»Ÿ** â€” æ¢å¤æˆæœ¬æé«˜

**å¦‚æœä½ ä¸å°å¿ƒè¿è¡Œäº†**ï¼š

```bash
# ç«‹å³åœæ­¢ï¼
# è€ƒè™‘ä»å¤‡ä»½æ¢å¤
# æˆ–ä½¿ç”¨å®‰è£…ç›˜è¿›å…¥æ•‘æ´æ¨¡å¼

# ä¸´æ—¶æ•‘æ€¥ï¼ˆå¯èƒ½éƒ¨åˆ†æ¢å¤ï¼‰
# éœ€è¦æ ¹æ®å‘è¡Œç‰ˆæŸ¥æ‰¾æ­£ç¡®æƒé™
```

### åæ¨¡å¼ 3ï¼šå¿½ç•¥ç›®å½•çš„ x æƒé™

```bash
# é”™è¯¯ï¼šç»™ç›®å½•è®¾ç½® 644
chmod 644 mydir/
# ç»“æœï¼šæ— æ³•è¿›å…¥ç›®å½•ï¼

ls mydir/
# ls: cannot access 'mydir': Permission denied

cd mydir/
# bash: cd: mydir: Permission denied

# æ­£ç¡®ï¼šç›®å½•å¿…é¡»æœ‰ x æƒé™æ‰èƒ½è¿›å…¥
chmod 755 mydir/
```

### åæ¨¡å¼ 4ï¼šå¿˜è®°é€’å½’è®¾ç½®å­ç›®å½•

```bash
# åªè®¾ç½®äº†é¡¶å±‚ç›®å½•
chmod 750 /opt/project

# ä½†å­ç›®å½•ä»ç„¶æ˜¯ 777
ls -la /opt/project/
# drwxrwxrwx  subdir/  # å±é™©ï¼

# æ­£ç¡®ï¼šé€’å½’è®¾ç½®
chmod -R 750 /opt/project/

# æ›´å¥½ï¼šåˆ†åˆ«è®¾ç½®ç›®å½•å’Œæ–‡ä»¶
find /opt/project -type d -exec chmod 750 {} \;
find /opt/project -type f -exec chmod 640 {} \;
```

---

## èŒåœºå°è´´å£«ï¼ˆJapan IT Contextï¼‰

### æƒé™ç®¡ç†åœ¨æ—¥æœ¬ IT èŒåœº

åœ¨æ—¥æœ¬çš„ IT è¿ç»´ç°åœºï¼Œæƒé™ç®¡ç†æœ‰ä¸¥æ ¼çš„è§„èŒƒï¼š

| æ—¥è¯­æœ¯è¯­ | å«ä¹‰ | å®è·µè¦ç‚¹ |
|----------|------|----------|
| æ¨©é™å¤‰æ›´å±¥æ­´ï¼ˆã‘ã‚“ã’ã‚“ã¸ã‚“ã“ã†ã‚Šã‚Œãï¼‰ | æƒé™å˜æ›´è®°å½• | æ¯æ¬¡ chmod/chown éƒ½è¦è®°å½• |
| æœ€å°æ¨©é™ã®åŸå‰‡ï¼ˆã•ã„ã—ã‚‡ã†ã‘ã‚“ã’ã‚“ã®ã’ã‚“ããï¼‰ | æœ€å°æƒé™åŸåˆ™ | åªç»™å¿…è¦æƒé™ |
| å¤‰æ›´ç®¡ç†ï¼ˆã¸ã‚“ã“ã†ã‹ã‚“ã‚Šï¼‰ | å˜æ›´ç®¡ç† | æƒé™å˜æ›´éœ€è¦å®¡æ‰¹ |
| ç›£æŸ»å¯¾å¿œï¼ˆã‹ã‚“ã•ãŸã„ãŠã†ï¼‰ | å®¡è®¡åº”å¯¹ | ä¿ç•™å˜æ›´è¯æ® |

### å®é™…åœºæ™¯

**å…±äº«ç›®å½•è®¾ç½®ï¼ˆãƒãƒ¼ãƒ å…±æœ‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰**ï¼š

æ—¥æœ¬ä¼ä¸šå¸¸è§çš„å›¢é˜Ÿåä½œç›®å½•è®¾ç½®ï¼š

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
sudo mkdir /opt/projects/customer-a

# è®¾ç½®ç»„æ‰€æœ‰æƒ
sudo chown :dev-team /opt/projects/customer-a
sudo chmod 2775 /opt/projects/customer-a  # SGID ç¡®ä¿æ–°æ–‡ä»¶ç»§æ‰¿ç»„

# è®°å½•å˜æ›´ï¼ˆå¤‰æ›´å±¥æ­´ï¼‰
echo "$(date): Created /opt/projects/customer-a, owner=dev-team, mode=2775" >> /var/log/permission-changes.log
```

**æƒé™å˜æ›´ç”³è¯·ï¼ˆæ¨©é™å¤‰æ›´ç”³è«‹ï¼‰**ï¼š

åœ¨æ­£å¼ç¯å¢ƒä¸­ï¼Œæƒé™å˜æ›´é€šå¸¸éœ€è¦ï¼š

1. **ç”³è«‹æ›¸**ï¼ˆç”³è¯·å•ï¼‰â€” è¯´æ˜å˜æ›´ç†ç”±
2. **æ‰¿èª**ï¼ˆå®¡æ‰¹ï¼‰â€” ä¸Šçº§æˆ–å®‰å…¨å›¢é˜Ÿå®¡æ‰¹
3. **å®Ÿæ–½è¨˜éŒ²**ï¼ˆå®æ–½è®°å½•ï¼‰â€” è®°å½•æ‰§è¡Œå†…å®¹å’Œæ—¶é—´
4. **ç¢ºèª**ï¼ˆéªŒè¯ï¼‰â€” å˜æ›´åæ£€æŸ¥æ˜¯å¦æ­£ç¡®

```bash
# å˜æ›´å‰è®°å½•ç°çŠ¶
ls -la /path/to/file > /tmp/before_change.txt

# æ‰§è¡Œå˜æ›´
sudo chmod 640 /path/to/file

# å˜æ›´åè®°å½•
ls -la /path/to/file > /tmp/after_change.txt

# å¯¹æ¯”
diff /tmp/before_change.txt /tmp/after_change.txt
```

### å®‰å…¨å®¡è®¡è¦ç‚¹

æ—¥æœ¬ä¼ä¸šçš„å®‰å…¨å®¡è®¡ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ï¼‰ç»å¸¸æ£€æŸ¥ï¼š

```bash
# æŸ¥æ‰¾ world-writable æ–‡ä»¶ï¼ˆä»»ä½•äººå¯å†™ï¼‰
find / -type f -perm -o+w 2>/dev/null | head -20

# æŸ¥æ‰¾ world-writable ç›®å½•
find / -type d -perm -o+w 2>/dev/null | head -20

# æŸ¥æ‰¾æ²¡æœ‰æ‰€æœ‰è€…çš„æ–‡ä»¶
find / -nouser -o -nogroup 2>/dev/null | head -20
```

---

## æ£€æŸ¥æ¸…å•

å®Œæˆæœ¬è¯¾åï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

- [ ] è¯»æ‡‚ `ls -l` è¾“å‡ºçš„æƒé™å­—ç¬¦ä¸²ï¼ˆå¦‚ `drwxr-xr-x`ï¼‰
- [ ] è§£é‡Š ownerã€groupã€others ä¸‰ç±»ç”¨æˆ·çš„åŒºåˆ«
- [ ] è¯´æ˜ rã€wã€x åœ¨æ–‡ä»¶å’Œç›®å½•ä¸Šçš„ä¸åŒå«ä¹‰
- [ ] ä½¿ç”¨ chmod ç¬¦å·æ¨¡å¼ä¿®æ”¹æƒé™ï¼ˆå¦‚ `u+x`, `g-w`, `o=r`ï¼‰
- [ ] ä½¿ç”¨ chmod å…«è¿›åˆ¶æ¨¡å¼ä¿®æ”¹æƒé™ï¼ˆå¦‚ 755, 644, 600ï¼‰
- [ ] ä½¿ç”¨ chown å’Œ chgrp æ›´æ”¹æ–‡ä»¶æ‰€æœ‰æƒ
- [ ] è§£é‡Š umask å¦‚ä½•å½±å“æ–°å»ºæ–‡ä»¶çš„æƒé™
- [ ] è®¡ç®— umask å¯¹åº”çš„é»˜è®¤æ–‡ä»¶å’Œç›®å½•æƒé™
- [ ] è§£é‡Šä¸ºä»€ä¹ˆ `chmod 777` æ˜¯å®‰å…¨ç¾éš¾
- [ ] æ­£ç¡®è®¾ç½® SSH å¯†é’¥æ–‡ä»¶æƒé™ï¼ˆ600ï¼‰

---

## æœ¬è¯¾å°ç»“

| æ¦‚å¿µ | å‘½ä»¤/è¯­æ³• | è®°å¿†ç‚¹ |
|------|-----------|--------|
| æƒé™ä¸‰å…ƒç»„ | owner/group/others | è°æ‹¥æœ‰ã€åŒç»„ã€å…¶ä»– |
| æƒé™ä½ | r(4) w(2) x(1) | è¯»ã€å†™ã€æ‰§è¡Œ |
| ç›®å½•ç‰¹æ®Š | x = è¿›å…¥ç›®å½• | æ²¡æœ‰ x å°±æ˜¯é”ç€çš„é—¨ |
| ç¬¦å·æ¨¡å¼ | `chmod u+x file` | ç›´è§‚ï¼Œé€‚åˆäººè¯» |
| å…«è¿›åˆ¶æ¨¡å¼ | `chmod 755 file` | é«˜æ•ˆï¼Œé€‚åˆè„šæœ¬ |
| æ”¹æ‰€æœ‰è€… | `chown user:group file` | éœ€è¦ root æƒé™ |
| æ”¹ç»„ | `chgrp group file` | æ™®é€šç”¨æˆ·åªèƒ½æ”¹æˆè‡ªå·±çš„ç»„ |
| é»˜è®¤æƒé™ | umask | 666/777 å‡å» umask |
| å±é™©æ“ä½œ | `chmod 777` | **æ°¸è¿œä¸è¦ç”¨ï¼** |

---

## å»¶ä¼¸é˜…è¯»

- [chmod Manual](https://man7.org/linux/man-pages/man1/chmod.1.html)
- [Understanding Linux File Permissions](https://www.linux.com/training-tutorials/understanding-linux-file-permissions/)
- ä¸‹ä¸€è¯¾ï¼š[04 Â· ç‰¹æ®Šæƒé™ (SUID, SGID, Sticky Bit)](../04-special-permissions/) â€” å­¦ä¹ ç‰¹æ®Šæƒé™ä½
- ç›¸å…³è¯¾ç¨‹ï¼š[05 Â· ACL ä¸æ–‡ä»¶å±æ€§](../05-acls-file-attributes/) â€” æ›´ç»†ç²’åº¦çš„æƒé™æ§åˆ¶

---

## ç³»åˆ—å¯¼èˆª

[02 Â· å¯†ç ä¸è´¦æˆ·ç®¡ç† â†](../02-password-account-management/) | [ç³»åˆ—é¦–é¡µ](../) | [04 Â· ç‰¹æ®Šæƒé™ â†’](../04-special-permissions/)
