# 01 Â· ç®¡é“å’Œé‡å®šå‘ï¼ˆPipes and Redirectionï¼‰

> **ç›®æ ‡**ï¼šæŒæ¡ Unix æ•°æ®æµæ§åˆ¶ï¼Œå­¦ä¼šç”¨ç®¡é“è¿æ¥å‘½ä»¤ 
> **å‰ç½®**ï¼šåŸºç¡€ Linux å‘½ä»¤è¡Œæ“ä½œï¼ˆcd, ls, catï¼‰ 
> **æ—¶é—´**ï¼šâš¡ 20 åˆ†é’Ÿï¼ˆé€Ÿè¯»ï¼‰/ ğŸ”¬ 75 åˆ†é’Ÿï¼ˆå®Œæ•´å®æ“ï¼‰ 
> **å®æˆ˜åœºæ™¯**ï¼šæ—¥å¿—ç›‘æ§ä¸æ•°æ®æµåˆ†æµ  

---

## å°†å­¦åˆ°çš„å†…å®¹

1. ç†è§£æ ‡å‡†è¾“å…¥/è¾“å‡º/é”™è¯¯ï¼ˆstdin, stdout, stderrï¼‰
2. æŒæ¡é‡å®šå‘æ“ä½œç¬¦ï¼ˆ>, >>, <, 2>, &>ï¼‰
3. ä½¿ç”¨ç®¡é“ï¼ˆ|ï¼‰è¿æ¥å‘½ä»¤
4. ä½¿ç”¨ tee åˆ†æµè¾“å‡º

---

## å…ˆè·‘èµ·æ¥ï¼ï¼ˆ5 åˆ†é’Ÿï¼‰

> åœ¨å­¦ä¹ ç†è®ºä¹‹å‰ï¼Œå…ˆä½“éªŒå‘½ä»¤ç»„åˆçš„å¨åŠ›ã€‚  
> è¿è¡Œè¿™äº›å‘½ä»¤ï¼Œè§‚å¯Ÿè¾“å‡º â€” è¿™å°±æ˜¯ä½ å°†è¦æŒæ¡çš„æŠ€èƒ½ã€‚  

```bash
# æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—å‰ 5 è¡Œ
cat /var/log/syslog | head -5
# å¦‚æœæ²¡æœ‰ syslogï¼Œç”¨ dmesg ä»£æ›¿
dmesg | head -5

# ç­›é€‰å†…æ ¸é”™è¯¯æ¶ˆæ¯
dmesg | grep -i error | tail -10

# æŸ¥æ‰¾ SSH ç›¸å…³è¿›ç¨‹
ps aux | grep ssh

# åˆ†æµè¾“å‡ºï¼šåŒæ—¶ä¿å­˜åˆ°æ–‡ä»¶ + è®¡æ•°
echo 'hello world' | tee /tmp/test.txt | wc -c
cat /tmp/test.txt
```

**ä½ åˆšåˆšç”¨ `|`ï¼ˆç®¡é“ï¼‰æŠŠå¤šä¸ªå‘½ä»¤è¿æ¥èµ·æ¥äº†ï¼**

è¿™å°±æ˜¯ Unix å“²å­¦ï¼š**å°å·¥å…· + ç»„åˆ = å¼ºå¤§åŠŸèƒ½**ã€‚

ç°åœ¨è®©æˆ‘ä»¬ç†è§£èƒŒåçš„åŸç†ã€‚

---

## Step 1 â€” æ ‡å‡†æµï¼šæ•°æ®çš„ä¸‰æ¡é€šé“ï¼ˆ10 åˆ†é’Ÿï¼‰

### 1.1 ä¸‰ä¸ªæµï¼Œä¸‰ä¸ªæ•°å­—

æ¯ä¸ª Linux è¿›ç¨‹å¯åŠ¨æ—¶éƒ½ä¼šæ‰“å¼€ä¸‰ä¸ªæ•°æ®é€šé“ï¼š

![Standard Streams](images/standard-streams.png)

<details>
<summary>View ASCII source</summary>

<!-- DIAGRAM: standard-streams -->
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         è¿›ç¨‹ (Process)                           â”‚
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚  stdin   â”‚â—€â”€â”€â”€â”€ é”®ç›˜/æ–‡ä»¶/ç®¡é“          â”‚     ä½ çš„ç¨‹åº      â”‚ â”‚
â”‚   â”‚   (0)    â”‚                              â”‚                  â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚   grep, awk,     â”‚ â”‚
â”‚                                             â”‚   sort, etc.     â”‚ â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚                  â”‚ â”‚
â”‚   â”‚  stdout  â”‚â”€â”€â”€â”€â–¶ å±å¹•/æ–‡ä»¶/ç®¡é“          â”‚                  â”‚ â”‚
â”‚   â”‚   (1)    â”‚      (æ­£å¸¸è¾“å‡º)              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚
â”‚   â”‚  stderr  â”‚â”€â”€â”€â”€â–¶ å±å¹•/æ–‡ä»¶               ï¼ˆé”™è¯¯ä¿¡æ¯ï¼‰         â”‚
â”‚   â”‚   (2)    â”‚                                                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
<!-- /DIAGRAM -->

</details>

| æµ | æ–‡ä»¶æè¿°ç¬¦ | é»˜è®¤æ–¹å‘ | ç”¨é€” |
|----|-----------|----------|------|
| stdin | 0 | é”®ç›˜è¾“å…¥ | æ¥æ”¶è¾“å…¥æ•°æ® |
| stdout | 1 | å±å¹•è¾“å‡º | æ­£å¸¸è¾“å‡ºç»“æœ |
| stderr | 2 | å±å¹•è¾“å‡º | é”™è¯¯å’Œè¯Šæ–­ä¿¡æ¯ |

### 1.2 ä¸ºä»€ä¹ˆåˆ†å¼€ stdout å’Œ stderrï¼Ÿ

```bash
# è¿™ä¸ªå‘½ä»¤åŒæ—¶äº§ç”Ÿæ­£å¸¸è¾“å‡ºå’Œé”™è¯¯
ls /home /nonexistent 2>/dev/null
```

è¿è¡Œç»“æœï¼š
- `/home` çš„å†…å®¹ â†’ stdoutï¼ˆæ˜¾ç¤ºåœ¨å±å¹•ï¼‰
- "No such file or directory" â†’ stderrï¼ˆè¢«ä¸¢å¼ƒåˆ° /dev/nullï¼‰

**åˆ†ç¦»çš„å¥½å¤„**ï¼šå¯ä»¥å•ç‹¬å¤„ç†æ­£å¸¸æ•°æ®å’Œé”™è¯¯ä¿¡æ¯ã€‚

---

## Step 2 â€” é‡å®šå‘ï¼šæ§åˆ¶æ•°æ®æµå‘ï¼ˆ15 åˆ†é’Ÿï¼‰

### 2.1 è¾“å‡ºé‡å®šå‘

```bash
# å‡†å¤‡ç»ƒä¹ ç›®å½•
mkdir -p ~/text-processing-lab
cd ~/text-processing-lab

# > è¦†ç›–å†™å…¥
echo "ç¬¬ä¸€è¡Œ" > output.txt
cat output.txt    # è¾“å‡º: ç¬¬ä¸€è¡Œ

# >> è¿½åŠ å†™å…¥
echo "ç¬¬äºŒè¡Œ" >> output.txt
cat output.txt    # è¾“å‡º: ç¬¬ä¸€è¡Œ ç¬¬äºŒè¡Œ

# è¦†ç›–ä¼šæ¸…ç©ºåŸå†…å®¹ï¼
echo "æ–°å†…å®¹" > output.txt
cat output.txt    # è¾“å‡º: æ–°å†…å®¹ ï¼ˆåŸå†…å®¹æ²¡äº†ï¼‰
```

### 2.2 é”™è¯¯é‡å®šå‘

```bash
# 2> é‡å®šå‘é”™è¯¯åˆ°æ–‡ä»¶
ls /nonexistent 2> error.log
cat error.log

# 2>> è¿½åŠ é”™è¯¯
ls /another-fake 2>> error.log

# ä¸¢å¼ƒé”™è¯¯ï¼ˆ/dev/null = é»‘æ´ï¼‰
ls /nonexistent 2>/dev/null
```

### 2.3 åŒæ—¶é‡å®šå‘ stdout å’Œ stderr

```bash
# æ–¹æ³• 1ï¼šåˆ†åˆ«é‡å®šå‘åˆ°ä¸åŒæ–‡ä»¶
ls /home /nonexistent > stdout.log 2> stderr.log

# æ–¹æ³• 2ï¼šåˆå¹¶åˆ°åŒä¸€æ–‡ä»¶
ls /home /nonexistent > combined.log 2>&1
# è§£é‡Šï¼šå…ˆæŠŠ stdout å®šå‘åˆ°æ–‡ä»¶ï¼Œå†æŠŠ stderr å®šå‘åˆ° stdout æ‰€åœ¨çš„ä½ç½®

# æ–¹æ³• 3ï¼šBash ç®€å†™ï¼ˆæ¨èï¼‰
ls /home /nonexistent &> combined.log
```

### 2.4 è¾“å…¥é‡å®šå‘

```bash
# ä»æ–‡ä»¶è¯»å–è¾“å…¥
echo -e "apple\nbanana\ncherry" > fruits.txt
sort < fruits.txt

# ä¸å‚æ•°çš„åŒºåˆ«
sort fruits.txt      # sort è‡ªå·±æ‰“å¼€æ–‡ä»¶
sort < fruits.txt    # shell æ‰“å¼€æ–‡ä»¶ï¼Œä¼ ç»™ sort çš„ stdin
# ç»“æœç›¸åŒï¼Œä½†æœºåˆ¶ä¸åŒ
```

### 2.5 é‡å®šå‘é€ŸæŸ¥è¡¨

| æ“ä½œç¬¦ | å«ä¹‰ | ç¤ºä¾‹ |
|--------|------|------|
| `>` | stdout è¦†ç›–å†™å…¥æ–‡ä»¶ | `ls > list.txt` |
| `>>` | stdout è¿½åŠ åˆ°æ–‡ä»¶ | `echo "log" >> app.log` |
| `<` | ä»æ–‡ä»¶è¯»å–åˆ° stdin | `sort < data.txt` |
| `2>` | stderr é‡å®šå‘åˆ°æ–‡ä»¶ | `cmd 2> error.log` |
| `2>>` | stderr è¿½åŠ åˆ°æ–‡ä»¶ | `cmd 2>> error.log` |
| `2>&1` | stderr åˆå¹¶åˆ° stdout | `cmd > all.log 2>&1` |
| `&>` | stdout+stderr åˆ°æ–‡ä»¶ï¼ˆBashï¼‰ | `cmd &> all.log` |
| `&>>` | stdout+stderr è¿½åŠ ï¼ˆBashï¼‰ | `cmd &>> all.log` |

---

## Step 3 â€” ç®¡é“ï¼šè¿æ¥å‘½ä»¤ï¼ˆ15 åˆ†é’Ÿï¼‰

### 3.1 ç®¡é“çš„æœ¬è´¨

ç®¡é“ `|` æŠŠå·¦è¾¹å‘½ä»¤çš„ **stdout** è¿æ¥åˆ°å³è¾¹å‘½ä»¤çš„ **stdin**ã€‚

![Pipe Mechanism](images/pipe-mechanism.png)

<details>
<summary>View ASCII source</summary>

<!-- DIAGRAM: pipe-mechanism -->
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  stdout    stdin  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  stdout    stdin  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‘½ä»¤ A   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”€â”€â”€â”€â”€â”€â”€â”€â”‚  å‘½ä»¤ B   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”€â”€â”€â”€â”€â”€â”€â”€â”‚  å‘½ä»¤ C   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¾‹å­ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   cat    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚   grep   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚   wc     â”‚
â”‚ file.log â”‚  å…¨éƒ¨å†…å®¹  â”‚ "ERROR"  â”‚  å«ERROR  â”‚   -l     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   çš„è¡Œ     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                  â–¼
                                              è¡Œæ•°ç»Ÿè®¡
```
<!-- /DIAGRAM -->

</details>

### 3.2 åŸºç¡€ç®¡é“ç¤ºä¾‹

```bash
# ç»Ÿè®¡å½“å‰ç›®å½•æ–‡ä»¶æ•°é‡
ls | wc -l

# æŸ¥æ‰¾ç‰¹å®šè¿›ç¨‹
ps aux | grep nginx

# æŒ‰å¤§å°æ’åºæ–‡ä»¶
ls -lS | head -10    # æœ€å¤§çš„ 10 ä¸ªæ–‡ä»¶

# ç»Ÿè®¡ç™»å½•ç”¨æˆ·
who | wc -l
```

### 3.3 ç®¡é“é“¾ï¼šå¤šçº§å¤„ç†

```bash
# åˆ›å»ºç¤ºä¾‹æ—¥å¿—
cat > access.log << 'EOF'
192.168.1.100 - - [01/Jan/2026:10:00:00] "GET /index.html" 200
192.168.1.101 - - [01/Jan/2026:10:00:01] "GET /api/users" 500
192.168.1.100 - - [01/Jan/2026:10:00:02] "POST /api/login" 200
192.168.1.102 - - [01/Jan/2026:10:00:03] "GET /api/data" 500
192.168.1.100 - - [01/Jan/2026:10:00:04] "GET /style.css" 200
192.168.1.103 - - [01/Jan/2026:10:00:05] "GET /api/users" 404
EOF

# ç»Ÿè®¡è®¿é—® IP çš„å‡ºç°æ¬¡æ•°ï¼ŒæŒ‰é¢‘ç‡æ’åº
cat access.log | awk '{print $1}' | sort | uniq -c | sort -rn
```

è¾“å‡ºï¼š
```
      3 192.168.1.100
      1 192.168.1.103
      1 192.168.1.102
      1 192.168.1.101
```

### 3.4 ç®¡é“åªä¼ é€’ stdout

**é‡è¦**ï¼šç®¡é“é»˜è®¤åªä¼ é€’ stdoutï¼Œstderr ä¼šç›´æ¥æ˜¾ç¤ºåœ¨ç»ˆç«¯ã€‚

```bash
# stderr ä¸ä¼šè¢«ä¼ é€’ç»™ grep
ls /nonexistent 2>&1 | grep "No such"
# å¦‚æœä¸åŠ  2>&1ï¼Œé”™è¯¯ä¿¡æ¯ä¸ä¼šè¢« grep å¤„ç†
```

**Bash 4+ çš„ `|&` è¯­æ³•**ï¼š

```bash
# |& ç­‰åŒäº 2>&1 |
ls /nonexistent |& grep "No such"
```

---

## Step 4 â€” teeï¼šåˆ†æµè¾“å‡ºï¼ˆ10 åˆ†é’Ÿï¼‰

### 4.1 tee çš„ä½œç”¨

`tee` åƒç®¡é“ä¸­çš„ T å‹æ¥å¤´ï¼ŒæŠŠæ•°æ®åŒæ—¶é€å¾€æ–‡ä»¶å’Œä¸‹ä¸€ä¸ªå‘½ä»¤ã€‚

![Tee Command](images/tee-command.png)

<details>
<summary>View ASCII source</summary>

<!-- DIAGRAM: tee-command -->
```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   æ–‡ä»¶ä¿å­˜      â”‚
                    â”‚  (backup.log)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‘½ä»¤ A   â”‚â”€â”€â”€â”€â”€â–¶â”‚        tee          â”‚â”€â”€â”€â”€â”€â–¶â”‚  å‘½ä»¤ B   â”‚
â”‚          â”‚      â”‚    (T å‹åˆ†æµå™¨)      â”‚      â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
<!-- /DIAGRAM -->

</details>

### 4.2 åŸºç¡€ç”¨æ³•

```bash
# ä¿å­˜è¾“å‡ºåŒæ—¶æ˜¾ç¤ºåœ¨å±å¹•
dmesg | grep -i error | tee errors.log

# è¿½åŠ æ¨¡å¼
dmesg | grep -i warning | tee -a errors.log

# å†™å…¥å¤šä¸ªæ–‡ä»¶
echo "important data" | tee file1.txt file2.txt file3.txt
```

### 4.3 å®æˆ˜åœºæ™¯ï¼šéšœå®³å¯¾å¿œè®°å½•

åœ¨æ—¥æœ¬ IT èŒåœºï¼Œå¤„ç†æ•…éšœæ—¶éœ€è¦ä¿ç•™æ‰€æœ‰æ“ä½œè®°å½•ï¼ˆéšœå®³å¯¾å¿œè¨˜éŒ²ï¼‰ã€‚

```bash
# ä¸€è¾¹æ’æŸ¥é—®é¢˜ï¼Œä¸€è¾¹ä¿ç•™è®°å½•
tail -f /var/log/syslog | tee -a incident_$(date +%Y%m%d).log

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯ï¼Œå¯ä»¥å®æ—¶æŸ¥çœ‹è®°å½•æ–‡ä»¶
# tail -f incident_20260104.log
```

### 4.4 ç»“åˆç®¡é“ä½¿ç”¨

```bash
# ç›‘æ§æ—¥å¿—ï¼ŒåŒæ—¶ä¿å­˜é”™è¯¯è®°å½•ï¼Œå¹¶ç»Ÿè®¡æ•°é‡
tail -100 access.log | grep "500" | tee server_errors.log | wc -l
```

---

## Step 5 â€” åŠ¨æ‰‹å®éªŒï¼šæ—¥å¿—æµåˆ†ç¦»ï¼ˆ15 åˆ†é’Ÿï¼‰

> **åœºæ™¯**ï¼šä½ æ˜¯è¿ç»´å·¥ç¨‹å¸ˆï¼Œéœ€è¦ç›‘æ§ Web æœåŠ¡å™¨æ—¥å¿—ã€‚  
> è¦æ±‚ï¼šå®æ—¶æŸ¥çœ‹é”™è¯¯ï¼ŒåŒæ—¶ä¿å­˜å®Œæ•´è®°å½•ã€‚  

### 5.1 å‡†å¤‡æ¨¡æ‹Ÿç¯å¢ƒ

```bash
cd ~/text-processing-lab

# åˆ›å»ºæ¨¡æ‹Ÿçš„åº”ç”¨ç¨‹åºï¼ˆåŒæ—¶äº§ç”Ÿ stdout å’Œ stderrï¼‰
cat > simulate_app.sh << 'EOF'
#!/bin/bash
for i in {1..10}; do
    if [ $((i % 3)) -eq 0 ]; then
        echo "[ERROR] Something went wrong at iteration $i" >&2
    else
        echo "[INFO] Processing iteration $i"
    fi
    sleep 0.5
done
echo "[INFO] Done"
EOF
chmod +x simulate_app.sh
```

### 5.2 ä»»åŠ¡ 1ï¼šåˆ†ç¦»æ­£å¸¸è¾“å‡ºå’Œé”™è¯¯

```bash
# è¿è¡Œæ¨¡æ‹Ÿç¨‹åºï¼Œstdout å’Œ stderr åˆ†åˆ«ä¿å­˜
./simulate_app.sh > info.log 2> error.log

# æ£€æŸ¥ç»“æœ
echo "=== INFO LOG ==="
cat info.log

echo "=== ERROR LOG ==="
cat error.log
```

### 5.3 ä»»åŠ¡ 2ï¼šå®æ—¶ç›‘æ§ + ä¿å­˜è®°å½•

```bash
# åˆå¹¶è¾“å‡ºï¼ŒåŒæ—¶æ˜¾ç¤ºåœ¨å±å¹•å’Œä¿å­˜åˆ°æ–‡ä»¶
./simulate_app.sh 2>&1 | tee combined.log

# æ£€æŸ¥ä¿å­˜çš„è®°å½•
cat combined.log
```

### 5.4 ä»»åŠ¡ 3ï¼šæ„å»ºè¿‡æ»¤ç®¡é“

```bash
# åªä¿å­˜é”™è¯¯ï¼Œä½†æ˜¾ç¤ºæ‰€æœ‰å†…å®¹
./simulate_app.sh 2>&1 | tee >(grep ERROR > errors_only.log)

# ä¸Šé¢ç”¨äº†è¿›ç¨‹æ›¿æ¢ >()ï¼Œå¦‚æœä¸æ”¯æŒï¼Œç”¨è¿™ä¸ªæ–¹æ³•ï¼š
./simulate_app.sh 2>&1 | tee full.log | grep ERROR > errors_only.log
```

### 5.5 æ£€æŸ¥æ¸…å•

å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼š

- [ ] stdout å’Œ stderr åˆ†åˆ«ä¿å­˜åˆ°ä¸åŒæ–‡ä»¶
- [ ] ä½¿ç”¨ tee åŒæ—¶æ˜¾ç¤ºå’Œä¿å­˜è¾“å‡º
- [ ] æ„å»ºç®¡é“æå–ç‰¹å®šå†…å®¹

---

## åæ¨¡å¼ï¼šå¸¸è§é”™è¯¯

### é”™è¯¯ 1ï¼šé‡å®šå‘é¡ºåºé”™è¯¯

```bash
# é”™è¯¯ï¼š2>&1 æ”¾åœ¨ > å‰é¢
command 2>&1 > output.log
# stderr å»äº†ç»ˆç«¯ï¼Œåªæœ‰ stdout è¿›äº†æ–‡ä»¶

# æ­£ç¡®ï¼šå…ˆå®šå‘ stdoutï¼Œå†åˆå¹¶ stderr
command > output.log 2>&1
```

**åŸå› **ï¼šé‡å®šå‘æ˜¯ä»å·¦åˆ°å³å¤„ç†çš„ã€‚`2>&1` çš„æ„æ€æ˜¯"æŠŠ stderr é€åˆ° stdout å½“å‰æŒ‡å‘çš„åœ°æ–¹"ã€‚

### é”™è¯¯ 2ï¼šä¸å°å¿ƒæ··åˆ stdout å’Œ stderr

```bash
# å±é™©ï¼šé”™è¯¯ä¿¡æ¯æ··å…¥æ­£å¸¸æ•°æ®
ls /home /nonexistent 2>&1 | grep "home"
# å¯èƒ½åŒ¹é…åˆ°é”™è¯¯ä¿¡æ¯é‡Œçš„å†…å®¹

# æ›´å®‰å…¨ï¼šæ˜ç¡®ä¸¢å¼ƒé”™è¯¯
ls /home /nonexistent 2>/dev/null | grep "home"

# æˆ–è€…ï¼šæ˜ç¡®éœ€è¦å¤„ç†é”™è¯¯
ls /home /nonexistent 2>&1 | grep -v "No such"
```

### é”™è¯¯ 3ï¼šè¦†ç›–é‡è¦æ–‡ä»¶

```bash
# å±é™©ï¼è¿™ä¼šæ¸…ç©º important.log
command > important.log

# å®‰å…¨åšæ³•ï¼šå…ˆæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
[ -f important.log ] && echo "è­¦å‘Šï¼šæ–‡ä»¶å·²å­˜åœ¨"

# æˆ–ä½¿ç”¨ noclobber é€‰é¡¹
set -o noclobber    # å¯ç”¨ä¿æŠ¤
command > important.log    # å¦‚æœæ–‡ä»¶å­˜åœ¨ä¼šæŠ¥é”™
set +o noclobber    # å…³é—­ä¿æŠ¤
```

---

## èŒåœºå°è´´å£«ï¼ˆJapan IT Contextï¼‰

### è¿ç»´ç›‘æ§ï¼ˆé‹ç”¨ç›£è¦–ï¼‰ä¸­çš„åº”ç”¨

åœ¨æ—¥æœ¬ IT å…¬å¸çš„è¿ç»´ç°åœºï¼Œä»¥ä¸‹åœºæ™¯éå¸¸å¸¸è§ï¼š

| æ—¥è¯­æœ¯è¯­ | å«ä¹‰ | ç®¡é“åº”ç”¨ |
|----------|------|----------|
| æ¨™æº–å‡ºåŠ›ï¼ˆã²ã‚‡ã†ã˜ã‚…ã‚“ã—ã‚…ã¤ã‚Šã‚‡ãï¼‰ | stdout | æ­£å¸¸çš„å‘½ä»¤è¾“å‡º |
| æ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ› | stderr | é”™è¯¯å’Œè­¦å‘Šä¿¡æ¯ |
| ãƒ­ã‚°ç›£è¦– | æ—¥å¿—ç›‘æ§ | `tail -f log \| grep ERROR` |
| éšœå®³å¯¾å¿œ | æ•…éšœå¤„ç† | `tee` ä¿å­˜æ“ä½œè®°å½• |

### å®é™…åœºæ™¯

**å¤œç­ç›‘æ§ï¼ˆå¤œå‹¤ï¼‰**ï¼š

```bash
# å¤œå‹¤æ‹…å½“è€…å¸¸ç”¨ï¼šå®æ—¶ç›‘æ§ + è®°å½•
tail -f /var/log/messages | tee -a shift_$(date +%Y%m%d).log | grep -i error
```

**æ•…éšœæŠ¥å‘Šï¼ˆéšœå®³å ±å‘Šæ›¸ï¼‰**ï¼š

å¤„ç†æ•…éšœåéœ€è¦æäº¤æŠ¥å‘Šï¼Œæ“ä½œè®°å½•éå¸¸é‡è¦ï¼š

```bash
# æ‰€æœ‰æ’æŸ¥å‘½ä»¤çš„è¾“å‡ºéƒ½ä¿å­˜
{
    echo "=== è°ƒæŸ¥å¼€å§‹ $(date) ==="
    df -h
    free -m
    ps aux | head -20
    echo "=== è°ƒæŸ¥ç»“æŸ $(date) ==="
} | tee investigation_$(date +%Y%m%d_%H%M%S).log
```

---

## æ£€æŸ¥æ¸…å•

å®Œæˆæœ¬è¯¾åï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

- [ ] è§£é‡Š stdinã€stdoutã€stderr çš„åŒºåˆ«
- [ ] ä½¿ç”¨ `>` å’Œ `>>` æŠŠè¾“å‡ºä¿å­˜åˆ°æ–‡ä»¶
- [ ] ä½¿ç”¨ `2>` å•ç‹¬å¤„ç†é”™è¯¯è¾“å‡º
- [ ] ä½¿ç”¨ `2>&1` æˆ– `&>` åˆå¹¶è¾“å‡ºæµ
- [ ] ä½¿ç”¨ `|` è¿æ¥å¤šä¸ªå‘½ä»¤
- [ ] ä½¿ç”¨ `tee` åˆ†æµæ•°æ®åˆ°æ–‡ä»¶å’Œç®¡é“
- [ ] é¿å…é‡å®šå‘é¡ºåºé”™è¯¯

---

## æœ¬è¯¾å°ç»“

| æ¦‚å¿µ | è¯­æ³• | è®°å¿†ç‚¹ |
|------|------|--------|
| æ ‡å‡†æµ | fd 0, 1, 2 | è¾“å…¥ã€è¾“å‡ºã€é”™è¯¯ |
| è¦†ç›–å†™å…¥ | `>` | ä¼šæ¸…ç©ºåŸæ–‡ä»¶ |
| è¿½åŠ å†™å…¥ | `>>` | ä¿ç•™åŸå†…å®¹ |
| é”™è¯¯é‡å®šå‘ | `2>` | æ•°å­— 2 ä»£è¡¨ stderr |
| åˆå¹¶è¾“å‡º | `2>&1` æˆ– `&>` | stderr è·Ÿéš stdout |
| ç®¡é“ | `\|` | stdout â†’ stdin |
| åˆ†æµ | `tee` | åŒæ—¶è¾“å‡ºåˆ°æ–‡ä»¶å’Œç®¡é“ |

---

## å»¶ä¼¸é˜…è¯»

- [Bash Manual - Redirections](https://www.gnu.org/software/bash/manual/html_node/Redirections.html)
- ä¸‹ä¸€è¯¾ï¼š[02 Â· æŸ¥çœ‹å’Œæµå¼å¤„ç†æ–‡ä»¶](../02-viewing-files/) â€” å­¦ä¹  catã€lessã€tail -f
- ç›¸å…³è¯¾ç¨‹ï¼š[LX04 Â· Shell è„šæœ¬ç¼–ç¨‹](../../lx04-shell-scripting/) â€” åœ¨è„šæœ¬ä¸­ä½¿ç”¨é‡å®šå‘

---

## ç³»åˆ—å¯¼èˆª

[ç³»åˆ—é¦–é¡µ](../) | [02 Â· æŸ¥çœ‹å’Œæµå¼å¤„ç†æ–‡ä»¶ â†’](../02-viewing-files/)
