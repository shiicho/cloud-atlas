# 08 - æ’åºã€å»é‡å’Œå­—æ®µæå–

> **ç›®æ ‡**ï¼šæŒæ¡ sortã€uniqã€cut å‘½ä»¤ï¼Œå®ç°æ—¥å¿—é¢‘ç‡åˆ†æå’Œè¶‹åŠ¿è¯†åˆ«  
> **å‰ç½®**ï¼šå·²å®Œæˆ [07 - awk ç¨‹åºå’Œèšåˆ](../07-awk-programs/)  
> **æ—¶é—´**ï¼šâš¡ 20 åˆ†é’Ÿï¼ˆé€Ÿè¯»ï¼‰/ ğŸ”¬ 75 åˆ†é’Ÿï¼ˆå®Œæ•´å®æ“ï¼‰  
> **å®æˆ˜é¡¹ç›®**ï¼šé¢‘ç‡åˆ†æ - æ‰¾å‡º Top é”™è¯¯ã€æœ€æ´»è·ƒ IPã€é‡å¤é—®é¢˜  

---

## å…ˆè·‘èµ·æ¥ï¼ˆ5 åˆ†é’Ÿï¼‰

> åœ¨å­¦ä¹ ç†è®ºä¹‹å‰ï¼Œå…ˆä½“éªŒè¿™äº›å·¥å…·ç»„åˆçš„å¨åŠ›ï¼  

### åˆ›å»ºç»ƒä¹ ç¯å¢ƒ

```bash
# åˆ›å»ºç»ƒä¹ ç›®å½•
mkdir -p ~/sort-lab && cd ~/sort-lab

# åˆ›å»ºæ¨¡æ‹Ÿè®¿é—®æ—¥å¿—
cat > access.log << 'EOF'
192.168.1.100 GET /api/users 200 45ms
10.0.0.50 POST /api/login 200 120ms
192.168.1.100 GET /api/orders 500 2300ms
172.16.0.25 GET /api/products 200 89ms
10.0.0.50 GET /api/users 200 52ms
192.168.1.100 GET /api/orders 504 30000ms
192.168.1.101 GET /health 200 5ms
10.0.0.50 POST /api/login 401 35ms
192.168.1.100 GET /api/users 200 48ms
172.16.0.25 GET /api/products 200 91ms
10.0.0.50 GET /api/orders 200 156ms
192.168.1.100 GET /api/orders 200 145ms
10.0.0.50 POST /api/login 200 118ms
192.168.1.101 GET /health 200 6ms
192.168.1.100 GET /api/users 500 1500ms
EOF

# åˆ›å»ºé”™è¯¯æ—¥å¿—
cat > errors.log << 'EOF'
2026-01-04 09:00:01 ERROR Database connection timeout
2026-01-04 09:01:15 ERROR Authentication failed
2026-01-04 09:02:30 ERROR Database connection timeout
2026-01-04 09:03:45 ERROR File not found: /tmp/cache
2026-01-04 09:05:00 ERROR Database connection timeout
2026-01-04 09:06:22 ERROR Authentication failed
2026-01-04 09:07:33 ERROR Memory allocation failed
2026-01-04 09:08:10 ERROR Database connection timeout
2026-01-04 09:09:55 ERROR File not found: /tmp/cache
2026-01-04 09:10:30 ERROR Database connection timeout
EOF
```

### ç«‹å³ä½“éªŒ

```bash
cd ~/sort-lab

# é­”æ³• 1: æ‰¾å‡ºæœ€æ´»è·ƒçš„ IPï¼ˆè¯·æ±‚æœ€å¤šçš„å‰ 3 ä¸ªï¼‰
cut -d' ' -f1 access.log | sort | uniq -c | sort -rn | head -3

# é­”æ³• 2: æ‰¾å‡ºæœ€å¸¸è§çš„é”™è¯¯ç±»å‹
cut -d' ' -f5- errors.log | sort | uniq -c | sort -rn

# é­”æ³• 3: æ‰¾å‡ºæœ‰å¤šå°‘ä¸ªä¸åŒçš„ IP è®¿é—®è¿‡
cut -d' ' -f1 access.log | sort -u | wc -l

# é­”æ³• 4: æŒ‰å“åº”æ—¶é—´æ’åºï¼Œæ‰¾å‡ºæœ€æ…¢çš„è¯·æ±‚
sort -t' ' -k5 -h access.log | tail -3
```

**è§‚å¯Ÿè¾“å‡º**ï¼š

```
# æœ€æ´»è·ƒ IP:
      6 192.168.1.100
      5 10.0.0.50
      2 172.16.0.25

# æœ€å¸¸è§é”™è¯¯:
      5 Database connection timeout
      2 Authentication failed
      2 File not found: /tmp/cache
      1 Memory allocation failed

# ä¸åŒ IP æ•°é‡:
4

# æœ€æ…¢è¯·æ±‚:
192.168.1.100 GET /api/users 500 1500ms
192.168.1.100 GET /api/orders 500 2300ms
192.168.1.100 GET /api/orders 504 30000ms
```

ä½ åˆšåˆšå®Œæˆäº†æ—¥å¿—é¢‘ç‡åˆ†æï¼è¿™æ˜¯è¿ç»´ç›‘æ§ï¼ˆé‹ç”¨ç›£è¦–ï¼‰å’Œæ•…éšœè¶‹åŠ¿åˆ†æï¼ˆéšœå®³å‚¾å‘åˆ†æï¼‰çš„æ ¸å¿ƒæŠ€èƒ½ã€‚

---

## æ ¸å¿ƒæ¦‚å¿µ

### ä¸ºä»€ä¹ˆéœ€è¦è¿™äº›å·¥å…·ï¼Ÿ

åœ¨æ—¥å¿—åˆ†æä¸­ï¼Œæœ€å¸¸è§çš„é—®é¢˜æ˜¯ï¼š

- å“ªä¸ª IP è¯·æ±‚æœ€å¤šï¼Ÿï¼ˆå¯èƒ½æ˜¯æ”»å‡»æˆ–å¼‚å¸¸ï¼‰
- å“ªç§é”™è¯¯å‡ºç°æœ€é¢‘ç¹ï¼Ÿï¼ˆéœ€è¦ä¼˜å…ˆä¿®å¤ï¼‰
- æœ‰å¤šå°‘ä¸åŒçš„ç”¨æˆ·/IP/é”™è¯¯ç±»å‹ï¼Ÿ

è¿™äº›é—®é¢˜éƒ½éœ€è¦ **æ’åº** å’Œ **å»é‡** æ“ä½œã€‚

![sort-uniq-pipeline](images/sort-uniq-pipeline.png)

<details>
<summary>View ASCII source</summary>

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŸå§‹æ•°æ®    â”‚â”€â”€â”€â”€â–¶â”‚    sort     â”‚â”€â”€â”€â”€â–¶â”‚    uniq     â”‚
â”‚  (æœªæ’åº)    â”‚     â”‚  (æ’åº)     â”‚     â”‚  (å»é‡è®¡æ•°)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   head/tail â”‚â—€â”€â”€â”€â”€â”‚  sort -rn   â”‚
                    â”‚  (å– Top N) â”‚     â”‚  (æŒ‰æ•°é‡æ’åº)â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

</details>

---

## sort å‘½ä»¤è¯¦è§£

### åŸºæœ¬ç”¨æ³•

```bash
sort file           # æŒ‰å­—æ¯é¡ºåºæ’åº
sort -n file        # æŒ‰æ•°å­—æ’åº
sort -r file        # é€†åº
sort -u file        # æ’åºå¹¶å»é‡ï¼ˆç­‰äº sort | uniqï¼‰
```

### å¸¸ç”¨é€‰é¡¹

| é€‰é¡¹ | å«ä¹‰ | ç¤ºä¾‹ |
|------|------|------|
| `-n` | æ•°å­—æ’åº | `sort -n numbers.txt` |
| `-r` | é€†åºï¼ˆä»å¤§åˆ°å°ï¼‰ | `sort -rn numbers.txt` |
| `-k N` | æŒ‰ç¬¬ N ä¸ªå­—æ®µæ’åº | `sort -k2 data.txt` |
| `-t 'X'` | æŒ‡å®šåˆ†éš”ç¬¦ä¸º X | `sort -t',' -k2 data.csv` |
| `-u` | å»é‡ï¼ˆuniqueï¼‰ | `sort -u file` |
| `-h` | äººç±»å¯è¯»æ•°å­—ï¼ˆ1K, 2Mï¼‰ | `sort -h sizes.txt` |

### å®é™…æ¼”ç¤º

```bash
cd ~/sort-lab

# åˆ›å»ºæµ‹è¯•æ•°æ®
cat > numbers.txt << 'EOF'
10
2
100
25
5
EOF

# å­—æ¯æ’åº vs æ•°å­—æ’åº
echo "=== å­—æ¯æ’åºï¼ˆé”™è¯¯ï¼ï¼‰==="
sort numbers.txt
# è¾“å‡º: 10, 100, 2, 25, 5  (æŒ‰å­—ç¬¦æ¯”è¾ƒï¼š'1' < '2')

echo "=== æ•°å­—æ’åºï¼ˆæ­£ç¡®ï¼ï¼‰==="
sort -n numbers.txt
# è¾“å‡º: 2, 5, 10, 25, 100
```

> **é‡è¦**ï¼šå¤„ç†æ•°å­—æ—¶ä¸€å®šè¦åŠ  `-n`ï¼Œå¦åˆ™ "10" ä¼šæ’åœ¨ "2" å‰é¢ï¼  

### æŒ‰å­—æ®µæ’åº

```bash
cd ~/sort-lab

# æŒ‰ç¬¬ 5 åˆ—ï¼ˆå“åº”æ—¶é—´ï¼‰æ’åº
sort -k5 access.log

# æŒ‰ç¬¬ 4 åˆ—ï¼ˆçŠ¶æ€ç ï¼‰æ•°å­—æ’åº
sort -t' ' -k4 -n access.log

# åªæŒ‰çŠ¶æ€ç æ’åºï¼ˆä¸åŒ…å«åç»­å­—æ®µï¼‰
sort -t' ' -k4,4 -n access.log
```

### sort -k çš„é™·é˜±

```bash
# åˆ›å»ºæµ‹è¯•æ•°æ®
cat > scores.txt << 'EOF'
Alice 85 90
Bob 90 75
Carol 85 95
EOF

# é”™è¯¯ç”¨æ³•ï¼šsort -k2 ä¼šä»ç¬¬ 2 å­—æ®µæ’åˆ°è¡Œå°¾
sort -k2 scores.txt
# Alice å’Œ Carol éƒ½æ˜¯ 85ï¼Œä½†åé¢çš„æ•°å­—ä¹Ÿå‚ä¸æ¯”è¾ƒ

# æ­£ç¡®ç”¨æ³•ï¼šsort -k2,2 åªæŒ‰ç¬¬ 2 å­—æ®µ
sort -k2,2 -n scores.txt
```

> **å…³é”®**ï¼š`-k2` æ„æ€æ˜¯ã€Œä»ç¬¬ 2 å­—æ®µåˆ°è¡Œå°¾ã€ï¼Œ`-k2,2` æ‰æ˜¯ã€ŒåªæŒ‰ç¬¬ 2 å­—æ®µã€ã€‚  

### äººç±»å¯è¯»æ•°å­—æ’åº

```bash
# åˆ›å»ºæ–‡ä»¶å¤§å°æ•°æ®
cat > sizes.txt << 'EOF'
512K
2M
100K
1G
50M
EOF

# æ™®é€šæ•°å­—æ’åºï¼ˆé”™è¯¯ï¼ï¼‰
sort -n sizes.txt
# ä¸èƒ½æ­£ç¡®å¤„ç† K, M, G

# äººç±»å¯è¯»æ’åºï¼ˆæ­£ç¡®ï¼ï¼‰
sort -h sizes.txt
# è¾“å‡º: 100K, 512K, 2M, 50M, 1G
```

---

## uniq å‘½ä»¤è¯¦è§£

### æ ¸å¿ƒåŸåˆ™ï¼ˆæœ€é‡è¦ï¼ï¼‰

> **uniq åªèƒ½å»é™¤ç›¸é‚»çš„é‡å¤è¡Œï¼** è¿™æ˜¯æœ€å¸¸è§çš„é”™è¯¯ã€‚  

```bash
cd ~/sort-lab

# åˆ›å»ºæµ‹è¯•æ•°æ®
cat > colors.txt << 'EOF'
red
blue
red
green
blue
red
EOF

# é”™è¯¯ç”¨æ³•ï¼šç›´æ¥ uniq
echo "=== ç›´æ¥ uniqï¼ˆé”™è¯¯ï¼ï¼‰==="
uniq colors.txt
# è¾“å‡º: red, blue, red, green, blue, red
# æ²¡æœ‰å»é‡ï¼å› ä¸ºé‡å¤çš„è¡Œä¸ç›¸é‚»

# æ­£ç¡®ç”¨æ³•ï¼šå…ˆ sort å† uniq
echo "=== sort | uniqï¼ˆæ­£ç¡®ï¼ï¼‰==="
sort colors.txt | uniq
# è¾“å‡º: blue, green, red
```

![uniq-adjacent-only](images/uniq-adjacent-only.png)

<details>
<summary>View ASCII source</summary>

```
åŸå§‹æ–‡ä»¶:           ç›´æ¥ uniq:          sort | uniq:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  red    â”‚        â”‚  red    â”‚  â”€â”€â”€â”€â”€â–¶ â”‚  blue   â”‚
â”‚  blue   â”‚  â”€â”€â”€â”€â–¶ â”‚  blue   â”‚         â”‚  green  â”‚
â”‚  red    â”‚        â”‚  red    â”‚ ç›¸é‚»    â”‚  red    â”‚
â”‚  green  â”‚        â”‚  green  â”‚ æ‰å»é‡   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  blue   â”‚        â”‚  blue   â”‚
â”‚  red    â”‚        â”‚  red    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   æ²¡æœ‰æ•ˆæœï¼
```

</details>

### å¸¸ç”¨é€‰é¡¹

| é€‰é¡¹ | å«ä¹‰ | ç”¨é€” |
|------|------|------|
| `-c` | ç»Ÿè®¡æ¯è¡Œå‡ºç°æ¬¡æ•° | é¢‘ç‡åˆ†æ |
| `-d` | åªæ˜¾ç¤ºé‡å¤çš„è¡Œ | æ‰¾é‡å¤é¡¹ |
| `-u` | åªæ˜¾ç¤ºä¸é‡å¤çš„è¡Œ | æ‰¾å”¯ä¸€é¡¹ |

### é¢‘ç‡åˆ†ææ ‡å‡†æ¨¡å¼

```bash
# ç»Ÿè®¡é¢‘ç‡çš„æ ‡å‡†ç®¡é“
sort file | uniq -c | sort -rn | head -10
```

è¿™ä¸ªæ¨¡å¼çš„å«ä¹‰ï¼š
1. `sort` - æŠŠç›¸åŒçš„è¡Œæ’åœ¨ä¸€èµ·
2. `uniq -c` - ç»Ÿè®¡æ¯è¡Œå‡ºç°æ¬¡æ•°
3. `sort -rn` - æŒ‰æ•°é‡ä»å¤§åˆ°å°æ’åº
4. `head -10` - å–å‰ 10 ä¸ª

```bash
cd ~/sort-lab

# ç»Ÿè®¡ IP å‡ºç°é¢‘ç‡
cut -d' ' -f1 access.log | sort | uniq -c | sort -rn

# è¾“å‡º:
#       6 192.168.1.100
#       5 10.0.0.50
#       2 172.16.0.25
#       2 192.168.1.101
```

### uniq -d å’Œ uniq -u

```bash
# å‡†å¤‡æ•°æ®
cat > users.txt << 'EOF'
alice
bob
alice
carol
bob
bob
EOF

# æ‰¾å‡ºé‡å¤çš„ç”¨æˆ·ï¼ˆå‡ºç° 2 æ¬¡ä»¥ä¸Šï¼‰
sort users.txt | uniq -d
# è¾“å‡º: alice, bob

# æ‰¾å‡ºåªå‡ºç°ä¸€æ¬¡çš„ç”¨æˆ·
sort users.txt | uniq -u
# è¾“å‡º: carol

# ç»Ÿè®¡é‡å¤ç”¨æˆ·çš„å‡ºç°æ¬¡æ•°
sort users.txt | uniq -dc
# è¾“å‡º:
#       2 alice
#       3 bob
```

---

## cut å‘½ä»¤è¯¦è§£

### åŸºæœ¬ç”¨æ³•

```bash
cut -d'åˆ†éš”ç¬¦' -få­—æ®µå· file
cut -cå­—ç¬¦ä½ç½® file
```

### å¸¸ç”¨é€‰é¡¹

| é€‰é¡¹ | å«ä¹‰ | ç¤ºä¾‹ |
|------|------|------|
| `-d ','` | æŒ‡å®šåˆ†éš”ç¬¦ä¸ºé€—å· | `cut -d',' -f1 data.csv` |
| `-f1` | å–ç¬¬ 1 ä¸ªå­—æ®µ | `cut -d' ' -f1 file` |
| `-f1,3` | å–ç¬¬ 1 å’Œç¬¬ 3 ä¸ªå­—æ®µ | `cut -d' ' -f1,3 file` |
| `-f1-3` | å–ç¬¬ 1 åˆ°ç¬¬ 3 ä¸ªå­—æ®µ | `cut -d' ' -f1-3 file` |
| `-c1-10` | å–ç¬¬ 1-10 ä¸ªå­—ç¬¦ | `cut -c1-10 file` |

### å®é™…æ¼”ç¤º

```bash
cd ~/sort-lab

# ä»è®¿é—®æ—¥å¿—æå– IP
cut -d' ' -f1 access.log

# æå– IP å’ŒçŠ¶æ€ç 
cut -d' ' -f1,4 access.log

# ä» /etc/passwd æå–ç”¨æˆ·å
cut -d':' -f1 /etc/passwd | head -5

# æå–ç”¨æˆ·åå’Œ shell
cut -d':' -f1,7 /etc/passwd | head -5
```

### cut çš„å±€é™æ€§

> **cut ä¸èƒ½å¤„ç†å¯å˜å®½åº¦çš„ç©ºç™½åˆ†éš”ç¬¦ï¼**  

```bash
# åˆ›å»ºæœ‰å¤šä¸ªç©ºæ ¼çš„æ•°æ®
cat > spaces.txt << 'EOF'
Alice    85
Bob      90
Carol    95
EOF

# cut æŠŠæ¯ä¸ªç©ºæ ¼éƒ½å½“ä½œåˆ†éš”ç¬¦ï¼ˆé”™è¯¯ï¼ï¼‰
cut -d' ' -f2 spaces.txt
# è¾“å‡º: ç©ºï¼ˆå› ä¸ºç¬¬ 2 ä¸ª"å­—æ®µ"æ˜¯ç©ºæ ¼ï¼‰

# æ­£ç¡®åšæ³•ï¼šä½¿ç”¨ awk
awk '{print $2}' spaces.txt
# è¾“å‡º: 85, 90, 95
```

> **è§„åˆ™**ï¼šå›ºå®šåˆ†éš”ç¬¦ï¼ˆå¦‚ `:`, `,`, `|`ï¼‰ç”¨ cutï¼Œå¯å˜ç©ºç™½ç”¨ awkã€‚  

---

## paste å’Œ joinï¼šæ–‡ä»¶åˆå¹¶

### paste - å¹¶åˆ—åˆå¹¶

```bash
cd ~/sort-lab

# åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶
cat > names.txt << 'EOF'
Alice
Bob
Carol
EOF

cat > scores.txt << 'EOF'
85
90
95
EOF

# å¹¶åˆ—åˆå¹¶ï¼ˆé»˜è®¤ç”¨ Tab åˆ†éš”ï¼‰
paste names.txt scores.txt
# è¾“å‡º:
# Alice   85
# Bob     90
# Carol   95

# ä½¿ç”¨è‡ªå®šä¹‰åˆ†éš”ç¬¦
paste -d',' names.txt scores.txt
# è¾“å‡º:
# Alice,85
# Bob,90
# Carol,95
```

### join - SQL é£æ ¼çš„è¿æ¥

```bash
cd ~/sort-lab

# åˆ›å»ºä¸¤ä¸ªæœ‰å…³è”é”®çš„æ–‡ä»¶ï¼ˆå¿…é¡»å·²æ’åºï¼ï¼‰
cat > users.txt << 'EOF'
001 Alice
002 Bob
003 Carol
EOF

cat > orders.txt << 'EOF'
001 Order-A
001 Order-B
002 Order-C
EOF

# join é»˜è®¤æŒ‰ç¬¬ä¸€ä¸ªå­—æ®µè¿æ¥
join users.txt orders.txt
# è¾“å‡º:
# 001 Alice Order-A
# 001 Alice Order-B
# 002 Bob Order-C
```

> **æ³¨æ„**ï¼šjoin è¦æ±‚ä¸¤ä¸ªæ–‡ä»¶éƒ½æŒ‰è¿æ¥å­—æ®µæ’åºï¼  

---

## å®æˆ˜é¡¹ç›®ï¼šæ—¥å¿—é¢‘ç‡åˆ†æ

### åœºæ™¯

> ä½ æ˜¯è¿ç»´å·¥ç¨‹å¸ˆï¼Œéœ€è¦ä»ä¸€å‘¨çš„æ—¥å¿—ä¸­åˆ†æï¼š  
> 1. æœ€æ´»è·ƒçš„ IPï¼ˆå¯èƒ½æ˜¯çˆ¬è™«æˆ–æ”»å‡»ï¼‰  
> 2. æœ€å¸¸è§çš„é”™è¯¯ç±»å‹ï¼ˆéœ€è¦ä¼˜å…ˆä¿®å¤ï¼‰  
> 3. é«˜å³°æ—¶æ®µï¼ˆæŒ‰å°æ—¶ç»Ÿè®¡è¯·æ±‚é‡ï¼‰  

### å‡†å¤‡æ•°æ®

```bash
cd ~/sort-lab

# åˆ›å»ºæ›´å¤§çš„æµ‹è¯•æ—¥å¿—
cat > week.log << 'EOF'
2026-01-04 08:15:22 192.168.1.100 GET /api/users 200
2026-01-04 08:15:25 10.0.0.50 GET /api/products 200
2026-01-04 08:16:01 192.168.1.100 POST /api/orders 500
2026-01-04 08:16:15 192.168.1.100 GET /api/users 200
2026-01-04 09:00:01 172.16.0.25 GET /health 200
2026-01-04 09:00:05 192.168.1.100 GET /api/orders 200
2026-01-04 09:15:30 10.0.0.50 POST /api/login 401
2026-01-04 09:20:45 192.168.1.101 GET /api/products 200
2026-01-04 10:00:01 192.168.1.100 GET /api/users 504
2026-01-04 10:05:22 10.0.0.50 GET /api/orders 200
2026-01-04 10:10:33 192.168.1.100 GET /api/users 500
2026-01-04 10:15:44 172.16.0.25 GET /api/products 200
2026-01-04 11:00:01 192.168.1.100 POST /api/orders 200
2026-01-04 11:05:15 10.0.0.50 GET /api/users 200
2026-01-04 11:10:30 192.168.1.101 GET /health 200
EOF
```

### ä»»åŠ¡ 1ï¼šæ‰¾å‡ºæœ€æ´»è·ƒçš„ IP

```bash
# æå– IPï¼ˆç¬¬ 3 å­—æ®µï¼‰â†’ æ’åº â†’ ç»Ÿè®¡ â†’ æŒ‰æ•°é‡æ’åº
cut -d' ' -f3 week.log | sort | uniq -c | sort -rn | head -5

# è¾“å‡º:
#       7 192.168.1.100
#       4 10.0.0.50
#       2 172.16.0.25
#       2 192.168.1.101
```

**åˆ†æ**ï¼š192.168.1.100 è¯·æ±‚é‡æœ€å¤§ï¼Œéœ€è¦ç¡®è®¤æ˜¯å¦æ­£å¸¸ã€‚

### ä»»åŠ¡ 2ï¼šæ‰¾å‡ºæœ€å¸¸è§çš„ HTTP é”™è¯¯

```bash
# å…ˆç­›é€‰å‡ºé”™è¯¯ï¼ˆ4xx, 5xxï¼‰ï¼Œå†ç»Ÿè®¡
grep -E ' [45][0-9]{2}$' week.log | cut -d' ' -f6 | sort | uniq -c | sort -rn

# è¾“å‡º:
#       2 500
#       1 504
#       1 401
```

**åˆ†æ**ï¼š500 é”™è¯¯æœ€å¤šï¼Œéœ€è¦æ£€æŸ¥æœåŠ¡ç«¯é—®é¢˜ã€‚

### ä»»åŠ¡ 3ï¼šæŒ‰å°æ—¶ç»Ÿè®¡è¯·æ±‚é‡

```bash
# æå–å°æ—¶éƒ¨åˆ†ï¼ˆç¬¬ 2 å­—æ®µçš„å‰ 2 ä¸ªå­—ç¬¦ï¼‰
cut -d' ' -f2 week.log | cut -c1-2 | sort | uniq -c | sort -k2 -n

# è¾“å‡º:
#       4 08
#       3 09
#       4 10
#       4 11
```

æˆ–è€…ä½¿ç”¨ awk æ›´çµæ´»ï¼š

```bash
awk '{split($2,t,":"); print t[1]}' week.log | sort | uniq -c | sort -k2 -n
```

### ä»»åŠ¡ 4ï¼šæ‰¾å‡ºæœ‰é”™è¯¯çš„ IP

```bash
# å…ˆç­›é€‰é”™è¯¯è¯·æ±‚ï¼Œå†ç»Ÿè®¡ IP
grep -E ' [45][0-9]{2}$' week.log | cut -d' ' -f3 | sort | uniq -c | sort -rn

# è¾“å‡º:
#       3 192.168.1.100
#       1 10.0.0.50
```

**åˆ†æ**ï¼š192.168.1.100 äº§ç”Ÿäº†æœ€å¤šçš„é”™è¯¯ï¼Œéœ€è¦è°ƒæŸ¥ã€‚

### ç»¼åˆåˆ†æè„šæœ¬

```bash
cat > ~/sort-lab/analyze.sh << 'EOF'
#!/bin/bash
# æ—¥å¿—é¢‘ç‡åˆ†æè„šæœ¬ - Log Frequency Analyzer

LOG_FILE="${1:-week.log}"

if [[ ! -f "$LOG_FILE" ]]; then
    echo "Error: File $LOG_FILE not found"
    exit 1
fi

echo "========================================"
echo "æ—¥å¿—é¢‘ç‡åˆ†ææŠ¥å‘Š"
echo "Log Frequency Analysis Report"
echo "æ–‡ä»¶: $LOG_FILE"
echo "========================================"
echo ""

echo "ã€æœ€æ´»è·ƒ IP Top 5ã€‘"
echo "Top 5 Most Active IPs:"
cut -d' ' -f3 "$LOG_FILE" | sort | uniq -c | sort -rn | head -5
echo ""

echo "ã€HTTP çŠ¶æ€ç åˆ†å¸ƒã€‘"
echo "HTTP Status Code Distribution:"
cut -d' ' -f6 "$LOG_FILE" | sort | uniq -c | sort -rn
echo ""

echo "ã€äº§ç”Ÿé”™è¯¯çš„ IPã€‘"
echo "IPs with Errors (4xx/5xx):"
grep -E ' [45][0-9]{2}$' "$LOG_FILE" | cut -d' ' -f3 | sort | uniq -c | sort -rn
echo ""

echo "ã€è®¿é—®æœ€å¤šçš„æ¥å£ã€‘"
echo "Most Accessed Endpoints:"
cut -d' ' -f5 "$LOG_FILE" | sort | uniq -c | sort -rn | head -5
echo ""

echo "ã€ä¸åŒ IP æ€»æ•°ã€‘"
echo "Total Unique IPs:"
cut -d' ' -f3 "$LOG_FILE" | sort -u | wc -l
EOF

chmod +x ~/sort-lab/analyze.sh
```

è¿è¡Œåˆ†æï¼š

```bash
cd ~/sort-lab
./analyze.sh week.log
```

---

## èŒåœºå°è´´å£«

### æ—¥æœ¬ IT ç°åœºæœ¯è¯­

| æ—¥æœ¬èª | ä¸­æ–‡ | åœºæ™¯ |
|--------|------|------|
| ã‚½ãƒ¼ãƒˆ | æ’åº | ãƒ‡ãƒ¼ã‚¿ã‚’ã‚½ãƒ¼ãƒˆã™ã‚‹ |
| é‡è¤‡æ’é™¤ï¼ˆã¡ã‚‡ã†ãµãã¯ã„ã˜ã‚‡ï¼‰ | å»é‡ | é‡è¤‡ãƒ‡ãƒ¼ã‚¿ã‚’æ’é™¤ã™ã‚‹ |
| é »åº¦åˆ†æï¼ˆã²ã‚“ã©ã¶ã‚“ã›ãï¼‰ | é¢‘ç‡åˆ†æ | ã‚¨ãƒ©ãƒ¼ã®é »åº¦ã‚’åˆ†æ |
| éšœå®³å‚¾å‘åˆ†æ | æ•…éšœè¶‹åŠ¿åˆ†æ | é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ |
| é›†è¨ˆï¼ˆã—ã‚…ã†ã‘ã„ï¼‰ | ç»Ÿè®¡/æ±‡æ€» | ãƒ­ã‚°é›†è¨ˆ |

### è¿ç»´ä¸­çš„å…¸å‹åœºæ™¯

**1. æ¯æ—¥é”™è¯¯ç»Ÿè®¡æŠ¥å‘Š**

```bash
# åœ¨æ—¥æœ¬ IT å…¬å¸ï¼Œæ¯æ—¥/æ¯å‘¨æŠ¥å‘Šï¼ˆæ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ/é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆï¼‰æ˜¯å¸¸è§ä»»åŠ¡
grep 'ERROR' /var/log/app/app.log | \
  awk '{print $4}' | \         # æå–é”™è¯¯ç±»å‹
  sort | uniq -c | sort -rn | \
  head -10 > /tmp/daily_errors.txt
```

**2. å¼‚å¸¸è®¿é—®æ£€æµ‹**

```bash
# æ‰¾å‡ºè¯·æ±‚é‡è¶…è¿‡ 1000 çš„ IPï¼ˆå¯èƒ½æ˜¯çˆ¬è™«æˆ–æ”»å‡»ï¼‰
cut -d' ' -f1 /var/log/nginx/access.log | \
  sort | uniq -c | sort -rn | \
  awk '$1 > 1000 {print}'
```

**3. æ•…éšœæ—¶é—´çº¿åˆ†æ**

```bash
# éšœå®³ç™ºç”Ÿæ™‚ï¼šæ‰¾å‡ºæ•…éšœå‰åçš„è¯·æ±‚æ¨¡å¼
grep '2026-01-04 09:' /var/log/app/app.log | \
  cut -d' ' -f1-2 | \
  sort | uniq -c
```

---

## åé¢æ¨¡å¼ï¼ˆAnti-Patternsï¼‰

### 1. uniq ä¸åŠ  sortï¼ˆæœ€å¸¸è§é”™è¯¯ï¼ï¼‰

```bash
# é”™è¯¯ï¼uniq åªå»é™¤ç›¸é‚»é‡å¤
uniq file.txt

# æ­£ç¡®
sort file.txt | uniq
```

### 2. sort -k ä¸æŒ‡å®šç»“æŸå­—æ®µ

```bash
# é”™è¯¯ï¼ä»ç¬¬ 2 å­—æ®µæ’åˆ°è¡Œå°¾
sort -k2 file.txt

# æ­£ç¡®ï¼åªæŒ‰ç¬¬ 2 å­—æ®µ
sort -k2,2 file.txt
```

### 3. ç”¨ cut å¤„ç†å¯å˜ç©ºç™½

```bash
# é”™è¯¯ï¼cut ä¸èƒ½å¤„ç†å¤šä¸ªç©ºæ ¼
cut -d' ' -f2 file.txt

# æ­£ç¡®ï¼ç”¨ awk
awk '{print $2}' file.txt
```

### 4. æ•°å­—æ’åºå¿˜åŠ  -n

```bash
# é”™è¯¯ï¼10 æ’åœ¨ 2 å‰é¢
echo -e "10\n2\n5" | sort

# æ­£ç¡®
echo -e "10\n2\n5" | sort -n
```

### 5. å¿˜è®° uniq -c è¾“å‡ºçš„æ ¼å¼

```bash
# uniq -c è¾“å‡ºæ ¼å¼æ˜¯ï¼šè®¡æ•° + ç©ºæ ¼ + å†…å®¹
# å¦‚æœè¦è¿›ä¸€æ­¥å¤„ç†ï¼Œæ³¨æ„å­—æ®µä½ç½®

# å– Top 10 çš„å†…å®¹ï¼ˆä¸å«è®¡æ•°ï¼‰
sort file | uniq -c | sort -rn | head -10 | awk '{print $2}'
```

---

## åŠ¨æ‰‹ç»ƒä¹ 

### ç»ƒä¹  1ï¼šéªŒè¯ uniq çš„è¡Œä¸º

```bash
cd ~/sort-lab

# åˆ›å»ºæµ‹è¯•æ–‡ä»¶
cat > test_uniq.txt << 'EOF'
apple
banana
apple
cherry
banana
apple
EOF

# ä»»åŠ¡ï¼š
# 1. ç›´æ¥ç”¨ uniqï¼Œè§‚å¯Ÿç»“æœï¼ˆä¸ºä»€ä¹ˆæ²¡å»é‡ï¼Ÿï¼‰
uniq test_uniq.txt

# 2. ç”¨ sort | uniqï¼Œè§‚å¯Ÿç»“æœ
sort test_uniq.txt | uniq

# 3. ç»Ÿè®¡æ¯ç§æ°´æœçš„å‡ºç°æ¬¡æ•°
sort test_uniq.txt | uniq -c

# 4. æ‰¾å‡ºå‡ºç°è¶…è¿‡ 1 æ¬¡çš„æ°´æœ
sort test_uniq.txt | uniq -d

# 5. æ‰¾å‡ºåªå‡ºç° 1 æ¬¡çš„æ°´æœ
sort test_uniq.txt | uniq -u
```

### ç»ƒä¹  2ï¼šå¤šå­—æ®µæ’åº

```bash
cd ~/sort-lab

# åˆ›å»ºæˆç»©å•
cat > grades.txt << 'EOF'
Alice Math 85
Bob Math 90
Carol Math 85
Alice Science 92
Bob Science 88
Carol Science 90
EOF

# ä»»åŠ¡ï¼š
# 1. æŒ‰ç§‘ç›®æ’åºï¼ˆç¬¬ 2 å­—æ®µï¼‰
sort -k2,2 grades.txt

# 2. æŒ‰åˆ†æ•°æ•°å­—æ’åºï¼ˆç¬¬ 3 å­—æ®µï¼‰
sort -k3,3 -n grades.txt

# 3. å…ˆæŒ‰ç§‘ç›®ï¼Œå†æŒ‰åˆ†æ•°ä»é«˜åˆ°ä½
sort -k2,2 -k3,3 -rn grades.txt

# 4. æ‰¾å‡ºæ¯ä¸ªç§‘ç›®çš„æœ€é«˜åˆ†
sort -k2,2 -k3,3 -rn grades.txt | \
  awk '!seen[$2]++ {print}'
```

### ç»ƒä¹  3ï¼šå®æˆ˜æ—¥å¿—åˆ†æ

```bash
cd ~/sort-lab

# ä½¿ç”¨ä¹‹å‰åˆ›å»ºçš„ week.log
# å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼š

# 1. ç»Ÿè®¡æ¯ä¸ª HTTP æ–¹æ³•ï¼ˆGET/POSTï¼‰çš„è¯·æ±‚æ•°
cut -d' ' -f4 week.log | sort | uniq -c

# 2. æ‰¾å‡ºå“åº” 500 é”™è¯¯æœ€å¤šçš„ 3 ä¸ª IP
grep ' 500$' week.log | cut -d' ' -f3 | sort | uniq -c | sort -rn | head -3

# 3. æŒ‰æ—¥æœŸ+å°æ—¶ç»Ÿè®¡è¯·æ±‚é‡
cut -d' ' -f1-2 week.log | cut -d':' -f1 | sort | uniq -c

# 4. æ‰¾å‡ºåªå‡ºç°è¿‡ä¸€æ¬¡çš„ IPï¼ˆå¯èƒ½æ˜¯ä¸´æ—¶è®¿å®¢ï¼‰
cut -d' ' -f3 week.log | sort | uniq -u
```

---

## æ£€æŸ¥æ¸…å•

å®Œæˆæœ¬è¯¾åï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

- [ ] ç†è§£ `sort -n` å’Œ `sort` çš„åŒºåˆ«ï¼ˆæ•°å­— vs å­—æ¯æ’åºï¼‰
- [ ] ä½¿ç”¨ `sort -k` æŒ‰æŒ‡å®šå­—æ®µæ’åº
- [ ] **è®°ä½ uniq åªå»é™¤ç›¸é‚»é‡å¤ï¼Œå¿…é¡»å…ˆ sort**
- [ ] ä½¿ç”¨ `uniq -c` ç»Ÿè®¡é¢‘ç‡
- [ ] ä½¿ç”¨ `cut -d -f` æå–å­—æ®µ
- [ ] çŸ¥é“ cut ä¸èƒ½å¤„ç†å¯å˜ç©ºç™½ï¼ˆç”¨ awk ä»£æ›¿ï¼‰
- [ ] æŒæ¡æ ‡å‡†é¢‘ç‡åˆ†æç®¡é“ï¼š`sort | uniq -c | sort -rn | head`
- [ ] ä½¿ç”¨ `paste` å¹¶åˆ—åˆå¹¶æ–‡ä»¶
- [ ] ç†è§£ `sort -k2` å’Œ `sort -k2,2` çš„åŒºåˆ«

**éªŒè¯å‘½ä»¤**ï¼š

```bash
cd ~/sort-lab

# æµ‹è¯• 1: ç»Ÿè®¡ IP é¢‘ç‡
cut -d' ' -f1 access.log | sort | uniq -c | sort -rn | head -1
# é¢„æœŸ: 6 192.168.1.100

# æµ‹è¯• 2: äººç±»å¯è¯»æ’åº
echo -e "1K\n2M\n500K" | sort -h | tail -1
# é¢„æœŸ: 2M

# æµ‹è¯• 3: éªŒè¯ uniq ç›¸é‚»åŸåˆ™
echo -e "a\nb\na" | uniq | wc -l
# é¢„æœŸ: 3ï¼ˆå› ä¸ºä¸¤ä¸ª a ä¸ç›¸é‚»ï¼‰

echo -e "a\nb\na" | sort | uniq | wc -l
# é¢„æœŸ: 2ï¼ˆæ’åºåç›¸é‚»ï¼Œèƒ½å»é‡ï¼‰
```

---

## å¿«é€Ÿå‚è€ƒ

```bash
# sort å¸¸ç”¨é€‰é¡¹
sort file           # å­—æ¯æ’åº
sort -n file        # æ•°å­—æ’åº
sort -r file        # é€†åº
sort -k2,2 file     # æŒ‰ç¬¬ 2 å­—æ®µ
sort -t',' file     # æŒ‡å®šåˆ†éš”ç¬¦
sort -u file        # æ’åºå¹¶å»é‡
sort -h file        # äººç±»å¯è¯»æ•°å­—

# uniq å¸¸ç”¨é€‰é¡¹ï¼ˆå¿…é¡»å…ˆ sortï¼ï¼‰
sort file | uniq       # å»é‡
sort file | uniq -c    # ç»Ÿè®¡é¢‘ç‡
sort file | uniq -d    # åªæ˜¾ç¤ºé‡å¤çš„
sort file | uniq -u    # åªæ˜¾ç¤ºä¸é‡å¤çš„

# cut å¸¸ç”¨é€‰é¡¹
cut -d':' -f1 file     # æŒ‰ : åˆ†éš”ï¼Œå–ç¬¬ 1 å­—æ®µ
cut -d',' -f1,3 file   # å–ç¬¬ 1 å’Œç¬¬ 3 å­—æ®µ
cut -c1-10 file        # å–å‰ 10 ä¸ªå­—ç¬¦

# æ ‡å‡†é¢‘ç‡åˆ†æç®¡é“
sort file | uniq -c | sort -rn | head -10

# paste å’Œ join
paste file1 file2      # å¹¶åˆ—åˆå¹¶
join file1 file2       # SQL é£æ ¼è¿æ¥ï¼ˆéœ€è¦å…ˆæ’åºï¼‰
```

---

## å»¶ä¼¸é˜…è¯»

### å®˜æ–¹æ–‡æ¡£

- [GNU coreutils: sort](https://www.gnu.org/software/coreutils/manual/html_node/sort-invocation.html)
- [GNU coreutils: uniq](https://www.gnu.org/software/coreutils/manual/html_node/uniq-invocation.html)
- [GNU coreutils: cut](https://www.gnu.org/software/coreutils/manual/html_node/cut-invocation.html)

### ç›¸å…³è¯¾ç¨‹

- [07 - awk ç¨‹åºå’Œèšåˆ](../07-awk-programs/) - æ›´å¤æ‚çš„èšåˆåˆ†æ
- [09 - ä½¿ç”¨ find å’Œ xargs æŸ¥æ‰¾æ–‡ä»¶](../09-find-xargs/) - æ‰¹é‡å¤„ç†æ–‡ä»¶
- [10 - ç»¼åˆé¡¹ç›®ï¼šæ—¥å¿—åˆ†æç®¡é“](../10-capstone-pipeline/) - æ•´åˆæ‰€æœ‰æŠ€èƒ½

---

## æ¸…ç†

```bash
cd ~
rm -rf ~/sort-lab
```

---

## ç³»åˆ—å¯¼èˆª

| è¯¾ç¨‹ | ä¸»é¢˜ |
|------|------|
| [01 - ç®¡é“å’Œé‡å®šå‘](../01-pipes-redirection/) | stdin/stdout/stderr |
| [02 - æŸ¥çœ‹å’Œæµå¼å¤„ç†æ–‡ä»¶](../02-viewing-files/) | cat/less/head/tail |
| [03 - grep åŸºç¡€](../03-grep-fundamentals/) | æ¨¡å¼æœç´¢ |
| [04 - æ­£åˆ™è¡¨è¾¾å¼](../04-regular-expressions/) | BRE/ERE |
| [05 - sed æ–‡æœ¬è½¬æ¢](../05-sed-transformation/) | æ–‡æœ¬æ›¿æ¢ |
| [06 - awk å­—æ®µå¤„ç†](../06-awk-fields/) | å­—æ®µæå– |
| [07 - awk ç¨‹åºå’Œèšåˆ](../07-awk-programs/) | æ•°æ®åˆ†æ |
| **08 - æ’åºã€å»é‡å’Œå­—æ®µæå–** | å½“å‰è¯¾ç¨‹ |
| [09 - ä½¿ç”¨ find å’Œ xargs æŸ¥æ‰¾æ–‡ä»¶](../09-find-xargs/) | æ–‡ä»¶æŸ¥æ‰¾ |
| [10 - ç»¼åˆé¡¹ç›®ï¼šæ—¥å¿—åˆ†æç®¡é“](../10-capstone-pipeline/) | å®æˆ˜é¡¹ç›® |
