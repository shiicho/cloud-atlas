# 03 - æ–‡ä»¶ç³»ç»Ÿé€‰æ‹©ä¸åˆ›å»ºï¼ˆFilesystemsï¼‰

> **ç›®æ ‡**ï¼šç†è§£ ext4 ä¸ XFS çš„å·®å¼‚ï¼ŒæŒæ¡æ–‡ä»¶ç³»ç»Ÿåˆ›å»ºä¸ç£ç›˜åŠ å¯†åŸºç¡€  
> **å‰ç½®**ï¼šå®Œæˆ [02 - åˆ†åŒºç®¡ç†](../02-partitioning/)  
> **æ—¶é—´**ï¼šâš¡ 12 åˆ†é’Ÿï¼ˆé€Ÿè¯»ï¼‰/ ğŸ”¬ 45 åˆ†é’Ÿï¼ˆå®Œæ•´å®æ“ï¼‰  
> **ç¯å¢ƒ**ï¼šä»»æ„ Linuxï¼ˆUbuntu/RHEL/AlmaLinuxï¼‰ï¼Œéœ€è¦ root æƒé™  

---

## å°†å­¦åˆ°çš„å†…å®¹

1. ç†è§£ ext4 å’Œ XFS çš„ç‰¹æ€§å·®å¼‚
2. ä½¿ç”¨ `mkfs.ext4`ã€`mkfs.xfs` åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ
3. æŒæ¡æ–‡ä»¶ç³»ç»Ÿé€‰æ‹©å†³ç­–æ ‡å‡†
4. äº†è§£ LUKS ç£ç›˜åŠ å¯†åŸºæœ¬å·¥ä½œæµç¨‹
5. äº†è§£ io_uring ç°ä»£å¼‚æ­¥ I/Oï¼ˆæ¦‚å¿µï¼‰

---

## Step 1 - ext4 vs XFSï¼šæ ¸å¿ƒå·®å¼‚

åœ¨ä¸Šä¸€è¯¾ä¸­ï¼Œä½ å·²ç»åœ¨ç£ç›˜ä¸Šåˆ›å»ºäº†åˆ†åŒºã€‚ä½†åˆ†åŒºåªæ˜¯"ç”»å‡ºåœ°ç›˜"ï¼Œè¦å­˜æ”¾æ–‡ä»¶è¿˜éœ€è¦**æ–‡ä»¶ç³»ç»Ÿ**ï¼ˆFilesystemï¼‰ã€‚

Linux ä¸–ç•Œæœ€å¸¸ç”¨çš„ä¸¤ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼š

| ç‰¹æ€§ | ext4 | XFS |
|------|------|-----|
| **èµ·æº** | ext å®¶æ—æ¼”è¿›ï¼ˆ1992-2008ï¼‰ | SGI IRIXï¼ˆ1993ï¼‰ï¼Œ2001 è¿›å…¥ Linux |
| **è®¾è®¡ç†å¿µ** | ç¨³å®šæˆç†Ÿï¼ŒåŠŸèƒ½å…¨é¢ | é«˜æ€§èƒ½ï¼Œå¤§è§„æ¨¡å­˜å‚¨ |
| **é»˜è®¤å‘è¡Œç‰ˆ** | Ubuntuã€Debian | RHEL 7+ã€CentOSã€AlmaLinux |
| **æœ€å¤§æ–‡ä»¶ç³»ç»Ÿ** | 1 EiB | 8 EiB |
| **åœ¨çº¿æ‰©å±•** | æ”¯æŒ | æ”¯æŒ |
| **åœ¨çº¿æ”¶ç¼©** | æ”¯æŒï¼ˆéœ€å¸è½½ï¼‰ | **ä¸æ”¯æŒ** |
| **fsck é€Ÿåº¦** | å¿«ï¼ˆå°åˆ†åŒºï¼‰ | ä¾èµ–æ—¥å¿—å›æ”¾ |
| **å¤§æ–‡ä»¶æ€§èƒ½** | è‰¯å¥½ | **ä¼˜ç§€**ï¼ˆAllocation Groupsï¼‰ |
| **å¹¶è¡Œ I/O** | ä¸€èˆ¬ | **ä¼˜ç§€** |
| **reflinkï¼ˆCoWï¼‰** | ä¸æ”¯æŒ | æ”¯æŒ |

### å…³é”®å†³ç­–ç‚¹

**é€‰æ‹© ext4 çš„åœºæ™¯ï¼š**
- ç³»ç»Ÿç›˜ï¼ˆ`/`ã€`/boot`ï¼‰
- éœ€è¦æ”¶ç¼©åˆ†åŒºçš„å¯èƒ½æ€§
- é€šç”¨ç”¨é€”æœåŠ¡å™¨
- å°æ–‡ä»¶å¯†é›†å‹å·¥ä½œè´Ÿè½½

**é€‰æ‹© XFS çš„åœºæ™¯ï¼š**
- å¤§æ–‡ä»¶å­˜å‚¨ï¼ˆæ•°æ®åº“ã€åª’ä½“æ–‡ä»¶ï¼‰
- é«˜ååé‡éœ€æ±‚
- RHEL/CentOS/AlmaLinux é»˜è®¤
- å®¹å™¨å­˜å‚¨ï¼ˆéœ€ `ftype=1`ï¼‰

> **æ ¸å¿ƒè®°å¿†ç‚¹**ï¼šXFS ä¸èƒ½æ”¶ç¼©ï¼é€‰æ‹© XFS å°±è¦åšå¥½"åªå¢ä¸å‡"çš„å‡†å¤‡ã€‚  

---

## Step 2 - åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ

### 2.1 åˆ›å»º ext4 æ–‡ä»¶ç³»ç»Ÿ

```bash
# åœ¨åˆ†åŒºä¸Šåˆ›å»º ext4
sudo mkfs.ext4 /dev/sdb1

# å¸¦æ ‡ç­¾åˆ›å»ºï¼ˆæ¨èï¼‰
sudo mkfs.ext4 -L data_ext4 /dev/sdb1
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
mke2fs 1.46.5 (30-Dec-2021)
Creating filesystem with 2621440 4k blocks and 655360 inodes
Filesystem UUID: a1b2c3d4-e5f6-7890-abcd-ef1234567890
Superblock backups stored on blocks:
        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632

Allocating group tables: done
Writing inode tables: done
Creating journal (16384 blocks): done
Writing superblocks and filesystem accounting information: done
```

### 2.2 åˆ›å»º XFS æ–‡ä»¶ç³»ç»Ÿ

```bash
# åœ¨åˆ†åŒºä¸Šåˆ›å»º XFS
sudo mkfs.xfs /dev/sdb2

# å¸¦æ ‡ç­¾åˆ›å»º
sudo mkfs.xfs -L data_xfs /dev/sdb2

# Docker/å®¹å™¨ç¯å¢ƒï¼ˆç¡®ä¿ ftype=1ï¼‰
sudo mkfs.xfs -n ftype=1 /dev/sdb2
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
meta-data=/dev/sdb2              isize=512    agcount=4, agsize=655360 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=1, sparse=1, rmapbt=0
         =                       reflink=1    bigtime=1 inobtcount=1 nrext64=0
data     =                       bsize=4096   blocks=2621440, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0, ftype=1
log      =internal log           bsize=4096   blocks=16384, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
```

> **æ³¨æ„ `ftype=1`**ï¼šDocker overlay2 éœ€è¦æ­¤é€‰é¡¹ï¼Œç°ä»£ xfsprogs é»˜è®¤å¯ç”¨ã€‚  

---

## Step 3 - æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿå‚æ•°

åˆ›å»ºå®Œæˆåï¼Œå¦‚ä½•ç¡®è®¤å’ŒæŸ¥çœ‹å‚æ•°ï¼Ÿ

### 3.1 ext4 å‚æ•°æŸ¥çœ‹

```bash
# æŸ¥çœ‹ ext4 è¯¦ç»†ä¿¡æ¯
sudo tune2fs -l /dev/sdb1
```

å…³é”®è¾“å‡ºå­—æ®µï¼š

```
Filesystem volume name:   data_ext4
Filesystem UUID:          a1b2c3d4-e5f6-7890-abcd-ef1234567890
Filesystem features:      has_journal ext_attr resize_inode dir_index
Inode count:              655360
Block count:              2621440
Reserved block count:     131072    # 5% ä¿ç•™ç»™ root
Block size:               4096
```

```bash
# ä¿®æ”¹ä¿ç•™å—æ¯”ä¾‹ï¼ˆé»˜è®¤ 5%ï¼Œæ•°æ®ç›˜å¯è®¾ 0ï¼‰
sudo tune2fs -m 1 /dev/sdb1    # æ”¹ä¸º 1%
```

### 3.2 XFS å‚æ•°æŸ¥çœ‹

```bash
# æŸ¥çœ‹ XFS ä¿¡æ¯ï¼ˆéœ€è¦æŒ‚è½½åæ‰§è¡Œï¼‰
sudo mount /dev/sdb2 /mnt
xfs_info /mnt
```

å…³é”®è¾“å‡ºå­—æ®µï¼š

```
meta-data=/dev/sdb2              isize=512    agcount=4, agsize=655360 blks
data     =                       bsize=4096   blocks=2621440
naming   =version 2              bsize=4096   ascii-ci=0, ftype=1
log      =internal               bsize=4096   blocks=16384
```

```bash
# æ£€æŸ¥ reflink æ”¯æŒ
xfs_info /mnt | grep reflink
# reflink=1 è¡¨ç¤ºæ”¯æŒ
```

---

## Step 4 - LUKS ç£ç›˜åŠ å¯†

### 4.1 ä»€ä¹ˆæ˜¯ LUKSï¼Ÿ

**LUKS**ï¼ˆLinux Unified Key Setupï¼‰æ˜¯ Linux æ ‡å‡†çš„ç£ç›˜åŠ å¯†æ–¹æ¡ˆï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å­˜å‚¨æ¶æ„å¯¹æ¯”                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  æ™®é€šåˆ†åŒº:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚ /dev/sdb1   â”‚â”€â”€â”€â”€â–¶â”‚ æ–‡ä»¶ç³»ç»Ÿ     â”‚â”€â”€â”€â”€â–¶ æŒ‚è½½ç‚¹            â”‚
â”‚  â”‚ (åˆ†åŒº)      â”‚     â”‚ (ext4/XFS)  â”‚      (/data)           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                             â”‚
â”‚  LUKS åŠ å¯†åˆ†åŒº:                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ /dev/sdb1   â”‚â”€â”€â”€â”€â–¶â”‚    LUKS     â”‚â”€â”€â”€â”€â–¶â”‚ /dev/mapper â”‚    â”‚
â”‚  â”‚ (åˆ†åŒº)      â”‚     â”‚  (åŠ å¯†å±‚)    â”‚     â”‚ /data_crypt â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                  â”‚          â”‚
â”‚                                          â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚                                          â”‚ æ–‡ä»¶ç³»ç»Ÿ     â”‚    â”‚
â”‚                                          â”‚ (ext4/XFS)  â”‚    â”‚
â”‚                                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                  â”‚          â”‚
â”‚                                              æŒ‚è½½ç‚¹          â”‚
â”‚                                              (/data)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 LUKS åŸºæœ¬å·¥ä½œæµç¨‹

```bash
# 1. åˆå§‹åŒ– LUKS åŠ å¯†ï¼ˆä¼šé”€æ¯åˆ†åŒºæ•°æ®ï¼ï¼‰
sudo cryptsetup luksFormat /dev/sdb1

# è¾“å…¥ YESï¼ˆå¤§å†™ï¼‰ç¡®è®¤ï¼Œç„¶åè®¾ç½®å¯†ç 

# 2. æ‰“å¼€ï¼ˆè§£é”ï¼‰åŠ å¯†åˆ†åŒº
sudo cryptsetup luksOpen /dev/sdb1 data_crypt

# 3. åœ¨è§£å¯†åçš„è®¾å¤‡ä¸Šåˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ
sudo mkfs.ext4 /dev/mapper/data_crypt

# 4. æŒ‚è½½ä½¿ç”¨
sudo mount /dev/mapper/data_crypt /data

# 5. ä½¿ç”¨å®Œæ¯•åå…³é—­
sudo umount /data
sudo cryptsetup luksClose data_crypt
```

### 4.3 æ¶æ„é€‰æ‹©ï¼šLVM on LUKS vs LUKS on LVM

| æ¶æ„ | æè¿° | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|------|
| **LVM on LUKS** | å…ˆåŠ å¯†ï¼Œå† LVM | ä¸€ä¸ªå¯†ç è§£é”æ‰€æœ‰ LV | å…¨åŠ å¯†æˆ–å…¨ä¸åŠ å¯† |
| **LUKS on LVM** | å…ˆ LVMï¼Œå†åŠ å¯† | å¯é€‰æ‹©æ€§åŠ å¯† LV | å¤šå¯†ç ç®¡ç† |

**ç”Ÿäº§æ¨è**ï¼šLVM on LUKSï¼ˆç®¡ç†ç®€å•ï¼Œå®‰å…¨æ€§ä¸€è‡´ï¼‰

### 4.4 å¼€æœºè‡ªåŠ¨è§£é”ï¼ˆcrypttabï¼‰

```bash
# /etc/crypttab é…ç½®ç¤ºä¾‹
# <name>         <device>                      <keyfile>      <options>
data_crypt      UUID=xxxxx-xxxxx-xxxxx-xxxxx   /root/keyfile  luks
```

> **å®‰å…¨æç¤º**ï¼šå¯†é’¥æ–‡ä»¶éœ€è¦ä¸¥æ ¼ä¿æŠ¤æƒé™ï¼ˆ`chmod 400`ï¼‰ï¼Œå¹¶ä¸”åªæœ‰ root å¯è¯»ã€‚  

---

## åŠ¨æ‰‹å®éªŒï¼šåˆ›å»ºåŠ å¯†åˆ†åŒº

ä½¿ç”¨ loop è®¾å¤‡å®‰å…¨ç»ƒä¹  LUKSï¼š

```bash
# åˆ›å»º 100MB è™šæ‹Ÿç£ç›˜
fallocate -l 100M /tmp/luks_test.img
sudo losetup /dev/loop10 /tmp/luks_test.img

# åˆå§‹åŒ– LUKS
sudo cryptsetup luksFormat /dev/loop10
# è¾“å…¥ YESï¼Œè®¾ç½®å¯†ç 

# æ‰“å¼€åŠ å¯†è®¾å¤‡
sudo cryptsetup luksOpen /dev/loop10 test_crypt

# åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿå¹¶æŒ‚è½½
sudo mkfs.ext4 /dev/mapper/test_crypt
sudo mkdir -p /mnt/encrypted
sudo mount /dev/mapper/test_crypt /mnt/encrypted

# å†™å…¥æµ‹è¯•æ–‡ä»¶
echo "Secret data" | sudo tee /mnt/encrypted/secret.txt

# æ¸…ç†
sudo umount /mnt/encrypted
sudo cryptsetup luksClose test_crypt
sudo losetup -d /dev/loop10
rm /tmp/luks_test.img
```

---

## Sidebar: io_uring ç°ä»£å¼‚æ­¥ I/O

> **è¦†ç›–çº§åˆ«**ï¼šäº†è§£å³å¯ï¼ˆAwareness Onlyï¼‰  

**io_uring** æ˜¯ Linux 5.1+ å¼•å…¥çš„æ–°å¼‚æ­¥ I/O æ¥å£ï¼š

- ä¼ ç»Ÿ I/Oï¼ˆread/write/epollï¼‰æ¯æ¬¡æ“ä½œéœ€è¦ç³»ç»Ÿè°ƒç”¨
- io_uring é€šè¿‡å…±äº«å†…å­˜ ring buffer å‡å°‘å†…æ ¸åˆ‡æ¢
- é«˜ IOPS åœºæ™¯æ€§èƒ½æå‡æ˜¾è‘—

**ä½œä¸ºå­˜å‚¨ç®¡ç†å‘˜éœ€è¦çŸ¥é“ï¼š**

| åœºæ™¯ | ç›¸å…³æ€§ |
|------|--------|
| é«˜æ€§èƒ½æ•°æ®åº“ | PostgreSQL 16+ å¯èƒ½å¯ç”¨ io_uring |
| æ€§èƒ½æµ‹è¯• | fio æ”¯æŒ io_uring å¼•æ“ |
| å†…æ ¸ç‰ˆæœ¬ | æŸäº›åŠŸèƒ½éœ€è¦ 5.x ä»¥ä¸Šå†…æ ¸ |

```bash
# æ£€æŸ¥ io_uring æ˜¯å¦è¢«ç¦ç”¨ï¼ˆæŸäº›å®‰å…¨åŠ å›ºä¼šç¦ç”¨ï¼‰
cat /proc/sys/kernel/io_uring_disabled
# 0 = å¯ç”¨, 1 = ç¦ç”¨
```

> **æ·±å…¥å­¦ä¹ **ï¼šio_uring çš„è¯¦ç»†å†…å®¹å°†åœ¨ LX09-PERFORMANCE è¯¾ç¨‹ä¸­è®¨è®ºã€‚  

---

## å†³ç­–æŒ‡å—

```
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚        é€‰æ‹©å“ªä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Ÿ                 â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚      å¯èƒ½éœ€è¦æ”¶ç¼©åˆ†åŒºå—ï¼Ÿ               â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚                    â”‚
                            æ˜¯                    å¦
                              â”‚                    â”‚
                              â–¼                    â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ ext4  â”‚     â”‚ å¤§æ–‡ä»¶ï¼ˆ>100MBï¼‰ä¸ºä¸»ï¼Ÿâ”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚         â”‚
                                            æ˜¯         å¦
                                              â”‚         â”‚
                                              â–¼         â–¼
                                          â”Œâ”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                          â”‚ XFS â”‚   â”‚ éœ€è¦å¹¶è¡Œ I/Oï¼Ÿ    â”‚
                                          â””â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚         â”‚
                                                      æ˜¯         å¦
                                                        â”‚         â”‚
                                                        â–¼         â–¼
                                                    â”Œâ”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”
                                                    â”‚ XFS â”‚   â”‚ éƒ½å¯ä»¥â”‚
                                                    â””â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¿«é€Ÿé€‰æ‹©è¡¨

| ä½¿ç”¨åœºæ™¯ | æ¨è | ç†ç”± |
|----------|------|------|
| ç³»ç»Ÿæ ¹åˆ†åŒº | ext4 | ç¨³å®šã€å¯æ”¶ç¼© |
| æ•°æ®åº“å­˜å‚¨ | XFS | å¤§æ–‡ä»¶ã€å¹¶è¡Œ I/O |
| Web æœåŠ¡å™¨ | ext4 | å°æ–‡ä»¶å¤š |
| æ—¥å¿—æœåŠ¡å™¨ | ext4 | æ—¥å¿—è½®è½¬ã€å°æ–‡ä»¶ |
| åª’ä½“å­˜å‚¨ | XFS | å¤§æ–‡ä»¶æ€§èƒ½ |
| RHEL é»˜è®¤ | XFS | å‘è¡Œç‰ˆæ ‡å‡† |
| éœ€è¦åŠ å¯† | ä»»æ„ + LUKS | å—è®¾å¤‡çº§åŠ å¯† |

---

## æœ¬è¯¾å°ç»“

| ä½ å­¦åˆ°çš„ | å‘½ä»¤/æ¦‚å¿µ |
|----------|-----------|
| åˆ›å»º ext4 | `mkfs.ext4 -L label /dev/sdX` |
| åˆ›å»º XFS | `mkfs.xfs -L label /dev/sdX` |
| æŸ¥çœ‹ ext4 å‚æ•° | `tune2fs -l /dev/sdX` |
| æŸ¥çœ‹ XFS å‚æ•° | `xfs_info /mount/point` |
| LUKS åˆå§‹åŒ– | `cryptsetup luksFormat /dev/sdX` |
| LUKS è§£é” | `cryptsetup luksOpen /dev/sdX name` |
| LUKS é”å®š | `cryptsetup luksClose name` |
| æ ¸å¿ƒå·®å¼‚ | XFS ä¸èƒ½æ”¶ç¼©ï¼Œext4 å¯ä»¥ |

---

## ä¸‹ä¸€æ­¥

æ–‡ä»¶ç³»ç»Ÿåˆ›å»ºå¥½äº†ï¼Œä½†è¿˜æ²¡æœ‰"æŒ‚è½½"åˆ°ç³»ç»Ÿç›®å½•æ ‘ã€‚ä¸‹ä¸€è¯¾æˆ‘ä»¬å°†å­¦ä¹ æŒ‚è½½æ“ä½œå’Œ fstab é…ç½®â€”â€”è¿™æ˜¯æœ€å®¹æ˜“å¯¼è‡´æœåŠ¡å™¨æ— æ³•å¯åŠ¨çš„é…ç½®æ–‡ä»¶ã€‚

-> [04 - æŒ‚è½½ä¸ fstab](../04-mounting-fstab/)

---

## èŒåœºå°è´´å£«

### æ—¥æœ¬ IT è¿ç»´åœºæ™¯

**ä¸ªäººæƒ…å ±ä¿è­·æ³•ã¨æš—å·åŒ–**

æ—¥æœ¬çš„ã€Šä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ã€‹ï¼ˆå€‹äººæƒ…å ±ä¿è­·æ³•ï¼‰å¯¹æ•°æ®ä¿æŠ¤æœ‰ä¸¥æ ¼è¦æ±‚ã€‚åœ¨ä»¥ä¸‹åœºæ™¯ï¼Œç£ç›˜åŠ å¯†æ˜¯å¿…è¦æˆ–æ¨èçš„ï¼š

- **ãƒãƒ¼ãƒˆ PC**ï¼ˆç¬”è®°æœ¬ç”µè„‘ï¼‰ï¼šå¿…é¡»åŠ å¯†
- **ãƒªãƒ ãƒ¼ãƒãƒ–ãƒ«ãƒ¡ãƒ‡ã‚£ã‚¢**ï¼ˆç§»åŠ¨å­˜å‚¨ï¼‰ï¼šUSB é©±åŠ¨å™¨ã€å¤–æ¥ç¡¬ç›˜
- **ã‚¯ãƒ©ã‚¦ãƒ‰ãƒœãƒªãƒ¥ãƒ¼ãƒ **ï¼šæ•æ„Ÿæ•°æ®æ‰€åœ¨çš„äº‘å­˜å‚¨å·

> é¢è¯•æ—¶æåˆ° LUKS ç»éªŒä¼šæ˜¯åŠ åˆ†é¡¹ï¼Œè¡¨æ˜ä½ ç†è§£æ—¥æœ¬ä¼ä¸šçš„åˆè§„éœ€æ±‚ã€‚  

---

## é¢è¯•å‡†å¤‡ï¼ˆInterview Prepï¼‰

**Q: ext4 ã¨ XFS ã®é•ã„ã¯ä½•ã§ã™ã‹ï¼Ÿ**

A: ä¸»ãªé•ã„ã¯ï¼š
- ext4 ã¯ç¸®å°å¯èƒ½ã€XFS ã¯æ‹¡å¼µã®ã¿
- XFS ã¯å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ã¨ä¸¦åˆ— I/O ã«å„ªã‚Œã‚‹
- RHEL ç³»ã¯ XFS ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã€Ubuntu ç³»ã¯ ext4 ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ

**Q: ãªãœ RHEL ã¯ XFS ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ**

A: ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºç’°å¢ƒã§ã¯å¤§å®¹é‡ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¨é«˜ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆãŒæ±‚ã‚ã‚‰ã‚Œã‚‹ãŸã‚ã€‚XFS ã® Allocation Group ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŒãƒãƒ«ãƒã‚³ã‚¢ç’°å¢ƒã§æœ‰åˆ©ã§ã™ã€‚

**Q: LUKS ã«ã¤ã„ã¦èª¬æ˜ã—ã¦ãã ã•ã„ã€‚**

A: LUKS ã¯ Linux æ¨™æº–ã®ãƒ‡ã‚£ã‚¹ã‚¯æš—å·åŒ–æ–¹å¼ã§ã™ã€‚dm-crypt ã®ä¸Šã«éµç®¡ç†å±¤ã‚’æä¾›ã—ã€ãƒ–ãƒ­ãƒƒã‚¯ãƒ‡ãƒã‚¤ã‚¹ãƒ¬ãƒ™ãƒ«ã§æš—å·åŒ–ã—ã¾ã™ã€‚å€‹äººæƒ…å ±ä¿è­·æ³•å¯¾å¿œã§ãƒãƒ¼ãƒˆ PC ã‚„ãƒªãƒ ãƒ¼ãƒãƒ–ãƒ«ãƒ¡ãƒ‡ã‚£ã‚¢ã®æš—å·åŒ–ã«ä½¿ã‚ã‚Œã¾ã™ã€‚

---

## æ£€æŸ¥æ¸…å•

åœ¨ç»§ç»­ä¸‹ä¸€è¯¾ä¹‹å‰ï¼Œç¡®è®¤ä½ èƒ½ï¼š

- [ ] è§£é‡Š ext4 å’Œ XFS çš„ä¸»è¦å·®å¼‚
- [ ] ä½¿ç”¨ `mkfs.ext4` å’Œ `mkfs.xfs` åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ
- [ ] ä½¿ç”¨ `tune2fs` æŸ¥çœ‹/ä¿®æ”¹ ext4 å‚æ•°
- [ ] ä½¿ç”¨ `xfs_info` æŸ¥çœ‹ XFS å‚æ•°
- [ ] æè¿° LUKS åŠ å¯†çš„åŸºæœ¬å·¥ä½œæµç¨‹
- [ ] æ ¹æ®ä½¿ç”¨åœºæ™¯é€‰æ‹©åˆé€‚çš„æ–‡ä»¶ç³»ç»Ÿ

---

## å»¶ä¼¸é˜…è¯»

- [Red Hat - Managing File Systems (RHEL 9)](https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html/managing_file_systems/)
- [Arch Wiki - ext4](https://wiki.archlinux.org/title/Ext4)
- [Arch Wiki - XFS](https://wiki.archlinux.org/title/XFS)
- [Arch Wiki - LUKS](https://wiki.archlinux.org/title/dm-crypt/Encrypting_an_entire_system)

---

## ç³»åˆ—å¯¼èˆª

<- [02 - åˆ†åŒºç®¡ç†](../02-partitioning/) | [è¯¾ç¨‹é¦–é¡µ](../) | [04 - æŒ‚è½½ä¸ fstab ->](../04-mounting-fstab/)
