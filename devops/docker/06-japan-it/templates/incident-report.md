# 障害報告書 (Incident Report)

> コンテナ障害発生時の報告テンプレート

---

## 基本情報

| 項目 | 内容 |
|------|------|
| 報告書番号 | INC-YYYYMMDD-XXX |
| 作成日 | YYYY-MM-DD |
| 作成者 | |
| 承認者 | |

---

## 障害概要

| 項目 | 内容 |
|------|------|
| 障害発生日時 | YYYY-MM-DD HH:MM:SS JST |
| 障害検知日時 | YYYY-MM-DD HH:MM:SS JST |
| 復旧完了日時 | YYYY-MM-DD HH:MM:SS JST |
| 障害時間 | XX 時間 XX 分 |
| 重要度 | [ ] Critical [ ] Major [ ] Minor [ ] Warning |
| 影響サービス | |
| 影響ユーザー数 | |

---

## 障害内容

### 事象

> 発生した事象を具体的に記載

```
（例）Web サービスのコンテナが OOM Kill により停止し、
ユーザーからのリクエストに応答できない状態となった。
```

### 検知方法

- [ ] 監視アラート（Zabbix / Datadog / etc.）
- [ ] ユーザー報告
- [ ] 定期点検
- [ ] その他：

### 影響範囲

| 影響 | 詳細 |
|------|------|
| サービス影響 | |
| データ影響 | |
| 業務影響 | |

---

## 原因分析

### 直接原因

> 障害の直接的な原因

```
（例）アプリケーションのメモリリークにより、
コンテナのメモリ使用量が制限値（512MB）を超過し、
OOM Kill が発生した。
```

### 根本原因

> 障害が発生した根本的な原因

```
（例）
1. メモリリークを検知する監視が不足していた
2. コンテナのメモリ制限が適切に設定されていなかった
3. 負荷テストでメモリ使用量の検証が不十分だった
```

---

## 対応内容

### 時系列

| 時刻 | 対応者 | 対応内容 |
|------|--------|---------|
| HH:MM | | Zabbix アラート受信 |
| HH:MM | | 状況確認開始 |
| HH:MM | | docker logs で原因調査 |
| HH:MM | | コンテナ再起動 |
| HH:MM | | サービス復旧確認 |
| HH:MM | | 監視強化、メモリ制限変更 |

### 実施コマンド

```bash
# 状況確認
docker ps -a | grep web-server
docker logs web-server --tail 100
docker inspect web-server --format '{{.State.OOMKilled}}'

# 対応
docker rm web-server
docker run -d --name web-server \
  --memory=1g \
  --memory-swap=1g \
  myapp:latest

# 復旧確認
docker ps | grep web-server
curl http://localhost/health
```

---

## 再発防止策

### 短期対策（実施済み）

| No. | 対策内容 | 実施日 | 担当者 |
|----|---------|--------|--------|
| 1 | メモリ制限を 512MB → 1GB に変更 | | |
| 2 | メモリ使用量の監視閾値を追加（70%） | | |
| 3 | | | |

### 中長期対策（計画）

| No. | 対策内容 | 予定日 | 担当者 | チケット |
|----|---------|--------|--------|---------|
| 1 | アプリケーションのメモリリーク修正 | | | |
| 2 | 負荷テスト項目にメモリ使用量を追加 | | | |
| 3 | コンテナリソース設計基準の見直し | | | |

---

## 参考情報

### 関連ログ

```
# docker logs 抜粋
2026-01-03T10:30:00.000Z [ERROR] Out of memory
2026-01-03T10:30:00.001Z Container killed by OOM
```

### 関連メトリクス

| メトリクス | 障害発生前 | 障害発生時 | 復旧後 |
|----------|----------|----------|--------|
| CPU 使用率 | 30% | 95% | 25% |
| メモリ使用量 | 400MB | 512MB (上限) | 350MB |
| レスポンスタイム | 200ms | Timeout | 180ms |

### 添付資料

- [ ] 監視アラートのスクリーンショット
- [ ] Grafana ダッシュボードのスクリーンショット
- [ ] 詳細ログファイル
- [ ] 対応時のコマンド履歴

---

## 承認

| 役職 | 氏名 | 日付 | 承認 |
|------|------|------|------|
| 担当者 | | | [ ] |
| チームリード | | | [ ] |
| インフラ責任者 | | | [ ] |

---

## 変更履歴

| 版 | 日付 | 変更者 | 変更内容 |
|----|------|--------|---------|
| 1.0 | YYYY-MM-DD | | 初版作成 |
| | | | |

---

*本テンプレートは cloud-atlas Docker 運用ガイドに基づいています。*
