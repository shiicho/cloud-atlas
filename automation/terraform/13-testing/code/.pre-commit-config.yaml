# =============================================================================
# Pre-commit Configuration for Terraform
# =============================================================================
#
# This configuration defines quality checks that run before every git commit.
# Install: pip install pre-commit && pre-commit install
# Run manually: pre-commit run --all-files
#
# =============================================================================

repos:
  # ---------------------------------------------------------------------------
  # Terraform formatting and validation
  # ---------------------------------------------------------------------------
  - repo: https://github.com/antonbabenko/pre-commit-terraform
    rev: v1.104.0
    hooks:
      # Format check (auto-fix)
      # Automatically fixes formatting issues
      - id: terraform_fmt

      # Syntax and reference validation
      # Checks for syntax errors and invalid references
      - id: terraform_validate
        args:
          - --hook-config=--retry-once-with-cleanup=true

      # Linting rules
      # Provider-specific best practices
      - id: terraform_tflint
        args:
          - --args=--config=__GIT_WORKING_DIR__/.tflint.hcl

      # Security scanning (optional but recommended)
      # Scans for security issues using Trivy (tfsec successor)
      - id: terraform_trivy
        args:
          - --args=--severity HIGH,CRITICAL

      # Documentation generation (optional)
      # Auto-generates README from terraform-docs
      - id: terraform_docs
        args:
          - --hook-config=--path-to-file=README.md
          - --hook-config=--add-to-existing-file=true
          - --hook-config=--create-file-if-not-exist=true

  # ---------------------------------------------------------------------------
  # General code quality
  # ---------------------------------------------------------------------------
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      # Remove trailing whitespace
      - id: trailing-whitespace

      # Ensure files end with newline
      - id: end-of-file-fixer

      # Validate YAML syntax
      - id: check-yaml

      # Prevent large file commits
      - id: check-added-large-files
        args: ['--maxkb=500']

      # Detect AWS credentials
      - id: detect-aws-credentials
        args: ['--allow-missing-credentials']

      # Detect private keys
      - id: detect-private-key
